<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Quantum Fourier Transformation and Phase Estimation · Documentation | Yao</title><script data-outdated-warner src="../../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.044/juliamono.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script><link href="../../../assets/indigo.css" rel="stylesheet" type="text/css"/><link href="https://yaoquantum.org/assets/favicon-light.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../index.html"><img src="../../../assets/logo.png" alt="Documentation | Yao logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../../index.html">Documentation | Yao</a></span></div><form class="docs-search" action="../../../search.html"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../../index.html">Home</a></li><li><a class="tocitem" href="../../../quick-start.html">Quick Start</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../../../man/registers.html">Quantum Registers</a></li><li><a class="tocitem" href="../../../man/blocks.html">Blocks</a></li><li><a class="tocitem" href="../../../man/symbolic.html">Symbolic Computation</a></li><li><a class="tocitem" href="../../../man/automatic_differentiation.html">Automatic Differentiation</a></li><li><a class="tocitem" href="../../../man/simplification.html">Simplification</a></li><li><a class="tocitem" href="../../../man/bitbasis.html">BitBasis</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../1.prepare-ghz-state/index.html">Prepare Greenberger–Horne–Zeilinger state with Quantum Circuit</a></li><li class="is-active"><a class="tocitem" href="index.html">Quantum Fourier Transformation and Phase Estimation</a><ul class="internal"><li><a class="tocitem" href="#Quantum-Fourier-Transformation"><span>Quantum Fourier Transformation</span></a></li><li><a class="tocitem" href="#Wrap-QFT-to-an-external-block"><span>Wrap QFT to an external block</span></a></li><li><a class="tocitem" href="#Phase-Estimation"><span>Phase Estimation</span></a></li></ul></li><li><a class="tocitem" href="../3.grover-search/index.html">Grover Search</a></li><li><a class="tocitem" href="../4.shor-algorithm/index.html">Shor&#39;s Algorithm</a></li><li><a class="tocitem" href="../5.shor-9-code/index.html">Shor&#39;s 9 qubit code</a></li><li><a class="tocitem" href="../6.quantum-circuit-born-machine/index.html">Quantum Circuit Born Machine</a></li><li><a class="tocitem" href="../7.variation-quantum-eigen-solver/index.html">Variational Quantum Eigen Solver</a></li></ul></li><li><a class="tocitem" href="../../../performancetips.html">Performance Tips</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href="index.html">Quantum Fourier Transformation and Phase Estimation</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="index.html">Quantum Fourier Transformation and Phase Estimation</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/QuantumBFS/Yao.jl/blob/master/docs/src/examples/2.qft-phase-estimation/main.jl" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><p><a href="https://mybinder.org/v2/gh/QuantumBFS/Yao.jl/gh-pages?filepath=dev/generated/examples/2.qft-phase-estimation/main.ipynb"><img src="https://mybinder.org/badge_logo.svg" alt/></a> <a href="https://nbviewer.jupyter.org/github/QuantumBFS/Yao.jl/blob/gh-pages/dev/generated/examples/2.qft-phase-estimation/main.ipynb"><img src="https://img.shields.io/badge/show-nbviewer-579ACA.svg" alt/></a> <a href="https://minhaskamal.github.io/DownGit/#/home?url=https://github.com/QuantumBFS/tutorials/tree/gh-pages/dev/generated/examples/2.qft-phase-estimation"><img src="https://img.shields.io/badge/download-project-orange" alt/></a></p><h1 id="example-qft"><a class="docs-heading-anchor" href="#example-qft">Quantum Fourier Transformation and Phase Estimation</a><a id="example-qft-1"></a><a class="docs-heading-anchor-permalink" href="#example-qft" title="Permalink"></a></h1><p>Let&#39;s use Yao first</p><pre><code class="language-julia hljs">using Yao</code></pre><h2 id="Quantum-Fourier-Transformation"><a class="docs-heading-anchor" href="#Quantum-Fourier-Transformation">Quantum Fourier Transformation</a><a id="Quantum-Fourier-Transformation-1"></a><a class="docs-heading-anchor-permalink" href="#Quantum-Fourier-Transformation" title="Permalink"></a></h2><p>The Quantum Fourier Transformation (QFT) circuit is to repeat two kinds of blocks repeatly:</p><p><img src="assets/qft.png" alt="qft-circuit"/></p><p>The basic building block control phase shift gate is defined as</p><p class="math-container">\[R(k)=\begin{bmatrix}
1 &amp; 0\\
0 &amp; \exp\left(\frac{2\pi i}{2^k}\right)
\end{bmatrix}\]</p><p>Let&#39;s define block <code>A</code> and block <code>B</code>, block <code>A</code> is actually a control block.</p><pre><code class="language-julia hljs">A(i, j) = control(i, j=&gt;shift(2π/(1&lt;&lt;(i-j+1))))</code></pre><pre><code class="nohighlight hljs">A (generic function with 1 method)</code></pre><p>Once you construct the blockl you can inspect its matrix using <code>mat</code> function. Let&#39;s construct the circuit in dash box A, and see the matrix of <span>$R_4$</span> gate.</p><pre><code class="language-julia hljs">R4 = A(4, 1)</code></pre><pre><code class="nohighlight hljs">(n -&gt; control(n, 4, 1 =&gt; shift(0.39269908169872414)))</code></pre><p>If you have read about <a href="generated/examples/2.qft-phase-estimation/@ref example-ghz">preparing GHZ state</a>, you probably know that in Yao, we could just leave the number of qubits, and it will be evaluated when possible.</p><pre><code class="language-julia hljs">R4(5)</code></pre><pre><code class="nohighlight hljs">nqubits: 5
control(4)
└─ (1,) shift(0.39269908169872414)</code></pre><p>its matrix will be</p><pre><code class="language-julia hljs">mat(R4(5))</code></pre><pre><code class="nohighlight hljs">32×32 Diagonal{ComplexF64, Vector{ComplexF64}}:
 1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im</code></pre><p>Then we repeat this control block over and over on different qubits, and put a Hadamard gate to <code>i</code>th qubit to construct <code>i</code>-th <code>B</code> block.</p><pre><code class="language-julia hljs">B(n, k) = chain(n, j==k ? put(k=&gt;H) : A(j, k) for j in k:n)</code></pre><pre><code class="nohighlight hljs">B (generic function with 1 method)</code></pre><p>We need to input the total number of qubits <code>n</code> here because we have to iterate through from <code>k</code>-th location to the last.</p><p>Now, let&#39;s construct the circuit by chaining all the <code>B</code> blocks together</p><pre><code class="language-julia hljs">qft(n) = chain(B(n, k) for k in 1:n)
qft(4)</code></pre><pre><code class="nohighlight hljs">nqubits: 4
chain
├─ chain
│  ├─ put on (1)
│  │  └─ H
│  ├─ control(2)
│  │  └─ (1,) shift(1.5707963267948966)
│  ├─ control(3)
│  │  └─ (1,) shift(0.7853981633974483)
│  └─ control(4)
│     └─ (1,) shift(0.39269908169872414)
├─ chain
│  ├─ put on (2)
│  │  └─ H
│  ├─ control(3)
│  │  └─ (2,) shift(1.5707963267948966)
│  └─ control(4)
│     └─ (2,) shift(0.7853981633974483)
├─ chain
│  ├─ put on (3)
│  │  └─ H
│  └─ control(4)
│     └─ (3,) shift(1.5707963267948966)
└─ chain
   └─ put on (4)
      └─ H
</code></pre><h2 id="Wrap-QFT-to-an-external-block"><a class="docs-heading-anchor" href="#Wrap-QFT-to-an-external-block">Wrap QFT to an external block</a><a id="Wrap-QFT-to-an-external-block-1"></a><a class="docs-heading-anchor-permalink" href="#Wrap-QFT-to-an-external-block" title="Permalink"></a></h2><p>In most cases, <code>function</code>s are enough to wrap quantum circuits, like <code>A</code> and <code>B</code> we defined above, but sometimes, we need to dispatch specialized methods on certain kinds of quantum circuit, or we want to define an external block to export, thus, it&#39;s useful to be able to wrap circuit to custom blocks.</p><p>First, we define a new type as subtype of <code>PrimitiveBlock</code> since we are not going to use the subblocks of <code>QFT</code>, if you need to use its subblocks, it&#39;d be better to define it under <code>CompositeBlock</code>.</p><pre><code class="language-julia hljs">struct QFT &lt;: PrimitiveBlock{2}
    n::Int
end

YaoBlocks.nqudits(q::QFT) = q.n</code></pre><p>Now, let&#39;s define its circuit</p><pre><code class="language-julia hljs">circuit(q::QFT) = qft(q.n)</code></pre><pre><code class="nohighlight hljs">circuit (generic function with 1 method)</code></pre><p>And forward <code>mat</code> to its circuit&#39;s matrix</p><pre><code class="language-julia hljs">YaoBlocks.mat(::Type{T}, x::QFT) where T = mat(T, circuit(x))</code></pre><p>You may notice, it is a little ugly to print <code>QFT</code> at the moment, this is because we print the type summary by default, you can define your own printing by overloading <code>print_block</code></p><pre><code class="language-julia hljs">YaoBlocks.print_block(io::IO, x::QFT) = print(io, &quot;QFT($(x.n))&quot;)</code></pre><p>Since it is possible to use FFT to simulate the results of QFT (like cheating), we could define our custom <code>apply!</code> method:</p><pre><code class="language-julia hljs">using FFTW, LinearAlgebra

function YaoBlocks.apply!(r::ArrayReg, x::QFT)
    α = sqrt(length(statevec(r)))
    invorder!(r)
    lmul!(α, ifft!(statevec(r)))
    return r
end</code></pre><p>Now let&#39;s check if our <code>apply!</code> method is correct:</p><pre><code class="language-julia hljs">r = rand_state(5)
r1 = r |&gt; copy |&gt; QFT(5)
r2 = r |&gt; copy |&gt; circuit(QFT(5))
r1 ≈ r2</code></pre><pre><code class="nohighlight hljs">true</code></pre><p>We can get iQFT (inverse QFT) directly by calling <code>adjoint</code></p><pre><code class="language-julia hljs">QFT(5)&#39;</code></pre><pre><code class="nohighlight hljs"> [†]QFT(5)</code></pre><p>QFT and iQFT are different from FFT and IFFT in three ways,</p><ol><li>they are different by a factor of <span>$\sqrt{2^n}$</span> with <span>$n$</span> the number of qubits.</li><li>the <a href="https://quantumbfs.github.io/BitBasis.jl/stable/tutorial/#Conventions-1">bit numbering</a> will exchange after applying QFT or iQFT.</li><li>due to the convention, QFT is more related to IFFT rather than FFT.</li></ol><h2 id="Phase-Estimation"><a class="docs-heading-anchor" href="#Phase-Estimation">Phase Estimation</a><a id="Phase-Estimation-1"></a><a class="docs-heading-anchor-permalink" href="#Phase-Estimation" title="Permalink"></a></h2><p>Since we have QFT and iQFT blocks we can then use them to realize phase estimation circuit, what we want to realize is the following circuit:</p><p><img src="assets/phaseest.png" alt="phase estimation"/></p><p>First we call Hadamard gates repeatly on first <code>n</code> qubits.</p><pre><code class="language-julia hljs">Hadamards(n) = repeat(H, 1:n)</code></pre><pre><code class="nohighlight hljs">Hadamards (generic function with 1 method)</code></pre><p>Then in dashed box <code>B</code>, we have controlled unitaries:</p><pre><code class="language-julia hljs">ControlU(n, m, U) = chain(n+m, control(k, n+1:n+m=&gt;matblock(U^(2^(k-1)))) for k in 1:n)</code></pre><pre><code class="nohighlight hljs">ControlU (generic function with 1 method)</code></pre><p>each of them is a <code>U</code> of power <span>$2^{(k-1)}$</span>.</p><p>Since we will only apply the qft and Hadamard on first <code>n</code> qubits, we could use <code>Subroutine</code>, which creates a context of a sub-scope of the qubits.</p><pre><code class="language-julia hljs">PE(n, m, U) =
    chain(n+m, # total number of the qubits
        subroutine(Hadamards(n), 1:n), # apply H in local scope
        ControlU(n, m, U),
        subroutine(QFT(n)&#39;, 1:n))</code></pre><pre><code class="nohighlight hljs">PE (generic function with 1 method)</code></pre><p>we use the first <code>n</code> qubits as the output space to store phase <span>$ϕ$</span>, and the other <code>m</code> qubits as the input state which corresponds to an eigenvector of oracle matrix <code>U</code>.</p><p>The subroutine here uses <code>focus!</code> and <code>relax!</code> to manage a local scope of quantum circuit, and only activate the first <code>n</code> qubits while applying the block inside the subroutine context, and the scope will be <code>relax!</code>ed back, after the context. This is equivalent to manually <code>focus!</code> then <code>relax!</code></p><p>fullly activated</p><pre><code class="language-julia hljs">r = rand_state(5)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 5/5
    nlevel: 2</code></pre><p>first 3 qubits activated</p><pre><code class="language-julia hljs">focus!(r, 1:3)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 3/5
    nlevel: 2</code></pre><p>relax back to the original</p><pre><code class="language-julia hljs">relax!(r, 1:3)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 5/5
    nlevel: 2</code></pre><p>In this way, we will be able to apply small operator directly on the subset of the qubits.</p><p>Details about the algorithm can be found here: <a href="https://en.wikipedia.org/wiki/Quantum_phase_estimation_algorithm">Quantum Phase Estimation Algorithm</a></p><p>Now let&#39;s check the results of our phase estimation.</p><p>First we need to set up a unitary with known phase, we set the phase to be 0.75, which is <code>0.75 * 2^3 == 6 == 0b110</code> .</p><pre><code class="language-julia hljs">N, M = 3, 5
P = eigen(rand_unitary(1&lt;&lt;M)).vectors
θ = Int(0b110) / 1&lt;&lt;N
phases = rand(1&lt;&lt;M)
phases[0b010+1] = θ
U = P * Diagonal(exp.(2π * im * phases)) * P&#39;</code></pre><pre><code class="nohighlight hljs">32×32 Matrix{ComplexF64}:
   -0.108233+0.0497644im    -0.121506+0.158217im    -0.00021044-0.207953im     -0.221862+0.0307541im     -0.135304+0.0256773im    -0.0434431-0.0234466im     -0.048259+0.00134275im    0.0840765+0.079807im      0.0915726-0.0397467im     0.080116-0.0775328im     -0.132959-0.0452422im     -0.112366+0.065905im    0.0161256+0.114667im     0.0883539+0.0510618im    0.0115232-0.239851im      0.141294+0.0443942im    0.144999+0.0740497im    -0.0603317+0.0261143im       0.233486-0.104727im      0.0737227+0.0421173im     -0.187508-0.231408im     0.0109568+0.203765im     -0.269131+0.0387541im     0.203106+0.150454im     0.0293964+0.140933im      0.056553-0.15114im        0.0400829-0.0724671im      0.0473905-0.0888106im   -0.0616974+0.401551im      0.13927+0.0958034im   -0.0591176+0.102688im      -0.0917591-0.0371843im
    0.196106-0.138072im     -0.153642+0.0720504im      0.129991+0.0479181im    0.0485108+0.0465226im     -0.127502-0.170837im    -0.00191035-0.150211im      -0.185735-0.205569im     -0.0940625+0.296613im      -0.204723-0.194635im    -0.0328397+0.044619im     -0.0643761+0.277779im     -0.0829961+0.144285im    -0.194812+0.138153im      0.147414-0.127995im      0.100525-0.0236062im   0.00261968+0.063394im    0.0370934+0.118292im      0.0024973-0.230646im        0.120903-0.0613403im     -0.212934+0.0805527im    -0.0244466+0.0831505im    0.0216128+0.153316im    -0.0653628-0.0656557im    0.0128351-0.074835im     0.0462332+0.0965968im   -0.0846805+0.126981im       -0.126382+0.0211609im    -0.00557936-0.128146im      0.180848-0.190585im   -0.0554413-0.0138172im  -0.00237174+0.0596407im      0.0468447+0.127909im
  -0.0386208-0.0299398im     0.190186+0.0789859im    -0.0151219+0.135451im     0.0802408-0.167224im      0.0916465-0.275545im      0.0551274-0.0492352im     -0.120376-0.00338948im   0.00219243-0.0553112im      0.227854-0.166872im       0.13159+0.0741337im     -0.191208-0.0508955im    -0.0828088-0.0434889im      0.2379-0.0322431im    0.0465163+0.0417554im    0.0651072-0.100883im    -0.0544752-0.166453im     0.255277+0.130878im      -0.191583-0.153554im        -0.17242-0.215879im      -0.140298+0.0559765im     -0.166688+0.00213898im  -0.0561024-0.0579883im    0.0968272-7.92377e-5im  -0.0860997+0.116364im     -0.053707-0.295893im      0.150872+0.17767im       -0.0408428+0.0360869im      0.0426988-0.132024im     -0.079471+0.108088im   -0.0349114-0.0475963im     0.191632+0.0413782im      0.0320672+0.0589135im
   0.0783257-0.0338579im    0.0382368-0.127342im         -0.232+0.0056554im   -0.0584016+0.216854im     -0.0942529-0.0130277im       0.20778+0.27327im       -0.299676+0.0459612im     -0.139234+0.0623914im       0.10111-0.0620433im    0.0349318+0.0587848im     0.0556901-0.0263639im     0.0793854+0.0297756im   -0.141004+0.0627394im   -0.0124176-0.037865im     0.0911294-0.00583545im   0.0128185+0.0991484im   0.0528708-0.0622751im     0.0307801+0.195438im       0.0250264+0.0509109im      0.122983-0.21312im      -0.0443714-0.261752im      0.193367+0.174039im    -0.0158938-0.0220555im    -0.133699+0.091813im    -0.0597113-0.213617im     0.0296559+0.0930245im      -0.261654-0.118985im        -0.21517-0.124114im    -0.0812931-0.0135719im   -0.107942-0.133862im    -0.0195019-0.165629im         0.11321-0.0184861im
   -0.230224-0.174293im     0.0623206+0.00653366im   -0.0455285+0.0392511im    -0.170024-0.0504776im    -0.0582495+0.0576276im       0.18002+0.154091im      0.0185943+0.182213im     -0.0996908+0.0708002im    -0.0840735+0.140453im      0.254173-0.217113im      -0.070196-0.247452im     -0.0333029+0.0786983im   -0.236193+0.021099im     0.0100579+0.134078im     -0.102796-0.0181117im   -0.0486664-0.178231im    0.0572088+0.0799259im     -0.151197-0.19678im        0.0630738+0.0909125im     0.0438299-0.0935368im     0.0274676+0.13065im      -0.173583+0.173282im      0.100173+0.0809747im    0.0264802-0.191278im    -0.0393824+0.069626im     -0.125465+0.186099im       -0.169183+0.258572im       0.0689474+0.0346638im    0.0524056-0.0231731im    0.173374-0.055245im    -0.0078517-0.0834104im     -0.0304766+0.0796738im
  -0.0213087+0.00678003im   0.0144924+0.0168923im      0.017414+0.202277im     -0.062355-0.0108102im     0.0847269+0.136884im      -0.320594-0.129238im      0.0922531-0.00213023im    -0.121274+0.216272im      0.0487732-0.0931491im     0.153935+0.0264169im    -0.0228077-0.0757125im     0.0399148-0.0505098im   0.0695577-0.128514im    -0.0708372-0.038702im       0.17009+0.0543817im    -0.109722-0.132152im     0.166157+0.100374im     -0.0318863+0.122811im        0.236345-0.0587061im       0.10846-0.150338im       0.236006-0.115008im      0.200847-0.0176469im   -0.0686397+0.344906im       0.18259+0.132422im     -0.142848-0.0267829im    0.0511835-0.0779297im     -0.0531764+0.0230462im       0.148667+0.00843398im   0.0868151-0.245649im    -0.055631+0.070573im     0.0408287-0.113394im       0.0346301+0.157081im
    0.187153+0.135622im     0.0703702-0.321915im       0.110007-0.0453975im    0.0568551-0.113727im      0.0145262-0.0801688im    -0.0202496+0.112165im      0.0638021+0.203172im        0.12598+0.106276im      -0.163361-0.0720983im    0.0163721-0.196251im     -0.0627079+0.174793im        0.21823-0.22372im     0.0864175+0.192399im    -0.0358652+0.125041im    0.00361521+0.102032im    0.00105151-0.135962im   -0.0644363+0.139563im      -0.190892-0.000773464im     0.216655-0.0855793im    0.00212265+0.128743im      0.0370125-0.0226232im   -0.0613651-0.0495939im    -0.108446+0.0114562im    -0.187053-0.0523033im   -0.0690864-0.17532im      -0.208537-0.189139im        -0.22392-0.156444im       0.0676728+0.00658836im   0.0300906+0.125705im     0.110961-0.0148514im   -0.0794521+0.014028im        0.062731-0.00722307im
   -0.119379-0.0527842im     0.221918+0.0888723im    -0.0373169-0.0590799im     0.104826+0.209519im      0.0698733-0.129793im       0.156859+0.199783im      0.0569604-0.135059im      0.0649339+0.186606im     -0.0566157-0.141453im     0.0607223+0.00533432im    -0.147581-0.136351im      -0.325851-0.134435im    0.0676769-0.0266525im   -0.0385575-0.0468305im    0.0785922+0.0934799im    -0.118857-0.135986im   -0.0391018+0.118204im     -0.0204241+0.053051im       -0.201384-0.0198445im      0.168948+0.18164im        0.143204+0.149171im      0.136685+0.0178303im     -0.29482-0.082949im     0.0976185-0.00930661im    0.116262+0.0390157im    -0.121595-0.128051im    -0.000233972+0.0422537im     -0.0493244+0.0712636im   -0.0376566-0.0595057im   -0.141867+0.0173134im    -0.278325+0.0226286im      0.0630746-0.148208im
  -0.0420254+0.108051im      0.182668+0.0102517im    0.00583896+0.0173854im   -0.0035879+0.0590999im      0.102866+0.00727501im    0.0105196-0.18436im        0.135981-0.0364651im     -0.318788+0.074425im      -0.420265+0.21004im       0.105559+0.145126im    -0.00926867-0.104617im       0.131751-0.0822434im    0.182932+0.0103195im   -0.0711285-0.151786im      0.191626-0.0404823im   -0.0364466+0.117468im     0.151047-0.18776im       0.0203356+0.176454im       -0.064515-0.0490221im     -0.100773+0.0386445im     -0.142997-0.0204494im    -0.161854+0.129463im     -0.069346-0.0079596im    0.0191659-0.186837im     0.0427525+0.0517759im   0.00406317+0.121779im       -0.183572-0.115957im        0.107191-0.0302899im    -0.151036+0.135572im   -0.0728648-0.106504im    -0.0803636+0.0712365im       -0.11791+0.0167989im
   -0.138583+0.044803im     0.0922697+0.108164im      -0.200973-0.0211744im    -0.290765+0.0787596im     0.0134801-0.0855569im       -0.2056-0.0111311im      0.115101+0.108849im      -0.128614-0.00397444im   -0.0925117+0.0928619im   -0.0705473-0.0567988im    -0.0299847+0.308215im     -0.0394038+0.0696765im   -0.168064+0.0336784im   -0.0550592+0.353816im      0.243828+0.117274im     0.0254661+0.0586042im   -0.123455-0.0172314im    -0.0492906-0.109043im       -0.280605-0.0596422im     -0.134779-0.00293502im    -0.121063-0.155501im     0.0276591-0.114491im     -0.112369+0.0231777im    -0.056586+0.179209im      0.105888-0.158192im     0.0676977-0.0507901im     -0.0981746+0.130181im      -0.0204483+0.124805im     0.0597483-0.137019im    0.0453126+0.0672995im   -0.0770439+0.0297839im      -0.138244-0.0224538im
   -0.100052-0.364506im     -0.117663-0.0997639im      0.128976-0.161111im     0.0903633+0.219878im     -0.0144275-0.0181364im      0.137222-0.219024im    -0.00715136+0.0837955im       -0.1317-0.0455406im     0.0795991+0.185299im      0.075856+0.0506486im     -0.163775+0.0757197im      0.196092+0.0143697im   -0.103321-0.115719im      0.164732+0.0647998im      0.11506-0.177356im       0.16197-0.11751im     0.0292816-0.0234315im    -0.0557639+0.0585832im      -0.147719-0.0964505im   -0.00980995+0.0365789im      0.107721-0.035501im     0.0304368+0.0123828im     0.152492+0.0381556im    0.0806625-0.0302166im    0.0654467-0.178575im     -0.139282-0.211018im        0.101048-0.154861im        0.239387-0.00192928im    0.106495-0.0252im     -0.0755512+0.0126554im   -0.0197758-0.0592039im       0.153454-0.237864im
   0.0874927-0.00210779im  -0.0260668+0.0663458im    -0.0121415+0.187115im     -0.149691-0.10355im       -0.256893+0.110786im      0.0309698+0.0845987im      0.198194-0.0124216im     0.0964802+0.0826136im     0.0948421+0.22979im      0.0137397+0.0328252im      0.125846-0.0595049im     -0.158291+0.180879im    0.0493982+0.012549im      0.115327-0.0533277im   -0.0609018+0.0286259im    -0.327648+0.0461931im  -0.0676324-0.088394im      -0.011334-0.140144im        0.064844-0.155131im      -0.219788-0.155531im      0.0898665+0.136472im      0.104139-0.0118722im   -0.0523161-0.151237im      0.126668-0.108706im     0.0262666-0.289334im     0.0670375-0.124132im       -0.181762-0.245275im        0.118729-0.0424376im   -0.0404974+0.0630062im   -0.074434+0.0763432im  -0.00516736+0.00552528im   -0.00237685-0.222531im
   -0.139071+0.0373431im   0.00782072-0.14804im       -0.369957-0.100817im     0.0901361-0.0898439im      0.141642-0.0245755im     0.0129145+0.111537im      -0.109583-0.0371877im     0.0649831+0.00100173im    -0.154738+0.125334im    -0.0623413+0.0100621im    -0.0397192-0.0982413im     0.0186801-0.0791033im   -0.251652+0.0691972im   -0.0614757-0.167022im     0.0934145-0.136034im    -0.0412107+0.252132im    0.0135646+0.114636im     -0.0399332-0.0404471im      0.0428024-0.26427im      -0.0405623-0.0790139im    -0.0685292+0.248726im    -0.0588853-0.104224im     -0.174323-0.0138337im   -0.0452565+0.0558652im    -0.275832-0.00609044im   0.0954859-0.0725561im       0.251692-0.0565979im       0.194369-0.0706981im      0.19363-0.0347667im   -0.023749+0.0497093im    0.0610483-0.176127im      -0.0173044-0.00560553im
   -0.138917-0.229768im     0.0171657-0.0998192im    -0.0261448+0.0486267im    0.0622722+0.0464769im    -0.0285792-0.149569im      0.0199978+0.0972102im      0.192573-0.0675237im    -0.0319838-0.0804939im     0.0225509+0.103645im      0.154674+0.145388im    0.000906451+0.189006im     0.00733797+0.11624im       0.18677-0.0040231im     -0.23885+0.0311574im    -0.157902+0.273761im    -0.0891167+0.0718073im  -0.0521741+0.267895im     -0.0332214+0.0826019im       0.156787+0.164258im      -0.103997+0.0205932im     -0.382941-0.106058im     0.0483794+0.126352im    -0.0191854+0.123967im    -0.0109412-0.134982im    -0.0476637+0.105009im     0.0798881-0.0814933im       0.132971+0.0146161im    -0.00548116-0.237732im      0.055516-0.0906149im  0.00981358+0.0800797im    0.0233622-0.0425372im       0.100222-0.168598im
   -0.020475-0.144517im     -0.160782-0.130886im      -0.194554+0.0471123im    0.0266589-0.100135im      0.0576923+0.185798im      0.0678681-0.0340413im     -0.298128-0.114895im      0.0527906+0.224277im     -0.0817019+0.00652673im   0.0184377+0.109721im      0.0438166-0.057272im     -0.0887034-0.0728793im   0.0211332-0.0144372im     0.142832+0.0370717im    -0.143644+0.231707im     -0.139021-0.106151im    0.0845786-0.0952694im   -0.00418972+0.245085im      -0.0847274+0.0992992im     -0.267267+0.15749im      0.00533739-0.113315im    -0.0916656-0.115411im     0.0404005+0.0493153im   -0.0208741+0.0644417im     0.262527-0.110922im     0.0720949-0.123598im       0.0627991+0.0804575im       0.100054-0.053543im     0.0575901+0.121539im     0.258185+0.061883im      -0.15686-0.123605im       -0.107728+0.153001im
   0.0469808+0.071095im     0.0465501-0.0522763im    -0.0893182+0.0342319im   -0.0525567+0.0329551im      0.167232-0.0571227im      0.151763-0.190362im     -0.0521825-0.152874im     0.00738828-0.100465im      0.0234776+0.0289918im    0.0444852-0.0595815im     0.0874944+0.0279479im      0.383336-0.109233im    0.0390621-0.0198339im    0.0306468+0.0875319im   -0.0964529-0.212419im     -0.412305+0.0298677im  -0.0118304+0.0192499im      0.179277-0.24357im       0.00154449+0.00809768im       0.1144+0.0944547im     0.0262304-0.0367583im   -0.0730924+0.0327825im    -0.188608-0.0012441im     0.199608+0.151602im       0.19244+0.0754817im    0.0786944-0.00271198im     -0.123503+0.0920829im      -0.113134-0.0787083im     0.016739-0.101442im     0.201998+0.0408652im    0.0167763-0.0939473im       0.195385-0.158543im
  -0.0528702+0.21217im     -0.0782745+0.216121im      0.0971746-0.278229im     0.0243599-0.00504257im     0.245582-0.0305822im      0.248222+0.0872182im    -0.0546814+0.163382im      0.0734461+0.0431095im     -0.056347+0.106793im      0.113986+0.179408im      0.0529706+0.240903im     -0.0883282-0.139161im     0.151249-0.101067im      0.157134+0.045486im      0.116077-0.043749im     -0.088995+0.112293im    -0.117264+0.140058im       -0.12093-0.0851043im    -0.00952477+0.163688im      -0.129524-0.0519459im      0.175086+0.0188139im     0.176967+0.0791905im     0.165747+0.148731im     0.0956116-0.102756im    -0.0941169+0.048843im      0.144396+0.0494206im     -0.0628113-0.126516im       -0.104934+0.0666im        0.104143+0.0977253im   0.0427198+0.0804771im    0.0188767-0.210633im       -0.089879+0.100117im
   -0.074993+0.0622492im    -0.216279-0.0908042im     -0.093541+0.0126743im   -0.0506387-0.0136946im    -0.0130707+0.017916im      0.0255319+0.0474392im    -0.0866076+0.101973im      0.0404249-0.153061im      0.0538954-0.102774im      0.195419+0.0648638im     0.0460359+0.0075549im      0.141301-0.118821im    -0.195465-0.158508im      0.188125+0.125254im    -0.0974826+0.0393317im    -0.107366-0.0281106im   -0.149755+0.067931im      -0.125535+0.159599im      -0.0602297-0.160599im     -0.0256398+0.0597012im    -0.0390272+0.0131881im    -0.011681-0.0157364im    -0.162652+0.045495im     0.0529951-0.2405im       0.0548295+0.142729im      0.210349+0.00787455im     -0.085508-0.0400474im      0.0598225+0.00553893im   -0.119636-0.0923374im   -0.338785+0.0389381im   0.00594583+0.427741im        0.078691+0.214142im
   -0.060044-0.0823661im   -0.0587547-0.159071im     -0.0475427-0.223159im     -0.228007-0.043092im      -0.173983-0.115432im     -0.0582767+0.0310568im     0.0115581+0.145373im     -0.0214994+0.14758im       0.0759799-0.155847im    -0.0900475-0.201724im      0.0495735-0.26562im        0.166538-0.0128847im    0.207169+0.0409527im   -0.0545925-0.142911im      0.115573+0.0190694im   -0.0785671+0.141052im   -0.0102297+0.14953im        0.135106-0.149202im       -0.256669+0.246035im      -0.167736+0.00242918im   -0.0278173+0.0430431im     0.210749-0.158826im     0.0600182+0.141582im     0.0101101+0.0368543im     0.116971+0.140761im    -0.0281659+0.11357im        0.0198207-0.185622im        0.178748-0.0430797im    0.0735909+0.0467216im   -0.039111-0.130261im    -0.0281687+0.0995837im      0.0635448+0.0657848im
  0.00676351-0.110107im    -0.0148325-0.203419im      0.0527765+0.191614im    -0.0607246-0.272342im       0.117935+0.0999013im    -0.0532288+0.183512im       0.195769+0.00693677im    -0.104541-0.0728596im    -0.0127978+0.138902im    -0.0087473-0.0173085im     -0.113857-0.00872965im    0.0435124-0.059225im    -0.127603-0.00051322im    0.111389-0.192963im      0.093124-0.208627im     0.0109831-0.0265234im    0.141014+0.158393im      -0.060132+0.0287768im     -0.0265895+0.0522857im    -0.0869234+0.137097im     -0.0326025-0.18063im        0.19918-0.0466651im    -0.081291-0.11298im       0.124559-0.0957504im     0.182623-0.0672183im   -0.0982802+0.109147im        0.175783-0.0507775im      -0.453088+0.119im         0.160106+0.0456548im  -0.0512411+0.0770485im    0.0130132+0.0145579im     -0.0803106+0.0485305im
   0.0791367+0.0386652im   -0.0546359+0.0909937im     0.0959733+0.00603118im  -0.0731624-0.168242im    -0.00940051-0.00349863im  -0.00695094-0.120925im       0.100144-0.0133095im      0.184727-0.0280649im   -0.00878365-0.0354728im   -0.0838326+0.156076im     -0.0518279-0.133644im    0.000403643+0.0490102im   -0.119821-0.0667808im     0.211499+0.035396im      0.132373-0.12635im      0.0009334-0.208299im   -0.0528272-0.0978876im    -0.0339937-0.0633158im     -0.0364664+0.153783im      0.0613005-0.0686634im     -0.239529-0.00189365im   0.0295371-0.111495im     -0.284263+0.269751im     -0.348087-0.205652im     0.0586954+0.0695024im     0.032506-0.088774im      0.00555904+0.000625483im   -0.0250157-0.154847im    -0.0744333-0.0629098im  -0.0934836-0.197799im     -0.106631-0.354462im      -0.0125776-0.075848im
    0.270778+0.21114im      -0.278767+0.012597im       -0.10614-0.111459im     0.0782542+0.234584im    -0.00400793+0.107434im      -0.143221-0.0445161im    -0.0145135-0.00558869im   -0.0102153+0.0123726im     -0.169527+0.171644im      0.206716-0.133661im      -0.208803-0.116573im    -0.00833416+0.181867im   0.00992869-0.180631im    0.00880724+0.00178953im   -0.207115+0.0773173im   -0.0495952-0.129701im    0.0829297+0.225319im      0.0269824-0.0964381im       -0.16417-0.0124903im     -0.125087+0.123017im     -0.0698988-0.0471869im    0.0756387+0.0224198im   -0.0658878-0.0245042im   -0.0528566+0.0967159im    -0.217155-0.0615422im   -0.0489653+0.0993667im       0.110658-0.125115im       -0.102103+0.146639im     -0.238565-0.102351im    0.0736017-0.119709im     0.0298343-0.0670641im     0.00878146-0.0557703im
   0.0322026+0.0557847im    -0.142293+0.0404286im     0.0162913-0.208715im      0.163554-0.217665im       0.322596-0.107616im      0.0567128+0.109564im      0.0820055+0.0735531im     -0.165411+0.0795814im    -0.0263508-0.0467152im    -0.136795-0.19184im       0.0729812-0.207291im      0.0272439+0.314483im     0.137971-0.0306649im     0.093464+0.11714im      -0.169846-0.0155122im    0.0755038+0.159003im    0.0546489-0.189228im       -0.14988+0.0244755im      0.0538835+0.0560834im    -0.0227588+0.0302013im    -0.0938239+0.0296697im   -0.0338473+0.12778im     -0.0639438+0.0650219im    0.0749397+0.14987im       0.101678-0.173058im     -0.115249-0.0921062im      -0.069501+0.0626492im    -0.00892884-0.0995173im     0.003176-0.224161im    -0.251371+0.20113im     -0.0442705-0.000405331im   0.00039929+0.0307092im
   -0.186953+0.114915im     0.0692892+0.118284im      0.0804526+0.0483542im     0.205983+0.0120952im      -0.29121-0.145018im      0.0429444+0.217007im      0.0963811+0.153033im      0.0805292+0.162904im      0.0952731+0.0499564im   -0.0166898+0.165021im     -0.0834373-0.006639im       0.180787-0.0284298im  -0.0167039-0.233333im       0.10523-0.149742im     -0.122285+0.0313163im   -0.0735918+0.134988im    0.0598523-0.0315472im     0.0986218-0.0122312im      0.0177586-0.125839im      -0.168018+0.00121606im    0.0510929-0.210937im     -0.248928+0.0986134im    -0.111901+0.0955215im    -0.170202+0.211623im      0.128599+0.120852im     -0.138971-0.0744067im    -0.00310023+0.0327528im     0.00236356+0.261309im      0.126099-0.0755775im  -0.0259572-0.0928517im     0.138268-0.0435966im     -0.0530951+0.0255645im
  -0.0214864-0.0264138im    0.0184844+0.0307062im     -0.165151+0.00556379im   -0.157517-0.10197im        0.192745+0.0930032im      0.065957-0.192852im       -0.05754-0.0825058im      0.153855+0.235442im      0.0582316-0.0712786im    -0.185428+0.0255549im      0.160151+0.0528385im    0.00897904+0.0126006im  -0.0943982-0.0895733im    -0.300223+0.0297232im    0.0348066-0.112006im     -0.105811-0.101091im    0.0592072+0.128378im      -0.126195+0.0234773im     -0.0839674+0.0889531im     -0.177912-0.0933416im     -0.044073+0.00028024im   -0.110369+0.271747im      0.107615+0.0211404im   -0.0068322-0.0627364im   -0.0691751+0.0300212im    -0.229175-0.299981im       0.0348366-0.0209493im       -0.13868+0.202245im     -0.117625+0.0860574im    -0.17908-0.160341im      0.185054+0.121352im       0.0771678-0.058826im
  0.00556907-0.056985im     -0.129984-0.0239042im      -0.13015-0.0279282im     0.119975+0.0771318im     0.0414348+0.0673112im     -0.122511-0.0599552im      0.317866+0.0446849im     0.0373651+0.144112im       0.130483-0.207047im      0.161326+0.145898im       0.136417+0.0901307im     0.0286537+0.088787im   -0.0366961-0.0336548im   -0.0473723+0.0985853im    0.0245157+0.0245168im    0.0439913+0.197231im    0.0922531-0.0760508im    -0.0608522-0.0594702im      -0.109451-0.0562273im     0.0183879-0.132242im       0.115617+0.106359im     -0.183338+0.0131617im    -0.140642+0.060236im      -0.07016-0.0887379im    0.0367602-0.11096im     -0.0878881+0.276276im        0.131647-0.0296504im      -0.135237+0.0174143im   0.00186963+0.287638im     0.115754+0.0933892im     -0.21382-0.0580018im        0.37908+0.103356im
  -0.0818448+0.169403im    0.00847066+0.0727128im     0.0640978-0.118701im     0.0718107-0.140318im      -0.181976+0.0348745im    -0.0398094+0.00758774im   -0.0155361-0.153213im      -0.114867-0.0478231im    -0.0749015+0.130392im     -0.151499+0.268033im     -0.0266517-0.148318im       0.107481-0.0102497im  -0.0724074+0.182521im     0.0119474+0.183494im     -0.118033+0.118516im    -0.0605422-0.0123205im     0.29184+0.096134im       0.136596-0.208193im       -0.133464+0.0143623im      0.132964+0.0522249im     0.0181231-0.127777im      0.125255+0.00636219im    0.148843-0.013243im    -0.0133619-0.107239im     -0.234602-0.0749316im    0.0350865-0.234952im      -0.0531137+0.1296im        -0.0470864+0.00838795im    0.177735+0.11862im     -0.128723+0.0271166im     -0.22059+0.0954831im       0.206596+0.146437im
   -0.152314-0.185246im      0.166343-0.115272im      0.0467878-0.169753im     0.0999184-0.082338im      0.0358856+0.0496948im     -0.118984-0.167761im       0.111313-0.13028im         0.21587-0.0309905im   -0.00344753+0.0855549im    0.0370369+0.0368556im     -0.227378-0.0611307im     -0.115445-0.0202109im  -0.0342089+0.17605im       0.226776+0.12764im     -0.0730969+0.0775504im     0.073278+0.199677im   0.00406228+0.0578163im     0.0443831+0.163204im      -0.0327183+0.09478im      -0.0404272-0.18013im      -0.0637019+0.132882im    -0.0165996-0.0469648im   -0.0402496-0.0643346im     0.137526+0.132866im     0.0046928+0.0404734im     0.023274-0.0650017im      -0.314273-0.177801im       -0.170848+0.103063im     -0.109074-0.14812im      0.114438-0.164828im      0.200213-0.022932im        0.153839+0.193495im
   -0.218217+0.0501741im   -0.0506535-0.203576im      0.0261766+0.0200075im    0.0869963+0.129472im       0.087372-0.139806im      0.0495597-0.0587422im     0.0702109-0.046161im      -0.115441-0.0869621im    -0.0349657+0.0853579im   -0.0928869+0.0804211im      0.158877-0.0852828im     -0.181541+0.026457im     -0.20852-0.0544064im   -0.0284262-0.174794im    0.00483423+0.154821im     -0.018388-0.151306im   -0.0871639-0.307407im      -0.256144-0.276407im       0.0953913-0.0428192im    -0.0848507+0.150644im      0.0166328-0.0861779im     0.218417-0.104248im    -0.0117549+0.181371im    0.00339623+0.208734im     -0.063739+0.142653im    -0.0775535-0.0345481im     -0.0936227-0.0938824im      -0.087533-0.0731644im    -0.104022+0.165546im     0.130791-0.036933im      0.142868+0.106862im        0.150792+0.0573968im
 -0.00289895-0.0391473im     0.215161+0.0608042im    -0.0495342-0.0699634im     -0.10254+0.0747265im    -0.0996437-0.0137482im     0.0946281-0.147801im     -0.0698647-0.10539im       0.0162287+0.0760408im     0.0119943+0.119127im      0.055583-0.265113im       0.122282-0.032696im     -0.0692937-0.100213im    0.0485215+0.109554im      0.110201+0.138377im    -0.0554162+0.180031im     0.0591976-0.0609817im  -0.0631357-0.0637187im      0.111512-0.0504286im       0.113202-0.0620365im    -0.0922666+0.122882im      0.0680249-0.196118im     -0.280669-0.190894im    -0.0552718+0.181331im      0.127358-0.0679355im    -0.131575-0.0205735im   -0.0593968+0.152519im        0.190959-0.161118im       -0.222257-0.0579426im    0.0978071+0.0546175im   -0.406008+0.04756im      0.0993548-0.15912im        0.0354656+0.0309165im
   0.0797806+0.128458im    -0.0983635-0.0161812im      0.202622-0.114051im    4.70218e-5+0.207109im      0.0114472-0.229505im     -0.0431617-0.0332281im    -0.0455469-0.000919083im    0.269168-0.124595im      0.0687789+0.14434im      0.0401269-0.0445185im      0.102409-0.117653im       0.131801-0.0819344im   -0.143283+0.0187815im    -0.138254-0.186988im      0.161013+0.230776im     0.0490442-0.215351im     0.253822-0.00730508im   -0.0972269+0.0478538im     -0.0811587+0.143357im      -0.144441-0.336786im     -0.0493369+0.0737473im    -0.156373+0.0156532im    -0.138561-0.118173im      0.177179+0.0269865im    0.0794055-0.0896594im    0.0512961-0.0109657im     -0.0367163+0.0833856im     -0.0881212-0.0889913im     0.154069-0.0196817im  -0.0178762+0.171074im    -0.0490227+0.0326602im     -0.0967524+0.0281972im
  -0.0911294-0.140245im     -0.241049+0.0579388im     -0.180367+0.14445im      0.0621798+0.0480163im     -0.115565-0.124046im      0.0393503-0.00310103im     0.098469-0.259602im       0.137998-0.124811im      -0.152495-0.0502524im     0.217812-0.174036im     -0.0303604+0.00959385im     0.125894-0.0285368im    0.253057+0.0783409im   -0.0151745-0.0503447im     0.100804-0.0360915im   -0.0426957+0.0252856im   -0.136117-0.155837im      -0.133676-0.183552im      -0.0886712-0.00325574im     0.166484-0.134274im    -0.00936753-0.146426im     0.0686109+0.0715426im    0.0781838-0.160372im    -0.0667038-0.0290846im    0.0236039-0.00752665im   -0.106133-0.22562im        0.0520391-0.0183938im      0.0117145+0.0992742im    -0.040529+0.0345592im  -0.0999618+0.056231im     0.0427111-0.169604im       -0.133995+0.379603im</code></pre><p>and then generate the state <span>$ψ$</span></p><pre><code class="language-julia hljs">psi = P[:, 3]</code></pre><pre><code class="nohighlight hljs">32-element Vector{ComplexF64}:
  -0.03483935250883015 + 0.10657498767214135im
  -0.06671116870812625 + 0.19754411308629582im
   0.03280927180900398 - 0.086903816944433im
  -0.33873547370701235 + 0.0382591167599627im
  -0.07392865580783867 + 0.10688496606263499im
   0.15030555382366687 + 0.3014758994065806im
  -0.11834356221215457 + 0.0007099668532037008im
  -0.06777295102390284 - 0.12576642459028367im
   -0.0911363154626678 - 0.022033789392020334im
    0.1083660317510332 + 0.06404185216412724im
   0.14258562309966433 - 0.018040030725847325im
   0.05053778179004118 - 0.009257355330797516im
   0.05532339028020612 + 0.01218941923679073im
  -0.10188428364517461 + 0.05651245968766475im
  0.008167366283206964 + 0.09972638598004208im
  0.004442851063809474 + 0.16726967759272715im
  -0.08784306393593307 - 0.04449313681997188im
   0.18586439068226257 - 0.053105285743484734im
    0.2845041037166404 + 0.13775086654410368im
  -0.19467757810297365 + 0.09889320513807831im
 -0.018764264015034872 + 0.010572104516766904im
   0.35578001622395555 + 0.0im
  -0.20533699504348704 - 0.16912572730075343im
   0.03978215546207846 - 0.09633903213835016im
 -0.047170516598076764 + 0.0189459688045186im
 -0.001406779490522404 - 0.13363103324173575im
    0.0902870999766586 - 0.18833060807405844im
  -0.04433661006714103 - 0.12570099174866042im
   0.11009990020601527 + 0.09565744650645376im
    0.1811982325283893 + 0.04615067816079779im
  -0.05597055948001414 - 0.0026624125810919743im
  -0.06673130865167642 - 0.051164030425132956im</code></pre><p>In the phase estimation process, we will feed the state to circuit and measure the first <code>n</code> qubits processed by iQFT.</p><pre><code class="language-julia hljs">r = join(ArrayReg(psi), zero_state(N))
r |&gt; PE(N, M, U)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 8/8
    nlevel: 2</code></pre><p>Since our phase can be represented by 3 qubits precisely, we only need to measure once</p><pre><code class="language-julia hljs">results = measure(r, 1:N; nshots=1)</code></pre><pre><code class="nohighlight hljs">1-element Vector{DitStr{2, 3, Int64}}:
 011 ₍₂₎</code></pre><p>Recall that our QFT&#39;s bit numbering is reversed, let&#39;s reverse it back</p><pre><code class="language-julia hljs">using BitBasis
estimated_phase = bfloat(results[]; nbits=N)</code></pre><pre><code class="nohighlight hljs">0.75</code></pre><p>the phase is exactly <code>0.75</code>!</p><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../1.prepare-ghz-state/index.html">« Prepare Greenberger–Horne–Zeilinger state with Quantum Circuit</a><a class="docs-footer-nextpage" href="../3.grover-search/index.html">Grover Search »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.19 on <span class="colophon-date" title="Saturday 18 June 2022 16:45">Saturday 18 June 2022</span>. Using Julia version 1.7.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
