<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Quantum Fourier Transformation and Phase Estimation · Documentation | Yao</title><meta name="title" content="Quantum Fourier Transformation and Phase Estimation · Documentation | Yao"/><meta property="og:title" content="Quantum Fourier Transformation and Phase Estimation · Documentation | Yao"/><meta property="twitter:title" content="Quantum Fourier Transformation and Phase Estimation · Documentation | Yao"/><meta name="description" content="Documentation for Documentation | Yao."/><meta property="og:description" content="Documentation for Documentation | Yao."/><meta property="twitter:description" content="Documentation for Documentation | Yao."/><script data-outdated-warner src="../../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../search_index.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script><link href="../../../assets/indigo.css" rel="stylesheet" type="text/css"/><link href="https://yaoquantum.org/assets/favicon-light.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../index.html"><img src="../../../assets/logo.png" alt="Documentation | Yao logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../../index.html">Documentation | Yao</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../../index.html">Home</a></li><li><a class="tocitem" href="../../../quick-start.html">Quick Start</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../../../man/registers.html">Quantum Registers</a></li><li><a class="tocitem" href="../../../man/blocks.html">Blocks</a></li><li><a class="tocitem" href="../../../man/symbolic.html">Symbolic Computation</a></li><li><a class="tocitem" href="../../../man/cuda.html">CUDA extension - CuYao</a></li><li><a class="tocitem" href="../../../man/plot.html">Quantum Circuit Visualization</a></li><li><a class="tocitem" href="../../../man/automatic_differentiation.html">Automatic Differentiation</a></li><li><a class="tocitem" href="../../../man/yao2einsum.html">Tensor network backend</a></li><li><a class="tocitem" href="../../../man/simplification.html">Simplification</a></li><li><a class="tocitem" href="../../../man/bitbasis.html">BitBasis</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../1.prepare-ghz-state/index.html">Prepare Greenberger–Horne–Zeilinger state with Quantum Circuit</a></li><li class="is-active"><a class="tocitem" href="index.html">Quantum Fourier Transformation and Phase Estimation</a><ul class="internal"><li><a class="tocitem" href="#Quantum-Fourier-Transformation"><span>Quantum Fourier Transformation</span></a></li><li><a class="tocitem" href="#Wrap-QFT-to-an-external-block"><span>Wrap QFT to an external block</span></a></li><li><a class="tocitem" href="#Phase-Estimation"><span>Phase Estimation</span></a></li></ul></li><li><a class="tocitem" href="../3.grover-search/index.html">Grover Search</a></li><li><a class="tocitem" href="../4.shor-algorithm/index.html">Shor&#39;s Algorithm</a></li><li><a class="tocitem" href="../5.shor-9-code/index.html">Shor&#39;s 9 qubit code</a></li><li><a class="tocitem" href="../6.quantum-circuit-born-machine/index.html">Quantum Circuit Born Machine</a></li><li><a class="tocitem" href="../7.variation-quantum-eigen-solver/index.html">Variational Quantum Eigen Solver</a></li><li><a class="tocitem" href="../8.riemannian-gradient-flow/index.html">Riemannian gradient flow optimizer</a></li></ul></li><li><a class="tocitem" href="../../../performancetips.html">Performance Tips</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href="index.html">Quantum Fourier Transformation and Phase Estimation</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="index.html">Quantum Fourier Transformation and Phase Estimation</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/QuantumBFS/Yao.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/QuantumBFS/Yao.jl/blob/master/docs/src/examples/2.qft-phase-estimation/main.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><p><a href="/generated/examples/2.qft-phase-estimation/main.ipynb"><img src="https://mybinder.org/badge_logo.svg" alt/></a></p><h1 id="example-qft"><a class="docs-heading-anchor" href="#example-qft">Quantum Fourier Transformation and Phase Estimation</a><a id="example-qft-1"></a><a class="docs-heading-anchor-permalink" href="#example-qft" title="Permalink"></a></h1><p>Let&#39;s use Yao first</p><pre><code class="language-julia hljs">using Yao</code></pre><h2 id="Quantum-Fourier-Transformation"><a class="docs-heading-anchor" href="#Quantum-Fourier-Transformation">Quantum Fourier Transformation</a><a id="Quantum-Fourier-Transformation-1"></a><a class="docs-heading-anchor-permalink" href="#Quantum-Fourier-Transformation" title="Permalink"></a></h2><p>The Quantum Fourier Transformation (QFT) circuit is to repeat two kinds of blocks repeatly:</p><p><img src="assets/qft.png" alt="qft-circuit"/></p><p>The basic building block control phase shift gate is defined as</p><p class="math-container">\[R(k)=\begin{bmatrix}
1 &amp; 0\\
0 &amp; \exp\left(\frac{2\pi i}{2^k}\right)
\end{bmatrix}\]</p><p>Let&#39;s define block <code>A</code> and block <code>B</code>, block <code>A</code> is actually a control block.</p><pre><code class="language-julia hljs">A(i, j) = control(i, j=&gt;shift(2π/(1&lt;&lt;(i-j+1))))</code></pre><pre><code class="nohighlight hljs">A (generic function with 1 method)</code></pre><p>Once you construct the blockl you can inspect its matrix using <code>mat</code> function. Let&#39;s construct the circuit in dash box A, and see the matrix of <span>$R_4$</span> gate.</p><pre><code class="language-julia hljs">R4 = A(4, 1)</code></pre><pre><code class="nohighlight hljs">(n -&gt; control(n, 4, 1 =&gt; shift(0.39269908169872414)))</code></pre><p>If you have read about <a href="@ref tutorial-ghz">preparing GHZ state</a>, you probably know that in Yao, we could just leave the number of qubits, and it will be evaluated when possible.</p><pre><code class="language-julia hljs">R4(5)</code></pre><pre><code class="nohighlight hljs">nqubits: 5
control(4)
└─ (1,) shift(0.39269908169872414)</code></pre><p>its matrix will be</p><pre><code class="language-julia hljs">mat(R4(5))</code></pre><pre><code class="nohighlight hljs">32×32 Diagonal{ComplexF64, Vector{ComplexF64}}:
 1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im</code></pre><p>Then we repeat this control block over and over on different qubits, and put a Hadamard gate to <code>i</code>th qubit to construct <code>i</code>-th <code>B</code> block.</p><pre><code class="language-julia hljs">B(n, k) = chain(n, j==k ? put(k=&gt;H) : A(j, k) for j in k:n)</code></pre><pre><code class="nohighlight hljs">B (generic function with 1 method)</code></pre><p>We need to input the total number of qubits <code>n</code> here because we have to iterate through from <code>k</code>-th location to the last.</p><p>Now, let&#39;s construct the circuit by chaining all the <code>B</code> blocks together</p><pre><code class="language-julia hljs">qft(n) = chain(B(n, k) for k in 1:n)
qft(4)</code></pre><pre><code class="nohighlight hljs">nqubits: 4
chain
├─ chain
│  ├─ put on (1)
│  │  └─ H
│  ├─ control(2)
│  │  └─ (1,) shift(1.5707963267948966)
│  ├─ control(3)
│  │  └─ (1,) shift(0.7853981633974483)
│  └─ control(4)
│     └─ (1,) shift(0.39269908169872414)
├─ chain
│  ├─ put on (2)
│  │  └─ H
│  ├─ control(3)
│  │  └─ (2,) shift(1.5707963267948966)
│  └─ control(4)
│     └─ (2,) shift(0.7853981633974483)
├─ chain
│  ├─ put on (3)
│  │  └─ H
│  └─ control(4)
│     └─ (3,) shift(1.5707963267948966)
└─ chain
   └─ put on (4)
      └─ H
</code></pre><h2 id="Wrap-QFT-to-an-external-block"><a class="docs-heading-anchor" href="#Wrap-QFT-to-an-external-block">Wrap QFT to an external block</a><a id="Wrap-QFT-to-an-external-block-1"></a><a class="docs-heading-anchor-permalink" href="#Wrap-QFT-to-an-external-block" title="Permalink"></a></h2><p>In most cases, <code>function</code>s are enough to wrap quantum circuits, like <code>A</code> and <code>B</code> we defined above, but sometimes, we need to dispatch specialized methods on certain kinds of quantum circuit, or we want to define an external block to export, thus, it&#39;s useful to be able to wrap circuit to custom blocks.</p><p>First, we define a new type as subtype of <code>PrimitiveBlock</code> since we are not going to use the subblocks of <code>QFT</code>, if you need to use its subblocks, it&#39;d be better to define it under <code>CompositeBlock</code>.</p><pre><code class="language-julia hljs">struct QFT &lt;: PrimitiveBlock{2}
    n::Int
end

YaoBlocks.nqudits(q::QFT) = q.n</code></pre><p>Now, let&#39;s define its circuit</p><pre><code class="language-julia hljs">circuit(q::QFT) = qft(q.n)</code></pre><pre><code class="nohighlight hljs">circuit (generic function with 1 method)</code></pre><p>And forward <code>mat</code> to its circuit&#39;s matrix</p><pre><code class="language-julia hljs">YaoBlocks.mat(::Type{T}, x::QFT) where T = mat(T, circuit(x))</code></pre><p>You may notice, it is a little ugly to print <code>QFT</code> at the moment, this is because we print the type summary by default, you can define your own printing by overloading <code>print_block</code></p><pre><code class="language-julia hljs">YaoBlocks.print_block(io::IO, x::QFT) = print(io, &quot;QFT($(x.n))&quot;)</code></pre><p>Since it is possible to use FFT to simulate the results of QFT (like cheating), we could define our custom <code>apply!</code> method:</p><pre><code class="language-julia hljs">using FFTW, LinearAlgebra

function YaoBlocks.apply!(r::ArrayReg, x::QFT)
    α = sqrt(length(statevec(r)))
    invorder!(r)
    lmul!(α, ifft!(statevec(r)))
    return r
end</code></pre><p>Now let&#39;s check if our <code>apply!</code> method is correct:</p><pre><code class="language-julia hljs">r = rand_state(5)
r1 = r |&gt; copy |&gt; QFT(5)
r2 = r |&gt; copy |&gt; circuit(QFT(5))
r1 ≈ r2</code></pre><pre><code class="nohighlight hljs">true</code></pre><p>We can get iQFT (inverse QFT) directly by calling <code>adjoint</code></p><pre><code class="language-julia hljs">QFT(5)&#39;</code></pre><pre><code class="nohighlight hljs"> [†]QFT(5)</code></pre><p>QFT and iQFT are different from FFT and IFFT in three ways,</p><ol><li>they are different by a factor of <span>$\sqrt{2^n}$</span> with <span>$n$</span> the number of qubits.</li><li>the <a href="https://quantumbfs.github.io/BitBasis.jl/stable/tutorial/#Conventions-1">bit numbering</a> will exchange after applying QFT or iQFT.</li><li>due to the convention, QFT is more related to IFFT rather than FFT.</li></ol><h2 id="Phase-Estimation"><a class="docs-heading-anchor" href="#Phase-Estimation">Phase Estimation</a><a id="Phase-Estimation-1"></a><a class="docs-heading-anchor-permalink" href="#Phase-Estimation" title="Permalink"></a></h2><p>Since we have QFT and iQFT blocks we can then use them to realize phase estimation circuit, what we want to realize is the following circuit:</p><p><img src="assets/phaseest.png" alt="phase estimation"/></p><p>First we call Hadamard gates repeatly on first <code>n</code> qubits.</p><pre><code class="language-julia hljs">Hadamards(n) = repeat(H, 1:n)</code></pre><pre><code class="nohighlight hljs">Hadamards (generic function with 1 method)</code></pre><p>Then in dashed box <code>B</code>, we have controlled unitaries:</p><pre><code class="language-julia hljs">ControlU(n, m, U) = chain(n+m, control(k, n+1:n+m=&gt;matblock(U^(2^(k-1)))) for k in 1:n)</code></pre><pre><code class="nohighlight hljs">ControlU (generic function with 1 method)</code></pre><p>each of them is a <code>U</code> of power <span>$2^{(k-1)}$</span>.</p><p>Since we will only apply the qft and Hadamard on first <code>n</code> qubits, we could use <code>Subroutine</code>, which creates a context of a sub-scope of the qubits.</p><pre><code class="language-julia hljs">PE(n, m, U) =
    chain(n+m, # total number of the qubits
        subroutine(Hadamards(n), 1:n), # apply H in local scope
        ControlU(n, m, U),
        subroutine(QFT(n)&#39;, 1:n))</code></pre><pre><code class="nohighlight hljs">PE (generic function with 1 method)</code></pre><p>we use the first <code>n</code> qubits as the output space to store phase <span>$ϕ$</span>, and the other <code>m</code> qubits as the input state which corresponds to an eigenvector of oracle matrix <code>U</code>.</p><p>The subroutine here uses <code>focus!</code> and <code>relax!</code> to manage a local scope of quantum circuit, and only activate the first <code>n</code> qubits while applying the block inside the subroutine context, and the scope will be <code>relax!</code>ed back, after the context. This is equivalent to manually <code>focus!</code> then <code>relax!</code></p><p>fullly activated</p><pre><code class="language-julia hljs">r = rand_state(5)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 5/5
    nlevel: 2</code></pre><p>first 3 qubits activated</p><pre><code class="language-julia hljs">focus!(r, 1:3)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 3/5
    nlevel: 2</code></pre><p>relax back to the original</p><pre><code class="language-julia hljs">relax!(r, 1:3)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 5/5
    nlevel: 2</code></pre><p>In this way, we will be able to apply small operator directly on the subset of the qubits.</p><p>Details about the algorithm can be found here: <a href="https://en.wikipedia.org/wiki/Quantum_phase_estimation_algorithm">Quantum Phase Estimation Algorithm</a></p><p>Now let&#39;s check the results of our phase estimation.</p><p>First we need to set up a unitary with known phase, we set the phase to be 0.75, which is <code>0.75 * 2^3 == 6 == 0b110</code> .</p><pre><code class="language-julia hljs">N, M = 3, 5
P = eigen(rand_unitary(1&lt;&lt;M)).vectors
θ = Int(0b110) / 1&lt;&lt;N
phases = rand(1&lt;&lt;M)
phases[0b010+1] = θ
U = P * Diagonal(exp.(2π * im * phases)) * P&#39;</code></pre><pre><code class="nohighlight hljs">32×32 Matrix{ComplexF64}:
     0.14335-0.0563285im     0.104036-0.0927981im      -0.157031+0.131143im      -0.075504-0.0314409im  -0.0907268+0.0268812im   -0.296964+0.0873927im    0.0265423+0.139983im     0.0334154-0.0151255im     -0.162055-0.174239im      0.031308-0.0829119im      0.092271+0.180645im      0.0808272+0.0340298im   -0.00373214+0.174144im     0.0164306-0.22296im       0.0983956+0.223262im      0.0595771+0.100252im     0.0336306-0.134735im      -0.170152-0.119819im       0.153743-0.0450348im   -0.000409417+0.0907651im       0.294221+0.0899295im      0.140521+0.0510589im      0.265566-0.0590415im      0.0795385+0.0927432im   0.0210259-0.213174im       0.10524+0.0643024im      0.0685973+0.177975im       0.309549+7.04939e-5im    -0.0384071+0.00494318im   0.00486046+0.0797556im     0.0521037+0.0883321im   -0.00115249+0.0311214im
  -0.0130386-0.0455838im     0.094309+0.224394im        0.110438+0.0529802im     -0.189959-0.0379224im    0.125527-0.0552705im    0.102961-0.0478657im     0.296525-0.184051im      0.154578+0.0996587im     0.0144732+0.0433332im    0.0546696+0.189379im    -0.00857455+0.229625im      0.0219044-0.165556im      0.0250889+0.11736im      0.0477962+0.0256814im       0.13116+0.0713987im    -0.0073618+0.148787im     0.0593117+0.00968142im    0.0399799+0.0737817im      0.019912-0.302024im        -0.21928-0.0752501im     -0.0739702-0.108803im     -0.0329566+0.168537im      -0.056747+0.135768im        0.102036+0.0687653im  -0.0150487-0.0237239im    -0.177273-0.202693im        0.164348-0.00345073im     0.078389+0.131074im      -0.0677893-0.191351im      0.0387437+0.103748im     -0.0609925+0.185017im      -0.183743+0.163506im
  -0.0918477-0.250384im    -0.0351583-0.00376565im       0.14514-0.221795im       0.223645-0.0622715im    0.103588+0.0531421im    0.108835+0.00312664im   -0.130744+0.0317689im     0.127913+0.148859im      0.0175507+0.0936319im   -0.0559801+0.0027583im    -0.0516972+0.121234im     -0.0538441+0.101019im       0.117668+0.0835962im    -0.243676-0.0627514im     -0.120136-0.00407905im    0.0745118-0.0359125im  -0.00994206-0.0836403im    -0.0651964-0.11036im       -0.111817-0.0225279im      -0.107119+0.106827im       0.0204502+0.0455651im    -0.0885076-0.0988137im    -0.0418087-0.399608im       -0.079367+0.0571471im    0.151476+0.0607129im    -0.175114+0.0262613im       0.179006+0.279975im      0.0931188+0.343601im      -0.0606092-0.0640623im    -0.0713344-0.0662682im      0.086426+0.0156698im      0.046659-0.0222058im
   -0.152198-0.0926962im     0.206933+0.218305im    -0.000551163+0.0431343im      0.343164+0.268273im     0.123536-0.116im        0.041614-0.121056im     0.0254541+0.247972im    -0.0084229+0.143671im      0.0331784-0.186436im     0.0238999+0.108631im     -0.0558415+0.00331844im    -0.182729-0.0861565im     0.0956054-0.00492846im   0.0100851+0.0772133im      0.237584+0.0299123im    -0.0108001+0.0483299im     0.239142+0.0240593im      0.110505-0.121188im     -0.0664179+0.119208im        0.099161-0.0864985im       0.220904-0.0957935im     0.0938077-0.105735im       0.036914-0.0633149im      -0.148691+0.146529im    0.0386666+0.0303573im     0.096046+0.102397im        0.106257-0.107358im      -0.131394-0.201046im      -0.0600984-0.0137083im     -0.021111+0.109824im     -0.0485299+0.119953im     -0.0725368+0.0507546im
   -0.112531-0.0123314im   0.00452801-0.0258832im       0.154026+0.305599im     -0.0414304+0.0135422im    0.071281+0.152212im    -0.179292+0.0766341im    -0.145786-0.00641879im   0.0336165-0.0277121im     0.0871879-0.042473im     -0.160412-0.112926im      0.0952881+0.00346488im     0.147667+0.0413278im      0.210468-0.0358889im   0.00873893-0.0317124im     -0.038979+0.00644185im    -0.249665+0.0464366im    0.0630635+0.220784im     -0.0646562+0.142413im       -0.07879+0.223144im       -0.105953+0.229633im       0.0872973-0.107208im     -0.0518248+0.00909844im   -0.0203168+0.189409im       0.0311618+0.157026im    0.0191615+0.129757im     0.0286287-0.0611628im      0.0489668-0.0865692im     -0.161111+0.219404im    -0.000557576-0.0826047im    -0.0897323+0.197629im       0.263084+0.230654im       0.135603-0.0581136im
   0.0423802-0.10484im     -0.0915665-0.124775im        0.208878-0.0671663im    -0.0019642-0.0880391im   0.0784745-0.230805im    0.0929003+0.0458681im   0.00277424+0.114342im    -0.0128645+0.0730988im      0.162824+0.104826im       0.10404-0.0373486im    -0.0552685+0.161593im     -0.0657135-0.0117399im     -0.166948-0.103355im      0.118417+0.207958im       0.227674+0.186194im      0.0885474-0.20155im        0.04557+0.0639561im     -0.321966+0.104513im       -0.13472+0.0550171im     -0.0757846-0.0867532im       0.198693+0.0616528im   -0.00574442+0.0754475im      0.160943+0.113855im       -0.066164+0.0270188im  -0.0956682-0.0842615im    -0.142082-0.0741473im     -0.0488302-0.00773583im   -0.0314962+0.0431032im       0.185974+0.0501166im      0.179823+0.0899978im   -0.00999403-0.054317im       0.352913-0.0627462im
   -0.308878+0.128625im    -0.0409014+0.317097im      -0.0520994+0.0119858im     0.0668992-0.112174im   -0.0979976+0.0567634im    0.140273+0.104363im     -0.107063-0.0715362im     0.091787+0.0417469im     0.0757156+0.104422im      0.256578-0.147299im       0.069087+0.106106im     0.00235913+0.00498934im     0.170401+0.151293im    -0.0160563-0.000932537im    -0.17961+0.116951im     -0.0583688+0.141954im      0.138603+0.0854736im    -0.0479536+0.0106608im    -0.0302379-0.0280682im       0.232265-0.0843598im      -0.116955-0.130926im       0.220531+0.105358im      0.0379327-0.119612im       0.0390786-0.0816085im  -0.0205394-0.0907758im     0.206665-0.125678im       -0.245366+0.11559im       0.0525165+0.0106631im      0.0241295+0.0457762im     0.0977784+0.0734293im     -0.118056+0.0627339im      0.261849-0.00228163im
     0.10041+0.0392445im    0.0215551-0.10906im       -0.0746508-0.00967129im    -0.143486-0.0691998im   -0.091101-0.313612im     0.111428+0.155283im     0.0523494+0.166346im     0.0368098-0.0122242im     0.0833746+0.0150893im   -0.0962914-0.0889748im      0.218979-0.162936im       0.133446-0.28084im        0.175106+0.0809438im    0.0583804+0.166049im     -0.0180679-0.0414255im    -0.0203659+0.0157161im    0.0595706-0.0421124im     0.0580729-0.120248im    -0.00249882-0.291311im      -0.0348423+0.0233328im    -0.00156632-0.0089272im     0.0784075-0.0036215im    -0.0539431-0.113543im       -0.319016+0.193297im   -0.0852857+0.0939614im     0.107208+0.224028im       -0.186469-0.0276248im    -0.0482339+0.259964im        0.109048+0.0287829im    -0.0810101+0.0384279im     0.0797456-0.0175083im    -0.0116313+0.147265im
  -0.0660177+0.13653im      -0.183428+0.00159051im      -0.11752-0.0638854im   -0.00845275+0.174006im    0.0166295+0.241353im   -0.0206589+0.181876im     0.0948085+0.0463399im     0.258195-0.162109im       0.189162+0.135047im    0.00118551-0.0842269im    -0.0611196-0.0222531im    -0.0822216+0.11865im        0.126883-0.14817im      0.0895715+0.119447im     -0.0524832-0.0633828im     0.0698664+0.124656im    -0.0380183-0.181162im       0.070439+0.183826im       0.148647+0.0569071im      -0.179738-0.0474742im      0.0301454+0.00865234im   -0.0816843-0.0112673im      0.322031+0.0408876im      -0.263464+0.0970094im    0.133112-0.0590003im    0.0891691+0.0114061im       0.245595-0.0147066im    -0.0396842+0.0129209im     -0.0160837+0.0327436im      0.111755-0.0424328im     -0.125565-0.0400921im     0.0509623+0.270618im
  -0.0539759-0.128143im    -0.0743637-0.0999632im      -0.194184+0.217125im      0.0283375+0.0339761im   0.0500774+0.11535im    -0.0371563+0.172025im    -0.0733027+0.159751im      0.158957-0.0615885im     -0.264427-0.0525912im     0.169772+0.0464618im     -0.108598-0.150843im      -0.151292-0.0572019im    -0.0710661+0.0347966im      0.18995+0.156309im       0.112108+0.124032im      0.0875078-0.119749im      0.126833+0.0490981im     0.0570538+0.050082im     -0.0911044+0.0497611im     -0.0095034+0.0325751im       -0.25128-0.0546686im    -0.0216538-0.15281im      -0.0394138-0.0518738im     -0.0868652-0.209667im    -0.064069-0.214456im    -0.0763668-0.0327381im     -0.0661333-0.1955im         0.146139+0.297667im      -0.0287045-0.193837im      -0.059154-0.142457im     -0.0392554+0.162415im     -0.0279464-0.0903201im
     0.12282+0.054065im     0.0402316-0.130029im         0.19486-0.0738678im     0.0439253+0.0153282im    0.105534+0.103341im   -0.0320638-0.0832692im     0.139606+0.232103im     -0.118886-0.0303626im     0.0562561-0.145902im      0.299111+0.0784043im    -0.0383077-0.0805302im     0.0329175+0.0959692im      0.304193+0.103491im    -0.0791583-0.149711im      0.0408955-0.165996im      -0.138433-0.0229562im    0.0392275-0.0188056im     -0.122932+0.133182im    -0.00405747-0.24183im        0.0125305-0.0445892im     -0.0945101+0.00920483im    0.0854945+0.0856882im    0.00773014+0.1072im        -0.0748629-0.0602414im    0.298956+0.047676im   -0.00361018-0.0552977im      0.0275895-0.174967im       0.162424-0.0414065im        0.22087-0.0114345im     -0.253118-0.163506im     -0.0833269+0.0109525im      0.179493-0.0865874im
    0.172535+0.165155im     -0.192523+0.166607im      -0.0702404+0.067478im       -0.12435-0.106278im     0.142579-0.118652im     0.130123+0.0523843im    0.0691662-0.120305im     0.0241216+0.152597im      -0.154421-0.152971im    -0.0772557-0.122516im      -0.105787+0.0154593im    -0.0512933+0.123347im     -0.0550746-0.0432484im    -0.220939-0.112708im       0.190013+0.040192im     -0.0866822-0.0485618im      0.20332-0.115436im      -0.157284-0.0916288im     -0.113151+0.0704923im       0.151273+0.321463im       -0.186383-0.0950866im      0.131818+0.0155307im    -0.0291448+0.181767im       -0.128434+0.0401457im   0.0256478-0.0442274im    0.0566994+0.111718im        0.174973+0.0754972im     -0.178041+0.0237437im     -0.0246824-0.0394722im     0.0285046-0.240296im     -0.0350799-0.0894723im     0.0828761+0.15578im
    0.143339-0.0351699im     0.115665-0.0658842im       0.385081+0.0710776im     0.0070422-0.111086im    -0.145376+0.075503im     0.136598+0.0267351im     0.127474+0.0231753im     0.102428+0.144989im       0.113008-0.187849im    -0.0285691-0.0404487im      0.113955-0.037774im       -0.21889+0.122054im     -0.0119909-0.0434274im   -0.0901113+0.0900795im    -0.0188338+0.153946im       0.100495-0.0415697im    -0.181524+0.173276im      0.0495002+0.287228im      0.0879665+0.0736884im      0.0255288+0.0733524im      0.0513031+0.149211im      0.0760397+0.150536im       -0.10182-0.0711418im     -0.0386909-0.0792317im   0.0534204-0.14839im        0.23662+0.149122im       -0.155787-0.00109848im   -0.0489919+0.0406727im      -0.264937+0.00562257im  -0.00886145-0.120236im     -0.0913274+0.129429im      -0.141971+0.115248im
    0.171592-0.0535117im    -0.209817+0.047093im       0.0950933-0.112411im     -0.0294656-0.153884im   -0.0226574+0.0207568im    -0.12369+0.0418884im    0.0339964+0.176045im     0.0874969-0.0226121im     0.0960711-0.152966im     -0.186926-0.0409656im      0.206786+0.293609im     -0.0921168-0.226755im      0.0822077-0.123891im     0.0275175-0.0430988im    -0.0168192-0.0523147im     -0.197465-0.188913im     -0.105672+0.00889916im     0.099301-0.265056im     -0.0442577+0.0628088im       0.132288-0.0562892im      -0.144084-0.0956954im     -0.147943-0.215232im       0.106328+0.034284im       0.0210058-0.186849im    0.0525471+0.0954334im   -0.0378897-0.112993im      -0.0360971-0.0524185im      0.119486-0.0845588im      -0.119234+0.0784028im     0.0472344+0.0384824im     -0.203099+0.231018im       0.081615+0.124773im
    0.104254-0.128725im     0.0440456-0.129485im      -0.0871887+0.143506im     -0.0768013-0.0743871im    0.243479+0.0226989im  -0.0715194+0.0682326im     0.128892-0.00228812im   0.0101469-0.0792637im     -0.174768-0.0986995im     0.142789-0.151748im     -0.0556351+0.0874083im    -0.0306778-0.117977im      0.0338305+0.19816im      0.0694718+0.273268im     -0.0825094-0.0702806im     0.0279574-0.0762755im   -0.0100755+0.165234im       0.111148+0.105224im    -0.00126796+0.184368im        0.121798-0.079486im       -0.179892+0.0780776im      0.128819+0.149652im    -0.00386633-0.142617im       0.0740694+0.28982im      0.216337+0.305718im     -0.132335+0.0117876im      0.0719996+0.174268im     -0.0269448-0.109301im      -0.0818752+0.169414im       0.175569-0.0141314im    -0.0272582-0.0827226im     0.0250667-0.00721341im
 -0.00433259+0.02112im      0.0894573+0.0356619im      -0.175236-0.0439998im    -0.0626112+0.0249792im   0.0410536-0.0921509im   0.0871829-0.0273716im     0.416058+0.0721262im    -0.130041-0.256758im     0.00601749+0.0582651im     0.046886+0.031576im     -0.0232584+0.0957199im    -0.0564931+0.00794533im    0.0501473+0.159869im    -0.0171035-0.022008im     -0.0360793+0.24167im      -0.0247008+0.136267im     -0.147158-0.0568151im     0.0714814+0.099691im      -0.112203+0.124767im       0.0663488+0.112617im        0.273062-0.0318149im     0.0113313-0.257937im     -0.0108332+0.0388669im      0.0295847-0.324995im    0.0916283+0.16895im     -0.0474539-0.0665453im     -0.0893281+0.00510964im    -0.179738+0.208158im         -0.1631+0.0212855im    -0.0983124-0.0300463im     0.0775516-0.141354im        0.13704+0.0298952im
   -0.176787-0.113669im       0.10111-0.0435276im      -0.080196-0.119685im       0.033372+0.0207873im  -0.0192046+0.0523516im   0.0323913+0.223981im    -0.0193736+0.12416im      -0.153213-0.238225im       0.102356-0.0485321im    -0.132933+0.00406958im     0.044011+0.150495im      0.0455677+0.0873204im     0.0209713+0.00637192im   -0.110045-0.0122698im      0.311314-0.231522im      0.0762763+0.117858im     -0.128519+0.312468im      -0.100426-0.166909im      0.0583103+0.0227143im     -0.0951056-0.0862295im      -0.191476+0.100388im         0.1891-0.0691091im     -0.060498+0.180802im       0.0586234+0.117042im    0.0161854-0.15365im      -0.013734+0.000636968im    -0.106388+0.124688im     -0.0723021+0.0700211im      -0.144532-0.257891im     -0.0262289-0.0167078im     -0.149732-0.186096im       0.030753+0.0511611im
   0.0549363-0.100978im     -0.011063+0.265676im         0.04877-0.170499im     -0.0650959-0.161458im     0.149012+0.154661im    -0.218362-0.0964473im     0.147643-0.0331979im    -0.196505+0.0010752im    0.00243631+0.23095im      0.0708483-0.0234969im      0.045948-0.295727im      0.0916288-0.10414im         0.23783-0.100913im     0.0557814+0.0830968im      0.121979-0.0301819im      0.208604-0.157531im    0.00748813-0.0871112im     -0.058034-0.211086im      0.0574029+0.242027im       -0.012564-0.011181im       0.0872152+0.0286101im     0.0662468+0.239273im       0.097726-0.0301541im       0.124515-0.0660182im   -0.117838+0.104919im      0.144246+0.0890759im    -0.00195793-0.0296906im    -0.0156173+0.145425im      -0.0586838-0.184951im      0.0236319-0.122306im     -0.0584859+0.101783im    -0.00314966-0.0105316im
   0.0161916+0.0530742im   -0.0378221+0.165644im        0.124732-0.129485im      0.0653171+0.010189im      0.10704-0.012034im    -0.140676-0.0839438im    0.0267678-0.0644604im    -0.103167+0.104188im      -0.214856-0.107787im     -0.124058+0.00752094im   -0.0117032+0.0602751im   -0.00821787-0.0769352im    -0.0342368+0.173895im      0.161951-0.0821435im     -0.165457-0.0762093im      0.225722+0.10561im      -0.153777+0.0882172im      -0.11699+0.176833im       0.162944+0.125177im      -0.0892186+0.045715im      -0.0792016+0.0683156im      0.144891-0.275579im      -0.226737+0.0197482im       -0.26266-0.0697474im  -0.0738033+0.060371im     0.0708518+0.08894im        0.0408703-0.101436im       0.170964-0.0190175im       0.221222-0.147506im       0.202491+0.158698im      0.0286838-0.00224774im     0.174261+0.173347im
   -0.207587+0.0382973im     0.155074-0.230622im       0.0537935+0.00951671im   -0.0979461-0.0913089im    0.208742+0.0746352im   -0.011519-0.16164im       0.120822-0.0400336im    0.0983057+0.00948347im    0.0585663-0.0148774im    -0.126725+0.0372134im    -0.0946519+0.069082im      -0.209615-0.156629im      0.0902733+0.1148im        0.129668-0.0986211im     -0.138083-0.101149im     -0.0879682+0.01751im      -0.198145+0.108718im      0.0157699-0.163885im      -0.109133-0.0870146im       0.291803+0.0624931im     -0.0147911+0.0886051im    -0.0161714+0.106091im       0.210809+0.00977724im     -0.156179-0.045868im    -0.223272-0.232617im      0.152946+0.00626336im      0.219005-0.00711712im    -0.131167+0.0699928im       0.100403-0.0691592im      0.109727-0.0539086im     0.0426976-0.105374im     -0.0437114-0.218916im
    0.203516-0.00689077im   -0.259341-0.107657im       -0.336149-0.00754442im     0.130658-0.15292im      0.178789+0.0296401im    0.117452-0.0318834im   -0.0948538-0.0267277im   -0.0411128+0.200814im       0.274488+0.0961953im    -0.066442+0.0345534im     0.0583619-0.0493786im     -0.136781+0.102393im      0.0487727+0.158433im     0.0504715-0.0396127im      0.216959-0.153256im       0.087985+0.171846im    -0.0767389-0.0212224im     0.0433696+0.117477im     -0.0126723-0.0454231im       0.252385-0.137991im       0.0543511+0.122196im      0.0320269-0.0275156im    -0.0495124+0.0724034im       0.145104-0.0149952im    0.109708-0.0191261im     0.022586-0.0224327im     -0.0544187-0.0539387im     0.0269668+0.0448409im      0.0120955-0.0466204im      0.117792+0.050928im       0.319125+0.23723im      -0.0566446+0.0659967im
   -0.102864-0.181885im    0.00425414-0.177979im      -0.0165003+0.0738281im    -0.0725946-0.192035im   -0.0389634+0.112546im    0.0611295+0.207645im     0.0507884-0.0467478im   0.00171475+0.144856im      0.0882988+0.0147191im    -0.187761+0.261339im     -0.0470141+0.132042im      0.0425864+0.0280894im    -0.0357814+0.0304082im   -0.0488011-0.0298625im    -0.0857108+0.0175239im      0.174884+0.227936im     0.0804639-0.269477im       0.172258-0.127054im      -0.110698+0.184155im       -0.159273-0.00535738im     0.0298881-0.0242951im        0.2637+0.114093im     -0.0907475+0.147269im       -0.173368+0.014495im   -0.0466391+0.152927im    0.00848902+0.00224547im    -0.0585231-0.179954im      0.0822042-0.120446im    -0.000285595+0.149224im     -0.0400893-0.133743im      -0.120908+0.0967645im      0.128665-0.234067im
    0.168202+0.0370333im     0.140239+0.138666im       0.0209915-0.161455im      -0.227624-0.118563im    -0.013773+0.251im        0.059817+0.1184im       -0.158273+0.00501983im   -0.234433+0.0170501im     0.0144076+0.0373559im    0.0911025-0.0239822im    -0.0200871+0.309648im      -0.147915-0.175295im     0.00554897+0.0719419im      0.12393+0.032429im     -0.0208477-0.118174im      0.0779838+0.0356699im     0.191226+0.0509806im    -0.0474618+0.0731175im     -0.183167+0.147217im      -0.0904913-0.0136028im       0.078459-0.132074im      -0.173912-0.100955im     -0.0166112-0.0925308im   -0.000177769+0.137565im    0.0400879-0.212259im      0.142372-0.0325376im     -0.0382785-0.123661im     -0.0153602-0.023545im       0.0705927+0.138379im      -0.187731-0.161424im       0.202102-0.158172im      -0.168908+0.0876723im
   0.0401993-0.0618221im    0.0106062+0.0577563im     0.00844063+0.0411596im      0.130071-0.215472im   -0.0264497+0.134571im   -0.0732698-0.044517im     0.0198239-0.0493958im    -0.197655-0.0819004im     0.0794003+0.105837im    -0.0877868+0.266362im       0.120263-0.102553im     -0.0992232+0.0459771im     0.0114228+0.0205892im    0.0563408-0.0808414im     -0.158725+0.202004im      -0.158418-0.281072im     0.0254015-0.119007im    -0.00248522+0.177663im   -0.000131856-0.0425984im      0.0585657-0.174377im       -0.163038-0.157288im       0.334684-0.130688im       0.138977+0.069593im      -0.0796968+0.188865im   -0.0573203-0.186689im     -0.244903+0.163105im        0.060975+0.0519623im    -0.0539452+0.0197774im      -0.125665+0.0276248im    -0.0925549+0.150352im       0.069026-0.111877im     -0.0278973+0.0944745im
  -0.0666689+0.0870185im    -0.162692+0.133948im       0.0681911-0.0130292im      0.067766+0.166656im    0.0408682+0.0599891im   -0.281556+0.151105im    -0.0616347+0.0333867im    -0.127008+0.208389im     -0.0894664-0.145578im     0.0816187+0.0699983im      0.167147+0.19367im      -0.0501582+0.120701im       0.061851-0.133877im      0.332637+0.216161im       0.044467+0.0110052im     0.0357852+0.0816607im    -0.186392-0.208235im     0.00469331+0.0209882im    -0.0816716-0.30299im        0.0896324+0.00335309im   -0.00694219+0.0477665im    -0.0235022+0.0675382im     -0.166177+0.0795451im     -0.0071202+0.0105502im   -0.101825+0.0801261im       0.0163+0.0271101im      0.0272574+0.181536im      -0.136394+0.0654268im      -0.203968+0.0551067im     -0.110853-0.100622im      0.0834976-0.116778im      0.0712365-0.168349im
   -0.100719-0.0893168im     0.118424+0.0521123im      -0.118135-0.0269187im     0.0211921+0.129114im    -0.129167+0.244443im     0.123491-0.00954907im    0.136362+0.0792876im   -0.0160661+0.149544im     -0.0997328-0.0541072im   -0.0533385-0.138212im      -0.162235+0.179088im      0.0959036+0.0593274im      0.175208-0.246002im    -0.0656047-0.0196538im    -0.0729528+0.0601767im   -0.00624059-0.0368794im   -0.0880561+0.0878227im    -0.0646124+0.0183374im      0.062068-0.0866034im       0.190099-0.0570617im      0.0694446-0.0161295im     0.0256693-0.0188349im     0.0292731+0.139015im        0.101913+0.0893747im   -0.185025+0.0969453im    -0.312047+0.234279im        -0.15613-0.133771im       0.071826+0.148026im        0.217127+0.148764im       0.181608-0.23957im       0.0749097+0.0889448im     -0.103343+0.131967im
    0.110133+0.0335861im   -0.0483299-0.00859156im     0.0209793+0.0460319im      0.143322+0.237577im    0.0498441-0.101297im    -0.259737+0.045095im      0.192554+0.00929241im     0.13037-0.0239146im      0.223391+0.144347im      0.207446+0.190847im      0.0589848+0.0223901im      0.112128-0.271982im      -0.075941-0.0618068im    -0.142956-0.148432im      -0.038162-0.115362im     -0.0519532+0.0256117im    0.0203546+0.0288038im       0.06958+0.0787624im   -0.00737017+0.226876im       0.0394851+0.0380051im     -0.0302682+0.0524927im     0.0461666-0.0619764im     -0.254263+0.034368im       0.0145709+0.101172im     -0.15553-0.272763im     -0.012451-0.0179016im     -0.0357756+0.267124im    -0.00177498+0.0847979im       0.110585+0.191604im      0.0373096-0.250069im      0.0235752+0.104495im      0.0306113+0.000963754im
  -0.0411189+0.132548im     0.0274544-0.0134254im      0.0715016-0.0611833im     -0.211158+0.0214862im    0.168349-0.204505im   0.00532879+0.05382im      -0.196901+0.179259im     -0.134845-0.136763im      -0.157578+0.0354534im   -0.0420033-0.00411818im    -0.171478-0.0724326im     -0.211005+0.059756im      -0.040924+0.0440869im    -0.123163-0.0267652im     -0.119324-0.106932im      0.0984708+0.0598278im    -0.195773-0.0457929im      0.111708+0.089939im     -0.0679523-0.00757959im    -0.0045098-0.172895im        0.118318-0.385542im     -0.0724889+0.0861981im    0.00249329+0.158295im       0.0920861+0.0564994im  -0.0225307-0.0705698im   -0.0125958+0.25213im       -0.0117386+0.231512im      0.0485699+0.0542796im    -0.00973196+0.0124393im    -0.0255613-0.00659995im    -0.113255+0.34208im       0.0961454-0.00454172im
    0.223167+0.041437im    -0.0680758+0.11375im       -0.0477168+0.0627457im     -0.105219-0.101853im   -0.0581388+0.113059im    -0.105694-0.100479im     0.0494583+0.0926137im     0.256863-0.0550202im     0.0124408+0.204748im     0.0311621+0.0610123im     -0.112301+0.0975835im     -0.298149+0.0329378im     0.0319658-0.179058im    -0.0147004-0.0693039im     0.0852961-0.132324im       0.170646+0.119651im      0.137494+0.250763im      0.0126806-0.035054im       0.186108-0.157069im      -0.0122911+0.178989im      0.00951793-0.02207im        0.121651-0.0372644im    -0.0675126-0.117233im       0.0654448-0.0519242im  -0.0823873+0.0901227im    -0.115243+0.235441im     -0.00591762-0.0101328im     -0.114998+0.00123236im     0.0385004+0.145112im      -0.179864+0.286042im     -0.0754647-0.0643035im      0.109576-0.219841im
  -0.0187608+0.211778im     0.0942763+0.0127553im       0.168932+0.0386163im     -0.184287+0.0373763im  -0.0747852+0.0721802im   -0.161702+0.125703im      0.191422+0.0552017im    0.0379318+0.251698im        0.18067+0.122758im    -0.0312023-0.0672808im     0.0358719-0.200409im      0.0261883+0.245492im       -0.22467+0.175419im     0.0702294+0.203506im     -0.0978683-0.0655022im     0.0250094+0.0607425im    0.0304076+0.106982im      0.0779545-0.252869im     -0.0818094+0.0226832im       0.209359+0.0499838im       0.109281-0.0609229im     0.0060083-0.176294im    0.000296755-0.0942481im        0.05906+0.105568im    0.0729721-0.0760057im    -0.303697-0.0331523im     0.00980478-0.0470111im      0.101894-0.118962im        0.035001-0.213403im     -0.0926369-0.0706473im    -0.0118662-0.00124439im     0.107933+0.110089im
     0.26314-0.216979im    -0.0103428-0.0648572im       0.037985+0.0404077im      0.098207+0.0117062im    0.163691+0.0395938im    0.166627-0.214183im    -0.0986061+0.0455567im    0.0197106-0.0189642im   -0.00923414+0.186325im      0.189044-0.134999im       0.137924-0.0424071im     0.0182444+0.0563201im    -0.0567533-0.0595822im     0.123074+0.123968im      -0.175731+0.002305im      -0.238878+0.304181im    -0.0695788+0.0740032im     -0.167325-0.175262im       0.114634-0.0468363im      -0.117589+0.0826337im      0.0904655-0.280714im       0.106717-0.146655im     -0.0378799+0.141132im      -0.0856188+0.057983im   -0.0606633-0.0193022im    0.0447359+0.007405im     -0.00534645-0.0264515im      0.109838-0.0514493im      -0.221781-0.0417719im      0.178548-0.188467im     -0.0549523-0.0667363im    -0.0710552-0.108423im
   0.0389489-0.141829im     0.0921861-0.141984im      0.00690795+0.0296721im    -0.0953268-0.181006im    -0.157976-0.102863im     0.149247+0.0601563im    -0.117452+0.0382694im   -0.0841338-0.065647im    -0.00128895+0.00306213im      0.2485+0.220245im     -0.0335793+0.0914979im       0.21967+0.0544409im     0.0587425-0.31743im       0.286864-0.126828im     -0.0325236-0.0256854im     0.0400609+0.138198im     0.0297078+0.0370849im     0.0533565+0.0695208im     0.0428815+0.105372im        0.275258+0.0850764im   -0.000639523-0.0103497im    -0.0373309+0.0110266im    -0.0205397-0.134683im       -0.108915-0.0853693im  -0.0187996+0.084001im    -0.0603247+0.0278053im       0.201385+0.201423im        -0.1292-0.133908im       0.0711787-0.279724im      -0.053264-0.0100644im    -0.0104623+0.139086im      0.0240792+0.209228im</code></pre><p>and then generate the state <span>$ψ$</span></p><pre><code class="language-julia hljs">psi = P[:, 3]</code></pre><pre><code class="nohighlight hljs">32-element Vector{ComplexF64}:
    0.2752553706150528 - 0.1507215634570709im
 -0.057968527898205044 - 0.098643850076158im
   0.46827229555036176 + 0.0im
    0.0723394527324004 + 0.03446605657457378im
   -0.2527551462475813 + 0.04298614385263125im
 -0.012034345096218542 + 0.08687264732593958im
  -0.15507724174205123 + 0.017629322253269443im
 -0.025133494765613714 - 0.032999361602323im
 -0.034449836373021826 - 0.006902239072279187im
   0.04478699113792879 - 0.047085274457579734im
   -0.1697463309917687 + 0.03985262925973169im
 -0.046946596699935755 - 0.009009833923387955im
   0.04039636797958098 + 0.17963261618946505im
    0.0525585703685915 - 0.010168456780380714im
  -0.09422308732599946 - 0.09712262955628763im
   0.02992357591720049 - 0.1565089784985335im
    0.1376868810871831 - 0.14699443920995947im
    0.3140275015684464 + 0.047743446012178836im
  -0.08643147966958808 - 0.025573937061049594im
  -0.05142431876527998 + 0.04796490004673054im
  -0.08725668062216443 - 0.1473522763453262im
   0.04545498705793306 - 0.013350993516632334im
    0.3251504809256739 + 0.03570208024787183im
  -0.06207629382209362 + 0.017298729158813867im
  0.032872706669337864 + 0.008551463071621091im
 -0.015319732492783011 - 0.07005305786470453im
  -0.05573917651617953 - 0.038596035026039074im
   -0.2050809396075544 + 0.0011436686860334805im
   0.11389183558706627 + 0.16855672862657045im
   0.04646309622493608 + 0.07730607029634286im
   0.08291418900911308 - 0.02074101227067567im
   0.05042825767460081 + 0.1872014573622745im</code></pre><p>In the phase estimation process, we will feed the state to circuit and measure the first <code>n</code> qubits processed by iQFT.</p><pre><code class="language-julia hljs">r = join(ArrayReg(psi), zero_state(N))
r |&gt; PE(N, M, U)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 8/8
    nlevel: 2</code></pre><p>Since our phase can be represented by 3 qubits precisely, we only need to measure once</p><pre><code class="language-julia hljs">results = measure(r, 1:N; nshots=1)</code></pre><pre><code class="nohighlight hljs">1-element Vector{DitStr{2, 3, Int64}}:
 011 ₍₂₎</code></pre><p>Recall that our QFT&#39;s bit numbering is reversed, let&#39;s reverse it back</p><pre><code class="language-julia hljs">using BitBasis
estimated_phase = bfloat(results[]; nbits=N)</code></pre><pre><code class="nohighlight hljs">0.75</code></pre><p>the phase is exactly <code>0.75</code>!</p><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../1.prepare-ghz-state/index.html">« Prepare Greenberger–Horne–Zeilinger state with Quantum Circuit</a><a class="docs-footer-nextpage" href="../3.grover-search/index.html">Grover Search »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.4.0 on <span class="colophon-date" title="Wednesday 17 April 2024 13:52">Wednesday 17 April 2024</span>. Using Julia version 1.10.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
