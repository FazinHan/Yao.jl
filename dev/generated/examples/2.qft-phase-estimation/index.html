<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Quantum Fourier Transformation and Phase Estimation · Documentation | Yao</title><script data-outdated-warner src="../../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script><link href="../../../assets/indigo.css" rel="stylesheet" type="text/css"/><link href="https://yaoquantum.org/assets/favicon-light.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../index.html"><img src="../../../assets/logo.png" alt="Documentation | Yao logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../../index.html">Documentation | Yao</a></span></div><form class="docs-search" action="../../../search.html"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../../index.html">Home</a></li><li><a class="tocitem" href="../../../quick-start.html">Quick Start</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../../../man/registers.html">Quantum Registers</a></li><li><a class="tocitem" href="../../../man/blocks.html">Blocks</a></li><li><a class="tocitem" href="../../../man/symbolic.html">Symbolic Computation</a></li><li><a class="tocitem" href="../../../man/automatic_differentiation.html">Automatic Differentiation</a></li><li><a class="tocitem" href="../../../man/simplification.html">Simplification</a></li><li><a class="tocitem" href="../../../man/bitbasis.html">BitBasis</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../1.prepare-ghz-state/index.html">Prepare Greenberger–Horne–Zeilinger state with Quantum Circuit</a></li><li class="is-active"><a class="tocitem" href="index.html">Quantum Fourier Transformation and Phase Estimation</a><ul class="internal"><li><a class="tocitem" href="#Quantum-Fourier-Transformation"><span>Quantum Fourier Transformation</span></a></li><li><a class="tocitem" href="#Wrap-QFT-to-an-external-block"><span>Wrap QFT to an external block</span></a></li><li><a class="tocitem" href="#Phase-Estimation"><span>Phase Estimation</span></a></li></ul></li><li><a class="tocitem" href="../3.grover-search/index.html">Grover Search</a></li><li><a class="tocitem" href="../4.shor-algorithm/index.html">Shor&#39;s Algorithm</a></li><li><a class="tocitem" href="../5.shor-9-code/index.html">Shor&#39;s 9 qubit code</a></li><li><a class="tocitem" href="../6.quantum-circuit-born-machine/index.html">Quantum Circuit Born Machine</a></li><li><a class="tocitem" href="../7.variation-quantum-eigen-solver/index.html">Variational Quantum Eigen Solver</a></li><li><a class="tocitem" href="../8.riemannian-gradient-flow/index.html">Riemannian gradient flow optimizer</a></li></ul></li><li><a class="tocitem" href="../../../performancetips.html">Performance Tips</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href="index.html">Quantum Fourier Transformation and Phase Estimation</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="index.html">Quantum Fourier Transformation and Phase Estimation</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/QuantumBFS/Yao.jl/blob/master/docs/src/examples/2.qft-phase-estimation/main.jl" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><p><a href="https://mybinder.org/v2/gh/QuantumBFS/Yao.jl/gh-pages?filepath=dev/generated/examples/2.qft-phase-estimation/main.ipynb"><img src="https://mybinder.org/badge_logo.svg" alt/></a> <a href="https://nbviewer.jupyter.org/github/QuantumBFS/Yao.jl/blob/gh-pages/dev/generated/examples/2.qft-phase-estimation/main.ipynb"><img src="https://img.shields.io/badge/show-nbviewer-579ACA.svg" alt/></a> <a href="https://minhaskamal.github.io/DownGit/#/home?url=https://github.com/QuantumBFS/tutorials/tree/gh-pages/dev/generated/examples/2.qft-phase-estimation"><img src="https://img.shields.io/badge/download-project-orange" alt/></a></p><h1 id="example-qft"><a class="docs-heading-anchor" href="#example-qft">Quantum Fourier Transformation and Phase Estimation</a><a id="example-qft-1"></a><a class="docs-heading-anchor-permalink" href="#example-qft" title="Permalink"></a></h1><p>Let&#39;s use Yao first</p><pre><code class="language-julia hljs">using Yao</code></pre><h2 id="Quantum-Fourier-Transformation"><a class="docs-heading-anchor" href="#Quantum-Fourier-Transformation">Quantum Fourier Transformation</a><a id="Quantum-Fourier-Transformation-1"></a><a class="docs-heading-anchor-permalink" href="#Quantum-Fourier-Transformation" title="Permalink"></a></h2><p>The Quantum Fourier Transformation (QFT) circuit is to repeat two kinds of blocks repeatly:</p><p><img src="assets/qft.png" alt="qft-circuit"/></p><p>The basic building block control phase shift gate is defined as</p><p class="math-container">\[R(k)=\begin{bmatrix}
1 &amp; 0\\
0 &amp; \exp\left(\frac{2\pi i}{2^k}\right)
\end{bmatrix}\]</p><p>Let&#39;s define block <code>A</code> and block <code>B</code>, block <code>A</code> is actually a control block.</p><pre><code class="language-julia hljs">A(i, j) = control(i, j=&gt;shift(2π/(1&lt;&lt;(i-j+1))))</code></pre><pre><code class="nohighlight hljs">A (generic function with 1 method)</code></pre><p>Once you construct the blockl you can inspect its matrix using <code>mat</code> function. Let&#39;s construct the circuit in dash box A, and see the matrix of <span>$R_4$</span> gate.</p><pre><code class="language-julia hljs">R4 = A(4, 1)</code></pre><pre><code class="nohighlight hljs">(n -&gt; control(n, 4, 1 =&gt; shift(0.39269908169872414)))</code></pre><p>If you have read about <a href="generated/examples/2.qft-phase-estimation/@ref example-ghz">preparing GHZ state</a>, you probably know that in Yao, we could just leave the number of qubits, and it will be evaluated when possible.</p><pre><code class="language-julia hljs">R4(5)</code></pre><pre><code class="nohighlight hljs">nqubits: 5
control(4)
└─ (1,) shift(0.39269908169872414)</code></pre><p>its matrix will be</p><pre><code class="language-julia hljs">mat(R4(5))</code></pre><pre><code class="nohighlight hljs">32×32 Diagonal{ComplexF64, Vector{ComplexF64}}:
 1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im</code></pre><p>Then we repeat this control block over and over on different qubits, and put a Hadamard gate to <code>i</code>th qubit to construct <code>i</code>-th <code>B</code> block.</p><pre><code class="language-julia hljs">B(n, k) = chain(n, j==k ? put(k=&gt;H) : A(j, k) for j in k:n)</code></pre><pre><code class="nohighlight hljs">B (generic function with 1 method)</code></pre><p>We need to input the total number of qubits <code>n</code> here because we have to iterate through from <code>k</code>-th location to the last.</p><p>Now, let&#39;s construct the circuit by chaining all the <code>B</code> blocks together</p><pre><code class="language-julia hljs">qft(n) = chain(B(n, k) for k in 1:n)
qft(4)</code></pre><pre><code class="nohighlight hljs">nqubits: 4
chain
├─ chain
│  ├─ put on (1)
│  │  └─ H
│  ├─ control(2)
│  │  └─ (1,) shift(1.5707963267948966)
│  ├─ control(3)
│  │  └─ (1,) shift(0.7853981633974483)
│  └─ control(4)
│     └─ (1,) shift(0.39269908169872414)
├─ chain
│  ├─ put on (2)
│  │  └─ H
│  ├─ control(3)
│  │  └─ (2,) shift(1.5707963267948966)
│  └─ control(4)
│     └─ (2,) shift(0.7853981633974483)
├─ chain
│  ├─ put on (3)
│  │  └─ H
│  └─ control(4)
│     └─ (3,) shift(1.5707963267948966)
└─ chain
   └─ put on (4)
      └─ H
</code></pre><h2 id="Wrap-QFT-to-an-external-block"><a class="docs-heading-anchor" href="#Wrap-QFT-to-an-external-block">Wrap QFT to an external block</a><a id="Wrap-QFT-to-an-external-block-1"></a><a class="docs-heading-anchor-permalink" href="#Wrap-QFT-to-an-external-block" title="Permalink"></a></h2><p>In most cases, <code>function</code>s are enough to wrap quantum circuits, like <code>A</code> and <code>B</code> we defined above, but sometimes, we need to dispatch specialized methods on certain kinds of quantum circuit, or we want to define an external block to export, thus, it&#39;s useful to be able to wrap circuit to custom blocks.</p><p>First, we define a new type as subtype of <code>PrimitiveBlock</code> since we are not going to use the subblocks of <code>QFT</code>, if you need to use its subblocks, it&#39;d be better to define it under <code>CompositeBlock</code>.</p><pre><code class="language-julia hljs">struct QFT &lt;: PrimitiveBlock{2}
    n::Int
end

YaoBlocks.nqudits(q::QFT) = q.n</code></pre><p>Now, let&#39;s define its circuit</p><pre><code class="language-julia hljs">circuit(q::QFT) = qft(q.n)</code></pre><pre><code class="nohighlight hljs">circuit (generic function with 1 method)</code></pre><p>And forward <code>mat</code> to its circuit&#39;s matrix</p><pre><code class="language-julia hljs">YaoBlocks.mat(::Type{T}, x::QFT) where T = mat(T, circuit(x))</code></pre><p>You may notice, it is a little ugly to print <code>QFT</code> at the moment, this is because we print the type summary by default, you can define your own printing by overloading <code>print_block</code></p><pre><code class="language-julia hljs">YaoBlocks.print_block(io::IO, x::QFT) = print(io, &quot;QFT($(x.n))&quot;)</code></pre><p>Since it is possible to use FFT to simulate the results of QFT (like cheating), we could define our custom <code>apply!</code> method:</p><pre><code class="language-julia hljs">using FFTW, LinearAlgebra

function YaoBlocks.apply!(r::ArrayReg, x::QFT)
    α = sqrt(length(statevec(r)))
    invorder!(r)
    lmul!(α, ifft!(statevec(r)))
    return r
end</code></pre><p>Now let&#39;s check if our <code>apply!</code> method is correct:</p><pre><code class="language-julia hljs">r = rand_state(5)
r1 = r |&gt; copy |&gt; QFT(5)
r2 = r |&gt; copy |&gt; circuit(QFT(5))
r1 ≈ r2</code></pre><pre><code class="nohighlight hljs">true</code></pre><p>We can get iQFT (inverse QFT) directly by calling <code>adjoint</code></p><pre><code class="language-julia hljs">QFT(5)&#39;</code></pre><pre><code class="nohighlight hljs"> [†]QFT(5)</code></pre><p>QFT and iQFT are different from FFT and IFFT in three ways,</p><ol><li>they are different by a factor of <span>$\sqrt{2^n}$</span> with <span>$n$</span> the number of qubits.</li><li>the <a href="https://quantumbfs.github.io/BitBasis.jl/stable/tutorial/#Conventions-1">bit numbering</a> will exchange after applying QFT or iQFT.</li><li>due to the convention, QFT is more related to IFFT rather than FFT.</li></ol><h2 id="Phase-Estimation"><a class="docs-heading-anchor" href="#Phase-Estimation">Phase Estimation</a><a id="Phase-Estimation-1"></a><a class="docs-heading-anchor-permalink" href="#Phase-Estimation" title="Permalink"></a></h2><p>Since we have QFT and iQFT blocks we can then use them to realize phase estimation circuit, what we want to realize is the following circuit:</p><p><img src="assets/phaseest.png" alt="phase estimation"/></p><p>First we call Hadamard gates repeatly on first <code>n</code> qubits.</p><pre><code class="language-julia hljs">Hadamards(n) = repeat(H, 1:n)</code></pre><pre><code class="nohighlight hljs">Hadamards (generic function with 1 method)</code></pre><p>Then in dashed box <code>B</code>, we have controlled unitaries:</p><pre><code class="language-julia hljs">ControlU(n, m, U) = chain(n+m, control(k, n+1:n+m=&gt;matblock(U^(2^(k-1)))) for k in 1:n)</code></pre><pre><code class="nohighlight hljs">ControlU (generic function with 1 method)</code></pre><p>each of them is a <code>U</code> of power <span>$2^{(k-1)}$</span>.</p><p>Since we will only apply the qft and Hadamard on first <code>n</code> qubits, we could use <code>Subroutine</code>, which creates a context of a sub-scope of the qubits.</p><pre><code class="language-julia hljs">PE(n, m, U) =
    chain(n+m, # total number of the qubits
        subroutine(Hadamards(n), 1:n), # apply H in local scope
        ControlU(n, m, U),
        subroutine(QFT(n)&#39;, 1:n))</code></pre><pre><code class="nohighlight hljs">PE (generic function with 1 method)</code></pre><p>we use the first <code>n</code> qubits as the output space to store phase <span>$ϕ$</span>, and the other <code>m</code> qubits as the input state which corresponds to an eigenvector of oracle matrix <code>U</code>.</p><p>The subroutine here uses <code>focus!</code> and <code>relax!</code> to manage a local scope of quantum circuit, and only activate the first <code>n</code> qubits while applying the block inside the subroutine context, and the scope will be <code>relax!</code>ed back, after the context. This is equivalent to manually <code>focus!</code> then <code>relax!</code></p><p>fullly activated</p><pre><code class="language-julia hljs">r = rand_state(5)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 5/5
    nlevel: 2</code></pre><p>first 3 qubits activated</p><pre><code class="language-julia hljs">focus!(r, 1:3)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 3/5
    nlevel: 2</code></pre><p>relax back to the original</p><pre><code class="language-julia hljs">relax!(r, 1:3)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 5/5
    nlevel: 2</code></pre><p>In this way, we will be able to apply small operator directly on the subset of the qubits.</p><p>Details about the algorithm can be found here: <a href="https://en.wikipedia.org/wiki/Quantum_phase_estimation_algorithm">Quantum Phase Estimation Algorithm</a></p><p>Now let&#39;s check the results of our phase estimation.</p><p>First we need to set up a unitary with known phase, we set the phase to be 0.75, which is <code>0.75 * 2^3 == 6 == 0b110</code> .</p><pre><code class="language-julia hljs">N, M = 3, 5
P = eigen(rand_unitary(1&lt;&lt;M)).vectors
θ = Int(0b110) / 1&lt;&lt;N
phases = rand(1&lt;&lt;M)
phases[0b010+1] = θ
U = P * Diagonal(exp.(2π * im * phases)) * P&#39;</code></pre><pre><code class="nohighlight hljs">32×32 Matrix{ComplexF64}:
  0.0729413-0.361308im     -0.177095-0.0472203im    -0.0951567+0.00156073im       0.136022-0.117827im      0.181376+0.0272543im      0.0212838-0.0258928im  -0.0484162+0.0856458im     0.0227658-0.0684308im   -0.0607219+0.00544203im   -0.0343519+0.0346499im     -0.229177+0.131202im        0.258675-0.173929im    -0.0796354-0.0441261im      0.0111635+0.13098im      0.0639934-0.0083828im    -0.0860696+0.233741im      -0.186562-0.0449859im       0.100629-0.256941im    -0.00577818+0.0282408im   -0.0575597-0.0537887im    -0.0555276+0.179916im       -0.04552+0.0668595im      0.125764+0.0816623im     -0.013334+0.0651071im    -0.0796222-0.0163057im     0.211597-0.0772356im    0.116033-0.208341im     0.0736512+0.30999im       0.0655733+0.0165779im     0.190949+0.00601524im   0.0605427-0.0752595im      0.127855+0.0573842im
   0.123621-0.041801im     -0.160831-0.385843im       0.132319-0.000568737im      0.125673+0.0212367im     0.140952+0.0216285im     -0.0830749-0.0623232im   -0.133048-0.174899im      0.0522129-0.0113566im    0.0483656-0.0591045im      0.203526-0.264031im     0.00152749+0.05497im        -0.265909-0.0426273im    -0.211965-0.032464im       -0.112475-0.0805948im   -0.0555844-0.0664782im    -0.0883466+0.154029im      0.0480977-0.248782im      0.00274635+0.10845im       -0.121242-0.0889257im   -0.0816615+0.00613207im    -0.100391-0.0443008im      0.176705+0.10569im       0.0999052-0.0931685im     0.0771741+0.0189973im     0.0080523+0.184485im    -0.0875895+0.0471068im  -0.0574313+0.0196943im      0.16904+0.00217709im    -0.241409-0.00892003im   -0.012786-0.0623381im    -0.113587-0.176297im     0.00825139-0.16765im
   0.100867+0.0721288im   -0.0705925-0.0196228im    -0.0311278-0.356682im     -0.000330038-0.0951973im    -0.191478+0.0358736im     -0.0144805+0.195003im    0.0565208+0.144687im      0.0942319+0.0861854im    -0.111171-0.00819912im  -0.00649782+0.0895155im      0.156704+0.108465im       0.0321567-0.099147im      -0.11887-0.00690489im      0.119617-0.167447im      0.383937+0.0173365im    -0.0793035+0.169741im    -0.00291314-0.0325737im     0.00531612+0.105403im      -0.109953-0.0425626im     0.295173+0.0559399im     -0.007435-0.0618287im    -0.0124605+0.0729227im   -0.00171436+0.0107016im     -0.222253-0.121907im      -0.293773+0.136im       -0.0156141-0.110402im     0.114077-0.12398im      -0.082263-0.0623293im    -0.0483986+0.0936231im   -0.0461649-0.130034im     -0.109437+0.0977787im   -0.00884683-0.142325im
  0.0148337-0.119824im     -0.056467-0.158203im       0.139017+0.0241149im      -0.0869569-0.350432im     0.0353992-0.138754im        0.160238-0.0745173im   0.0486777-0.014846im      0.0833205-0.0476504im    0.0829416+0.00337565im   -0.0762912-0.101821im       0.155631+0.165957im      -0.0388122+0.0308393im     0.250009+0.0365258im      0.0587085+0.0263401im     0.103831+0.267759im     -0.0609362+0.0288126im      0.173461-0.312577im        -0.07271+0.109519im       0.239784-0.028726im      0.171284-0.135709im      0.0268033+0.136345im      -0.165705+0.0913218im      0.107423-0.0479539im    -0.0416636+0.12577im         0.21864+0.121231im    -0.0582538-0.0491914im  -0.0430682+0.136092im    -0.0857146+0.0168822im      0.142151-0.06436im       0.029897+0.00365033im    0.128006+0.180306im      0.0283025+0.0466238im
  -0.133674+0.0803744im    -0.131709+0.0290243im     -0.102252+0.109001im        0.0859573-0.345842im     -0.104976-0.128741im       -0.108197-0.0622401im   -0.199618+0.0960213im     -0.199711+0.0735041im     0.213872+0.0129766im      0.106307+0.14609im     -0.00796151-0.0464425im     -0.0925886+0.0539629im    -0.126703-0.0607085im     0.00954534-0.139815im    -0.0799196-0.0733372im     -0.169148+0.0490164im     0.0439754-0.0469413im      0.0722156-0.104998im      -0.219189-0.100186im    -0.0247065-0.184384im     -0.0306615-0.12921im       0.0619585+0.15325im      -0.0738458+0.110178im     -0.0436393+0.1268im         -0.11506-0.088068im     0.0868073-0.248155im    -0.169068+0.124376im     -0.124237-0.126742im      0.0137779+0.0071803im    0.0588424+0.259266im    -0.0805143+0.130848im      0.0411095+0.201803im
 -0.0339921+0.244958im     -0.112249+0.0685385im      -0.22343+0.0162776im       -0.016094+0.075752im     0.0830312-0.0875956im      0.0807374-0.313684im   -0.0154075+0.171976im      -0.166056+0.214494im    -0.0897857+0.0927887im     0.0962883+0.0236912im    -0.0556112+0.110048im       0.0854034+0.0934841im      0.15471+0.148712im       -0.100508+0.0946218im    -0.161175-0.0109689im     0.0489014+0.0653416im     0.0168088-0.193876im      -0.0143098-0.00768859im     0.168647-0.16302im       0.180419+0.0661076im    -0.0658656-0.0887227im       0.10458+0.143181im      0.0207815-0.119839im      -0.154333-0.159997im     -0.0660568+0.00862193im   0.0122043+0.0493929im  -0.0566991-0.103704im    -0.0456044-0.015785im     -0.0512388+0.247235im    -0.0118307+0.0489665im     0.271262-0.204979im       0.145927-0.149794im
  -0.146133-0.0995514im   -0.0828565-0.158913im      -0.170447-0.0173805im       -0.206606+0.0810462im    -0.140317-0.128125im       -0.140983-0.0383793im    0.264489-0.290432im      0.0491497-0.0564755im    -0.101623+0.199129im      0.0772291-0.0716793im     -0.184743+0.0664843im       0.244293-0.021345im     -0.141523+0.121392im       -0.129959-0.240373im    -0.0331862+0.195486im     0.00269478-0.0693495im    -0.0169954-0.0256937im      0.0466311+0.0866983im     -0.189112+0.13338im       0.143071+0.0340781im   -0.00153445+0.0486888im    0.00157209-0.0470211im      0.207851+0.0336659im     -0.117922+0.0868847im     0.0279194-0.178368im     0.0157472+0.0217551im   0.0171507+0.101651im      0.133017-0.247837im      0.0411877+0.0417423im   -0.0412359+0.0908507im    0.0308606-0.0279629im      0.157977+0.08925im
 -0.0520726+0.173458im     -0.125275-0.195267im      -0.163513+0.169733im        -0.067665-0.0257743im   -0.0895608+0.0118282im      -0.137021+0.0985179im   0.0904363-0.10226im       -0.075276-0.336126im     -0.250078+0.0465674im     0.0425418+0.0258632im      0.169515-0.259978im     -0.00558939+0.120996im     0.0625438+0.000750208im     0.096983+0.169231im     -0.174249+0.23521im       0.0685271+0.0911893im    0.00219083-0.0487441im      -0.150121-0.0624485im    -0.0710273-0.0297027im    -0.147758+0.0918512im     0.0701863-0.135523im      -0.118809+0.0836765im     -0.030241-0.101914im     -0.0613063+0.0190914im    -0.0291559+0.255692im      0.188602-0.128804im     0.165487-0.163411im     -0.165385+0.106188im     -0.0223059-0.0236702im   -0.0260009-0.0309724im    -0.116861-0.00197973im      0.07608+0.0416244im
   0.114982+0.0906557im   -0.0344761+0.0599906im    -0.0718173-0.14766im        0.00721851-0.00391688im    0.141684-0.142016im        0.105735+0.1471im     -0.0175454-0.0088613im    -0.0239212-0.0800524im   -0.0186972-0.270333im       0.289855-0.12524im       -0.135384+0.0479935im     -0.0265793+0.0115835im     0.235427-0.00977568im     0.0816788+0.125591im      0.140857-0.142142im     -0.0829948+0.180621im     -0.0352309+0.0309969im     -0.0218414+0.143094im      -0.144978+0.089339im     0.0304411+0.0599734im      0.136624-0.326423im      -0.114245-0.300318im     -0.0251212-0.101im        -0.0610727+0.112578im       0.139298-0.0355561im     0.102703-0.133453im   -0.0206107+0.0221197im     0.108795-0.14167im        0.164678-0.120074im     0.0627988+0.114095im      0.113387-0.195095im      0.0739362+0.0713127im
  0.0658351+0.08485im      0.0458099-0.0672258im      0.057208+0.246442im         0.018804+0.146757im     -0.176564-0.000453007im    0.0385723+0.0236266im    0.264583+0.191506im      0.0358852+0.0501575im     0.107409-0.0165901im   -0.00666129-0.103277im       0.110936-0.0436845im     -0.0468138-0.0333385im   -0.0225017+0.0245931im      -0.152591+0.105863im     0.0946417-0.130696im     -0.0172567+0.243179im       0.165469-0.0807477im       0.314129+0.0781991im    -0.0740225+0.0752693im   -0.0489001+0.153918im       0.286516+0.23591im        -0.09844+0.153914im      -0.111458+0.0508353im    -0.0542447-0.168631im       0.223899-0.153324im       0.17202-0.0844912im   -0.147197-0.113821im     0.0643942-0.0365772im    -0.0511553+0.0545335im    0.0844058+0.0378322im    -0.112195+0.0571505im      0.130399+0.0149425im
   0.231501+0.0656658im   -0.0112799-0.0310592im    -0.0293646+0.0170245im        0.190915-0.134726im      0.183194-0.08671im        -0.186043+0.120734im     0.041844-0.130187im      -0.109569+0.147602im     0.0299765-0.0163434im     -0.233935+0.080408im       0.277887-0.156978im       0.0828752+0.0131797im    -0.113004+0.127183im        0.137991-0.0582482im   -0.0243662-0.156672im      0.0549919-0.0246948im     0.0705064+0.204891im    -0.000604932+0.139989im     0.00138422-0.00368036im  -0.0028071+0.0633732im     0.0948149+0.145117im     -0.0819042+0.0817137im       0.21893-0.154303im     0.00856884+0.13328im       0.0753282-0.0399598im     -0.21207-0.0921529im     0.17921-0.00645483im  -0.0109173-0.0599903im    -0.0760661+0.166492im      0.221019+0.0975717im     0.200164-0.215441im      0.0305205+0.107601im
  -0.145526+0.121328im     -0.246756-0.0472096im       0.19853-0.150585im       -0.0524388-0.0349636im      0.15226+0.0169425im     0.00409944+0.0574737im    0.216624+0.0670769im    -0.0813011+0.160301im     -0.246846+0.0539269im      0.179175-0.101571im       0.073753-0.0447802im      -0.190806-0.260421im     -0.155889+0.187697im        0.019823-0.00236575im  -0.0295042+0.125217im    -0.00111124-0.0202903im      0.052256+0.0932198im       0.210125+0.0551109im      0.188623-0.0535424im    -0.169218+0.0113526im     -0.106322-0.0183729im    -0.0121791+0.0455295im     -0.103352+0.14274im      -0.0194068+0.139246im     -0.0136785-0.189178im     0.0364882+0.0680936im   0.0553331-0.0804028im    -0.145817+0.0626353im      0.251932-0.102142im    0.00479361+0.165779im      0.028803-0.0831665im      -0.22969-0.0224138im
   0.166118-0.00960126im     0.01475+0.272302im       0.017606+0.108182im       -0.0661526-0.164936im      0.153368-0.00222082im    -0.0378032+0.0551367im   -0.151978-0.0164292im      0.198174-0.0766784im    -0.239635+0.00264645im     0.137877-0.174479im       0.162972+0.0246521im     -0.0330783-0.0338003im    0.0365379-0.174556im       -0.128512+0.0120035im    0.0375776-0.0801688im    -0.0250215-0.147084im       0.123241+0.0134557im      -0.272052+0.0230392im     -0.148619+0.101872im    -0.0173481+0.121169im      0.0170689+0.045431im      0.0794097+0.294429im       0.042739-0.0162675im     -0.079414+0.146237im     -0.0589981-0.318318im      0.230077+0.172984im     0.032259-0.0563989im    0.0172915-0.00986243im    -0.049524+0.0908095im    -0.113863+0.0731495im     0.108587+0.179091im      0.0422945-0.116361im
  0.0249204-0.0421435im    -0.109607+0.0510414im    -0.0551054-0.131252im        0.0148498+0.278887im      0.184338+0.0858478im     -0.0229587+0.0547382im  -0.0256186+0.137354im       0.178075-0.0396992im     0.143025+0.0636187im     0.0606265-0.0123065im      0.177219+0.123547im       0.0496971+0.0217909im   -0.0946005-0.112457im       0.0366931-0.334974im     -0.269879+0.0583332im     -0.147791+0.00800072im   -0.0852709+0.0200073im     0.00841565-0.142517im     -0.0110582+0.0470677im     0.135826+0.262887im      0.0926278-0.0221638im    -0.0223077+0.11415im      -0.0023011-0.254022im       0.121402-0.048624im       0.169712-0.0162791im   0.00277883-0.209836im    -0.101536+0.137681im      -0.24931+0.153463im       0.206858-0.0959902im    -0.103626-0.00685659im   0.0219192-0.0144647im      0.032623+0.0315436im
 -0.0545946-0.197162im      0.056386+0.0189177im     0.0324994-0.0391332im      -0.0115511-0.0636572im    0.0930895+0.0157701im      -0.213681+0.224306im    0.0576547+0.0279521im    -0.0738656+0.125546im     -0.158158+0.235038im     -0.0853282+0.0381917im    -0.0536858+0.0156309im       0.209649+0.0750879im    0.0963817-0.0575811im      -0.179587+0.127591im      0.108912-0.162234im    0.000856362+0.22736im        0.102666+0.0210366im     -0.0738099-0.0429608im     0.0824985-0.16603im     -0.0685486+0.102216im       0.127705-0.153682im    -0.00197921+0.100731im      0.0909901+0.0758114im      0.120793-0.0745012im      0.042878+0.187361im     -0.114051+0.152101im   -0.0998401+0.219955im    -0.0941163-0.0539568im     0.0459245-0.161803im     -0.146508+0.346534im      -0.15968-0.0356356im     0.0668309-0.169069im
  0.0849383+0.0946793im    -0.180839-0.0104944im     -0.180136-0.0124765im      -0.0220557+0.0152587im    -0.105891-0.0237598im       0.171212+0.0886587im  -0.0170936+0.259816im    -0.00142099-0.0237313im   0.00640001+0.117189im       -0.12342-0.150041im     -0.0864222-0.0927065im      -0.025859+0.0182801im    -0.216888+0.11881im         0.132207+0.127294im    0.00134022-0.093242im      -0.256974-0.360783im      0.0629472-0.0410949im      -0.134077-0.0926269im    -0.0104654+0.0360585im   -0.0828479-0.217618im       0.207265-0.044167im     -0.0864396+0.0298971im      0.179183+0.106351im      -0.141301-0.0349047im       0.12296-0.0435587im   -0.0344175-0.0096957im   0.0583793+0.222606im     0.0852485+0.0868932im     0.0529967-0.0876181im   -0.0137322-0.0912341im    -0.116924-0.16593im       0.0724772-0.273508im
  -0.108273+0.012734im      0.138139-0.0244055im      0.038263+0.063534im         0.246246+0.0682443im     0.202377+0.0129345im       0.140996-0.116192im    0.0465682+0.215429im      -0.123545+0.0122806im    -0.188829+0.0206566im    -0.0761421+0.101643im       0.121112-0.114251im       0.0305994-0.117792im     0.0181059+0.0880984im     -0.0680787-0.142324im      0.191084-0.00493627im    0.0955306-0.2182im        -0.170422-0.440639im      -0.0635553-0.0263415im     -0.268511+0.05405im      -0.102241+0.160299im    0.000559824+0.0324159im    -0.0392643-0.153094im      0.0459715-0.103337im    -0.00483694+0.135009im     -0.0848439+0.0227289im   -0.0784697+0.110002im   -0.0882028-0.0180535im     -0.10061-0.11184im       0.0572399-0.152151im      0.158467+0.0257235im    -0.125092+0.0428691im      0.121684+0.0276126im
 -0.0426627+0.180072im      0.151108-0.167497im      -0.154864+0.0351197im       -0.198314+0.0169985im     0.149549+0.063877im       0.0526616+0.081124im    -0.014736-0.0221863im  -0.000505727+0.222644im    -0.0892838-0.0737726im     -0.186619-0.0330192im     0.0204457-0.036808im      -0.0281202-0.0885928im   -0.0378545-0.0145369im       0.270151+0.0382422im    0.0775328+0.168191im      -0.119863+0.127396im      0.0100693-0.0289392im       0.104249-0.359697im     -0.0867688+0.198775im      0.122445-0.0546612im     0.0195469+0.00330926im   -0.0351711+0.0741295im     -0.239439-0.18852im        0.150785+0.166527im      -0.039099+0.0546221im    0.0409702+0.185407im   -0.0762626+0.147108im      0.271172+0.00139249im   -0.0837449+0.119964im    -0.0968666+0.173094im     0.0450316+0.0209653im     -0.036552-0.020938im
  0.0966048-0.25275im      -0.100479-0.0620832im    -0.0507819+0.0740917im       -0.259248+0.119352im       0.22455+0.0661875im      0.0316642-0.0793476im   0.0665778+0.0843568im     -0.173165+0.0973518im    0.0256827-0.0441645im    -0.0688528-0.085998im       0.212463+0.0362958im     -0.0317221-0.0783675im    0.0543761-0.0548405im      -0.149786-0.0435201im    0.0494329+0.173543im      -0.108331-0.113333im      0.0213731+0.248911im      0.00582988-0.0242003im      0.010159-0.147618im     0.0901379-0.0347508im      0.172463-0.320437im      0.0422176-0.166392im      0.0448579+0.163355im     -0.0309693+0.0908713im     0.0235301+0.0473483im     0.116229+0.0689165im   -0.114371-0.0291379im    -0.123498-0.0253516im     -0.272176+0.160175im      0.267107-0.115189im     -0.108839+0.0853444im     0.0367098+0.068111im
 -0.0300117-0.00944235im    0.174946+0.00176193im     0.144358-0.0234514im      -0.0545127+0.148804im      0.254899-0.127132im        0.189561-0.13821im     -0.183803-0.0590015im      0.112826+0.169794im       -0.1102+0.0770378im      0.136222-0.0487897im    -0.0400333-0.130365im      0.00539666+0.0931313im   0.00880331+0.0579536im      0.0950114+0.123631im    -0.0705409+0.173274im     -0.0336376+0.158036im      -0.185327+0.176773im       0.0364731+0.0397262im     -0.215498+0.0202241im    0.0155611-0.331109im       0.200516+0.128694im     -0.0280669+0.137961im       0.178034-0.00218318im   -0.0815436-0.15667im      0.00522436-0.0184301im    -0.168664-0.135652im    0.0742772-0.168431im     -0.171743-0.150197im     -0.0314416-0.0877757im   -0.0653465+0.0821353im    -0.125525+0.124458im    -0.00425997-0.0537336im
   0.267981+0.133252im    -0.0543028+0.240897im      0.0291572-0.00329146im      0.0548046+0.0957108im    0.0379962-0.168951im      -0.0808299+0.0611753im  -0.0198536+0.0846613im    -0.0905936+0.00897096im   -0.106865+0.110086im       0.255028+0.099071im      0.0284155+0.00615379im      0.156429-0.134622im     -0.160972-0.10306im       -0.0466326+0.0208484im   -0.0847635+0.0798501im      0.160503+0.0264724im   -0.00291981-0.193287im        0.199083+0.0394854im      0.243353+0.0397544im   -0.0476822-0.19624im        0.180108-0.0795529im     -0.102293-0.00808158im      0.16431-0.127948im      0.0967052+0.0188976im     -0.103732+0.107885im     0.0745811+0.0512336im     0.01998+0.217658im      0.211446-0.0249231im     -0.105854-0.00700701im  -0.0519531-0.160915im     -0.067358+0.199498im      -0.117549+0.234736im
  -0.167837+0.0151418im    0.0201577+0.316032im      -0.185151+0.0776652im       0.0435845-0.121446im      0.230266-0.0370397im      -0.078705-0.107838im   0.00336985-0.244443im      0.0646525+0.0241626im     0.123941+0.00467971im    0.0226482-0.113655im     -0.0171036-0.0919484im   -0.000506804-0.016147im     -0.203982-0.194805im        0.241589-0.119508im     0.0183375+0.0400881im     -0.104213+0.0871108im     0.0744185-0.161867im        0.156557+0.0718295im       0.17198+0.0867869im    -0.110834+0.127881im       0.168672+0.0423069im      0.055377-0.199815im      -0.153166+0.223484im      -0.129049-0.0681218im     0.0361705+0.177616im    -0.0248268+0.127011im     0.143746-0.0235803im    -0.139497-0.0757im       0.00197364+0.0148256im    0.0274269-0.0642484im    0.0265078+0.0402879im      0.180423-0.19003im
   0.120409+0.0740146im     0.012036+0.0258433im    0.00764504+0.0880752im       -0.201769-0.177551im      0.194254-0.0160675im      -0.021741-0.0915635im    0.139258-0.201297im     -0.0193996+0.0444887im    0.0095079-0.090841im      -0.163985+0.0579615im     -0.037971+0.227822im        0.044787+0.11142im      -0.307808-0.0553387im      -0.166075+0.128961im      0.190549-0.0285979im   -0.00712418-0.196938im      0.0621233-0.0584674im     0.00948076-0.0458226im    -0.0580365+0.16634im     -0.0922686-0.0549333im    -0.0571529-0.190574im      0.0121562+0.0823079im    -0.0413689-0.230433im     -0.0647348-0.393227im      0.0112586+0.0497169im    0.0142438-0.0566062im   -0.093703-0.160886im    -0.0838944+0.012205im       0.161411-0.131777im     0.0154548-0.0073751im   -0.0427571-0.0868678im     -0.157167+0.166985im
  -0.102705-0.0953475im    0.0270977-0.00468706im     0.072705+0.0524665im       0.0286412+0.0360345im   -0.0536693-0.0462952im     0.00939352+0.306421im    0.0376216-0.08522im        -0.23687+0.0808147im     0.091547+0.045546im      0.0421092-0.212678im       0.172229-0.0482189im      -0.069275+0.0383262im     0.223825-0.0885103im      0.0771009-0.261002im    -0.0883501-0.0350856im    -0.0891437+0.0836711im     -0.201622-0.121505im       -0.118881-0.0425969im     0.0224879+0.196145im     -0.119715-0.145594im     -0.0106877-0.0277958im     -0.131832+0.0370929im      0.134893+0.0683811im     -0.208776-0.348635im      -0.169249-0.0595912im   0.00704413+0.228182im     -0.12804-0.0315641im    0.0596455+0.146604im      0.0827692+0.138015im     0.0399189+0.0189046im    0.0705805-0.107198im     -0.0814085+0.127294im
  -0.114497-0.0232472im   -0.0248518+0.0392216im    -0.0857483+0.200226im        0.0678236-0.0862659im     -0.17982+0.110217im        0.107735-0.0993385im  0.00395688-0.0927585im      0.142565-0.0147789im    -0.253074-0.226361im       0.179303-0.159306im     -0.0472964-0.195568im         0.10821-0.0886322im   -0.0782057+0.0509629im       0.178959-0.0276137im     0.201639-0.0630873im     -0.114336-0.0310835im    -0.0842949+0.0792589im     -0.0516461+0.0235125im      0.242053-0.132347im      0.101781+0.0660296im   -0.00017995+0.0864354im      0.128726-0.100558im        0.21082-0.222432im       0.124361-0.185314im     0.00553564-0.0382277im    0.0285713-0.0480741im   -0.221761+0.15305im      -0.148855+0.0809582im    -0.0853333+0.13232im       0.094428+0.174106im       -0.1352+0.00543782im    -0.113573+0.100352im
 -0.0834292+0.123791im    -0.0263858-0.174241im      -0.207277+0.00987575im     -0.0591279-0.0615318im     0.200755+0.0262904im      -0.138688+0.10646im     -0.084889+0.0500342im      0.318527+0.0865936im    0.0451204-0.0446187im     -0.126787-0.123284im      0.0488684-0.0979097im       0.198925-0.145464im      0.235224+0.0279751im     -0.0925312-0.0333851im    -0.065966-0.0517788im    -0.0199795-0.190363im      -0.124402-0.106184im        0.102094+0.17772im        0.154411-0.052611im     -0.169573+0.00285828im   -0.0633236-0.1642im       -0.0473151+0.00336667im   -0.0349843+0.121028im       0.096237-0.122572im      -0.106732-0.0884492im    -0.138404-0.325937im   -0.0317192-0.143131im      0.257521+0.00305664im    0.0175238+0.0525149im   -0.0327956+0.0483595im   -0.0696006+0.214185im      0.0154703-0.0353127im
  0.0367711+0.00455734im   -0.148491-0.0725098im     0.0555037+0.0699951im       0.0180987+0.0324571im    -0.145044+0.028284im      -0.0820187+0.0699512im   0.0561002+0.0690268im       0.10407+0.213451im     -0.022038+0.0951915im     -0.044424+0.00960458im    0.0142325-0.00157866im     -0.150709+0.148163im     -0.205747-0.218428im     -0.00229663+0.0518157im    -0.122609-0.0706906im    -0.0531267+0.0479863im   -0.00722111-0.0737731im      -0.181986-0.08015im        0.173883-0.0772429im     0.143065-0.109112im        0.03982-0.0227812im    -0.0483677-0.404347im      0.0469927-0.199367im     -0.0176771+0.0951501im   -0.00456646-0.161389im      -0.11297+0.101766im   0.00246506-0.411021im     0.0648989+0.00671724im   0.00858244-0.136155im    -0.0357336+0.186805im     0.0324745+0.199706im       0.190709+0.0497207im
 0.00296571-0.0864028im   -0.0316184-0.0066408im    -0.0448282-0.0337299im       -0.138099+0.0225352im     0.206896+0.0442637im      -0.256241+0.133934im    0.0929045+0.169149im     -0.0545331+0.0410479im     0.139014-0.104609im     -0.0419953-0.0750011im     -0.302348-0.268531im      -0.0412449-0.141497im      0.096954-0.0236923im    -0.00342179-0.0662221im    0.0286814-0.0152653im       0.12741+0.0219658im      0.133203-0.0964289im      -0.136583-0.0963973im       0.10135+0.00338436im   0.0294375-0.100014im      -0.109873+0.228636im     -0.0625232-0.0296236im    -0.0170266-0.186335im      -0.210819-0.0318523im    -0.0233682-0.0948129im     0.142835-0.146696im   -0.0455253+0.0357812im    -0.214546-0.209091im      -0.293745-0.198008im      -0.10495-0.116614im     0.0496897-0.0745313im     -0.121096-0.0189975im
   -0.20108-0.0427268im    -0.192363+0.0624456im      0.209999+0.279786im         0.163644+0.043566im    -0.0648777-0.0433638im     -0.0119489+0.10508im     0.0250592+0.0738504im       0.13791+0.153748im     -0.163678-0.128856im      -0.100421-0.114786im      0.0115368+0.0768279im       0.179808+0.0848398im    0.0934936+0.0870363im      0.0935436-0.12989im     -0.0626723-0.0953866im    -0.0426451-0.169024im      0.0649224+0.047016im         0.17355+0.0227233im     -0.136558+0.0138013im     0.166483-0.095388im      0.0787098-0.104097im        0.15447+0.0789533im    -0.0382464+0.0559978im     0.0173603+0.00110312im   -0.0178379+0.282202im      0.152324+0.0253924im    0.102752-0.0818005im    0.0400962-0.0256383im     -0.164918-0.325045im    -0.0906216-0.0520202im     0.276065-0.0487661im    -0.0403137+0.100744im
 -0.0513725+0.154268im     0.0959905-0.138525im      -0.197218+0.0808715im        0.137033-0.114915im     0.0460202+0.120487im       0.0616352+0.20753im    -0.0380685+0.02479im       0.0353131+0.0566503im   -0.0640205+0.20066im      -0.0608746-0.0851445im   -0.00533753+0.091809im        0.105889-0.00709545im  -0.0909029+0.00959529im     0.0277344+0.140136im      0.029506+0.0418416im    -0.0719647+0.246329im     -0.0990923-0.0201887im      -0.124609+0.0904963im   -0.00549591-0.0913838im   -0.0338908-0.0270931im      0.031731-0.0520648im      0.233091+0.00876777im   -0.0400724+0.113249im      0.0924826+0.0645934im      0.121199-0.243529im    -0.0721527+0.107696im    -0.145468+0.00829582im   -0.178523-0.1279im        0.0230527-0.0699315im   -0.0738184-0.479327im      0.113024-0.0498533im    -0.0481641+0.27836im
  -0.166657-0.171114im    0.00701991-0.016587im    -0.00763806+0.238026im       -0.0260716-0.083002im     0.0595973+0.186989im     -0.00802877+0.0371255im   -0.126348+0.157696im       0.237846+0.0254306im   -0.0120616+0.287746im       0.234555+0.169605im      0.0504908+0.00583082im     -0.184345+0.289603im    7.67554e-7-0.0570996im     -0.0415711+0.0544898im     0.218457+0.116359im      0.0545424-0.0324923im    -0.0380787-0.00656841im      0.173445-0.0424622im      0.074368+0.118235im     0.0104873+0.154025im     0.00734523-0.0983282im     -0.155094-0.045863im      0.0040976-0.0350688im     -0.188734+0.0326994im    -0.0419341-0.0973234im    -0.152269-0.120183im     0.136844+0.122223im      0.117113+0.00833907im    -0.164572+0.0403205im    0.0448133-0.00317644im   0.0607992-0.256278im      -0.172312+0.0572088im
  0.0220668+0.0613721im     0.113657-0.116759im     -0.0264167+0.0466075im        0.067552-0.0414002im      0.15691-0.103713im        0.081939+0.265161im     0.151361-0.0460251im     -0.132799-0.0981056im   -0.0966173+0.0241313im      0.111715+0.114033im      0.0627725+0.151649im       0.0232644+0.353222im     0.0850922-0.002325im       0.0291893-0.175613im     0.0821245-0.00848023im   -0.0363212-0.0734968im   0.000815944+0.125861im        0.251435-0.100207im       0.115283-0.120914im     -0.155422-0.164659im      -0.150656+0.121305im       0.261553-0.107725im      0.0242871-0.189814im     -0.0157328-0.00185332im   0.00679866-0.123993im      0.167841-0.0883588im  -0.0213962+0.050073im     0.0272204-0.0111166im   -0.00519719-0.0328968im    0.0845335-0.0946508im   -0.0235381+0.153377im       0.141935-0.340576im</code></pre><p>and then generate the state <span>$ψ$</span></p><pre><code class="language-julia hljs">psi = P[:, 3]</code></pre><pre><code class="nohighlight hljs">32-element Vector{ComplexF64}:
   0.28483355809123073 + 0.12124427157832608im
   0.12269509651076799 + 0.013270458619248068im
   -0.2766811175797946 - 0.14254207726493973im
  0.027772939869193356 - 0.08993846560050647im
   0.08968386831642408 - 0.103795003884636im
  0.021978691576562705 - 0.027715617863152978im
   0.08588451096794163 + 0.11363151204164426im
   -0.1296732730180196 + 0.13073778856111282im
   -0.0662836484385469 + 0.0030833597415949312im
  -0.00581362429603359 + 0.053419979736271925im
  -0.02001421331013578 + 0.25541778489970246im
  -0.04275025750382367 - 0.18265380653718322im
  -0.06775945976274389 + 0.19543012799588874im
  -0.02510039518967135 - 0.044874551602648104im
   0.02517853798989311 + 0.07865800584730837im
    0.0675208425100086 + 0.12787774172063446im
   0.18772667150360886 - 0.011943348763072204im
   0.10766018145276753 + 0.02462713673731725im
  -0.14851542008415267 + 0.03559960599407132im
   0.15702816452741852 + 0.05829789643471382im
 -0.011596397151587997 - 0.02695170558781217im
  -0.05652733131813738 - 0.0002642361669901545im
    0.3714645139260867 + 0.0im
   0.16474183228973466 - 0.050781015079633576im
   0.09049226542233109 + 0.05542681275587722im
 -0.026521323244890187 - 0.03845736709776571im
   0.18834288749861833 + 0.1711869434025478im
   0.06865885928621043 - 0.137207547621778im
   0.15320395289473723 - 0.18572855802107255im
  -0.05205718806617459 - 0.24684860152343402im
  -0.01341262470509333 - 0.04766843505816908im
   0.12226113001998556 + 0.12716203608377438im</code></pre><p>In the phase estimation process, we will feed the state to circuit and measure the first <code>n</code> qubits processed by iQFT.</p><pre><code class="language-julia hljs">r = join(ArrayReg(psi), zero_state(N))
r |&gt; PE(N, M, U)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 8/8
    nlevel: 2</code></pre><p>Since our phase can be represented by 3 qubits precisely, we only need to measure once</p><pre><code class="language-julia hljs">results = measure(r, 1:N; nshots=1)</code></pre><pre><code class="nohighlight hljs">1-element Vector{DitStr{2, 3, Int64}}:
 011 ₍₂₎</code></pre><p>Recall that our QFT&#39;s bit numbering is reversed, let&#39;s reverse it back</p><pre><code class="language-julia hljs">using BitBasis
estimated_phase = bfloat(results[]; nbits=N)</code></pre><pre><code class="nohighlight hljs">0.75</code></pre><p>the phase is exactly <code>0.75</code>!</p><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../1.prepare-ghz-state/index.html">« Prepare Greenberger–Horne–Zeilinger state with Quantum Circuit</a><a class="docs-footer-nextpage" href="../3.grover-search/index.html">Grover Search »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.23 on <span class="colophon-date" title="Thursday 8 December 2022 12:58">Thursday 8 December 2022</span>. Using Julia version 1.8.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
