<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Quantum Fourier Transformation and Phase Estimation · Documentation | Yao</title><meta name="title" content="Quantum Fourier Transformation and Phase Estimation · Documentation | Yao"/><meta property="og:title" content="Quantum Fourier Transformation and Phase Estimation · Documentation | Yao"/><meta property="twitter:title" content="Quantum Fourier Transformation and Phase Estimation · Documentation | Yao"/><meta name="description" content="Documentation for Documentation | Yao."/><meta property="og:description" content="Documentation for Documentation | Yao."/><meta property="twitter:description" content="Documentation for Documentation | Yao."/><script data-outdated-warner src="../../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../search_index.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script><link href="../../../assets/indigo.css" rel="stylesheet" type="text/css"/><link href="https://yaoquantum.org/assets/favicon-light.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../index.html"><img src="../../../assets/logo.png" alt="Documentation | Yao logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../../index.html">Documentation | Yao</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../../index.html">Home</a></li><li><a class="tocitem" href="../../../quick-start.html">Quick Start</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../../../man/registers.html">Quantum Registers</a></li><li><a class="tocitem" href="../../../man/blocks.html">Blocks</a></li><li><a class="tocitem" href="../../../man/symbolic.html">Symbolic Computation</a></li><li><a class="tocitem" href="../../../man/cuda.html">CUDA extension - CuYao</a></li><li><a class="tocitem" href="../../../man/plot.html">Quantum Circuit Visualization</a></li><li><a class="tocitem" href="../../../man/automatic_differentiation.html">Automatic Differentiation</a></li><li><a class="tocitem" href="../../../man/yao2einsum.html">Tensor network backend</a></li><li><a class="tocitem" href="../../../man/simplification.html">Simplification</a></li><li><a class="tocitem" href="../../../man/bitbasis.html">BitBasis</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../1.prepare-ghz-state/index.html">Prepare Greenberger–Horne–Zeilinger state with Quantum Circuit</a></li><li class="is-active"><a class="tocitem" href="index.html">Quantum Fourier Transformation and Phase Estimation</a><ul class="internal"><li><a class="tocitem" href="#Quantum-Fourier-Transformation"><span>Quantum Fourier Transformation</span></a></li><li><a class="tocitem" href="#Wrap-QFT-to-an-external-block"><span>Wrap QFT to an external block</span></a></li><li><a class="tocitem" href="#Phase-Estimation"><span>Phase Estimation</span></a></li></ul></li><li><a class="tocitem" href="../3.grover-search/index.html">Grover Search</a></li><li><a class="tocitem" href="../4.shor-algorithm/index.html">Shor&#39;s Algorithm</a></li><li><a class="tocitem" href="../5.shor-9-code/index.html">Shor&#39;s 9 qubit code</a></li><li><a class="tocitem" href="../6.quantum-circuit-born-machine/index.html">Quantum Circuit Born Machine</a></li><li><a class="tocitem" href="../7.variation-quantum-eigen-solver/index.html">Variational Quantum Eigen Solver</a></li><li><a class="tocitem" href="../8.riemannian-gradient-flow/index.html">Riemannian gradient flow optimizer</a></li></ul></li><li><a class="tocitem" href="../../../performancetips.html">Performance Tips</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href="index.html">Quantum Fourier Transformation and Phase Estimation</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="index.html">Quantum Fourier Transformation and Phase Estimation</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/QuantumBFS/Yao.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/QuantumBFS/Yao.jl/blob/master/docs/src/examples/2.qft-phase-estimation/main.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><p><a href="/generated/examples/2.qft-phase-estimation/main.ipynb"><img src="https://mybinder.org/badge_logo.svg" alt/></a></p><h1 id="example-qft"><a class="docs-heading-anchor" href="#example-qft">Quantum Fourier Transformation and Phase Estimation</a><a id="example-qft-1"></a><a class="docs-heading-anchor-permalink" href="#example-qft" title="Permalink"></a></h1><p>Let&#39;s use Yao first</p><pre><code class="language-julia hljs">using Yao</code></pre><h2 id="Quantum-Fourier-Transformation"><a class="docs-heading-anchor" href="#Quantum-Fourier-Transformation">Quantum Fourier Transformation</a><a id="Quantum-Fourier-Transformation-1"></a><a class="docs-heading-anchor-permalink" href="#Quantum-Fourier-Transformation" title="Permalink"></a></h2><p>The Quantum Fourier Transformation (QFT) circuit is to repeat two kinds of blocks repeatly:</p><p><img src="assets/qft.png" alt="qft-circuit"/></p><p>The basic building block control phase shift gate is defined as</p><p class="math-container">\[R(k)=\begin{bmatrix}
1 &amp; 0\\
0 &amp; \exp\left(\frac{2\pi i}{2^k}\right)
\end{bmatrix}\]</p><p>Let&#39;s define block <code>A</code> and block <code>B</code>, block <code>A</code> is actually a control block.</p><pre><code class="language-julia hljs">A(i, j) = control(i, j=&gt;shift(2π/(1&lt;&lt;(i-j+1))))</code></pre><pre><code class="nohighlight hljs">A (generic function with 1 method)</code></pre><p>Once you construct the blockl you can inspect its matrix using <code>mat</code> function. Let&#39;s construct the circuit in dash box A, and see the matrix of <span>$R_4$</span> gate.</p><pre><code class="language-julia hljs">R4 = A(4, 1)</code></pre><pre><code class="nohighlight hljs">(n -&gt; control(n, 4, 1 =&gt; shift(0.39269908169872414)))</code></pre><p>If you have read about <a href="@ref tutorial-ghz">preparing GHZ state</a>, you probably know that in Yao, we could just leave the number of qubits, and it will be evaluated when possible.</p><pre><code class="language-julia hljs">R4(5)</code></pre><pre><code class="nohighlight hljs">nqubits: 5
control(4)
└─ (1,) shift(0.39269908169872414)</code></pre><p>its matrix will be</p><pre><code class="language-julia hljs">mat(R4(5))</code></pre><pre><code class="nohighlight hljs">32×32 Diagonal{ComplexF64, Vector{ComplexF64}}:
 1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im</code></pre><p>Then we repeat this control block over and over on different qubits, and put a Hadamard gate to <code>i</code>th qubit to construct <code>i</code>-th <code>B</code> block.</p><pre><code class="language-julia hljs">B(n, k) = chain(n, j==k ? put(k=&gt;H) : A(j, k) for j in k:n)</code></pre><pre><code class="nohighlight hljs">B (generic function with 1 method)</code></pre><p>We need to input the total number of qubits <code>n</code> here because we have to iterate through from <code>k</code>-th location to the last.</p><p>Now, let&#39;s construct the circuit by chaining all the <code>B</code> blocks together</p><pre><code class="language-julia hljs">qft(n) = chain(B(n, k) for k in 1:n)
qft(4)</code></pre><pre><code class="nohighlight hljs">nqubits: 4
chain
├─ chain
│  ├─ put on (1)
│  │  └─ H
│  ├─ control(2)
│  │  └─ (1,) shift(1.5707963267948966)
│  ├─ control(3)
│  │  └─ (1,) shift(0.7853981633974483)
│  └─ control(4)
│     └─ (1,) shift(0.39269908169872414)
├─ chain
│  ├─ put on (2)
│  │  └─ H
│  ├─ control(3)
│  │  └─ (2,) shift(1.5707963267948966)
│  └─ control(4)
│     └─ (2,) shift(0.7853981633974483)
├─ chain
│  ├─ put on (3)
│  │  └─ H
│  └─ control(4)
│     └─ (3,) shift(1.5707963267948966)
└─ chain
   └─ put on (4)
      └─ H
</code></pre><h2 id="Wrap-QFT-to-an-external-block"><a class="docs-heading-anchor" href="#Wrap-QFT-to-an-external-block">Wrap QFT to an external block</a><a id="Wrap-QFT-to-an-external-block-1"></a><a class="docs-heading-anchor-permalink" href="#Wrap-QFT-to-an-external-block" title="Permalink"></a></h2><p>In most cases, <code>function</code>s are enough to wrap quantum circuits, like <code>A</code> and <code>B</code> we defined above, but sometimes, we need to dispatch specialized methods on certain kinds of quantum circuit, or we want to define an external block to export, thus, it&#39;s useful to be able to wrap circuit to custom blocks.</p><p>First, we define a new type as subtype of <code>PrimitiveBlock</code> since we are not going to use the subblocks of <code>QFT</code>, if you need to use its subblocks, it&#39;d be better to define it under <code>CompositeBlock</code>.</p><pre><code class="language-julia hljs">struct QFT &lt;: PrimitiveBlock{2}
    n::Int
end

YaoBlocks.nqudits(q::QFT) = q.n</code></pre><p>Now, let&#39;s define its circuit</p><pre><code class="language-julia hljs">circuit(q::QFT) = qft(q.n)</code></pre><pre><code class="nohighlight hljs">circuit (generic function with 1 method)</code></pre><p>And forward <code>mat</code> to its circuit&#39;s matrix</p><pre><code class="language-julia hljs">YaoBlocks.mat(::Type{T}, x::QFT) where T = mat(T, circuit(x))</code></pre><p>You may notice, it is a little ugly to print <code>QFT</code> at the moment, this is because we print the type summary by default, you can define your own printing by overloading <code>print_block</code></p><pre><code class="language-julia hljs">YaoBlocks.print_block(io::IO, x::QFT) = print(io, &quot;QFT($(x.n))&quot;)</code></pre><p>Since it is possible to use FFT to simulate the results of QFT (like cheating), we could define our custom <code>apply!</code> method:</p><pre><code class="language-julia hljs">using FFTW, LinearAlgebra

function YaoBlocks.apply!(r::ArrayReg, x::QFT)
    α = sqrt(length(statevec(r)))
    invorder!(r)
    lmul!(α, ifft!(statevec(r)))
    return r
end</code></pre><p>Now let&#39;s check if our <code>apply!</code> method is correct:</p><pre><code class="language-julia hljs">r = rand_state(5)
r1 = r |&gt; copy |&gt; QFT(5)
r2 = r |&gt; copy |&gt; circuit(QFT(5))
r1 ≈ r2</code></pre><pre><code class="nohighlight hljs">true</code></pre><p>We can get iQFT (inverse QFT) directly by calling <code>adjoint</code></p><pre><code class="language-julia hljs">QFT(5)&#39;</code></pre><pre><code class="nohighlight hljs"> [†]QFT(5)</code></pre><p>QFT and iQFT are different from FFT and IFFT in three ways,</p><ol><li>they are different by a factor of <span>$\sqrt{2^n}$</span> with <span>$n$</span> the number of qubits.</li><li>the <a href="https://quantumbfs.github.io/BitBasis.jl/stable/tutorial/#Conventions-1">bit numbering</a> will exchange after applying QFT or iQFT.</li><li>due to the convention, QFT is more related to IFFT rather than FFT.</li></ol><h2 id="Phase-Estimation"><a class="docs-heading-anchor" href="#Phase-Estimation">Phase Estimation</a><a id="Phase-Estimation-1"></a><a class="docs-heading-anchor-permalink" href="#Phase-Estimation" title="Permalink"></a></h2><p>Since we have QFT and iQFT blocks we can then use them to realize phase estimation circuit, what we want to realize is the following circuit:</p><p><img src="assets/phaseest.png" alt="phase estimation"/></p><p>First we call Hadamard gates repeatly on first <code>n</code> qubits.</p><pre><code class="language-julia hljs">Hadamards(n) = repeat(H, 1:n)</code></pre><pre><code class="nohighlight hljs">Hadamards (generic function with 1 method)</code></pre><p>Then in dashed box <code>B</code>, we have controlled unitaries:</p><pre><code class="language-julia hljs">ControlU(n, m, U) = chain(n+m, control(k, n+1:n+m=&gt;matblock(U^(2^(k-1)))) for k in 1:n)</code></pre><pre><code class="nohighlight hljs">ControlU (generic function with 1 method)</code></pre><p>each of them is a <code>U</code> of power <span>$2^{(k-1)}$</span>.</p><p>Since we will only apply the qft and Hadamard on first <code>n</code> qubits, we could use <code>Subroutine</code>, which creates a context of a sub-scope of the qubits.</p><pre><code class="language-julia hljs">PE(n, m, U) =
    chain(n+m, # total number of the qubits
        subroutine(Hadamards(n), 1:n), # apply H in local scope
        ControlU(n, m, U),
        subroutine(QFT(n)&#39;, 1:n))</code></pre><pre><code class="nohighlight hljs">PE (generic function with 1 method)</code></pre><p>we use the first <code>n</code> qubits as the output space to store phase <span>$ϕ$</span>, and the other <code>m</code> qubits as the input state which corresponds to an eigenvector of oracle matrix <code>U</code>.</p><p>The subroutine here uses <code>focus!</code> and <code>relax!</code> to manage a local scope of quantum circuit, and only activate the first <code>n</code> qubits while applying the block inside the subroutine context, and the scope will be <code>relax!</code>ed back, after the context. This is equivalent to manually <code>focus!</code> then <code>relax!</code></p><p>fullly activated</p><pre><code class="language-julia hljs">r = rand_state(5)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 5/5
    nlevel: 2</code></pre><p>first 3 qubits activated</p><pre><code class="language-julia hljs">focus!(r, 1:3)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 3/5
    nlevel: 2</code></pre><p>relax back to the original</p><pre><code class="language-julia hljs">relax!(r, 1:3)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 5/5
    nlevel: 2</code></pre><p>In this way, we will be able to apply small operator directly on the subset of the qubits.</p><p>Details about the algorithm can be found here: <a href="https://en.wikipedia.org/wiki/Quantum_phase_estimation_algorithm">Quantum Phase Estimation Algorithm</a></p><p>Now let&#39;s check the results of our phase estimation.</p><p>First we need to set up a unitary with known phase, we set the phase to be 0.75, which is <code>0.75 * 2^3 == 6 == 0b110</code> .</p><pre><code class="language-julia hljs">N, M = 3, 5
P = eigen(rand_unitary(1&lt;&lt;M)).vectors
θ = Int(0b110) / 1&lt;&lt;N
phases = rand(1&lt;&lt;M)
phases[0b010+1] = θ
U = P * Diagonal(exp.(2π * im * phases)) * P&#39;</code></pre><pre><code class="nohighlight hljs">32×32 Matrix{ComplexF64}:
  -0.0526996-0.22421im       0.0128664+0.168771im   -0.0335017+0.133141im     -0.139864+0.0514957im    -0.0692334+0.0502212im    -0.0837363+0.100694im    -0.0935593+0.120847im      0.0132444+0.117902im     -0.0416006+0.0946299im     0.0196702+0.062941im     -0.118766-0.358501im     0.0678714-0.0510622im    -0.0346764-0.0370976im     0.0145856+0.00542763im    0.011167-0.177898im      -0.164386+0.0271192im    -0.024812+0.252677im       0.182036+0.149022im     -0.212218-0.00834517im      0.128909-0.0148332im        0.135067-0.0334861im     0.0471925-0.113645im       -0.141951-0.277749im     0.0104956-0.168331im      -0.0269291-0.104848im     -0.166469+0.0353146im     0.0374391+0.0185183im  -0.00348168-0.085192im    -0.0972994-0.229066im    -0.00615647+0.0145823im    0.0510723-0.0211244im     0.158325-0.325751im
    0.021477+0.15612im       0.0451422+0.227862im     0.164682-0.0127927im   -0.0184847+0.121588im       0.242953+0.0848848im      0.393205-0.0172452im   -0.0321594+0.0587131im    -0.0307446+0.161185im        -0.0329+0.0971828im     -0.222282-0.0936846im    -0.118975-0.0650255im    0.0877655+0.0687391im     0.0294707-0.198833im      0.0798504+0.0203396im   -0.0161194-0.189618im     -0.0652304+0.106762im     -0.233445-0.0617749im     0.0532101+0.0324228im    0.0759531+0.0554118im      -0.173281-0.031394im        -0.334095-0.016302im      0.0446035-0.072099im       0.0819948-0.00567213im   -0.127344+0.0624705im      -0.127168-0.0971389im   -0.0319754-0.176003im     0.00305449-0.0420586im   -0.0361255+0.0314326im    0.0475119+0.059434im      0.0616207-0.242125im    0.00428657-0.0559402im     0.212017+0.0410345im
   0.0416436-0.0934301im      0.152165+0.112657im    0.0048498-0.178783im   -0.00453895-0.00688684im   -0.0705875+0.0540186im     0.0562567-0.078178im     0.0169281+0.206605im      -0.273093+0.195288im     -0.0396568-0.0337249im      0.154088+0.241009im     0.0887246-0.197161im      -0.15096-0.125626im      -0.154155-0.0494132im     0.0893216+0.0183136im     -0.10499-0.0213312im    -0.0158709-0.0867938im     0.084292-0.128291im      0.0144216+0.110612im     0.0819109+0.0245111im      0.0360517+0.0216867im         0.22948-0.0398543im     0.0778227-0.237534im       -0.142968+0.224451im      0.090437+0.145049im       -0.182976-0.0105783im     0.083971-0.350783im     -0.0593166-0.0978377im    0.0096594+0.00553791im  -0.0120058+0.190394im       0.074465+0.138681im     -0.117305+0.048776im    -0.0334235+0.0891459im
   -0.114447+0.0267826im      0.204046+0.117025im     0.031464+0.0839363im   -0.0381309-0.097155im       0.174976-0.119684im      0.0631227-0.017931im      0.132102+0.112326im       0.126995+0.0803286im     -0.114003+0.0220304im      0.172382-0.139811im       0.17523-0.0852272im    0.0352349+0.0607725im     0.0757098-0.152536im       0.143193+0.0211829im   -0.0597211+0.24278im       -0.120496-0.177383im     0.0704901+0.0480815im    -0.0420049+0.141899im       0.13231+0.232756im     -0.00308174-0.000871037im     0.0817467+0.0638171im     0.0653938+0.148096im        -0.09353+0.0168172im     0.142905-0.119044im          0.2312+0.136564im     0.0811444+0.000236048im    0.242011-0.0818393im     0.141557-0.162881im    0.00897846-0.0691429im     -0.132358-0.285242im     -0.177197-0.184017im    -0.0651519+0.0265751im
    -0.16196+0.04318im     -0.00222885+0.0918224im   -0.216355+0.0483731im     0.151907+0.030621im      -0.114055-0.261561im      0.0982004+0.0667757im    -0.183614+0.0855967im     0.0850579-0.0324266im    -0.0247312+0.227811im      0.0537634+0.0976373im    -0.162944-0.128006im     0.0908347-0.0632589im     0.0477608+0.0540564im    -0.0478947-0.130234im     0.0146954+0.0665247im      0.165347+0.168511im      0.293011-0.223846im      -0.235956+0.157686im      0.186467-0.047072im      -0.0134422+0.17314im         -0.100106-0.0221659im     0.0176507+0.00544486im    -0.0573621+0.0245538im     0.189938+0.0217419im      0.0104439-0.0843072im    0.0340725+0.0462624im    0.00887288+0.303438im    -0.0756149-0.12242im     -0.0589397+0.0855981im     0.0339025-0.0812651im     0.108963+0.008236im      0.227321-0.00271815im
  -0.0198973-0.169897im       0.155247-0.0269878im    0.121943-0.0983296im    -0.228509+0.071926im     -0.0991372-0.0149831im     -0.194663+0.0601827im    -0.170723+0.0115248im      0.080792-0.00485213im    0.0203646+0.057984im      0.0246884+0.11498im     0.00365025+0.194606im     0.0869119-0.0922859im      0.136996-0.164313im     -0.0162447-0.174132im    -0.0883037+0.00220804im    0.0268356-0.0369269im    -0.224397-0.0541962im     -0.184356+0.134235im      0.210918-0.0178753im      -0.139185-0.153999im        0.0667736-0.0932159im      0.120596-0.0987019im     -0.0123099+0.0964591im   -0.0882137-0.120892im       0.0738775-0.22672im     -0.0767159+0.0266782im     -0.143226+0.15702im       0.222637+0.142038im      0.109937-0.025651im      0.0882444-0.236668im     0.0370734+0.143323im     -0.252635-0.125113im
    0.109692+0.197211im       0.318302+0.144226im   -0.0307001+0.270417im     0.0039144+0.0708409im        0.1331+0.152791im      -0.170094-0.0460297im    0.0152169-0.0603514im     -0.215923-0.0884439im     0.0139062-0.132778im      -0.146752+0.0197218im   -0.0179548+0.0540935im    -0.102458+0.146071im       0.146453+0.0735052im    0.00543751-0.158291im     0.0601049+0.0460455im     -0.162894-0.00382273im   0.0277309+0.180546im     -0.0735554+0.119003im     -0.127299-0.0216595im     -0.0359441+0.13372im          0.132909+0.0473203im     0.0637249-0.015771im       -0.191492+0.20374im      -0.128685+0.0607367im      0.0872138+0.0387368im    -0.131934-0.0243293im    -0.0496796+0.273773im     -0.229231-0.120381im     0.0765278+0.116297im     -0.0835098-0.065364im      0.182935+0.0726788im    0.0208514+0.0746688im
   -0.307013-0.0739188im   -0.00848203-0.0259702im  -0.0656224-0.195105im    -0.0983095+0.0160411im      0.165689+0.114549im      -0.114967-0.219381im     0.0810893-0.0351108im      -0.24492-0.356355im        -0.1001+0.0707986im     0.0717571+0.148253im    -0.0766847+0.080895im    -0.0810988+0.0016497im     0.0677662-0.0891377im      0.111804-0.273337im     -0.090062+0.0560679im    -0.0237164-0.12604im      0.0505477-0.0416444im    -0.0426183+0.114822im    -0.0829284-0.000884605im     -0.14693+0.0141793im      -0.0923368-0.114422im     -0.0534662-0.0524154im       0.183829-0.0562815im   -0.0335618+0.0927047im       0.058395-0.0648932im    0.0124759+0.0829818im      0.133508-0.150931im     -0.243324+0.0139238im   -0.0104966-0.14687im        0.138929+0.0512626im    -0.139356-0.133112im      0.173058-0.121189im
   0.0611846+0.248376im      -0.178336+0.203086im    -0.185816+0.0286254im    0.0328945-0.218976im      0.0176165-0.0270718im     -0.128726-0.0383419im    -0.179842-0.0255122im     0.0926665+0.0121187im    -0.0465622-0.158351im      0.0270193+0.123347im     0.0270672+0.00802681im  -0.0851438+0.074668im      -0.209031-0.0128505im     -0.128683-0.104866im     -0.128829-0.0174461im     0.0303311+0.0680851im   -0.0641363+0.0947116im    -0.0300977-0.133488im      0.295902-0.00376727im     -0.031368-0.0991096im       0.0946943-0.204714im      0.0616035-0.0387877im     -0.0178645+0.190945im     -0.146949-0.220257im      -0.0859313+0.0185098im   -0.0814557-0.0963711im     0.0741291-0.0516058im    -0.100947+0.126596im      -0.15256-0.255574im     -0.0602197-0.0310203im    0.0832016-0.329549im     0.0612271+0.0437996im
  -0.0514817-0.245863im    -0.00316769-0.0756546im  -0.0233101+0.0674767im     0.198535-0.236855im      -0.013886+0.137215im      -0.105374-0.0905547im   -0.0430623+0.189458im     -0.0410014-0.17734im       -0.140683-0.0664211im    -0.0204538-0.342189im    -0.0747444-0.139917im     -0.030444+0.0349938im    -0.0578586-0.204679im      -0.100327-0.0165035im   -0.0381737-0.0881166im     -0.059798+0.128274im     -0.103336+0.102187im      0.0297565-0.165046im     0.0125995-0.118479im       0.0780357+0.0989258im       -0.087351+0.0483064im      0.182538+0.152933im     -0.00776145+0.315134im      0.210304+0.213813im      -0.0545382-0.0776357im     0.139821+0.0313775im     -0.167778+0.0776875im   -0.0102367+0.0219384im   -0.0538598-0.0733193im     0.0718301-0.160489im    -0.0944015+0.00181514im  -0.0536422-0.129974im
   0.0930207-0.141369im      0.0814207-0.0898643im  -0.0481971+0.15851im      -0.324387-0.196512im      0.0728638-0.0884129im      0.122129-0.156981im     0.0972017+0.100457im    0.000510543-0.015194im      -0.249818-0.126377im      -0.034223-0.0111187im    -0.182679+0.0464573im    -0.135491+0.0114583im    -0.0692173+0.0815951im     -0.124133-0.191189im      0.159768-0.114212im       0.142563-0.117752im      0.105838-0.0775679im      0.133655+0.0324686im    0.0441796+0.0488246im     -0.0751049+0.0165166im       0.0946644-0.0244176im     -0.230363+0.115461im       -0.107981-0.2515im       0.0104913+0.102545im      -0.0866696-0.199158im      0.153505-0.0534395im     -0.118073-0.0193152im    0.0812421+0.0767528im   -0.0263256-0.0453259im    -0.0724453-0.164774im      0.225499-0.0642587im    -0.036968+0.208022im
 0.000705878-0.0969476im     -0.241083+0.149589im     0.052594+0.238072im   -0.00167003-0.0797823im    -0.0728902-0.016886im       0.137026-0.225749im     -0.232294-0.279158im     -0.0085945-0.0340486im    -0.0688998+0.213044im       0.169656+0.034077im    -0.0214041+0.134125im     0.0609437+0.00394617im    -0.132298-0.0535803im      0.248166-0.0507069im     0.107537+0.142746im      -0.270239+0.0129171im    0.0634691+0.00431202im    0.0194797+0.0550213im    -0.140894-0.00101342im      0.128963+0.0702723im      -0.0586261-0.148509im     -0.0552757-0.172203im       0.0995569+0.105604im    -0.0141099+0.125519im       -0.085201+0.0622051im    0.0719193-0.00918283im   -0.0787267-0.0382458im     0.109162+0.0276415im    0.0908013+0.110908im      -0.225418-0.066573im      0.163825-0.0840251im    -0.208546-0.0995218im
  -0.0321416+0.0867378im     -0.139512+0.0843357im  -0.0257491+0.108045im     0.0531004+0.227665im     -0.0270781-0.107576im      -0.273461-0.0839274im     0.256887-0.0432968im     0.0617154+0.00526426im    -0.043177-0.161891im      -0.285364+0.101344im    -0.0459011-0.176137im     0.0307638-0.0807071im     0.0173073-0.147331im     -0.0149138+0.0504633im     0.185761-0.0302623im      0.216707-0.0325253im     0.114226-0.12845im       0.0154417+0.195426im    -0.0522343-0.0292673im       0.202654-0.0403314im       -0.173661-0.0379108im      -0.06028-0.155808im      -0.0468049+0.140717im    -0.0916111+0.164686im       0.0805824+0.12859im     -0.0305386-0.0331888im     -0.134384-0.0741913im     0.196697-0.0752544im    0.0858208-0.185138im        0.14506-0.111759im    -0.0522445-0.196002im     -0.151204-0.00571249im
    0.148577-0.0149001im    -0.0308238+0.0235526im   0.0419356-0.103439im     0.0962817+0.00248175im    -0.150748+0.235222im       0.109346+0.00720702im  0.00863489-0.0517391im     -0.233927+0.0489686im     -0.223017+0.154743im      -0.126571-0.073194im     0.0380089+0.0719155im    0.0610347-0.16518im       -0.129263-0.031213im      -0.147371-0.200828im     0.0949673+0.295422im      0.0910363-0.117867im       0.18547+0.143574im      0.0307503-0.278336im     0.0497242-0.0195568im       0.122817-0.0863536im       -0.119161+0.000838841im   -0.198628+0.00598582im     -0.204238+0.0297301im   -0.0709444-0.132115im       0.0959283-0.100259im     -0.123843-0.10238im        0.172951+0.107398im      0.154474-0.0447004im     0.180049-0.019206im      0.0860733-0.0678686im   -0.0995235+0.0398628im     0.131653-0.100159im
   -0.114531+0.0804317im     0.0210623-0.0958594im  -0.0846496+0.131855im     0.0718596-0.0701802im      0.259943+0.132042im     -0.0921072-0.0915602im    0.0324504+0.120362im      0.0010089+0.0362917im     -0.359014-0.0515997im      0.126812+0.134266im     0.0118708+0.0471725im     0.233123-0.21724im       -0.126383+0.166344im       0.129926+0.135361im     0.0321382-0.122087im     -0.0601267-0.0340072im    -0.147327-0.0163779im     0.0107063+0.128843im      0.202647+0.0713155im       0.115439+0.055249im        -0.285809+0.0405311im     0.0333896+0.0196245im      -0.123934+0.0314755im    -0.145824-0.171469im    -0.000942224-0.020188im      0.137623+0.130501im     -0.0357911+0.123977im     0.0231863+0.043045im      0.126511-0.0452527im    -0.0514363+0.288195im     -0.009237+0.187957im    -0.0114534+0.0223733im
   -0.127284+0.13426im        0.103707+0.124028im    -0.115664-0.239562im   -0.00554238-0.008285im    -0.00485851-0.0893597im    -0.0414902-0.177435im    -0.0675211+0.0163979im    -0.0993181-0.000884703im   0.0020483+0.06928im       -0.149442+0.0024397im   -0.0206802-0.131825im      0.173749+0.0732023im   -0.00437264+0.178917im      0.0839669+0.179267im      0.190304-0.00299152im   -0.0289099-0.155981im     -0.106581+0.0116075im      0.324409-0.150081im      0.197423-0.107226im       0.0492002-0.0728798im        0.190661-0.2015im        0.0739498+0.0881837im       0.101953-0.080894im    -0.0360851+0.267468im       0.0869973-0.0254584im    0.0162207+0.13595im        0.221334+0.253697im     0.0485539+0.0551985im   -0.0423397+0.149897im      0.0971907-0.0523086im    0.0668706-0.0483685im    -0.164861-0.0785002im
   0.0696502-0.159469im      0.0150394+0.0807741im   -0.130125+0.0193233im   0.00548258+0.277112im      -0.247365+0.0697547im     0.0518858-0.0317775im     0.179939+0.113687im     -0.0362797+0.131226im      -0.268926-0.0989305im    -0.0101609-0.0587497im     0.113311+0.283702im    -0.0303286-0.0936213im    -0.0440631+0.188234im      0.0833293-0.0498594im     0.116039+0.119953im     -0.0809677+0.306883im     -0.145235-0.199502im     -0.0180334-0.0924409im    0.0367938+0.122487im       0.0227839-0.0148222im        0.092779+0.115781im       0.224311-0.166354im        0.105253-0.0785925im   -0.0133378+0.0995353im      0.0371628+0.0763067im    0.0291391+0.0888701im     0.0970457-0.015592im     -0.164918-0.029839im     -0.191899-0.188985im    -0.00158619-0.161222im     0.0613285-0.00562226im   0.0274824-0.0139409im
  -0.0220296+0.170458im      -0.036872-0.12908im    -0.0601073+0.0655985im    -0.152279+0.032035im       0.202421+0.131762im       0.336826-0.0320278im   -0.0709777-0.0118688im    -0.0577293+0.0990224im      0.064149+0.00528613im    0.0462787+0.102064im      0.048431-0.0975497im    0.0673374-0.299159im        0.10379+0.0487851im    -0.0978018-0.188214im     -0.187712+0.0223953im      0.138488+0.00636103im   -0.115138-0.163764im      0.0843848-0.150106im     -0.216701-0.119593im        0.112328+0.124344im          0.12297-0.114215im        0.16235+0.0755316im      0.0584825+0.0814634im     0.029026+0.0718714im       0.329867+0.0331765im   -0.0769042+0.0137809im     -0.208733+0.0839974im     0.103933-0.0621928im     -0.12129-0.15819im       -0.137187+0.0396078im   -0.0674553-0.0870251im   -0.0669507-0.00887694im
    0.091351-0.0830872im       -0.1707+0.0431448im  -0.0653883+0.0735367im    -0.105204+0.180808im       0.179188+0.14109im      -0.0333331+0.174624im     -0.036007+0.0195601im      0.182165+0.0144591im    -0.0824322-0.0740594im     -0.143039+0.162823im     -0.134083+0.0268468im    -0.167152-0.0549185im    -0.0597577-0.139102im      0.0977453-0.0246721im     0.138589+0.190325im     -0.0633443+0.190092im    -0.0989436-0.0130297im     0.0526082+0.0446524im      0.13114-0.117783im       -0.165654+0.188519im        0.0736324+0.0767059im     -0.125401+0.290725im       0.0449362-0.0274252im     0.165155-0.0128944im      0.0736835-0.0382206im    0.0217213-0.241467im       0.153475+0.0739081im    -0.045816+0.00580175im   0.0188203+0.162403im       0.070038+0.230543im    -0.0962702-0.128131im      -0.21622-0.19868im
 -0.00526069+0.145739im      -0.180294-0.123873im     0.224698+0.0718626im      0.12824+0.171157im        0.04955+0.0344771im   -0.00333851-0.047643im    -0.0301729+0.21762im      -0.0260494-0.135969im     -0.0141941-0.0339415im     0.0331475+0.189571im    -0.0748455-0.215251im       0.10955-0.0221524im    -0.0162447+0.291282im    -0.00832849-0.0986177im     0.136018+0.295225im     -0.0430491+0.041861im    -0.0725599+0.0718343im     0.0335584+0.0919956im    -0.102695-0.0168937im      -0.199755-0.370621im         0.116487+0.0768196im      0.081136+0.125441im      -0.0351933+0.106249im      0.185224-0.0300324im      -0.148205+0.00987847im   0.0375106+0.0908363im     -0.102335-0.114742im       0.07689+0.186446im     0.0572042+0.0541552im    -0.0557303-0.161242im     0.0250163-0.0243592im     0.137388+0.00848894im
  -0.0847002+0.0197681im       0.18982-0.0963067im  0.00843944-0.0790929im    0.0661384-0.0704379im     -0.111255-0.132573im     -0.0167062-0.0314768im    -0.208763+0.0269376im    -0.0800042+0.0722772im    -0.0614246+0.0870217im     -0.215458+0.00235595im  -0.0130242+0.184001im     -0.416831-0.148687im      -0.146427+0.0324579im      0.128571+0.252777im     0.0393623+0.045361im      0.0361421+0.116919im    -0.0502294+0.0964246im     0.0875503+0.206144im     -0.194445-0.00615652im     -0.110088+0.0163698im       -0.142121-0.23325im       0.0412116+0.14467im        -0.113198+0.0854878im    0.0494516-0.079196im         0.28642+0.0794923im    0.0154209+0.0115131im    -0.0308844-0.111033im      0.155427+0.133683im    -0.0955257-0.0309952im     0.0319423-0.0104818im     0.103125+0.00347085im    0.175178+0.0166448im
   0.0713924-0.113858im      0.0946699+0.131215im    -0.252416-0.0407791im    0.0366619+0.195766im       0.347226-0.0124321im    -0.0532429+0.174622im     -0.191526-0.0410822im      0.131619-0.0506614im    0.00926938-0.0207051im    -0.0749244-0.277745im     -0.032195+0.175062im    -0.0370288+0.0818734im    -0.0904563+0.0016823im     0.0592881-0.0992629im    0.0186509+0.0205087im      0.147878-0.236746im     0.0952899-0.170802im       0.189729-0.0377917im   -0.0689535-0.083673im      -0.0273856-0.188027im        0.0544263+0.0877789im      0.184586-0.26503im       -0.0834338+0.0893406im     0.146485-0.0165793im     -0.0425496-0.0216686im     0.120538+0.0786912im    -0.0147859-0.0531174im     0.136072+0.0500865im    0.0970887+0.00525505im    -0.134067+0.177761im     0.0390283-0.0326417im     0.158525-0.0783199im
   -0.125887-0.0266197im     0.0281366+0.0105762im   0.0344576-0.0798946im      0.15741-0.219995im     -0.0324576-0.064709im     -0.0593198+0.0882227im    0.0943868+0.00934589im     0.164707+0.0991362im    -0.0771024+0.0185111im     0.0679197-0.0329951im    0.0308684+0.0423954im     0.149027+0.0402419im    -0.0194482+0.0825894im    -0.0962465+0.0879855im   -0.0458843+0.2369im        0.0287442-0.0509216im   -0.0046151-0.0604171im    0.00316575+0.0306212im    -0.237431-0.0576166im      -0.196226-0.131882im        -0.170274-0.0352643im      0.212266-0.0206135im      -0.180119-0.194332im    -0.0840408+0.239225im       0.0979006-0.176145im     -0.104521-0.382234im     -0.0797432+0.0672767im     -0.26774+0.0396506im      0.14083-0.102194im     -0.0940908+0.0992041im    0.0895852-0.131027im     -0.162682-0.0451778im
    0.152412-0.00431073im        0.187-0.012701im    -0.201518-0.033806im    -0.0172127+0.117797im      0.0413976-0.0277642im      -0.14491+0.00777818im    0.111197+0.0649088im     0.0454225-0.235636im      0.0227818+0.200097im       0.126584+0.033986im      0.145697-0.191393im     0.0607027-0.0773204im      -0.10795-0.262008im        0.19184+0.0644888im    0.0995446+0.0143894im      0.104047+0.0726969im   -0.0123254-0.171141im     -0.0370906-0.221791im     -0.288697+0.172718im       0.0259621-0.0686514im       0.0125887-0.0512798im    -0.0758955+0.219384im        0.101453+0.0253774im    -0.216766-0.146979im       -0.104994+0.0483839im    0.0709948-0.185522im     -0.0205728+0.184275im    -0.0223858+0.22524im     -0.0762137+0.00797906im    -0.107354-0.0827493im     0.113784+0.0384242im    0.0565223+0.0127066im
    0.133198-0.149121im      0.0250425+0.0909123im   0.0918588-0.150477im      0.108653+0.0566016im      0.024745-0.0304923im     -0.113089+0.149175im     0.0537814+0.0834942im     -0.081447+0.10315im       0.0288761+0.112515im      -0.151804-0.106643im    -0.0266057-0.0597284im    0.0685877-0.222057im      0.0174377+0.139457im       0.136532-0.0690513im   -0.0691247+0.137087im    -0.00343515-0.310927im    -0.0799335+0.018126im     -0.0304214+0.00239852im   0.0609235+0.0184922im       0.129161+0.268762im       -0.0909842-0.0346586im     -0.011317+0.117826im        0.107893+0.0314828im    0.0462588-0.205297im      -0.0859363-0.105112im    -0.0652232+0.162576im      -0.236479-0.177682im     -0.248108+0.00896191im  -0.0805119+0.108059im      0.0112137-0.038134im      0.242776-0.296901im     -0.121609+0.103935im
   -0.180614-0.162015im     -0.0779949-0.0408623im   0.0572638+0.0759844im    0.0583387-0.161889im      0.0451599-0.00399472im    -0.247803-0.00238396im   -0.286814+0.0607043im      0.107415+0.114175im     -0.0279795-0.0728148im     -0.121496+0.103514im     -0.130163+0.00221854im   0.0776443-0.0660974im      0.248659-0.0775638im    -0.0155107-0.127331im     0.0358355+0.235137im      0.0988194-0.0562293im   -0.0904876-0.108953im       0.216511-0.124266im    -0.0690952+0.0904635im      0.0249893+0.182342im     -0.000704816+0.0489681im     0.0642795-0.0186044im   -0.000653766-0.00461155im   -0.249645+0.0444452im      -0.136935+0.173457im    -0.0747306-0.108862im       0.182318-0.151091im     0.0554528-0.0742914im    -0.190335+0.11662im      -0.0480854-0.0787552im   -0.0436086+0.246982im      0.127692+0.197802im
    0.019482+0.133349im      0.0252219-0.0950194im   -0.181238+0.0975017im     0.193444-0.0101663im    -0.0330123+0.120935im     -0.0447229-0.0739549im   -0.0539232+0.180348im      -0.133333+0.0586498im    -0.0962831+0.282698im     -0.0224052-0.0629882im    -0.256594+0.174654im      0.091593+0.130157im        0.10986-0.220907im      0.0765721+0.197464im    -0.0743203+0.0997473im    0.00640034+0.102805im    -0.0232086-0.0130566im    -0.0815823+0.0598686im    0.0197205+0.0225307im      0.0291617-0.0854414im        0.344818+0.119109im     -0.0531789+0.0394382im      0.0795171-0.112763im     -0.129112+0.0540488im     -0.0281847-0.184081im     -0.150554+0.0580238im     -0.170066-0.112382im      0.183541-0.108885im     0.0473298-0.0618928im     0.0350733+0.180568im    -0.0505314-0.202315im    0.00190268+0.194992im
    0.266957+0.0217313im    -0.0350241-0.200179im    0.0873894-0.144516im    -0.0469949-0.127124im       0.148885+0.0364518im    -0.0507674+0.0671436im    -0.125722+0.0299654im    -0.0852101-0.180692im      -0.101831+0.224429im     -0.0406663+0.0773261im   -0.0369939-0.199724im     -0.221732+0.173491im     -0.0479916+0.00355438im   -0.0497536+0.0672154im   -0.0403938+0.101143im     -0.0259142+0.124754im     -0.154629-0.268897im    -0.00702008-0.0495131im    0.0492424-0.024635im       0.0217669+0.0467351im      -0.0645623-0.031636im      0.0678654-0.24124im        -0.261883-0.24238im     -0.0125972-0.0648988im     -0.0256104+0.291472im     0.0231757+0.174252im     -0.0141393+0.0546681im   -0.0749905-0.173366im      0.125178-0.0188296im      0.025296-0.120602im    -0.0232138-0.0805421im    -0.169906+0.00395639im
  -0.0763112+0.108943im      0.0437671-0.165994im      0.19222+0.0548089im    0.0356515+0.136784im      -0.103252+0.00285778im     0.102541-0.0660406im    -0.171817+0.0967723im    -0.0596731+0.223005im     -0.0878699-0.0485598im     0.0592285-0.057705im    -0.0620166-0.0365481im   -0.0947933+0.151749im      0.0494308-0.218365im       0.277795-0.0867943im     0.232672-0.0159249im      0.109337-0.297297im      0.123819+0.0588598im     -0.159656-0.114063im     0.0866132-0.231592im      -0.0731817-0.0432628im       -0.058743+0.0646267im     0.0528564+0.00501558im    0.00394779-0.0980597im     0.037373-0.0471855im     -0.0722656+0.24634im     -0.0247106-0.0113805im    -0.0639824+0.150075im      -0.14962+0.136061im     -0.186063-0.277253im     -0.0155081+0.129478im     0.0194332+0.0542042im    -0.125218-0.0223303im
  -0.0384619-0.0992083im    -0.0939341-0.236417im   -0.0543226+0.178452im    -0.0278737+0.124686im      0.0759885+0.0696616im    -0.0749859-0.117371im      -0.20493+0.0333698im    0.00206588-0.0343029im     0.0971783+0.0230987im      0.125488-0.0526787im    0.0235097+0.0600985im    0.0526218-0.240631im       -0.11857+0.0118105im    -0.0804288+0.251016im      0.087988-0.15453im      0.00261277-0.0836516im     0.224991+0.0974592im      0.137147-0.0676519im     0.105403+0.0300181im      -0.173265+0.0114937im       0.0629778+0.156141im      0.0573877-0.195127im       0.0814426-0.056592im    -0.0721654-0.113063im        0.235936+0.0735088im   -0.0569099-0.154721im     -0.0984122+0.0460858im    -0.242171+0.0186384im    0.0724567+0.190884im       0.157128-0.287204im    -0.0987021-0.189369im     0.0322824+0.0715585im
   -0.086562+0.174062im       0.029792-0.179107im    0.0192398-0.234476im    -0.0746971-0.0220291im     0.0275427-0.135775im     -0.0348802+0.0735521im    -0.194879-0.123879im       0.028109+0.121027im      -0.225409-0.18035im       0.0984275-0.192854im    -0.0274879+0.0374182im    0.0526999-0.0615032im    -0.0658786+0.132226im       0.132279-0.0643474im     0.170971-0.128908im       0.153001+0.069145im     -0.170555+0.0469997im     -0.231306+0.0630727im    -0.266227-0.0197973im      0.0927331+0.0151053im         0.16132+0.0337549im     -0.123917+0.0209339im     -0.0535916+0.085894im     -0.133568-0.00978382im     -0.193624-0.0764674im    0.0476653-0.0366674im     0.0290406+0.0138659im   -0.0513447-0.243167im      0.017796+0.174555im      0.0115169-0.134815im     -0.200195-0.211563im     0.0298841-0.179489im
  -0.0466266+0.138217im       0.146521+0.0698492im    0.145948+0.0476715im   -0.0562904+0.116295im       -0.14261+0.190408im     -0.0660324+0.0224232im   -0.0610028-0.0910534im      0.251881+0.0731577im     0.0399354+0.149324im    -0.00688414+0.0193494im     -0.18313-0.109173im    -0.0217037+0.063691im      -0.213973+0.125365im      -0.114663+0.0390004im   -0.0296542+0.102299im      0.0513085-0.134681im    -0.0603604+0.0622643im     -0.108209-0.0988302im   -0.0675656+0.144168im      -0.0677471+0.359746im         0.154983-0.00739002im    0.0557787-0.0590411im      0.0987295+0.0174024im   -0.0791321+0.100666im       0.0278002-0.0300571im     0.422624+0.0255171im      0.015484-0.0301777im   0.00892479+0.102831im      0.239926-0.238744im       0.139422+0.00209327im  -0.0627664+0.0245244im    0.0902886+0.0484741im</code></pre><p>and then generate the state <span>$ψ$</span></p><pre><code class="language-julia hljs">psi = P[:, 3]</code></pre><pre><code class="nohighlight hljs">32-element Vector{ComplexF64}:
    0.08695905590612928 - 0.05584442741175883im
     0.1839919462018838 - 0.01635714469611562im
   -0.08571114158905853 - 0.03459324821296174im
     0.2713986794723094 + 0.12683226977672024im
   -0.03331728826095534 - 0.008451600033764784im
  -0.043525168796768016 + 0.07336898924704191im
    -0.1105799508732842 + 0.04146555806962089im
   -0.05124884742506187 - 0.06084513104894285im
  -0.020767298026627218 + 0.25371532130591123im
    0.37767931485098155 + 0.0im
     0.2086566724113831 + 0.0561826044515541im
  -0.021145682938249075 - 0.0320583709117203im
   -0.07428474695759227 - 0.037655458705691945im
  -0.045568255744059094 - 0.11600036157786942im
     0.2108471745090979 + 0.1729951718017576im
    0.07545594801362293 + 0.045763236215134034im
   -0.10514002907922385 - 0.032699731569213686im
   -0.06372974371813711 - 0.1513533409190795im
 -0.0058318478953128736 - 0.25199234349822247im
    -0.2447063965167265 + 0.0885609984432236im
   -0.04646182052375011 + 0.222959711152558im
   -0.06692569436803593 - 0.09244543368659627im
    0.05102601211261609 - 0.07190497040118868im
   -0.11885778270815689 + 0.18616059604897112im
   0.051349270745635674 - 0.014556489292634539im
    0.08534340867337267 - 0.18820930337577443im
   -0.05618059564861685 - 0.07570421565303549im
    0.09322514460994255 - 0.08683069465356412im
  -0.012257434706160168 - 0.016169510870687468im
     0.1565944395269311 + 0.14566930077054374im
    0.14430259083927063 + 0.1720424710993217im
    0.09384872930677537 + 0.00806120413230683im</code></pre><p>In the phase estimation process, we will feed the state to circuit and measure the first <code>n</code> qubits processed by iQFT.</p><pre><code class="language-julia hljs">r = join(ArrayReg(psi), zero_state(N))
r |&gt; PE(N, M, U)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 8/8
    nlevel: 2</code></pre><p>Since our phase can be represented by 3 qubits precisely, we only need to measure once</p><pre><code class="language-julia hljs">results = measure(r, 1:N; nshots=1)</code></pre><pre><code class="nohighlight hljs">1-element Vector{DitStr{2, 3, Int64}}:
 011 ₍₂₎</code></pre><p>Recall that our QFT&#39;s bit numbering is reversed, let&#39;s reverse it back</p><pre><code class="language-julia hljs">using BitBasis
estimated_phase = bfloat(results[]; nbits=N)</code></pre><pre><code class="nohighlight hljs">0.75</code></pre><p>the phase is exactly <code>0.75</code>!</p><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../1.prepare-ghz-state/index.html">« Prepare Greenberger–Horne–Zeilinger state with Quantum Circuit</a><a class="docs-footer-nextpage" href="../3.grover-search/index.html">Grover Search »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.4.1 on <span class="colophon-date" title="Tuesday 21 May 2024 20:49">Tuesday 21 May 2024</span>. Using Julia version 1.10.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
