<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Quantum Fourier Transformation and Phase Estimation · Documentation | Yao</title><meta name="title" content="Quantum Fourier Transformation and Phase Estimation · Documentation | Yao"/><meta property="og:title" content="Quantum Fourier Transformation and Phase Estimation · Documentation | Yao"/><meta property="twitter:title" content="Quantum Fourier Transformation and Phase Estimation · Documentation | Yao"/><meta name="description" content="Documentation for Documentation | Yao."/><meta property="og:description" content="Documentation for Documentation | Yao."/><meta property="twitter:description" content="Documentation for Documentation | Yao."/><script data-outdated-warner src="../../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../search_index.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script><link href="../../../assets/indigo.css" rel="stylesheet" type="text/css"/><link href="https://yaoquantum.org/assets/favicon-light.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../index.html"><img src="../../../assets/logo.png" alt="Documentation | Yao logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../../index.html">Documentation | Yao</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../../index.html">Home</a></li><li><a class="tocitem" href="../../../quick-start.html">Quick Start</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../../../man/registers.html">Quantum Registers</a></li><li><a class="tocitem" href="../../../man/blocks.html">Blocks</a></li><li><a class="tocitem" href="../../../man/symbolic.html">Symbolic Computation</a></li><li><a class="tocitem" href="../../../man/cuda.html">CUDA extension - CuYao</a></li><li><a class="tocitem" href="../../../man/plot.html">Quantum Circuit Visualization</a></li><li><a class="tocitem" href="../../../man/automatic_differentiation.html">Automatic Differentiation</a></li><li><a class="tocitem" href="../../../man/yao2einsum.html">Tensor network backend</a></li><li><a class="tocitem" href="../../../man/simplification.html">Simplification</a></li><li><a class="tocitem" href="../../../man/bitbasis.html">BitBasis</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../1.prepare-ghz-state/index.html">Prepare Greenberger–Horne–Zeilinger state with Quantum Circuit</a></li><li class="is-active"><a class="tocitem" href="index.html">Quantum Fourier Transformation and Phase Estimation</a><ul class="internal"><li><a class="tocitem" href="#Quantum-Fourier-Transformation"><span>Quantum Fourier Transformation</span></a></li><li><a class="tocitem" href="#Wrap-QFT-to-an-external-block"><span>Wrap QFT to an external block</span></a></li><li><a class="tocitem" href="#Phase-Estimation"><span>Phase Estimation</span></a></li></ul></li><li><a class="tocitem" href="../3.grover-search/index.html">Grover Search</a></li><li><a class="tocitem" href="../4.shor-algorithm/index.html">Shor&#39;s Algorithm</a></li><li><a class="tocitem" href="../5.shor-9-code/index.html">Shor&#39;s 9 qubit code</a></li><li><a class="tocitem" href="../6.quantum-circuit-born-machine/index.html">Quantum Circuit Born Machine</a></li><li><a class="tocitem" href="../7.variation-quantum-eigen-solver/index.html">Variational Quantum Eigen Solver</a></li><li><a class="tocitem" href="../8.riemannian-gradient-flow/index.html">Riemannian gradient flow optimizer</a></li></ul></li><li><a class="tocitem" href="../../../performancetips.html">Performance Tips</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href="index.html">Quantum Fourier Transformation and Phase Estimation</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="index.html">Quantum Fourier Transformation and Phase Estimation</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/QuantumBFS/Yao.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/QuantumBFS/Yao.jl/blob/master/docs/src/examples/2.qft-phase-estimation/main.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><p><a href="/generated/examples/2.qft-phase-estimation/main.ipynb"><img src="https://mybinder.org/badge_logo.svg" alt/></a></p><h1 id="example-qft"><a class="docs-heading-anchor" href="#example-qft">Quantum Fourier Transformation and Phase Estimation</a><a id="example-qft-1"></a><a class="docs-heading-anchor-permalink" href="#example-qft" title="Permalink"></a></h1><p>Let&#39;s use Yao first</p><pre><code class="language-julia hljs">using Yao</code></pre><h2 id="Quantum-Fourier-Transformation"><a class="docs-heading-anchor" href="#Quantum-Fourier-Transformation">Quantum Fourier Transformation</a><a id="Quantum-Fourier-Transformation-1"></a><a class="docs-heading-anchor-permalink" href="#Quantum-Fourier-Transformation" title="Permalink"></a></h2><p>The Quantum Fourier Transformation (QFT) circuit is to repeat two kinds of blocks repeatly:</p><p><img src="assets/qft.png" alt="qft-circuit"/></p><p>The basic building block control phase shift gate is defined as</p><p class="math-container">\[R(k)=\begin{bmatrix}
1 &amp; 0\\
0 &amp; \exp\left(\frac{2\pi i}{2^k}\right)
\end{bmatrix}\]</p><p>Let&#39;s define block <code>A</code> and block <code>B</code>, block <code>A</code> is actually a control block.</p><pre><code class="language-julia hljs">A(i, j) = control(i, j=&gt;shift(2π/(1&lt;&lt;(i-j+1))))</code></pre><pre><code class="nohighlight hljs">A (generic function with 1 method)</code></pre><p>Once you construct the blockl you can inspect its matrix using <code>mat</code> function. Let&#39;s construct the circuit in dash box A, and see the matrix of <span>$R_4$</span> gate.</p><pre><code class="language-julia hljs">R4 = A(4, 1)</code></pre><pre><code class="nohighlight hljs">(n -&gt; control(n, 4, 1 =&gt; shift(0.39269908169872414)))</code></pre><p>If you have read about <a href="@ref tutorial-ghz">preparing GHZ state</a>, you probably know that in Yao, we could just leave the number of qubits, and it will be evaluated when possible.</p><pre><code class="language-julia hljs">R4(5)</code></pre><pre><code class="nohighlight hljs">nqubits: 5
control(4)
└─ (1,) shift(0.39269908169872414)</code></pre><p>its matrix will be</p><pre><code class="language-julia hljs">mat(R4(5))</code></pre><pre><code class="nohighlight hljs">32×32 Diagonal{ComplexF64, Vector{ComplexF64}}:
 1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im</code></pre><p>Then we repeat this control block over and over on different qubits, and put a Hadamard gate to <code>i</code>th qubit to construct <code>i</code>-th <code>B</code> block.</p><pre><code class="language-julia hljs">B(n, k) = chain(n, j==k ? put(k=&gt;H) : A(j, k) for j in k:n)</code></pre><pre><code class="nohighlight hljs">B (generic function with 1 method)</code></pre><p>We need to input the total number of qubits <code>n</code> here because we have to iterate through from <code>k</code>-th location to the last.</p><p>Now, let&#39;s construct the circuit by chaining all the <code>B</code> blocks together</p><pre><code class="language-julia hljs">qft(n) = chain(B(n, k) for k in 1:n)
qft(4)</code></pre><pre><code class="nohighlight hljs">nqubits: 4
chain
├─ chain
│  ├─ put on (1)
│  │  └─ H
│  ├─ control(2)
│  │  └─ (1,) shift(1.5707963267948966)
│  ├─ control(3)
│  │  └─ (1,) shift(0.7853981633974483)
│  └─ control(4)
│     └─ (1,) shift(0.39269908169872414)
├─ chain
│  ├─ put on (2)
│  │  └─ H
│  ├─ control(3)
│  │  └─ (2,) shift(1.5707963267948966)
│  └─ control(4)
│     └─ (2,) shift(0.7853981633974483)
├─ chain
│  ├─ put on (3)
│  │  └─ H
│  └─ control(4)
│     └─ (3,) shift(1.5707963267948966)
└─ chain
   └─ put on (4)
      └─ H
</code></pre><h2 id="Wrap-QFT-to-an-external-block"><a class="docs-heading-anchor" href="#Wrap-QFT-to-an-external-block">Wrap QFT to an external block</a><a id="Wrap-QFT-to-an-external-block-1"></a><a class="docs-heading-anchor-permalink" href="#Wrap-QFT-to-an-external-block" title="Permalink"></a></h2><p>In most cases, <code>function</code>s are enough to wrap quantum circuits, like <code>A</code> and <code>B</code> we defined above, but sometimes, we need to dispatch specialized methods on certain kinds of quantum circuit, or we want to define an external block to export, thus, it&#39;s useful to be able to wrap circuit to custom blocks.</p><p>First, we define a new type as subtype of <code>PrimitiveBlock</code> since we are not going to use the subblocks of <code>QFT</code>, if you need to use its subblocks, it&#39;d be better to define it under <code>CompositeBlock</code>.</p><pre><code class="language-julia hljs">struct QFT &lt;: PrimitiveBlock{2}
    n::Int
end

YaoBlocks.nqudits(q::QFT) = q.n</code></pre><p>Now, let&#39;s define its circuit</p><pre><code class="language-julia hljs">circuit(q::QFT) = qft(q.n)</code></pre><pre><code class="nohighlight hljs">circuit (generic function with 1 method)</code></pre><p>And forward <code>mat</code> to its circuit&#39;s matrix</p><pre><code class="language-julia hljs">YaoBlocks.mat(::Type{T}, x::QFT) where T = mat(T, circuit(x))</code></pre><p>You may notice, it is a little ugly to print <code>QFT</code> at the moment, this is because we print the type summary by default, you can define your own printing by overloading <code>print_block</code></p><pre><code class="language-julia hljs">YaoBlocks.print_block(io::IO, x::QFT) = print(io, &quot;QFT($(x.n))&quot;)</code></pre><p>Since it is possible to use FFT to simulate the results of QFT (like cheating), we could define our custom <code>apply!</code> method:</p><pre><code class="language-julia hljs">using FFTW, LinearAlgebra

function YaoBlocks.apply!(r::ArrayReg, x::QFT)
    α = sqrt(length(statevec(r)))
    invorder!(r)
    lmul!(α, ifft!(statevec(r)))
    return r
end</code></pre><p>Now let&#39;s check if our <code>apply!</code> method is correct:</p><pre><code class="language-julia hljs">r = rand_state(5)
r1 = r |&gt; copy |&gt; QFT(5)
r2 = r |&gt; copy |&gt; circuit(QFT(5))
r1 ≈ r2</code></pre><pre><code class="nohighlight hljs">true</code></pre><p>We can get iQFT (inverse QFT) directly by calling <code>adjoint</code></p><pre><code class="language-julia hljs">QFT(5)&#39;</code></pre><pre><code class="nohighlight hljs"> [†]QFT(5)</code></pre><p>QFT and iQFT are different from FFT and IFFT in three ways,</p><ol><li>they are different by a factor of <span>$\sqrt{2^n}$</span> with <span>$n$</span> the number of qubits.</li><li>the <a href="https://quantumbfs.github.io/BitBasis.jl/stable/tutorial/#Conventions-1">bit numbering</a> will exchange after applying QFT or iQFT.</li><li>due to the convention, QFT is more related to IFFT rather than FFT.</li></ol><h2 id="Phase-Estimation"><a class="docs-heading-anchor" href="#Phase-Estimation">Phase Estimation</a><a id="Phase-Estimation-1"></a><a class="docs-heading-anchor-permalink" href="#Phase-Estimation" title="Permalink"></a></h2><p>Since we have QFT and iQFT blocks we can then use them to realize phase estimation circuit, what we want to realize is the following circuit:</p><p><img src="assets/phaseest.png" alt="phase estimation"/></p><p>First we call Hadamard gates repeatly on first <code>n</code> qubits.</p><pre><code class="language-julia hljs">Hadamards(n) = repeat(H, 1:n)</code></pre><pre><code class="nohighlight hljs">Hadamards (generic function with 1 method)</code></pre><p>Then in dashed box <code>B</code>, we have controlled unitaries:</p><pre><code class="language-julia hljs">ControlU(n, m, U) = chain(n+m, control(k, n+1:n+m=&gt;matblock(U^(2^(k-1)))) for k in 1:n)</code></pre><pre><code class="nohighlight hljs">ControlU (generic function with 1 method)</code></pre><p>each of them is a <code>U</code> of power <span>$2^{(k-1)}$</span>.</p><p>Since we will only apply the qft and Hadamard on first <code>n</code> qubits, we could use <code>Subroutine</code>, which creates a context of a sub-scope of the qubits.</p><pre><code class="language-julia hljs">PE(n, m, U) =
    chain(n+m, # total number of the qubits
        subroutine(Hadamards(n), 1:n), # apply H in local scope
        ControlU(n, m, U),
        subroutine(QFT(n)&#39;, 1:n))</code></pre><pre><code class="nohighlight hljs">PE (generic function with 1 method)</code></pre><p>we use the first <code>n</code> qubits as the output space to store phase <span>$ϕ$</span>, and the other <code>m</code> qubits as the input state which corresponds to an eigenvector of oracle matrix <code>U</code>.</p><p>The subroutine here uses <code>focus!</code> and <code>relax!</code> to manage a local scope of quantum circuit, and only activate the first <code>n</code> qubits while applying the block inside the subroutine context, and the scope will be <code>relax!</code>ed back, after the context. This is equivalent to manually <code>focus!</code> then <code>relax!</code></p><p>fullly activated</p><pre><code class="language-julia hljs">r = rand_state(5)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 5/5
    nlevel: 2</code></pre><p>first 3 qubits activated</p><pre><code class="language-julia hljs">focus!(r, 1:3)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 3/5
    nlevel: 2</code></pre><p>relax back to the original</p><pre><code class="language-julia hljs">relax!(r, 1:3)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 5/5
    nlevel: 2</code></pre><p>In this way, we will be able to apply small operator directly on the subset of the qubits.</p><p>Details about the algorithm can be found here: <a href="https://en.wikipedia.org/wiki/Quantum_phase_estimation_algorithm">Quantum Phase Estimation Algorithm</a></p><p>Now let&#39;s check the results of our phase estimation.</p><p>First we need to set up a unitary with known phase, we set the phase to be 0.75, which is <code>0.75 * 2^3 == 6 == 0b110</code> .</p><pre><code class="language-julia hljs">N, M = 3, 5
P = eigen(rand_unitary(1&lt;&lt;M)).vectors
θ = Int(0b110) / 1&lt;&lt;N
phases = rand(1&lt;&lt;M)
phases[0b010+1] = θ
U = P * Diagonal(exp.(2π * im * phases)) * P&#39;</code></pre><pre><code class="nohighlight hljs">32×32 Matrix{ComplexF64}:
   0.273377+0.028995im      -0.151105+0.17996im        -0.322557-0.0285396im      0.194415-0.0621056im    0.0698352-0.15085im      -0.0913545-0.0520082im      -0.129152+0.101798im      -0.156983-0.0683686im     0.0599082+0.134617im      0.171737-0.164708im      -0.105015-0.0302217im      -0.280791+0.0600845im     0.166221+0.256013im      0.0511359+0.0342509im   -0.00953045+0.0176098im    -0.0447429+0.205799im     -0.0426531+0.0340066im    -0.235507+0.0416017im     0.115764-0.070069im    -0.0920808+0.069959im      0.104285+0.0503641im   -0.0294796+0.131241im    0.0184657-0.137691im      0.106209-0.0139664im      -0.197631+0.0094396im  0.000635473-0.168938im   -0.0391384-0.00373406im    -0.123123+0.0186343im        0.15706-0.0958053im     0.106462-0.0185146im      0.126356-0.0277572im    -0.0891199+0.0642551im
 -0.0388806+0.0431214im      0.292797+0.19069im         0.148252-0.183125im      0.0342547+0.115114im    -0.0800088-0.00626896im      0.14041-0.0858857im     -0.0597812-0.00441965im   -0.0921274-0.190274im     -0.0388235-0.202648im      0.106764-0.0200248im     0.0472474-0.0876651im      0.0540648+0.0948336im     0.179074+0.0339307im     0.0613676-0.158482im       0.190447+0.0429323im      0.191534-0.0510561im    0.00810983-0.0664187im     0.111956+0.0780105im    0.0148361+0.0694116im    -0.234943+0.0532185im      0.10426+0.199984im    -0.0553466+0.0715423im  -0.0938016-0.217361im     -0.145024+0.0942095im     -0.0893751-0.190889im    -0.0239391+0.0346167im   0.0719895-0.164401im       0.129801-0.23822im       0.00633473+0.0474629im     -0.11311+0.0397655im     0.0970002-0.12401im      0.00812633+0.287015im
  0.0588082+0.00124815im    0.0277329+0.00610851im   -0.00732541+0.30104im       0.0181111-0.134568im     -0.160761-0.0796165im      0.125237-0.174109im      -0.0114566-0.214319im      -0.128006+0.0118466im    -0.0280508+0.155551im     0.0513956+0.29928im      0.00416591+0.0471059im      -0.186635+0.210977im     -0.161195+0.0521229im     -0.198016-0.0344624im      0.160575+0.0688305im     0.0206727-0.112034im      -0.114696+0.0807311im   -0.0361247-0.00529774im   0.0316624+0.132159im     0.0729566-0.15688im      0.0372788-0.177143im    -0.0435286-0.14259im     0.0827788-0.0616057im     0.142043-0.0103322im     -0.0314302-0.142056im      0.258141-0.0172121im   -0.101564-0.0501676im     0.0136239-0.0658123im     -0.0287717+0.00234791im  -0.0232475-0.0977681im      -0.25073-0.234306im     -0.0406274+0.208189im
    0.05753-0.0880387im     0.0658443-0.111251im       0.0126535+0.0408094im       0.19246+0.108706im      0.155858+0.168918im      -0.142987+0.035058im       -0.106623-0.204198im       0.179458-0.149929im       0.228081-0.0201807im    0.0220183-0.144245im     -0.0209011+0.0258863im      -0.117529+0.199499im       0.07373-0.169344im     -0.0466863+0.0643534im      -0.15916+0.146388im       0.136602+0.125918im        0.12873-0.163718im      0.192661-0.152442im    -0.0508165+0.310875im     -0.161089+0.018358im       0.15004-0.247358im     -0.153681-0.0538304im  0.00172835+0.0703889im  -0.00833795+0.0294703im     0.00687705+0.0410825im     0.110748-0.0898103im   -0.214767+0.115872im      0.0626353-0.051204im       0.0496121+0.0799257im   -0.0208842-0.11706im        0.145837-0.0628139im     0.0182096-0.0842295im
  -0.126868+0.191302im     -0.0954926-0.0702368im     -0.0552109+0.0505862im   -0.00320453-0.083937im     0.0230715-0.0288074im      0.059512+0.0609244im      -0.197099+0.0115669im     0.0999797-0.00415387im    0.0575428-0.0413151im   -0.0178063+0.0428916im    -0.0765561-0.0555599im     -0.0948032+0.0600998im   -0.0124681-0.0768457im   -0.00775287+0.1493im         0.144748-0.0147651im     0.0728291-0.00203006im   -0.0292423+0.105454im      0.126063+0.187363im     -0.145864-0.0329706im    -0.142187+0.051506im     -0.287424+0.0278059im    -0.178026-0.0828954im    -0.23007+0.356439im      0.156257+0.0500142im      -0.268925+0.165361im    -0.0739651-0.06307im     0.0715498-0.393562im     -0.0068191-0.0189952im     -0.0477222+0.10299im      0.0336127+0.000650017im   0.0703364-0.0927177im     -0.210631-0.0293201im
 -0.0038992-0.0231757im      0.197274+0.0464012im     -0.0106318-0.132309im      0.0713237-0.242047im     0.0326451+0.0978832im     0.0603112+0.0543253im       0.103405+0.0730496im    -0.0664832-0.147304im       0.083943-0.0090902im   -0.0816592+0.0853729im      0.287819-0.0632869im      -0.156506-0.129966im    -0.0853094-0.0196571im      0.202919-0.282233im      -0.103168-0.0492811im    -0.0292317+0.15875im      -0.0995548+0.217737im      0.164448+0.0322867im    -0.117095-0.0571052im    -0.249041+0.0406738im  -0.00481051-0.230819im     0.0197951+0.0112343im   0.0513654+0.0527713im  -0.00251739-0.12438im        -0.076558+0.0123761im   -0.0110512-0.0892745im   0.0395069+0.0541213im    0.00843221+0.0931387im       0.285934+0.136725im     0.0251418+0.0658626im     -0.343897+0.0701964im    -0.0539107-0.0335469im
   0.159438-0.0824215im      0.151308-0.110987im        0.168933+0.173862im      -0.115898-0.0435583im    0.0875811-0.088129im      0.0277806+0.013688im        0.251271+0.193295im      0.0405348-0.0064401im       0.18185-0.0281011im     0.158165-0.0511526im    -0.0468981+0.114368im      -0.0556324-0.216808im    -0.0900861+0.0751876im    -0.0853072+0.0763649im    -0.0686593+0.183549im       -0.17836+0.153733im      -0.103486+0.0385044im     0.262352-0.0852051im     0.277856+0.108477im      0.106693-0.0176609im   -0.0530005+0.0543412im    0.0271482-0.0700832im   -0.204699+0.0223547im    0.0116457+0.0761342im      -0.157232-0.230776im     -0.282967+0.0348934im   -0.152162-0.0200658im    -0.0226757-0.0567713im      0.0139212-0.0673483im    -0.030531+0.123542im      0.0261847-0.0933635im     -0.158752+0.0389357im
     0.1703+0.0775266im     -0.130519+0.0317337im      -0.154387-0.0657681im       0.14139+0.150811im     -0.265197-0.00464008im   -0.0761452-0.255779im        0.182464-0.00992572im      0.11026+0.079199im      0.0768012-0.0684289im    -0.106095-0.0572611im      0.247404+0.00796832im    -0.0239622+0.0491712im    -0.248629-0.196815im       0.122307-0.0945147im   -0.00809707+0.107775im     -0.0250516-0.0488921im      0.174869+0.0676428im   -0.0461641+0.0835694im    0.0540601+0.143269im     0.0214348-0.0878163im    -0.278342+0.0289098im     0.100917+0.0999521im   0.0294279-0.0116793im    0.0823376+0.106266im       -0.168705+0.0173009im   -0.0887989-0.21233im    0.00778153+0.0393987im      0.238413-0.0233713im     -0.0331331-0.102456im      0.018703+0.190118im      0.0923756-0.10325im        0.229099+0.0135426im
  -0.104171+0.0177137im     0.0583596+0.181057im         -0.1007+0.133114im     -0.0652529+0.0771341im     0.230673-0.00818677im    0.0390154-0.0954806im     -0.0224042+0.017926im       0.187013+0.00362844im     0.151479+0.109668im    -0.0578718-0.119471im     -0.0529031-0.044706im        0.182302+0.118406im    -0.0359641+0.215867im     -0.0678104-0.321256im      -0.180024-0.128489im       0.141611-0.125622im      -0.139589-0.0215im       -0.107182-0.159516im     -0.139602-0.098922im      0.142136-0.233044im      -0.09562+0.0793476im   -0.0546516+0.237516im    -0.183379+0.24221im     -0.0642667+0.0890463im      -0.195855-0.13041im      0.0536561+0.0461134im  -0.0777763+0.157077im      0.0901199-0.0638074im        0.10139+0.0413153im    0.0763656-0.0112807im    -0.0698584-0.0597213im    0.00535798+0.0137968im
   0.144056+0.0951766im    -0.0787466+0.0109307im     -0.0305434-0.0754773im     -0.153179+0.0135355im   -0.0882212+0.0561848im    -0.0624904+0.0950197im      0.0359219+0.25968im      -0.0707903-0.146901im     -0.0136281-0.230221im      0.323082+0.204054im    -0.00457203-0.0785753im      0.0068505+0.00933895im   0.0494642-0.116514im     -0.0925447+0.0973125im    -0.0494618+0.192546im      0.0431628+0.0311756im    -0.0674835-0.218935im    -0.0619725-0.0531632im    -0.247168-0.169461im      0.121637-0.138735im    0.00139638-0.129141im     0.0184631-0.0652868im   -0.196516+0.0730952im     0.150899-0.102561im        0.138352+0.014276im    -0.0301849-0.0711303im   0.0599767+0.112575im       0.122434-0.106342im        0.129214+0.117809im      0.299787-0.0255114im    -0.0110992-0.0659442im      0.196172+0.137766im
 -0.0239596+0.193651im     -0.0430046+0.00829131im      0.303376+0.00628579im    0.0300252-0.204382im     -0.053354+0.0526078im     -0.343188-0.0346615im     -0.0905406+0.128694im      0.0115621+0.30416im       -0.118489-0.0982012im     0.112253+0.0468652im      0.215365+0.0186029im      -0.124646-0.0444563im    -0.109906+0.0148897im    -0.0216264-0.0686489im     0.0484256-0.138567im        0.13392+0.120419im      0.0209787-0.0319331im   -0.0732453-0.0358778im    0.0970784+0.170304im     0.0203689-0.0206483im     0.106161-0.0233101im     0.233734+0.149038im   -0.0683954+0.163262im     -0.201352+0.0696222im     -0.0463086-0.0294427im     0.114044+0.0852734im   0.0814723-0.0295422im     0.0139625+0.0578079im       0.142519-0.0469585im    0.0604204-0.282122im       0.169836-0.121689im       -0.11209-0.000103412im
  0.0427846-0.125068im        0.10796-0.0522849im      -0.109654-0.354827im     0.00362513-0.135474im     -0.240077-0.0309404im    -0.0309583+0.148599im       -0.199069+0.149926im       0.029612+0.233552im       0.161778-0.0226621im   -0.0656988+0.0126849im     -0.129549+0.122787im        0.110424+0.20614im      0.0246252-0.0557756im    -0.0914302-0.293935im       0.100323+0.139734im      -0.302232+0.0916953im     -0.166054+0.0311806im   -0.0260727-0.21689im     -0.0182878+0.0633987im   -0.0878303-0.191366im    -0.0425425+0.0564197im   -0.0844467-0.114445im     0.167621+0.0582531im    -0.081332-0.0761484im     -0.0101314-0.0523751im    0.0133042+0.0835823im  -0.0576857-0.111798im      0.0149917+0.0123619im       -0.12052-0.0138997im     0.132747-0.0127973im      0.109214+4.84631e-5im   -0.0314677-0.0379296im
  -0.108831-0.176899im     -0.0639582-0.085907im      -0.0318245+0.0232403im      -0.08106+0.00102287im   0.0191987+0.0351565im     0.0381572-0.191983im       -0.013718+0.0494867im     0.0861862-0.00177276im    0.0272943-0.137414im       0.15933+0.0460127im     -0.222266-0.20322im      -0.00401872+0.0478311im    0.0285688+0.0796612im      0.348923+0.00567197im    0.0116616-0.0285302im     -0.321822+0.0548508im    -0.0754758+0.0226843im    0.0466419+0.120173im     -0.101632+0.051373im     0.0783264+0.128859im    -0.0181437-0.300119im      0.197194+0.156905im     0.165909-0.0217315im   -0.0358138+0.254452im       -0.122238+0.103704im     0.0375783+0.132563im    0.0376296+0.109242im       0.111563-0.232388im       -0.193177+0.0668921im    0.0406962-0.14218im      -0.0136343-0.0305109im     -0.110081+0.0531847im
   0.207079-0.020169im      0.0106312-0.0514062im      0.0525167-0.0415488im     -0.025876+0.0435938im     0.236789+0.233194im      0.0360463+0.0572503im      -0.167377+0.0767739im    -0.0608731+0.0022044im     0.0115378+0.109448im     -0.151044+0.128511im      0.0537534-0.324684im      0.00915759-0.0708641im    0.0314508-0.0736142im     0.0700501+0.0221529im      0.147516+0.11183im       0.0717112+0.0992744im    -0.0215527+0.27566im     -0.0985152-0.0938519im    -0.166486+0.271966im      0.205168-0.258583im     0.0595538+0.0605615im    0.0387693+0.0718784im   -0.091338-0.115854im     0.0272292-0.0554674im     -0.0884812+0.136946im     -0.155557+0.0417696im   0.0525427+0.0800772im     -0.191711+0.133735im       -0.177069+0.0631816im    -0.168923+0.0330874im     0.0629793-0.0704537im     0.0416415+0.176857im
  -0.196004-0.0515181im    -0.0061349+0.0674217im       0.171479-0.125389im      0.0649784+0.064883im      0.206785+0.148241im      0.0464723+0.0517007im       0.030007+0.215745im      -0.069544-0.0618033im    -0.0115834+0.213658im    -0.0593092+0.0508617im     0.0673896+0.0369909im       -0.17039+0.150756im      0.157386-0.0442346im     -0.184768+0.0623411im      0.346953+0.0676092im     -0.113255+0.027069im      0.0611502+0.0317832im      0.20244+0.126497im    -0.0626786-0.0767764im    0.0277326-0.03844im      -0.174752+0.107196im      0.114619+0.199376im    0.0556955-0.0557375im     0.162152+0.219178im       0.0955943-0.0564879im     0.130176+0.0126533im   -0.182707+0.123028im      0.0828945+0.0468156im       0.103139-0.203751im      0.159417+0.0137465im    -0.0212794-0.0696843im     0.0423458-0.202888im
  -0.085636-0.116467im       0.348417-0.164261im       -0.150682-0.144188im      0.0338442+0.090723im     0.0172274+0.0209447im     -0.222737-0.0543495im     -0.0193099-0.0290997im     -0.137364+0.139198im      0.0914776+0.21248im      0.0626327+0.147508im     -0.0307967+0.142097im      -0.0391902-0.302092im     0.0138623+0.0951474im     0.0447765+0.0279036im      0.112987-0.0346078im       0.30055+0.0249511im     0.0400374-0.256667im    -0.0536096+0.122152im    -0.0239694-0.0725508im    0.0898341-0.079206im     -0.199833-0.0555493im   -0.0747964+0.0547357im    0.282954+0.0925787im    0.0645208+0.0186305im     0.00542314+0.0156272im    -0.224473-0.0990599im  -0.0668994+0.046185im      0.0625422-0.0353238im     -0.0561258+0.0889366im   -0.0367962-0.0959269im    0.00730028-0.0209025im     -0.095997+0.145725im
   0.127314-0.0920113im    -0.0120238-0.188276im       -0.217106-0.048926im      0.0498655+0.183785im     -0.240939+0.0998348im    -0.0348312+0.0982445im     -0.0949541-0.0323293im      0.124058-0.0181452im   -0.00559579-0.127237im     -0.100293+0.245603im      -0.162553+0.074098im      0.00351133+0.0698025im     0.125485+0.0770255im      0.176837+0.00722353im    0.0772725+0.0479191im    -0.0196309-0.048039im       0.218639+0.115376im      0.152677+0.0681803im    0.0871092-0.0256891im      0.15009-0.0250379im    0.0564487+0.153486im     0.0464345+0.078757im    -0.201587+0.187989im    -0.0319731+0.000385682im    0.0584971-0.225602im     0.0826247-0.0779162im    0.138315+0.158916im      -0.114063-0.00119422im      0.297999-0.106053im     -0.178199-0.148078im      -0.151686+0.0354691im     -0.163202-0.00936255im
 -0.0699701+0.139396im      0.0846452-0.17849im        0.0377744-0.00212908im    0.0474987-0.0713268im    -0.114941+0.107443im      0.0905364-0.128319im    -0.000626109-0.0300089im     -0.050176-0.13137im        0.134306+0.360516im      0.221969-0.197955im    -0.00718058-0.0866025im       0.105974+0.197001im    -0.0663361-0.202345im     -0.0746683+0.00424297im   -0.0140005+0.129218im      -0.095645+0.130373im      0.0343475+0.0273713im    -0.135348+0.0881084im     0.115892-0.12317im       0.176856+0.0202073im     0.138642+0.152414im    -0.0243799-0.015813im    0.0980399+0.0807479im   -0.0639486+0.0156624im      0.0462301+0.14457im      -0.129761+0.167046im     0.277141+0.0348576im      0.174175-0.000482138im     0.256436+0.150401im     -0.151741+0.00772197im   -0.0297335-0.128506im     -0.0867634-0.0717921im
  -0.163068+0.091124im     0.00444154+0.0431724im      -0.152732-0.0801343im     0.0485991-0.0953499im    -0.145814-0.123588im      -0.044517+0.0187082im      0.0658194+0.0633538im       0.10897-0.216264im      -0.031521+0.0666841im    -0.120472+0.0149496im      0.146647-0.147497im        0.147852+0.0863981im     0.137096+0.164304im     -0.0243916+0.166382im    -0.00504839+0.0211998im      0.014419+0.119695im    -0.00556002-0.164503im      0.105549+0.10503im       0.180914+0.265808im      0.196918-0.0902758im  -0.00756496-0.19869im     -0.0218153+0.154644im    0.0330088+0.0263237im     0.143004-0.147014im       -0.131003-0.16351im     -0.0571646+0.314502im   -0.0144984-0.215344im     0.00178392+0.137624im       0.0325132+0.0213688im    0.0194725-0.110893im     -0.0311213+0.232822im       0.213533+0.0202514im
 -0.0021088-0.329891im      -0.168303+0.0383756im      0.0188132-0.0965136im     0.0119309-0.104511im     0.0280867+0.0600007im     -0.127394-0.0818876im    -0.00733316-0.0269748im     -0.155181+0.0168927im   -0.00810523-0.0827813im  -0.00768923+0.115051im      0.0458482+0.0456854im     0.00535871+0.0146106im     0.308451+0.0148766im    -0.0825459+0.195868im      -0.269231-0.159621im       0.125173+0.0485112im    -0.0350313+0.210367im    -0.0454871-0.126484im    -0.0997774+0.112199im      0.180304+0.0832397im    -0.090136+0.110014im     0.0413448-0.0369932im    0.153054+0.0388763im     -0.01024-0.0644357im     -0.0490787-0.190498im    0.00949575+0.0167637im   0.0752824-0.199865im       0.201312-0.164363im       0.0678094+0.114171im    -0.0782394+0.214928im     -0.0486278-0.243663im      0.0180556-0.211483im
  -0.189481-0.162828im       0.098323-0.148613im       0.0428814+0.0551795im      0.158089+0.209443im     -0.107863-0.0967898im   0.000903521+0.345412im       -0.106043-0.0818147im     -0.199036-0.126462im     -0.0267488-0.0641832im   0.00348969-0.102511im      -0.094114-0.139837im      -0.0203388+0.0422349im     -0.32943+0.00405721im   -0.0658292+0.113936im        -0.1814-0.12254im       -0.114785+0.217338im      -0.011834+0.0018196im   -0.0321658-0.0110953im   -0.0841467-0.0549019im    0.0556328-0.0728567im   -0.0444936+0.119672im      0.232111+0.177763im   -0.0525954-0.0529013im    -0.112959-0.00582051im     -0.025126-0.016129im     0.0719019-0.194939im     -0.14227-0.213161im       0.124464+0.159876im     -0.00311702+0.00881525im   0.0229717-0.0492282im    -0.0787921-0.058412im      0.0568102+0.177379im
  0.0892389-0.0141774im     -0.213373+0.101429im       0.0105078-0.086276im      -0.234012-0.0583646im    0.0269104+0.139162im     -0.0655203+0.170129im        0.196463-0.250262im       -0.17602-0.0199817im      0.200796+0.110419im    -0.0227403+0.115117im     -0.0882116+0.248969im       0.0858057+0.0762534im   -0.0283623-0.0297309im     0.0363716-0.0239019im     0.0609042+0.142081im      0.0401093-0.144408im     -0.0817723-0.057013im     0.0102503-0.0711078im    0.0136622+0.0918615im   -0.0615763+0.14835im       0.116673+0.0972311im     0.161323+0.178174im   -0.0177998-0.0413682im    0.0363078+0.304154im       -0.161399-0.0128903im   -0.0962676-0.091424im    0.0785999-0.141512im    0.000101348+0.19153im        0.0131538+0.302566im     0.0923497-0.148441im      -0.057585+0.149605im       0.059929+0.0260227im
  0.0709971-0.0643763im     -0.237499-0.110564im        0.102004-0.00541053im     0.043017+0.329673im    -0.0743209-0.138282im     -0.0907507-0.13004im          0.11162+0.189171im     -0.0150211+0.00932175im   -0.0823317-0.038573im    -0.0870771+0.0218586im     0.0564131-0.131306im      -0.0269142+0.134484im     0.0769639-0.0436922im     -0.159612-0.177598im       0.161977-0.00650958im     0.101061+0.0116032im     -0.237298-0.183104im    -0.0346651+0.0844239im   -0.0209426+0.0106968im    0.0583091-0.0423785im     0.146494-0.0625465im    0.0407337-0.0374im     -0.0299196-0.0655334im    -0.115368-0.088731im      -0.0890047+0.106361im     -0.113116-0.144337im    -0.193307-0.0715083im     0.0777836-0.00530375im    0.00913053+0.180994im     -0.144518+0.046053im      -0.171015+0.209383im      -0.335713-0.209882im
  0.0703871-0.269638im      0.0446663-0.0427834im      0.0403124+0.167864im     -0.0264911-0.0805783im    0.0770601-0.152499im     -0.0276074-0.194652im      -0.0614505+0.129786im       0.167476+0.0788028im    -0.0949578+0.131927im     -0.261481+0.0869759im     0.0399545-0.154846im       0.0241963+0.00963433im  -0.0177095-0.174855im       0.160033+0.173387im      0.0217861-0.0143716im    -0.0196866+0.116284im      -0.152446-0.155848im     0.0175683-0.148525im    -0.0179587-0.100478im     -0.110716-0.0244428im   -0.0284492+0.234467im    -0.0407408-0.234918im    0.0565856-0.0500178im    0.0181014+0.245144im      -0.0322668-0.0185484im    0.0579154-0.0651705im   0.0536979-0.0793387im     0.0284741-0.0401199im       0.331144+0.0503227im    0.0329818-0.157446im      0.0667698+0.185376im       0.180261+0.164727im
   0.184632-0.00493314im     0.210772-0.0516592im     -0.0580583-0.0459785im      0.185563-0.0711083im    0.0763894-0.00513148im   -0.0150771-0.0445662im        0.09785+0.0602796im      -0.13331-0.073599im     -0.0753994-0.167805im      0.135688+0.135895im       0.168702+0.209705im    -0.000324664+0.210452im    -0.0414402+0.0745174im      0.101927+0.0762786im     -0.205864-0.037262im    -0.00396839+0.00434472im   -0.0294892+0.00404182im  -0.0984335-0.0226352im   -0.0327845-0.0250145im    0.0496649-0.219542im     -0.107105+0.0557134im    -0.211441+0.056623im     -0.17971-0.109291im    0.00233144+0.37557im          0.13004+0.256748im     0.0480012+0.182088im   -0.0180369-0.139529im     0.00923902+0.0538863im      -0.120597-0.0809174im    -0.148443-0.0915607im    -0.0868195+0.15803im      -0.0829555-0.177201im
 0.00578258+0.149087im      0.0668369+0.00982489im     0.0406702+0.182664im      0.0549209+0.0900055im   -0.0128075+0.0680957im     -0.219519+0.190198im        0.170075+0.138836im      -0.223013+0.0396968im      0.065614-0.0400103im    -0.105657+0.00473112im  -0.00512776-0.0957434im      0.0654713+0.116407im    0.00577156+0.0894465im      0.105065+0.00388522im    0.0886955-0.0260502im     -0.197676-0.0497094im      0.272829-0.119989im     -0.291167-0.0434885im    -0.229407+0.00966912im   -0.109254+0.174516im     -0.129575-0.0357564im   -0.0557372-0.266071im    0.0300893+0.0123466im    0.0563345+0.058034im        -0.17718-0.21905im      0.0424074+0.259899im     -0.13254+0.095702im     -0.0174878+0.0838403im      0.0998633+0.12505im      -0.169492+0.105956im      0.0271321-0.0489459im    -0.0534283+0.0232915im
  -0.223848-0.00849825im    -0.078625+0.091617im       -0.273229-0.0808422im     -0.251793-0.124436im     0.0412612-0.162895im      -0.221438-0.0870374im    -0.00181281-0.0951142im     -0.147901-0.0831163im    -0.0480358-0.0401521im    0.0203067-0.0260582im      0.127436+0.0210833im     0.00220941-0.0316102im   -0.0159455+0.167534im     -0.0214593+0.0850147im      0.124367+0.0764439im     -0.188326+0.0363876im     -0.086241-0.130344im      0.221901+0.0688343im    -0.135368+0.144562im     0.0238715-0.0866993im    0.0913555+0.110238im    -0.0736914-0.15988im     -0.094736+0.0949349im    -0.307979+0.0728309im    -0.00542371+0.204858im      0.058522-0.115166im    -0.026662+0.19312im       0.0350024+0.156336im       0.0472771-0.0613743im    -0.228367+0.136575im     0.00114789-0.181691im      0.0844732+0.0319355im
 -0.0870246-0.0838627im    -0.0397105-0.0441738im     -0.0177549+0.0228814im      0.222823+0.102573im    -0.0139361+0.0969146im     -0.106749-0.0149266im      0.0717834+0.219068im    -0.00176577+0.0280901im     0.0206119+0.117901im     0.0306441-0.145937im      0.0374182-0.0125052im       0.134572-0.215398im     0.0693645+0.199339im      0.0635647-0.00654794im    0.0344157+0.17828im     -0.00182637-0.273645im     0.00856756+0.11897im       0.110671-0.231041im       0.02877+0.0785026im    0.0516587+0.149091im    0.00568142+0.0238586im    -0.125079-0.133604im    -0.125588-0.141331im     0.0574196-0.112309im      -0.0334304+0.191734im      0.221256-0.0340431im     0.16363-0.0954726im      0.340471+0.176165im      -0.0540134-0.0560709im     0.149898-0.200759im      -0.122344-0.0624338im     -0.118049+0.128985im
 -0.0908901-0.0408471im   -0.00572147+0.0174616im      0.0642312+0.0372659im      0.108017-0.0627615im    -0.136572-0.0694922im      0.213207+0.00812999im      0.214191+0.0154607im    -0.0642438+0.171594im       0.100737-0.172665im     0.0532212-0.0469562im     0.0338697-0.259985im       0.0840867-0.014094im     0.0599993+0.163423im     -0.0606708-0.0156184im     0.0121741-0.0325617im    -0.0101898-0.120916im       0.199994-0.0330971im     0.192018-0.122467im    -0.0312711-0.10757im       0.125537-0.209086im     0.0512109-0.102819im     -0.157048+0.0540024im    0.198108-0.0906404im    0.0409872+0.156666im     -0.00603505+0.0595867im   -0.0342581-0.256662im    0.0715721-0.0822206im     -0.312023+0.111667im        0.166167+0.190479im    0.00360045-0.0870041im      0.211799-0.186542im    -0.00596169-0.160571im
  0.0748907+0.049541im       0.181161-0.223556im       0.0203311+0.06686im      0.00530026-0.0688768im    0.0443055-0.111855im    -0.00613896+0.10422im         0.101241-0.103102im       0.280641-0.146126im     -0.0993333+0.147647im     0.0634805+0.0234935im     0.0666352+0.202408im        0.148787+0.145983im     0.0667456+0.220675im       0.202191+0.07375im        0.286379-0.0316506im     0.0404605-0.0333329im     0.0248136+0.066406im     -0.127716-0.129955im     -0.161254+0.0655679im    0.0775938-0.0198313im   -0.0161222-0.126808im        0.2516-0.0236086im  -0.0205204-0.098346im     -0.186611-0.076905im       0.0384715+0.108874im   -0.00649799-0.142935im   -0.0242607-0.161641im      -0.029217-0.0822299im       0.154128+0.00856052im    0.212364+0.277583im       0.127894-0.0360097im    -0.0332426-0.0626756im
  0.0890308+0.16275im       0.0270299-0.0789198im    -0.00091824+0.0426003im      0.150028-0.170451im      0.205871-0.134257im      -0.212673+0.00781721im    -0.0493312-0.146996im      0.0955735-0.0606916im      -0.15805-0.253244im      0.127065-0.0734919im     -0.149884-0.0586352im       0.130042-0.0240903im    0.0378282-0.120333im      0.0288415-0.095965im       0.156775+0.0371709im     0.0615819-0.00356654im   -0.0263049+0.296938im      0.064578+0.159432im    -0.0159079-0.159109im      0.184788-0.0318425im     0.100037+0.0649654im    -0.128794-0.126652im     0.195632-0.0358532im   -0.0179756+0.108243im      -0.0622894-0.253036im      -0.09696-0.0722794im   -0.159826+0.0603696im      0.229474+0.258485im       -0.062347+0.0634373im    0.0867699-0.088837im     -0.0539294+0.0628204im      0.101557-0.0599178im
  -0.117565-0.0600067im      0.207734-0.0382357im   -0.000252143+0.00452961im    -0.191519-0.129708im     -0.102985+0.301804im      0.0281118-0.0885062im     0.00948737+0.129816im     -0.0621586-0.190622im    -0.00952329-0.211424im      -0.13911-0.247378im      -0.117011+0.0459226im       -0.27143+0.0718746im   -0.0849017+0.0373446im      0.038248+0.060082im      0.0287576-0.214921im      0.0184673-0.196679im     -0.0939791-0.0164582im    -0.147128+0.0790462im     0.108167+0.204452im      0.158832-0.134776im      0.108054+0.0908072im  -0.00562833-0.130859im    0.0363902+0.0421265im     0.191024+0.00974369im   -0.00452855-0.0323351im    0.0789479-0.166642im    0.0591953+0.0797545im      0.075792+0.100832im       0.0202002+0.0717512im     0.126606+0.12829im        0.169843+0.198704im      -0.139331+0.000748446im</code></pre><p>and then generate the state <span>$ψ$</span></p><pre><code class="language-julia hljs">psi = P[:, 3]</code></pre><pre><code class="nohighlight hljs">32-element Vector{ComplexF64}:
  -0.031316779506490255 - 0.05714314469403669im
    0.05619246393990095 + 0.03570156899039435im
 -0.0030132278775023766 - 0.14287862299914544im
    0.07309868512374924 - 0.00890748913932506im
   -0.28730182405038757 - 0.10675659018898861im
    0.20476582673274768 + 0.22825397429631744im
   -0.10742420356614384 - 0.13905386680156803im
    0.14734640000361404 + 0.13213165873519359im
   0.056719938487298754 - 0.006603861677896488im
  -0.007930217411871103 + 0.05892966676179544im
      0.344599003034498 - 0.02071400354965114im
  -0.004300826253121077 + 0.04604517696655673im
    0.11887027822607889 + 0.17066407807634024im
      0.401989170865969 + 0.0im
   0.014267424539195394 - 0.016517131357859705im
   -0.15733209826289835 - 0.0950493407780297im
   -0.15131070825800647 + 0.0405070208714837im
    0.10963404892863914 + 0.16654815320356384im
   -0.17324570341492745 + 0.14207239165211719im
    0.07873600880649641 - 0.0789420715168261im
    0.04404203521278777 - 0.09685618636534808im
  -0.028299652451705598 - 0.20570431564330643im
    0.18711868606148346 - 0.06495398583992781im
   -0.03283251702096994 + 0.21805653349060236im
  -0.005210181869556789 - 0.0494461895070894im
    0.06498214180837249 - 0.1005892282230611im
 -0.0048007943992690524 - 0.08171872693761222im
   -0.02010417102229979 + 0.03427072048081744im
    0.05714477441074988 - 0.000537946817007303im
    0.02098653443248056 + 0.06238548063147077im
    0.07951489181403877 - 0.11939994093266118im
    0.13315635508964696 - 0.0037984419563945743im</code></pre><p>In the phase estimation process, we will feed the state to circuit and measure the first <code>n</code> qubits processed by iQFT.</p><pre><code class="language-julia hljs">r = join(ArrayReg(psi), zero_state(N))
r |&gt; PE(N, M, U)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 8/8
    nlevel: 2</code></pre><p>Since our phase can be represented by 3 qubits precisely, we only need to measure once</p><pre><code class="language-julia hljs">results = measure(r, 1:N; nshots=1)</code></pre><pre><code class="nohighlight hljs">1-element Vector{DitStr{2, 3, Int64}}:
 011 ₍₂₎</code></pre><p>Recall that our QFT&#39;s bit numbering is reversed, let&#39;s reverse it back</p><pre><code class="language-julia hljs">using BitBasis
estimated_phase = bfloat(results[]; nbits=N)</code></pre><pre><code class="nohighlight hljs">0.75</code></pre><p>the phase is exactly <code>0.75</code>!</p><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../1.prepare-ghz-state/index.html">« Prepare Greenberger–Horne–Zeilinger state with Quantum Circuit</a><a class="docs-footer-nextpage" href="../3.grover-search/index.html">Grover Search »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.4.0 on <span class="colophon-date" title="Sunday 21 April 2024 15:49">Sunday 21 April 2024</span>. Using Julia version 1.10.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
