<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Quantum Fourier Transformation and Phase Estimation · Documentation | Yao</title><meta name="title" content="Quantum Fourier Transformation and Phase Estimation · Documentation | Yao"/><meta property="og:title" content="Quantum Fourier Transformation and Phase Estimation · Documentation | Yao"/><meta property="twitter:title" content="Quantum Fourier Transformation and Phase Estimation · Documentation | Yao"/><meta name="description" content="Documentation for Documentation | Yao."/><meta property="og:description" content="Documentation for Documentation | Yao."/><meta property="twitter:description" content="Documentation for Documentation | Yao."/><script data-outdated-warner src="../../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../search_index.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script><link href="../../../assets/indigo.css" rel="stylesheet" type="text/css"/><link href="https://yaoquantum.org/assets/favicon-light.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../index.html"><img src="../../../assets/logo.png" alt="Documentation | Yao logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../../index.html">Documentation | Yao</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../../index.html">Home</a></li><li><a class="tocitem" href="../../../quick-start.html">Quick Start</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../../../man/registers.html">Quantum Registers</a></li><li><a class="tocitem" href="../../../man/blocks.html">Blocks</a></li><li><a class="tocitem" href="../../../man/symbolic.html">Symbolic Computation</a></li><li><a class="tocitem" href="../../../man/cuda.html">CUDA extension - CuYao</a></li><li><a class="tocitem" href="../../../man/plot.html">Quantum Circuit Visualization</a></li><li><a class="tocitem" href="../../../man/automatic_differentiation.html">Automatic Differentiation</a></li><li><a class="tocitem" href="../../../man/yao2einsum.html">Tensor network backend</a></li><li><a class="tocitem" href="../../../man/simplification.html">Simplification</a></li><li><a class="tocitem" href="../../../man/bitbasis.html">BitBasis</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../1.prepare-ghz-state/index.html">Prepare Greenberger–Horne–Zeilinger state with Quantum Circuit</a></li><li class="is-active"><a class="tocitem" href="index.html">Quantum Fourier Transformation and Phase Estimation</a><ul class="internal"><li><a class="tocitem" href="#Quantum-Fourier-Transformation"><span>Quantum Fourier Transformation</span></a></li><li><a class="tocitem" href="#Wrap-QFT-to-an-external-block"><span>Wrap QFT to an external block</span></a></li><li><a class="tocitem" href="#Phase-Estimation"><span>Phase Estimation</span></a></li></ul></li><li><a class="tocitem" href="../3.grover-search/index.html">Grover Search</a></li><li><a class="tocitem" href="../4.shor-algorithm/index.html">Shor&#39;s Algorithm</a></li><li><a class="tocitem" href="../5.shor-9-code/index.html">Shor&#39;s 9 qubit code</a></li><li><a class="tocitem" href="../6.quantum-circuit-born-machine/index.html">Quantum Circuit Born Machine</a></li><li><a class="tocitem" href="../7.variation-quantum-eigen-solver/index.html">Variational Quantum Eigen Solver</a></li><li><a class="tocitem" href="../8.riemannian-gradient-flow/index.html">Riemannian gradient flow optimizer</a></li></ul></li><li><a class="tocitem" href="../../../performancetips.html">Performance Tips</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href="index.html">Quantum Fourier Transformation and Phase Estimation</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="index.html">Quantum Fourier Transformation and Phase Estimation</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/QuantumBFS/Yao.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/QuantumBFS/Yao.jl/blob/master/docs/src/examples/2.qft-phase-estimation/main.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><p><a href="/generated/examples/2.qft-phase-estimation/main.ipynb"><img src="https://mybinder.org/badge_logo.svg" alt/></a></p><h1 id="example-qft"><a class="docs-heading-anchor" href="#example-qft">Quantum Fourier Transformation and Phase Estimation</a><a id="example-qft-1"></a><a class="docs-heading-anchor-permalink" href="#example-qft" title="Permalink"></a></h1><p>Let&#39;s use Yao first</p><pre><code class="language-julia hljs">using Yao</code></pre><h2 id="Quantum-Fourier-Transformation"><a class="docs-heading-anchor" href="#Quantum-Fourier-Transformation">Quantum Fourier Transformation</a><a id="Quantum-Fourier-Transformation-1"></a><a class="docs-heading-anchor-permalink" href="#Quantum-Fourier-Transformation" title="Permalink"></a></h2><p>The Quantum Fourier Transformation (QFT) circuit is to repeat two kinds of blocks repeatly:</p><p><img src="assets/qft.png" alt="qft-circuit"/></p><p>The basic building block control phase shift gate is defined as</p><p class="math-container">\[R(k)=\begin{bmatrix}
1 &amp; 0\\
0 &amp; \exp\left(\frac{2\pi i}{2^k}\right)
\end{bmatrix}\]</p><p>Let&#39;s define block <code>A</code> and block <code>B</code>, block <code>A</code> is actually a control block.</p><pre><code class="language-julia hljs">A(i, j) = control(i, j=&gt;shift(2π/(1&lt;&lt;(i-j+1))))</code></pre><pre><code class="nohighlight hljs">A (generic function with 1 method)</code></pre><p>Once you construct the blockl you can inspect its matrix using <code>mat</code> function. Let&#39;s construct the circuit in dash box A, and see the matrix of <span>$R_4$</span> gate.</p><pre><code class="language-julia hljs">R4 = A(4, 1)</code></pre><pre><code class="nohighlight hljs">(n -&gt; control(n, 4, 1 =&gt; shift(0.39269908169872414)))</code></pre><p>If you have read about <a href="@ref tutorial-ghz">preparing GHZ state</a>, you probably know that in Yao, we could just leave the number of qubits, and it will be evaluated when possible.</p><pre><code class="language-julia hljs">R4(5)</code></pre><pre><code class="nohighlight hljs">nqubits: 5
control(4)
└─ (1,) shift(0.39269908169872414)</code></pre><p>its matrix will be</p><pre><code class="language-julia hljs">mat(R4(5))</code></pre><pre><code class="nohighlight hljs">32×32 Diagonal{ComplexF64, Vector{ComplexF64}}:
 1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im</code></pre><p>Then we repeat this control block over and over on different qubits, and put a Hadamard gate to <code>i</code>th qubit to construct <code>i</code>-th <code>B</code> block.</p><pre><code class="language-julia hljs">B(n, k) = chain(n, j==k ? put(k=&gt;H) : A(j, k) for j in k:n)</code></pre><pre><code class="nohighlight hljs">B (generic function with 1 method)</code></pre><p>We need to input the total number of qubits <code>n</code> here because we have to iterate through from <code>k</code>-th location to the last.</p><p>Now, let&#39;s construct the circuit by chaining all the <code>B</code> blocks together</p><pre><code class="language-julia hljs">qft(n) = chain(B(n, k) for k in 1:n)
qft(4)</code></pre><pre><code class="nohighlight hljs">nqubits: 4
chain
├─ chain
│  ├─ put on (1)
│  │  └─ H
│  ├─ control(2)
│  │  └─ (1,) shift(1.5707963267948966)
│  ├─ control(3)
│  │  └─ (1,) shift(0.7853981633974483)
│  └─ control(4)
│     └─ (1,) shift(0.39269908169872414)
├─ chain
│  ├─ put on (2)
│  │  └─ H
│  ├─ control(3)
│  │  └─ (2,) shift(1.5707963267948966)
│  └─ control(4)
│     └─ (2,) shift(0.7853981633974483)
├─ chain
│  ├─ put on (3)
│  │  └─ H
│  └─ control(4)
│     └─ (3,) shift(1.5707963267948966)
└─ chain
   └─ put on (4)
      └─ H
</code></pre><h2 id="Wrap-QFT-to-an-external-block"><a class="docs-heading-anchor" href="#Wrap-QFT-to-an-external-block">Wrap QFT to an external block</a><a id="Wrap-QFT-to-an-external-block-1"></a><a class="docs-heading-anchor-permalink" href="#Wrap-QFT-to-an-external-block" title="Permalink"></a></h2><p>In most cases, <code>function</code>s are enough to wrap quantum circuits, like <code>A</code> and <code>B</code> we defined above, but sometimes, we need to dispatch specialized methods on certain kinds of quantum circuit, or we want to define an external block to export, thus, it&#39;s useful to be able to wrap circuit to custom blocks.</p><p>First, we define a new type as subtype of <code>PrimitiveBlock</code> since we are not going to use the subblocks of <code>QFT</code>, if you need to use its subblocks, it&#39;d be better to define it under <code>CompositeBlock</code>.</p><pre><code class="language-julia hljs">struct QFT &lt;: PrimitiveBlock{2}
    n::Int
end

YaoBlocks.nqudits(q::QFT) = q.n</code></pre><p>Now, let&#39;s define its circuit</p><pre><code class="language-julia hljs">circuit(q::QFT) = qft(q.n)</code></pre><pre><code class="nohighlight hljs">circuit (generic function with 1 method)</code></pre><p>And forward <code>mat</code> to its circuit&#39;s matrix</p><pre><code class="language-julia hljs">YaoBlocks.mat(::Type{T}, x::QFT) where T = mat(T, circuit(x))</code></pre><p>You may notice, it is a little ugly to print <code>QFT</code> at the moment, this is because we print the type summary by default, you can define your own printing by overloading <code>print_block</code></p><pre><code class="language-julia hljs">YaoBlocks.print_block(io::IO, x::QFT) = print(io, &quot;QFT($(x.n))&quot;)</code></pre><p>Since it is possible to use FFT to simulate the results of QFT (like cheating), we could define our custom <code>apply!</code> method:</p><pre><code class="language-julia hljs">using FFTW, LinearAlgebra

function YaoBlocks.apply!(r::ArrayReg, x::QFT)
    α = sqrt(length(statevec(r)))
    invorder!(r)
    lmul!(α, ifft!(statevec(r)))
    return r
end</code></pre><p>Now let&#39;s check if our <code>apply!</code> method is correct:</p><pre><code class="language-julia hljs">r = rand_state(5)
r1 = r |&gt; copy |&gt; QFT(5)
r2 = r |&gt; copy |&gt; circuit(QFT(5))
r1 ≈ r2</code></pre><pre><code class="nohighlight hljs">true</code></pre><p>We can get iQFT (inverse QFT) directly by calling <code>adjoint</code></p><pre><code class="language-julia hljs">QFT(5)&#39;</code></pre><pre><code class="nohighlight hljs"> [†]QFT(5)</code></pre><p>QFT and iQFT are different from FFT and IFFT in three ways,</p><ol><li>they are different by a factor of <span>$\sqrt{2^n}$</span> with <span>$n$</span> the number of qubits.</li><li>the <a href="https://quantumbfs.github.io/BitBasis.jl/stable/tutorial/#Conventions-1">bit numbering</a> will exchange after applying QFT or iQFT.</li><li>due to the convention, QFT is more related to IFFT rather than FFT.</li></ol><h2 id="Phase-Estimation"><a class="docs-heading-anchor" href="#Phase-Estimation">Phase Estimation</a><a id="Phase-Estimation-1"></a><a class="docs-heading-anchor-permalink" href="#Phase-Estimation" title="Permalink"></a></h2><p>Since we have QFT and iQFT blocks we can then use them to realize phase estimation circuit, what we want to realize is the following circuit:</p><p><img src="assets/phaseest.png" alt="phase estimation"/></p><p>First we call Hadamard gates repeatly on first <code>n</code> qubits.</p><pre><code class="language-julia hljs">Hadamards(n) = repeat(H, 1:n)</code></pre><pre><code class="nohighlight hljs">Hadamards (generic function with 1 method)</code></pre><p>Then in dashed box <code>B</code>, we have controlled unitaries:</p><pre><code class="language-julia hljs">ControlU(n, m, U) = chain(n+m, control(k, n+1:n+m=&gt;matblock(U^(2^(k-1)))) for k in 1:n)</code></pre><pre><code class="nohighlight hljs">ControlU (generic function with 1 method)</code></pre><p>each of them is a <code>U</code> of power <span>$2^{(k-1)}$</span>.</p><p>Since we will only apply the qft and Hadamard on first <code>n</code> qubits, we could use <code>Subroutine</code>, which creates a context of a sub-scope of the qubits.</p><pre><code class="language-julia hljs">PE(n, m, U) =
    chain(n+m, # total number of the qubits
        subroutine(Hadamards(n), 1:n), # apply H in local scope
        ControlU(n, m, U),
        subroutine(QFT(n)&#39;, 1:n))</code></pre><pre><code class="nohighlight hljs">PE (generic function with 1 method)</code></pre><p>we use the first <code>n</code> qubits as the output space to store phase <span>$ϕ$</span>, and the other <code>m</code> qubits as the input state which corresponds to an eigenvector of oracle matrix <code>U</code>.</p><p>The subroutine here uses <code>focus!</code> and <code>relax!</code> to manage a local scope of quantum circuit, and only activate the first <code>n</code> qubits while applying the block inside the subroutine context, and the scope will be <code>relax!</code>ed back, after the context. This is equivalent to manually <code>focus!</code> then <code>relax!</code></p><p>fullly activated</p><pre><code class="language-julia hljs">r = rand_state(5)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 5/5
    nlevel: 2</code></pre><p>first 3 qubits activated</p><pre><code class="language-julia hljs">focus!(r, 1:3)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 3/5
    nlevel: 2</code></pre><p>relax back to the original</p><pre><code class="language-julia hljs">relax!(r, 1:3)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 5/5
    nlevel: 2</code></pre><p>In this way, we will be able to apply small operator directly on the subset of the qubits.</p><p>Details about the algorithm can be found here: <a href="https://en.wikipedia.org/wiki/Quantum_phase_estimation_algorithm">Quantum Phase Estimation Algorithm</a></p><p>Now let&#39;s check the results of our phase estimation.</p><p>First we need to set up a unitary with known phase, we set the phase to be 0.75, which is <code>0.75 * 2^3 == 6 == 0b110</code> .</p><pre><code class="language-julia hljs">N, M = 3, 5
P = eigen(rand_unitary(1&lt;&lt;M)).vectors
θ = Int(0b110) / 1&lt;&lt;N
phases = rand(1&lt;&lt;M)
phases[0b010+1] = θ
U = P * Diagonal(exp.(2π * im * phases)) * P&#39;</code></pre><pre><code class="nohighlight hljs">32×32 Matrix{ComplexF64}:
    0.0136782-0.1595im       -0.292007+0.170807im       0.133899+0.0819358im    0.0580527-0.041717im      0.0439433-0.000276429im     0.127384+0.0174232im       -0.0463-0.378181im      0.192298+0.0471401im   -0.0710893+0.239273im     0.0781829+0.107813im       0.0124497-0.0906282im     0.00796852-0.0548586im      0.112303-0.0948688im   -0.0665741+0.134412im     0.0798222+0.103281im     0.0152442+0.0746483im     0.203867+0.0952546im     -0.126284+0.113501im      -0.260743-0.116199im        0.198853+0.110135im    -0.0871904+0.209554im      0.0425857-0.0787161im     0.126472-0.0663526im    0.0785387-0.161616im     -0.0890633+0.00292407im   -0.0406236-0.010012im       0.0428097-0.0283053im      0.0721276+0.123739im    0.00701183+0.165619im     -0.124846-0.134676im       -0.10469+0.143979im      0.085181-0.105299im
   -0.0648763+0.134613im      -0.14204-0.00547831im    -0.142878+0.0999666im     0.142791+0.0879882im     0.0882422+0.0994461im      -0.123778-0.178469im     -0.0158419-0.17912im       0.242321-0.154219im     -0.072054-0.210836im      0.195304+0.131257im        0.076145-0.000210653im   -0.0971713+0.157625im      0.0653097+0.00691313im       -0.11-0.241094im      0.169592+0.193065im     0.0668556-0.037975im     0.0296453-0.164936im      0.0607184+0.0837116im      0.161814-0.0107205im      -0.120655-0.00756433im    0.151118+0.0203373im    -0.0453151-0.0992637im   -0.0924273+0.266617im     -0.146281-0.147618im      -0.110852-0.201825im       0.119591+0.0617475im      0.0546857-0.0344598im       0.102701-0.0871902im    0.0244073-0.120279im    -0.0835349+0.016463im     0.00326748-0.0895836im     0.257147+0.00717124im
   -0.0426164+0.0330556im    0.0811283-0.0337541im     -0.146635-0.0403018im     0.263862+0.0859252im     0.0693362-0.267774im         0.10584+0.0509367im   -0.00164467-0.253717im    -0.0603671-0.136639im    -0.0217747-0.11892im     -0.0890799+0.063692im       -0.165573+0.0179707im       0.185181-0.0524456im     -0.127035+0.0449533im   -0.0371365+0.0855484im   -0.0297358+0.146479im    -0.0811226+0.0398159im    0.0453863-0.237464im       0.176627+0.0893612im     0.0232816+0.132735im       -0.036034-0.0206732im    -0.147393+0.108516im      0.0372807-0.0225356im     0.157269+0.0224501im  -0.00373499+0.0939907im    -0.0650961+0.001482im       0.124801+0.0133594im      -0.300113+0.284665im        0.134965-0.0682814im     -0.16852+0.110501im      0.154825-0.147713im    -0.00942614+0.113487im     -0.142722+0.206827im
     0.176998-0.0148555im   -0.0824811+0.0677641im      0.136256-0.040142im      0.141214-0.167866im     -0.0230075-0.047555im        0.209119-0.00476798im    -0.222583+0.109689im    -0.0487667+0.184357im     0.0283529+0.0127849im    -0.104089+0.218271im       0.0685173-0.0374674im        0.20935+0.0593972im     0.0839342-0.262667im     0.0987522-0.202337im    0.00346679-0.14774im       0.092268-0.199189im     0.0414295-0.255749im     -0.0155228+0.00946327im    -0.211601+0.0600718im     -0.0169258+0.0810944im    -0.180156-0.0932128im      0.192374-0.0181161im   -0.0500662+0.218649im      0.136637+0.058183im     -0.0378411+0.053359im      0.0134183-0.00652492im    0.00318769-0.102355im    -0.000272732-0.0937351im     -0.04289-0.226991im   0.000401164-0.0214432im     0.0716255-0.149472im      0.107282+0.210913im
     0.035893+0.229992im    -0.0203692+0.0520764im      0.104816-0.133731im     0.0833608-0.10294im       0.0336479-0.162995im       0.0458089+0.0353909im      0.108566+0.105455im    -0.0235375-0.0769405im    -0.102144+0.188533im     0.0972613-0.0932326im       0.134047-0.0177237im    -0.00591468+0.111231im     -0.0336749-0.0405922im    0.0894504+0.250066im     -0.305205+0.196204im     0.0993244+0.161894im    -0.0405772+0.0250299im    -0.0558331+0.0874503im     0.0279975+0.173341im     -0.00466357+0.222656im     0.0672953+0.141396im      -0.141383+0.0963734im    -0.127641+0.178027im      0.111218-0.234152im      0.0457034+0.0373548im      0.245142-0.165614im       0.0723817-0.00989153im     0.0631688-0.154247im     0.0982983-0.0480123im     0.047556-0.0545512im    -0.0946425-0.273258im     -0.110466-0.0193526im
    0.0806345+0.116887im    -0.0715267-0.29087im      -0.0511981+0.0105811im   -0.0811243+0.0283696im     0.0244247+0.0130699im      -0.112012-0.15384im       -0.272392-0.09355im      0.0683758+0.0345898im      -0.1814-0.00915088im   0.0205123-0.00115042im     0.0355178+0.0663574im       0.191434-0.0491905im     -0.032724-0.103686im        0.1362-0.210451im     0.0690246+0.0880894im    0.0311557-0.0359798im    -0.117687+0.147866im      0.0052166+0.14656im       -0.116558+0.123257im      -0.0533253-0.0711506im     0.007667-0.00286114im     0.116346+0.192315im     0.0992338-0.0649555im     0.142865+0.0593387im      0.198207-0.16115im       0.0083776-0.125064im       -0.195344+0.0667078im       0.108255+0.147332im     0.0424739+0.0940122im    -0.138761+0.0208273im     0.0291732-0.226417im     -0.232339-0.332684im
  -0.00012666-0.165335im    -0.0396155+0.133702im       0.176579+0.127042im      0.204798-0.188097im      -0.152849+0.131925im      -0.0356331-0.166719im      0.0230286-0.132787im      0.146725-0.00674772im    0.210964-0.18264im      -0.196733+0.105119im       0.0501589-0.141831im       -0.028202-0.0206886im  -0.000575525-0.0772608im    0.0667485+0.163301im     -0.105902+0.00906094im   -0.134899-0.0176905im   -0.0260811-0.0315019im     0.0285638+0.0756034im      0.278262+0.103346im       -0.332127+0.283954im    -0.0598451-0.0112014im   -0.00214815+0.0836997im   -0.0237041-0.0847606im    0.0107569+0.140795im     -0.0271783-0.122455im     -0.0545924-0.146037im      -0.0392942-0.0115887im      -0.127845+0.0262278im     0.158539-0.0795374im     0.034446+0.0423479im     0.0143177+0.1128im       -0.137984-0.223201im
     0.064066+0.160434im     -0.101466-0.157677im       0.239676-0.097865im    -0.0386536-0.221731im      -0.155507+0.102714im     -0.00858562+0.107283im       0.203634+0.00815062im   0.0174493-0.108016im    -0.0180852+0.00230739im    0.111856+0.165063im        0.155006+0.0792733im      -0.180597+0.110425im     -0.0259144+0.0222192im     0.131961+0.1616im         0.24559-0.110244im    -0.0120329-0.110554im     -0.014011-0.148199im     -0.0176256+0.132509im      0.0988732+0.178292im        0.089017-0.140838im     -0.182592-0.146334im     -0.0670157+0.101958im      0.159323+0.0508314im    0.0363103-0.0665919im    -0.0815212-0.0843758im      0.118889+0.102658im      -0.0317604+0.0191213im     -0.0049213+0.232026im    -0.0433193+0.271752im    -0.0222576+0.242478im     0.00755608+0.0500502im   -0.0564852+0.160011im
   -0.0990045-0.245091im     -0.116077-0.0413191im    -0.0680841+0.0468652im    0.0751193-0.00868111im    0.0914102-0.01939im       -0.0858988+0.254538im      0.0997176-0.0822385im    -0.278441-0.0989253im    0.0309611+0.137271im     0.0257756-0.0361217im      -0.166042-0.169043im       0.0117415-0.0571223im    -0.0554292+0.0404104im     0.282376-0.0872906im    -0.125896+0.00569937im  -0.0103131-0.316417im     0.0965357-0.00226656im    0.0340013-0.117227im      0.0874099+0.120948im      -0.0434484+0.186228im      0.210697-0.0412192im    -0.0629198-0.0314324im     0.124568+0.0877159im      0.21854-0.042205im      0.0966117-0.0498459im       0.10483+0.219838im       0.0325179+0.101932im       0.0859218+0.0558499im   -0.0197881-0.0233596im    -0.226173+0.132269im       0.124422-0.0131479im     0.163652-0.126605im
   -0.0305346+0.0531803im    0.0957419+0.22617im       -0.167667+0.179909im    -0.0081129-0.06699im       -0.218774+0.140673im       0.0354414+0.0486608im     0.0529316-0.222875im    -0.0102488-0.154127im    -0.0913473+0.0640161im     0.126888-0.0891231im      0.0500226-0.0670008im      -0.184061+0.0181662im     -0.206951-0.258279im      0.010783-0.085845im     0.0407053-0.0451296im    -0.155185+0.0443525im     0.193214+0.00549779im     0.190124-0.0229187im     -0.194427-0.0395768im     -0.0247927-0.0926442im    0.0589848+0.0143929im    -0.0518181+0.0973734im   -0.0421795-0.0798679im      0.21037+0.155825im       0.265395-0.133348im      0.0540889-0.035654im       0.0782798+0.0110986im      -0.227044+0.0186505im   -0.0882727-0.052652im      0.200805+0.0289694im    -0.0966323-0.209533im    0.00651355+0.167651im
     0.017823-0.149592im     0.0652687+0.165676im       0.138706+0.0841912im   -0.0254559+0.109907im    -0.00214574-0.1812im         -0.212194-0.0736771im    -0.0673303-0.0882667im     0.122196+0.254629im     -0.233358+0.118078im    -0.0693454+0.121814im      -0.0291079-0.193361im       0.0706817+0.111198im      -0.141438+0.195351im      0.263761+0.0234064im     0.165369-0.139488im    -0.0142243+0.138074im    -0.0253247+0.0203341im     -0.119423+0.0693087im     0.0408459-0.0500939im      -0.201161-0.0982547im    0.0157071-0.0958792im     -0.034475-0.186948im    -0.0802914+0.0790353im     -0.12374-0.216308im       0.206072+0.116135im       0.127906-0.0433569im      0.0297123+0.171099im      -0.0980753+0.0444526im    -0.203439-0.0326605im     0.107821+0.137929im      0.0445695-0.0288163im    -0.061942+0.0516467im
    0.0380558+0.08422im      0.0297572-0.148685im      0.0526871-0.0175025im    0.0883196-0.00660467im    0.0691623-0.00916305im     0.0503865+0.358406im      -0.124439-0.108221im      0.183901+0.132629im      0.221102-0.0814374im    0.0544864-0.151433im         0.11502-0.220946im       -0.280929-0.16079im        0.144733-0.00528719im   0.0607614+0.135008im     0.0865532-0.0408608im    0.0657292+0.175454im     -0.254535-0.00973904im     0.107098-0.0310518im   -0.00530603+0.0771829im        0.13915+0.0136279im     0.107147-0.0369635im      0.248009-0.271476im     0.0863356+0.0611718im    0.0116506+0.0279031im     0.0968479-0.0520114im    -0.0362099+0.0627996im      -0.135895+0.0887853im     -0.0177894+0.00947922im    0.010343-0.122303im      0.202297+0.0107409im    0.00012757-0.155138im     0.0906724-0.110298im
   -0.0490669-0.131138im   -0.00868826-0.0918353im     -0.118944+0.137088im     0.0457894+0.0786962im     -0.161632-0.0447925im      -0.212695+0.0100656im     -0.097337-0.0586428im    -0.143863-0.132373im      0.255581-0.0244983im     -0.10675-0.0838687im       0.148979+0.093062im       -0.124321+0.268299im      -0.166186-0.126543im    -0.0150289-0.12456im     -0.0438739-0.0291587im    0.0289785-0.156377im    -0.0593359+0.141947im      -0.121977+0.107352im     -0.0394545+0.00582959im      0.172582+0.19715im      -0.121541+0.0949446im      0.154705-0.219012im     -0.164979+0.0477658im    -0.119791-0.0965406im     -0.134153+0.170101im      0.0896765-0.110467im      -0.0681594+0.0225584im      -0.151574+0.0449877im   -0.0239349+0.313237im     0.0543635-0.0552058im      0.144979-0.150569im      -0.02619+0.0198212im
     0.233284-0.0796126im   -0.0932779+0.0432428im     0.0557051+0.106191im      0.171549+0.262783im     0.00856239+0.119685im       0.0745576+0.00442725im    -0.108154+0.01551im      0.0640981-0.233207im       0.31774+0.0609094im     0.192533+0.134918im      -0.0530034+0.0920383im       0.127159+0.028263im     -0.0458521+0.198674im     0.0973111+0.079166im     0.0692495-0.0598103im   -0.0920725+0.0940174im   -0.0896943-0.073526im       -0.15008-0.121605im       0.213134-0.196409im        0.120762-0.090674im     -0.118072+0.0485867im      -0.10652+0.0774187im   0.00600781-0.0297546im     0.166755-0.0346699im      0.189502+0.0433546im    -0.0353441+0.145336im       -0.116314-0.146053im       -0.083807-0.158244im    -0.0472787-0.0141525im    -0.123233-0.085792im     -0.0215103-0.251725im     -0.130139+0.0152161im
    -0.106122+0.309016im    0.00453687+0.220895im      0.0158474-0.115913im      0.127634+0.0207797im      0.045498+0.181895im      -0.0141755-0.0963174im      -0.14133-0.0138298im     0.107594+0.172803im     0.0306292+0.023726im     -0.108158-0.30982im        0.0349474+0.0687421im     -0.0325946+0.0149944im     0.0163306-0.0724877im    0.0549745-0.0951854im   -0.0427905-0.0578205im      0.03221+0.0956572im     0.146943+0.175489im     -0.0127231-0.091396im       0.284553-0.0293676im     -0.0785112+0.0566945im   -0.0375032+0.0770638im     0.0738642-0.0631784im     0.162425+0.235094im      0.182218+0.145033im      0.0802073+0.18332im      -0.0264891+0.0222111im     -0.0800966-0.0278258im      0.0699211-0.0306956im    -0.179982+0.256634im     -0.212745+0.150096im     -0.0513516+0.104886im     0.0360854+0.135512im
   0.00574648-0.051951im    -0.0345667+0.0386173im    -0.0543729-0.0908818im    -0.191192+0.120714im     -0.0903203+0.059305im        0.108945+0.0870383im     -0.136693-0.119843im       0.10527-0.00452648im  -0.0614577-0.25692im      0.0287385-0.00444885im      0.204542+0.0689025im      0.0991197-0.168521im     -0.0397517+0.0239307im     0.130204+0.182477im    -0.0349468-0.0362058im    -0.163717-0.210611im    -0.0807913+0.036018im     0.00213072-0.242962im      -0.251373-0.0540994im      -0.105395+0.145393im      0.163474-0.177236im      -0.170068-0.0443694im   -0.0725891+0.241435im   -0.00308555-0.171933im    -0.00776166-0.13432im       -0.099172-0.0716903im     -0.0880382-0.0984598im      0.0642358-0.235535im     0.0222107+0.285598im     0.0618448+0.0204779im    -0.0110134+0.106824im     -0.106489+0.0935533im
     0.153949+0.167096im      0.106731+0.0868844im     0.0911045+0.276511im     -0.179912+0.145201im     -0.0875857+0.100845im        0.145531-0.047451im     -0.0582675+0.0701694im    -0.128492-0.0490546im   -0.0257592+0.0364442im   0.00704534-0.0437548im      -0.103068+0.0197474im       0.053069-0.230692im     -0.0305989+0.0114207im     0.136292-0.0225835im    0.0328241+0.178942im     0.0407302-0.133593im     -0.180266+0.0432785im    -0.0530278+0.352568im      0.0121858-0.0839365im     -0.0427031+0.0767215im   -0.0534796+0.131162im       0.029901-0.212265im    -0.0511483+0.15163im      0.0402457+0.160276im     -0.0328991-0.0257102im      0.218262+0.3111im          0.146068-0.0752506im      0.0278586+0.0210121im     0.100949+0.0195654im      0.19782+0.0471937im     -0.121209+0.189781im    -0.0642655-0.0498912im
   0.00581644-0.21393im       0.126663-0.0340865im    -0.0543351-0.0551363im     0.180022+0.11078im       -0.234152-0.102501im       -0.025488-0.0426398im    -0.0413161-0.0768572im   -0.0454558+0.0653688im    -0.189773+0.0117075im    0.0370105-0.054594im       0.0839783+0.165772im       -0.122895+0.188825im      -0.065025-0.0228656im   -0.0192121+0.0243778im   -0.0271039+0.0121672im    0.0684821-0.010554im      -0.14257-0.112978im      -0.226251-0.265656im    -0.00734727+0.016315im       0.0790036+0.0305969im   -0.0194722+0.272362im    -0.00933499-0.139968im        0.2513+0.0600146im   -0.0334272+0.133817im      0.0781672-0.164383im      -0.055225-0.0196347im      0.0729669-0.187253im        0.239859+0.146777im      0.139429-0.223205im     0.0320378+0.228049im      -0.084283+0.076154im     -0.169901+0.0701196im
   -0.0247215-0.107986im      -0.23198-0.093112im       0.210958+0.0388485im    -0.011948+0.0686769im     -0.193048-0.00901727im     -0.034259-0.12553im        0.121521+0.180227im       0.24876-0.0203051im    0.0368471+0.00249116im   0.0507785-0.387181im       -0.174525+0.112472im       0.0678854+0.241846im      -0.135984-0.0315549im    0.0863686+0.0389724im   -0.0875011+0.148675im     -0.164428+0.0938991im   -0.0754542-0.227447im      0.0969763+0.0968936im      -0.19761-0.208855im       0.0261945+0.0536868im    0.0827481-0.208501im       0.159668+0.0243401im    0.0855798+0.0518995im     0.054987+0.0475427im     0.0420988+0.0436223im    -0.0749736+0.0526983im      0.0305328+0.227814im        0.081887-0.0200802im     0.102717-0.0170006im    -0.022375-0.0111921im     0.0591406+0.0513042im    0.0994811+0.0523461im
     0.122307-0.0768525im   -0.0665802+0.0709889im     -0.103689+0.18879im      -0.158451-0.0935184im     -0.125365-0.184712im      -0.0698735-0.152331im      0.0486062-0.115364im     0.0134853+0.0185143im    0.0546447-0.101004im     -0.053727-0.066886im       0.0614373-0.211307im      -0.0996766+0.0446546im      0.237563+0.352674im    -0.0513045-0.229211im     -0.199375-0.0750976im     0.120074+0.17758im     -0.0699638-0.147085im       0.139115+0.0997384im      -0.13462+0.114024im        0.102725-0.0265807im     0.035489+0.00383352im    -0.195938+0.0485092im    0.0543678+0.101593im      0.276541+0.0688422im     -0.183864+0.123815im      -0.135148+0.0731446im    -0.00104404-0.109674im       0.0270359-0.0364686im   -0.0638419+0.0978728im   -0.0129935+0.131878im      0.0270928-0.0547276im    -0.174433+0.0115305im
    0.0961974+0.115653im      0.174713+0.300218im      0.0473985+0.0314819im    0.0938194+0.250552im     -0.0204867+0.131592im      -0.0165256-0.242082im       0.149133+0.0667019im    -0.192935+0.115802im     0.0565125+0.0439541im     0.125606+0.172861im        0.159323-0.0410795im      0.0409826+0.130775im       0.212835-0.0670343im    0.0288895+0.0991909im    -0.120607-0.0298015im    0.0423849-0.101377im    -0.0433704+0.00789544im    0.0564282-0.0346155im    -0.0189845+0.000385936im     0.247537+0.0475036im    0.0890674-0.151006im       0.022033-0.0663676im    0.0115007-0.0747289im   -0.0215001+0.0776823im    -0.0328404-0.242152im      -0.131246-0.0394781im      0.0253202+0.385177im        0.189286+0.0336065im    -0.165148+0.0962439im    0.0302418-0.0199596im     0.0453045-0.0675955im   0.00429046-0.127843im
   -0.0210846-0.0589346im    0.0603514-0.0752037im    0.00564655-0.219537im     -0.237271+0.0491972im     -0.150226+0.0504142im     -0.0271692-0.0815264im     -0.159745-0.02884im      -0.120517-0.013943im       0.13943-0.0180412im    0.0583911-0.136075im       0.0966912-0.363184im     -0.00899359-0.0667606im      0.045111+0.0772129im    -0.254504+0.123451im     0.0893843+0.233743im     0.0464876+0.00612426im     0.12594-0.0614911im     -0.164273+0.0118634im    -0.0370041-0.116073im       -0.111484+0.0736625im    -0.248377-0.167009im      -0.117316-0.148217im     0.0300738-0.0840992im    0.0456832+0.147966im       0.066749-0.101412im       0.279589-0.0906829im     0.00367787+0.0923937im      0.0741729-0.00473885im  -0.0156517-0.0841943im     -0.25241+0.00753141im    0.0965002-0.107648im    0.00158313+0.148358im
   -0.0895389-0.106766im      0.111752+0.0110079im      0.120183+0.0936681im     -0.12106-0.0180971im     0.0466671-0.126172im       0.0456435-0.12291im     -0.00485234-0.161128im     0.0856536+0.110341im      0.119792+0.0288563im   0.00974079-0.0822037im      0.0608311+0.270195im       0.0185603-0.11536im       -0.201131+0.028216im     0.0242767+0.0587073im     0.109327-0.0425249im     0.285777-0.0862391im    0.0980341+0.198319im      0.0680359-0.0361156im     0.0397348-0.0405894im    0.000270252+0.096425im     -0.173764-0.0561776im     -0.277833+0.120383im     0.0198816+0.04622im      0.0286482+0.0403882im     -0.196724+0.0427572im     -0.109202+0.130768im       -0.186276+0.223974im       0.0896375+0.0127389im     0.166697-0.163983im      0.128954+0.124206im      -0.113259-0.280432im      0.223211+0.0196506im
   -0.0525059-0.0453324im     0.250742+0.0946616im    -0.0690197+0.151661im     0.0654759+0.0419152im     -0.120183-0.00365086im      0.245048+0.140188im       0.152339+0.149881im     0.0866525+0.122857im     -0.149629-0.218014im      0.106038-0.105514im        0.117308-0.0967239im      0.0453312+0.115633im       -0.11781+0.125321im    0.00728707+0.0162678im     0.198525-0.06384im       0.146442-0.0373018im    0.0729491+0.041255im       0.162028+0.133025im    0.000761599+0.0141036im      -0.116548+0.246117im    -0.0622258+0.0279987im      0.197244+0.0925497im     0.157971-0.243464im    -0.0608596-0.174746im      0.0116749+0.0399575im   -0.00995615+0.157746im       0.0494522-0.188143im        0.156132-0.0815412im   -0.0431668+0.0800752im    -0.195954-0.136607im        0.11179-0.155312im    -0.0730997-0.035236im
      0.15758-0.146079im    -0.0739514-0.0701877im   -0.00246264-0.00708813im   0.0657481+0.0399763im    -0.0802504-0.00674461im     0.0128121+0.0357228im      -0.28146-0.034592im    -0.0411955+0.0224106im    -0.206237-0.0338819im   -0.0972478-0.171729im        0.151177+0.107862im       0.0320577-0.117588im     -0.0334556-0.030529im    -0.0183924+0.167209im     -0.333239+0.0315482im   -0.0165192+0.0422165im     0.107921-0.00150717im     0.277095+0.214564im       0.236947-0.0525023im       0.209366-0.103955im     -0.168099-0.0484678im    -0.0837409+0.0330669im   -0.0848023-0.0231933im    -0.140047-0.136368im      0.0506359-0.206397im     -0.0666065+0.10229im        0.0958526-0.134535im      -0.0452284+0.0588933im    -0.239121-0.0715492im   -0.0175716+0.112041im       0.211646+0.0191563im     0.155556-0.0212383im
    -0.228424+0.101408im     -0.114733+0.0640093im    -0.0425604-0.137054im       0.10484+0.0869762im    -0.0152184+0.084132im     -0.00711634-0.00967401im   -0.0157754-0.0923858im    -0.027131+0.173545im    -0.0824899+0.0688534im     0.137456+0.105543im        -0.09621-0.0373055im      -0.104834+0.0350656im     -0.263913+0.180771im    -0.0927031+0.0665449im    -0.208309-0.0906597im     0.375963-0.203973im     -0.100958-0.0406478im     0.0905302+0.0993981im    -0.0201681-0.165711im       0.0292579-0.160521im    -0.0810803-0.113285im        0.13073-0.0344385im      0.11529+0.0430632im     0.147621-0.00472167im   -0.0559852-0.115977im      0.0216682-0.075424im      -0.0324499-0.0222189im      -0.342007-0.18834im       0.205406-0.0121604im    -0.029536-0.0412892im     0.0550009+0.110006im     -0.130973-0.0817933im
 -0.000222283+0.13489im      -0.208818+0.158023im       0.266992+0.0627701im   -0.0825355+0.114604im       0.263542-0.300806im       -0.136364-0.0317114im   -0.00176788-0.0384622im     0.093443+0.0639798im     0.050113-0.164997im    -0.0718183-0.0461834im   -0.000416359-0.121147im      -0.0250857-0.0430825im     -0.165943-0.00449685im    0.024387-0.00675681im  -0.0619144+0.0439287im    0.0486823-0.173279im     -0.175096+0.0137364im    -0.0893701-0.0711676im    0.00777494+0.0763819im       0.105951+0.046559im      0.125232+0.100898im    0.000328593+0.17198im      0.0575722-0.249787im     -0.126696+0.252952im      0.0454267-0.204507im      0.0557288+0.0157147im       0.125902-0.181832im      -0.0541912+0.051624im    -0.0575688+0.124256im    -0.0201492-0.0713358im     0.0608099-0.106604im     0.0924379+0.299471im
     0.101814-0.0908699im     0.038824-0.029695im       0.135547+0.0396441im    -0.221136-0.141762im      0.0879853+0.0624018im      -0.108871+0.0236329im    -0.0699882-0.031152im     -0.103753+0.00530757im  0.00785926-0.0748223im    0.0675882+0.141102im        -0.16351+0.229414im       -0.140409+0.223627im       0.106299+0.176892im     0.0881018+0.126276im     -0.112287+0.101668im    -0.0914164+0.0478054im     0.258936+0.168688im    -0.00150142+0.0593101im     -0.114621+0.156659im       -0.119423-0.0497264im   -0.0584315+0.102863im        0.21912-0.123839im      0.225012+0.0204636im    -0.115204+0.166503im      0.0327406-0.134967im     -0.0359242+0.000973526im    0.0128629-0.0278238im     -0.0296902-0.437274im    -0.0746789+0.0201633im   0.00669493+0.0661879im    -0.0300597-0.126674im      0.078898-0.0143034im
     0.244569-0.0966731im   -0.0646537+0.0278595im       0.13912-0.0541626im     0.154554-0.00628576im    0.0794758+0.206827im        0.166704+0.161797im     -0.0113167-0.0101277im    0.0316958+0.0195207im    -0.100679-0.0724425im     0.203199-0.0427972im     0.00186401-0.00102515im     -0.116023+0.0254737im      -0.15447+0.147899im     -0.105948-0.226505im    0.00495936+0.298123im      0.209256-0.0720499im   -0.0216197-0.0204206im    -0.0891667-0.0646857im    -0.0871848+0.159931im      0.00389687+0.0919706im   -0.0501591+0.00692627im   -0.0908973+0.10272im      -0.272037-0.125682im    -0.0792546+0.143714im       0.149168+0.229591im     -0.0920353-0.124034im      -0.0498325+0.140765im      0.00731016-0.0774799im    -0.144957+0.0669272im     0.106801+0.232864im      0.0745387+0.179923im     0.0228646-0.0818072im
   -0.0592391-0.272544im     0.0449722+0.101011im      -0.246264+0.169497im    -0.0189512-0.0409394im      0.254459+0.136254im      -0.0307433+0.00829376im   -0.0666736+0.0584393im      0.18978-0.0652913im   -0.0697126-0.0182029im    0.0037754+0.0551894im      0.0896555+0.200277im      -0.0602362-0.0912217im     0.0574127+0.0810324im     0.110251+0.143508im      -0.11853+0.0232164im    0.0969454-0.0618403im   -0.0143242-0.108694im     -0.0224627+0.103195im      0.0827247+0.0592382im       0.122661-0.0251571im     0.031289-0.357711im       0.124702-0.0357241im    0.0432411-0.0636927im    0.0716433+0.174804im      0.0429377+0.207394im       0.256918-0.267326im       0.0937469-0.0813836im        0.16559+0.134074im     0.0271533+0.0282464im   -0.0102338-0.0584911im     -0.219194-0.040913im    0.00125446+0.113286im
    0.0774977+0.0910387im    -0.167221+0.1054im       -0.0293815-0.115185im     0.0940083-0.161197im     -0.0580079+0.0566674im      -0.304571-0.101275im      0.0172374-0.0114028im    -0.208656+0.156995im     -0.127356-0.0198635im     0.016289-0.158116im       -0.109922+0.0707609im      -0.202723-0.112983im      0.0516428+0.0273535im    0.0889781-0.0296241im    0.0542112-0.00194685im   0.0137129-0.111568im     0.0821772-0.246422im     -0.0679874+0.0405535im     0.0124417-0.00622792im    -0.0340025+0.0934681im    -0.113853-0.121642im      -0.154745-0.161664im    -0.0519296-0.164393im    -0.0855245-0.0735156im      0.186231+0.0419808im     -0.153219+0.158869im       -0.213882-0.162425im         0.14626-0.0217123im    0.0635791+0.0676392im     0.157378-0.353385im      -0.152141-0.103142im   -0.00500054-0.0592866im
    0.0424332+0.0388855im   -0.0631355+0.129im        -0.0245088+0.242768im    -0.0908928-0.112339im        -0.1535-0.00155482im     -0.167131+0.0886091im      0.123753+0.142461im      0.138435+0.029871im    7.09881e-5-0.163608im      0.162247-0.181785im      -0.0858391+0.00171924im      0.221113-0.121475im      0.0488149+0.0347597im     0.100713-0.00706119im   0.0384658-0.0754963im     0.149499+0.0233157im     0.253943+0.0159783im     -0.137178-0.25642im       0.0733714+0.107965im        0.213399-0.12196im      -0.148741+0.118778im      0.0620342+0.00126497im  -0.0615413+0.103863im     0.0518309-0.0115845im    -0.0396206-0.184886im       0.238265-0.185959im       -0.142668+0.0189342im      0.0210676-0.00997567im   0.0411706-0.0732114im     0.134642-0.120107im       0.268477+0.158863im   0.000594381-0.100426im</code></pre><p>and then generate the state <span>$ψ$</span></p><pre><code class="language-julia hljs">psi = P[:, 3]</code></pre><pre><code class="nohighlight hljs">32-element Vector{ComplexF64}:
   -0.0715185471110946 + 0.2794996415206333im
 -0.030405702211689367 - 0.31405779823539465im
  0.057667685111014985 - 0.06917084918150741im
  -0.05864427785240574 + 0.010030360948497439im
   0.09569668592402124 - 0.0736207880226533im
  -0.10743176969258289 - 0.09336153600553981im
    0.0773442064216757 + 0.0027444290326005417im
 -0.008781350856492821 - 0.06221325992075498im
   0.19467380057342362 - 0.09629502374468668im
  -0.13355453213119856 + 0.13237747688216314im
   0.10927134341893208 + 0.06914815415774922im
 -0.046029912287303604 + 0.025081504526873497im
 -0.050390060689268615 + 0.10612671157680152im
   -0.1414276852293883 - 0.023698369140468592im
   0.10043630292811279 + 0.0681457695120513im
    0.2002577117926313 - 0.14104167365546577im
  -0.13882775966040503 - 0.025448027898599464im
   0.04180869312802873 - 0.051244223619742554im
   -0.2598508649671375 + 0.009986791723511586im
  -0.10667028964129152 + 0.23269316297594395im
  -0.11822766081639778 - 0.061402810615189846im
 -0.027017080011785273 + 0.07560687939501042im
   0.06655495590616231 + 0.03688117112446692im
     0.352310225413394 + 0.0im
  -0.10170895934389035 - 0.24511801423907634im
 -0.013442108607704522 + 0.10440987881488051im
     0.110488120463398 - 0.027627717597350644im
  -0.04456702238982552 - 0.21570571635835173im
 -0.017520681345773247 - 0.059174103851715516im
   -0.0648277568004935 + 0.20767220228362704im
  -0.11158231573996345 - 0.03977944459747112im
  -0.17041892842874246 - 0.030549305207779428im</code></pre><p>In the phase estimation process, we will feed the state to circuit and measure the first <code>n</code> qubits processed by iQFT.</p><pre><code class="language-julia hljs">r = join(ArrayReg(psi), zero_state(N))
r |&gt; PE(N, M, U)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 8/8
    nlevel: 2</code></pre><p>Since our phase can be represented by 3 qubits precisely, we only need to measure once</p><pre><code class="language-julia hljs">results = measure(r, 1:N; nshots=1)</code></pre><pre><code class="nohighlight hljs">1-element Vector{DitStr{2, 3, Int64}}:
 011 ₍₂₎</code></pre><p>Recall that our QFT&#39;s bit numbering is reversed, let&#39;s reverse it back</p><pre><code class="language-julia hljs">using BitBasis
estimated_phase = bfloat(results[]; nbits=N)</code></pre><pre><code class="nohighlight hljs">0.75</code></pre><p>the phase is exactly <code>0.75</code>!</p><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../1.prepare-ghz-state/index.html">« Prepare Greenberger–Horne–Zeilinger state with Quantum Circuit</a><a class="docs-footer-nextpage" href="../3.grover-search/index.html">Grover Search »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.4.1 on <span class="colophon-date" title="Tuesday 21 May 2024 20:49">Tuesday 21 May 2024</span>. Using Julia version 1.10.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
