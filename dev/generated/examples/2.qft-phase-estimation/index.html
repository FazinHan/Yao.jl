<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Quantum Fourier Transformation and Phase Estimation · Documentation | Yao</title><meta name="title" content="Quantum Fourier Transformation and Phase Estimation · Documentation | Yao"/><meta property="og:title" content="Quantum Fourier Transformation and Phase Estimation · Documentation | Yao"/><meta property="twitter:title" content="Quantum Fourier Transformation and Phase Estimation · Documentation | Yao"/><meta name="description" content="Documentation for Documentation | Yao."/><meta property="og:description" content="Documentation for Documentation | Yao."/><meta property="twitter:description" content="Documentation for Documentation | Yao."/><script data-outdated-warner src="../../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../search_index.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script><link href="../../../assets/indigo.css" rel="stylesheet" type="text/css"/><link href="https://yaoquantum.org/assets/favicon-light.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../index.html"><img src="../../../assets/logo.png" alt="Documentation | Yao logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../../index.html">Documentation | Yao</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../../index.html">Home</a></li><li><a class="tocitem" href="../../../quick-start.html">Quick Start</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../../../man/registers.html">Quantum Registers</a></li><li><a class="tocitem" href="../../../man/blocks.html">Blocks</a></li><li><a class="tocitem" href="../../../man/symbolic.html">Symbolic Computation</a></li><li><a class="tocitem" href="../../../man/cuda.html">CUDA extension - CuYao</a></li><li><a class="tocitem" href="../../../man/plot.html">Quantum Circuit Visualization</a></li><li><a class="tocitem" href="../../../man/automatic_differentiation.html">Automatic Differentiation</a></li><li><a class="tocitem" href="../../../man/simplification.html">Simplification</a></li><li><a class="tocitem" href="../../../man/bitbasis.html">BitBasis</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../1.prepare-ghz-state/index.html">Prepare Greenberger–Horne–Zeilinger state with Quantum Circuit</a></li><li class="is-active"><a class="tocitem" href="index.html">Quantum Fourier Transformation and Phase Estimation</a><ul class="internal"><li><a class="tocitem" href="#Quantum-Fourier-Transformation"><span>Quantum Fourier Transformation</span></a></li><li><a class="tocitem" href="#Wrap-QFT-to-an-external-block"><span>Wrap QFT to an external block</span></a></li><li><a class="tocitem" href="#Phase-Estimation"><span>Phase Estimation</span></a></li></ul></li><li><a class="tocitem" href="../3.grover-search/index.html">Grover Search</a></li><li><a class="tocitem" href="../4.shor-algorithm/index.html">Shor&#39;s Algorithm</a></li><li><a class="tocitem" href="../5.shor-9-code/index.html">Shor&#39;s 9 qubit code</a></li><li><a class="tocitem" href="../6.quantum-circuit-born-machine/index.html">Quantum Circuit Born Machine</a></li><li><a class="tocitem" href="../7.variation-quantum-eigen-solver/index.html">Variational Quantum Eigen Solver</a></li><li><a class="tocitem" href="../8.riemannian-gradient-flow/index.html">Riemannian gradient flow optimizer</a></li></ul></li><li><a class="tocitem" href="../../../performancetips.html">Performance Tips</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href="index.html">Quantum Fourier Transformation and Phase Estimation</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="index.html">Quantum Fourier Transformation and Phase Estimation</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/QuantumBFS/Yao.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/QuantumBFS/Yao.jl/blob/master/docs/src/examples/2.qft-phase-estimation/main.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><p><a href="/generated/examples/2.qft-phase-estimation/main.ipynb"><img src="https://mybinder.org/badge_logo.svg" alt/></a></p><h1 id="example-qft"><a class="docs-heading-anchor" href="#example-qft">Quantum Fourier Transformation and Phase Estimation</a><a id="example-qft-1"></a><a class="docs-heading-anchor-permalink" href="#example-qft" title="Permalink"></a></h1><p>Let&#39;s use Yao first</p><pre><code class="language-julia hljs">using Yao</code></pre><h2 id="Quantum-Fourier-Transformation"><a class="docs-heading-anchor" href="#Quantum-Fourier-Transformation">Quantum Fourier Transformation</a><a id="Quantum-Fourier-Transformation-1"></a><a class="docs-heading-anchor-permalink" href="#Quantum-Fourier-Transformation" title="Permalink"></a></h2><p>The Quantum Fourier Transformation (QFT) circuit is to repeat two kinds of blocks repeatly:</p><p><img src="assets/qft.png" alt="qft-circuit"/></p><p>The basic building block control phase shift gate is defined as</p><p class="math-container">\[R(k)=\begin{bmatrix}
1 &amp; 0\\
0 &amp; \exp\left(\frac{2\pi i}{2^k}\right)
\end{bmatrix}\]</p><p>Let&#39;s define block <code>A</code> and block <code>B</code>, block <code>A</code> is actually a control block.</p><pre><code class="language-julia hljs">A(i, j) = control(i, j=&gt;shift(2π/(1&lt;&lt;(i-j+1))))</code></pre><pre><code class="nohighlight hljs">A (generic function with 1 method)</code></pre><p>Once you construct the blockl you can inspect its matrix using <code>mat</code> function. Let&#39;s construct the circuit in dash box A, and see the matrix of <span>$R_4$</span> gate.</p><pre><code class="language-julia hljs">R4 = A(4, 1)</code></pre><pre><code class="nohighlight hljs">(n -&gt; control(n, 4, 1 =&gt; shift(0.39269908169872414)))</code></pre><p>If you have read about <a href="@ref tutorial-ghz">preparing GHZ state</a>, you probably know that in Yao, we could just leave the number of qubits, and it will be evaluated when possible.</p><pre><code class="language-julia hljs">R4(5)</code></pre><pre><code class="nohighlight hljs">nqubits: 5
control(4)
└─ (1,) shift(0.39269908169872414)</code></pre><p>its matrix will be</p><pre><code class="language-julia hljs">mat(R4(5))</code></pre><pre><code class="nohighlight hljs">32×32 Diagonal{ComplexF64, Vector{ComplexF64}}:
 1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im</code></pre><p>Then we repeat this control block over and over on different qubits, and put a Hadamard gate to <code>i</code>th qubit to construct <code>i</code>-th <code>B</code> block.</p><pre><code class="language-julia hljs">B(n, k) = chain(n, j==k ? put(k=&gt;H) : A(j, k) for j in k:n)</code></pre><pre><code class="nohighlight hljs">B (generic function with 1 method)</code></pre><p>We need to input the total number of qubits <code>n</code> here because we have to iterate through from <code>k</code>-th location to the last.</p><p>Now, let&#39;s construct the circuit by chaining all the <code>B</code> blocks together</p><pre><code class="language-julia hljs">qft(n) = chain(B(n, k) for k in 1:n)
qft(4)</code></pre><pre><code class="nohighlight hljs">nqubits: 4
chain
├─ chain
│  ├─ put on (1)
│  │  └─ H
│  ├─ control(2)
│  │  └─ (1,) shift(1.5707963267948966)
│  ├─ control(3)
│  │  └─ (1,) shift(0.7853981633974483)
│  └─ control(4)
│     └─ (1,) shift(0.39269908169872414)
├─ chain
│  ├─ put on (2)
│  │  └─ H
│  ├─ control(3)
│  │  └─ (2,) shift(1.5707963267948966)
│  └─ control(4)
│     └─ (2,) shift(0.7853981633974483)
├─ chain
│  ├─ put on (3)
│  │  └─ H
│  └─ control(4)
│     └─ (3,) shift(1.5707963267948966)
└─ chain
   └─ put on (4)
      └─ H
</code></pre><h2 id="Wrap-QFT-to-an-external-block"><a class="docs-heading-anchor" href="#Wrap-QFT-to-an-external-block">Wrap QFT to an external block</a><a id="Wrap-QFT-to-an-external-block-1"></a><a class="docs-heading-anchor-permalink" href="#Wrap-QFT-to-an-external-block" title="Permalink"></a></h2><p>In most cases, <code>function</code>s are enough to wrap quantum circuits, like <code>A</code> and <code>B</code> we defined above, but sometimes, we need to dispatch specialized methods on certain kinds of quantum circuit, or we want to define an external block to export, thus, it&#39;s useful to be able to wrap circuit to custom blocks.</p><p>First, we define a new type as subtype of <code>PrimitiveBlock</code> since we are not going to use the subblocks of <code>QFT</code>, if you need to use its subblocks, it&#39;d be better to define it under <code>CompositeBlock</code>.</p><pre><code class="language-julia hljs">struct QFT &lt;: PrimitiveBlock{2}
    n::Int
end

YaoBlocks.nqudits(q::QFT) = q.n</code></pre><p>Now, let&#39;s define its circuit</p><pre><code class="language-julia hljs">circuit(q::QFT) = qft(q.n)</code></pre><pre><code class="nohighlight hljs">circuit (generic function with 1 method)</code></pre><p>And forward <code>mat</code> to its circuit&#39;s matrix</p><pre><code class="language-julia hljs">YaoBlocks.mat(::Type{T}, x::QFT) where T = mat(T, circuit(x))</code></pre><p>You may notice, it is a little ugly to print <code>QFT</code> at the moment, this is because we print the type summary by default, you can define your own printing by overloading <code>print_block</code></p><pre><code class="language-julia hljs">YaoBlocks.print_block(io::IO, x::QFT) = print(io, &quot;QFT($(x.n))&quot;)</code></pre><p>Since it is possible to use FFT to simulate the results of QFT (like cheating), we could define our custom <code>apply!</code> method:</p><pre><code class="language-julia hljs">using FFTW, LinearAlgebra

function YaoBlocks.apply!(r::ArrayReg, x::QFT)
    α = sqrt(length(statevec(r)))
    invorder!(r)
    lmul!(α, ifft!(statevec(r)))
    return r
end</code></pre><p>Now let&#39;s check if our <code>apply!</code> method is correct:</p><pre><code class="language-julia hljs">r = rand_state(5)
r1 = r |&gt; copy |&gt; QFT(5)
r2 = r |&gt; copy |&gt; circuit(QFT(5))
r1 ≈ r2</code></pre><pre><code class="nohighlight hljs">true</code></pre><p>We can get iQFT (inverse QFT) directly by calling <code>adjoint</code></p><pre><code class="language-julia hljs">QFT(5)&#39;</code></pre><pre><code class="nohighlight hljs"> [†]QFT(5)</code></pre><p>QFT and iQFT are different from FFT and IFFT in three ways,</p><ol><li>they are different by a factor of <span>$\sqrt{2^n}$</span> with <span>$n$</span> the number of qubits.</li><li>the <a href="https://quantumbfs.github.io/BitBasis.jl/stable/tutorial/#Conventions-1">bit numbering</a> will exchange after applying QFT or iQFT.</li><li>due to the convention, QFT is more related to IFFT rather than FFT.</li></ol><h2 id="Phase-Estimation"><a class="docs-heading-anchor" href="#Phase-Estimation">Phase Estimation</a><a id="Phase-Estimation-1"></a><a class="docs-heading-anchor-permalink" href="#Phase-Estimation" title="Permalink"></a></h2><p>Since we have QFT and iQFT blocks we can then use them to realize phase estimation circuit, what we want to realize is the following circuit:</p><p><img src="assets/phaseest.png" alt="phase estimation"/></p><p>First we call Hadamard gates repeatly on first <code>n</code> qubits.</p><pre><code class="language-julia hljs">Hadamards(n) = repeat(H, 1:n)</code></pre><pre><code class="nohighlight hljs">Hadamards (generic function with 1 method)</code></pre><p>Then in dashed box <code>B</code>, we have controlled unitaries:</p><pre><code class="language-julia hljs">ControlU(n, m, U) = chain(n+m, control(k, n+1:n+m=&gt;matblock(U^(2^(k-1)))) for k in 1:n)</code></pre><pre><code class="nohighlight hljs">ControlU (generic function with 1 method)</code></pre><p>each of them is a <code>U</code> of power <span>$2^{(k-1)}$</span>.</p><p>Since we will only apply the qft and Hadamard on first <code>n</code> qubits, we could use <code>Subroutine</code>, which creates a context of a sub-scope of the qubits.</p><pre><code class="language-julia hljs">PE(n, m, U) =
    chain(n+m, # total number of the qubits
        subroutine(Hadamards(n), 1:n), # apply H in local scope
        ControlU(n, m, U),
        subroutine(QFT(n)&#39;, 1:n))</code></pre><pre><code class="nohighlight hljs">PE (generic function with 1 method)</code></pre><p>we use the first <code>n</code> qubits as the output space to store phase <span>$ϕ$</span>, and the other <code>m</code> qubits as the input state which corresponds to an eigenvector of oracle matrix <code>U</code>.</p><p>The subroutine here uses <code>focus!</code> and <code>relax!</code> to manage a local scope of quantum circuit, and only activate the first <code>n</code> qubits while applying the block inside the subroutine context, and the scope will be <code>relax!</code>ed back, after the context. This is equivalent to manually <code>focus!</code> then <code>relax!</code></p><p>fullly activated</p><pre><code class="language-julia hljs">r = rand_state(5)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 5/5
    nlevel: 2</code></pre><p>first 3 qubits activated</p><pre><code class="language-julia hljs">focus!(r, 1:3)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 3/5
    nlevel: 2</code></pre><p>relax back to the original</p><pre><code class="language-julia hljs">relax!(r, 1:3)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 5/5
    nlevel: 2</code></pre><p>In this way, we will be able to apply small operator directly on the subset of the qubits.</p><p>Details about the algorithm can be found here: <a href="https://en.wikipedia.org/wiki/Quantum_phase_estimation_algorithm">Quantum Phase Estimation Algorithm</a></p><p>Now let&#39;s check the results of our phase estimation.</p><p>First we need to set up a unitary with known phase, we set the phase to be 0.75, which is <code>0.75 * 2^3 == 6 == 0b110</code> .</p><pre><code class="language-julia hljs">N, M = 3, 5
P = eigen(rand_unitary(1&lt;&lt;M)).vectors
θ = Int(0b110) / 1&lt;&lt;N
phases = rand(1&lt;&lt;M)
phases[0b010+1] = θ
U = P * Diagonal(exp.(2π * im * phases)) * P&#39;</code></pre><pre><code class="nohighlight hljs">32×32 Matrix{ComplexF64}:
  -0.294045-0.109222im      -0.0297758-0.0701133im        0.20672+0.139002im       0.121086+0.0898758im     -0.130228+0.0150297im     0.100887-0.0192206im       0.0861462+0.0660224im     0.0941812-0.0344898im     0.0223403+0.193302im      -0.0460258-0.258121im     0.00197543+0.156759im      -0.037813+0.0469836im   -0.00417562+0.0374833im    -0.109321+0.236894im       -0.142235+0.0477516im    -0.172883+0.0710139im    -0.0252237+0.0778058im     -0.082511-0.152019im        0.246107-0.0110276im    -0.178368+0.181311im      0.111883+0.127388im    0.00113147-0.0366322im     0.175238-0.111056im      -0.126344-0.0249296im     -0.163934+0.141648im     0.00605048+0.171058im     -0.0645941-0.138678im    -0.177148+0.121197im     -0.0536001+0.236161im      -0.112362+0.07188im       0.0749884-0.0336491im    0.0864131-0.107744im
   0.133956-0.124957im       -0.121832-0.000486862im    0.0364433-0.19008im     0.000523746-0.0623333im     0.0486821-0.128772im     -0.035892-0.000695277im    -0.0641902+0.0952841im      0.131799-0.0505495im     -0.153267+0.160224im      -0.0205767-0.107361im     -0.0353407-0.0778873im     0.0354843-0.108788im       0.242843+0.102262im      0.147848+0.146469im       -0.024347-0.214236im    -0.0932012+0.325033im      -0.189643-0.191756im      -0.194438+0.0613436im     -0.0265114+0.102109im    -0.0596939+0.00642188im   0.0613405+0.163481im     0.0170954-0.0909048im    -0.076123+0.0449023im    -0.0512599+0.115476im      0.0132944+0.108621im     0.00314834+0.138127im        0.16147+0.0768867im    0.075437+0.102317im      -0.207351-0.155752im       0.299368-0.111597im     -0.0514242+0.165059im     -0.150649-0.0939398im
 -0.0614641-0.0777677im      -0.300143+0.0797261im      -0.156283-0.125928im     -0.0762703-0.235477im      -0.246675-0.0932245im    -0.139944-0.212168im        0.0354745-0.252227im       0.206329+0.230021im      0.0553541-0.00397367im     -0.111529+0.106209im     -0.0268967+0.0277721im    -0.0290604-0.239529im      0.0337682-0.133682im     -0.166909-0.0349028im     -0.0265462+0.105159im     -0.013839-0.114007im      0.0994749+0.0153091im     -0.216833-0.261419im        0.031337+0.226343im     0.0917931-0.0402856im   -0.0200377-0.0709044im     0.080678+0.0423225im   0.00294269+0.0352861im    -0.0236333+0.083619im      0.0382005+0.00164365im   -0.0231724+0.0353273im   -0.00342879+0.103893im    0.0837847-0.0902394im     -0.157029+0.185699im      0.0339099+0.179294im     -0.0314403-0.0177745im    0.0284086-0.0639291im
   0.106743+0.129118im        0.114275-0.0475822im      -0.175471+0.0610398im     -0.131694-0.0463111im     0.0927441-0.0841908im    -0.085322-0.0224649im      -0.0273693+0.12595im       0.0140603+0.0360596im       0.10134+0.0986877im      0.0872323+0.107877im      -0.165578-0.24736im       0.0811876+0.208854im      -0.169217+0.17118im       0.053786-0.0210201im      -0.106354+0.122269im    -0.0209218+0.0313325im     -0.072678+0.0897357im      0.174527-0.15798im         0.165436+0.234038im      0.188263+0.11718im     -0.0725789-0.172635im    0.00844354-0.220739im    -0.0815128-0.048707im       0.109529+0.179573im      -0.171742+0.0579244im     0.0825116+0.140697im        -0.1965+0.0291843im  -0.0924134+0.150244im      -0.115975+0.113512im       0.213261-0.0979126im   0.000799115-0.121034im     0.0712654-0.160132im
   0.230072-0.0384063im       0.426584+0.0755022im     -0.0269948-0.195472im    -0.00212096+0.089351im      -0.199073-0.101186im    -0.0729503-0.243966im       -0.0927165-0.142851im        0.01919+0.017902im       0.192283+0.0218369im      0.0512712-0.0698192im      0.101357+0.161494im       0.173447+0.01874im       0.0583306+0.0737371im    -0.068674-0.00415177im      0.132906-0.120393im    0.00906058-0.176222im     -0.0631225+0.124972im      0.0312748-0.0531729im     -0.0742194+0.0352018im    -0.191578-0.0276936im    0.0602035+0.0325238im   -0.0972296-0.0223502im    0.0520927-0.0865584im    -0.0245005+0.259313im      -0.179666+0.138055im       0.187367-0.0540807im     0.0821353-0.0853365im  -0.0751628+0.00926346im    0.0981873+0.0404912im      0.108343+0.119712im      0.0784995+0.078222im     -0.150091+0.190734im
  -0.228364-0.342498im       0.0804838+0.135694im        0.145128+0.175308im      -0.114687+0.0136038im   -0.00942149-0.175832im     -0.199524+0.0131038im    -0.000114778-0.053359im       -0.26448+0.0177093im    -0.0635188+0.0416995im      0.0919037+0.0533366im     0.0328941-0.255312im     -0.0393268+0.0390409im     0.0222261+0.125073im     0.0773634-0.0814993im       0.146947-0.244628im      0.149656+0.0431473im      0.114822+0.0127402im       -0.1295-0.0777658im     -0.0015778+0.0537925im     0.124322+0.183293im     0.0262347-0.0967784im     0.228141-0.120859im     0.0894701-0.142496im      -0.111762+0.0253167im     0.0641885+0.0522248im     0.0771401-0.0403141im      0.181685+0.0981475im  -0.0110386+0.0927487im     0.0541343-0.00564044im    -0.155348+0.0828301im     -0.139802-0.164463im     -0.067068+0.135872im
   0.100443+0.00482956im    -0.0157682+0.146539im       -0.146291-0.145679im     -0.0357122+0.120925im       0.100176-0.106313im      0.110513-0.250864im        -0.171606-0.0404961im      0.096921-0.0220752im     -0.057723-0.179183im     -0.00500626-0.0149199im      0.034294-0.0416653im     0.0921207-0.150507im       0.182076-0.0407303im    0.0514839+0.153821im       -0.135169-0.0454713im    0.0728908-0.0534688im      0.132279-0.00526686im     0.102282+0.0536935im      0.0713452-0.025661im     0.0263981-0.215903im      0.225837+0.129908im      0.177667-0.323006im    -0.0186359-0.0407565im    -0.0120056-0.186793im      0.0297789-0.00169591im   -0.0132077+0.0707982im    -0.0609586-0.116004im   -0.0503713+0.209106im       0.134251+0.101442im      -0.164981-0.151875im      -0.208304-0.161229im      0.263814+0.0312681im
   0.156263+0.0547127im     -0.0949306+0.19651im        0.0561036-0.111718im       0.193248-0.130106im     0.00655317+0.115875im    -0.0395019+0.214564im        -0.107643-0.0777087im     -0.355536+0.0336337im     0.0205715-0.232984im       0.0252104-0.155002im      -0.141542+0.0669712im     -0.118549-0.0966724im    -0.0185975+0.00483843im    0.142959+0.0512407im      0.0250534+0.195866im      0.136269+0.0957587im      0.212381+0.10934im     -0.00335075-0.1016im          0.257531+0.0406998im    -0.280151+0.0359717im   -0.0948953-0.0312972im    0.0803541-0.119743im     0.0184321-0.02598im      -0.0492105+0.0460022im     -0.194722-0.0517565im   -0.00490109-0.124202im      0.0719249-0.0135762im   0.0720315+0.115524im      -0.204704-0.0513784im      0.119205+0.0252334im     0.0130795+0.087145im      0.113984+0.140757im
  -0.043499+0.152278im         0.10411+0.0612258im      -0.217181-0.0588948im   -0.00701762+0.0524429im      0.111133-0.136691im    -0.0921987-0.00540914im       0.215851+0.124857im     -0.0271521+0.0545463im     -0.179239-0.0297738im       0.112174-0.0169038im      0.167467+0.119568im      0.0892154-0.115237im       -0.01027+0.117414im     -0.104819-0.0523224im     -0.0919377+0.206779im     0.0659779-0.0407772im     0.0381659+0.113311im      -0.263461+0.209066im        0.166599+0.13871im      0.0792443-0.013574im     0.0420883-0.0949593im    -0.172913+0.149317im      0.238176-0.0705934im     -0.195499-0.0112959im    0.00310284+0.0584992im     -0.273344-0.00397338im    0.0859449-0.143626im    0.0128953+0.163814im     -0.0258239-0.214226im      0.0798167-0.029447im     -0.0337571-0.236852im     -0.137562+0.00868448im
   0.177194-0.0915126im      -0.104154+0.0577388im     -0.0594314-0.0226949im      0.199266+0.00277781im  -0.00357646+0.225747im      0.112015+0.0593888im      -0.0577545+0.116332im      0.0226103-0.126013im     0.00705495+0.186266im      -0.0288702-0.0586375im    -0.0739214-0.208328im       0.137675-0.28937im      -0.0884012+0.0530751im    -0.161582-0.254593im    -0.000521909-0.0716297im     0.239999+0.143062im       0.021381-0.292896im    -0.00142741+0.042598im       0.0921134+0.0498756im     0.104665-0.0721494im   -0.0320258+0.0497582im    -0.116874+0.0706876im     0.260453-0.138961im      0.0504376+0.0719703im     -0.133213+0.0519855im      0.147545+0.0915222im    -0.0451001-0.0362343im   0.0160223-0.0838439im      0.206704+0.0289298im   -0.00418428+0.216406im      0.0653855-0.120088im      0.152128+0.0307927im
 -0.0239802+0.224846im        0.190462-0.0356037im      0.0439235+0.00486063im     0.202947-0.0723443im     0.0181603-0.0278253im    0.0475536-0.0741339im        0.177912+0.00171986im     0.148977-0.160181im      -0.315975+0.0481978im      0.0254195+0.0330946im     -0.196908-0.0967097im      0.102983+0.0380593im     0.0297792-0.148075im     0.0837295-0.00582737im     0.0640629-0.0136349im     0.114338+0.00496055im     0.150398+0.103166im     -0.0262993-0.0516068im       0.123805+0.176913im     -0.103516+0.0462175im     0.209688+0.00201395im    0.149474-0.00989752im  -0.0786098-0.215386im       0.234866-0.09341im      -0.0383706+0.194149im      -0.185467-0.105303im      0.0995803+0.169041im   -0.0624957-0.362026im      0.0610075+0.065445im      0.0137554+0.00404882im   -0.0561783+0.0959649im   -0.0744778+0.00717056im
   0.103477+0.0702545im       0.251782-0.117651im       -0.158886+0.101497im      -0.113312+0.0534768im      -0.18471+0.100989im      0.121693-0.0547975im       0.0440092+0.113562im      -0.117222+0.0693786im      0.138193-0.0601617im      -0.204078+0.0984216im    -0.0266639+0.183067im      -0.188632+0.0621508im      0.149115-0.0285568im   -0.0301585+0.0542668im       0.106626+0.0504378im   0.00544152+0.266281im    -0.00132823-0.0321092im     -0.107805+0.00438428im     -0.101123+0.22307im       0.175635-0.0791622im   -0.0481899+0.00229265im   0.0803215-0.0690029im    0.0465465-0.272704im      0.0778958-0.25095im      -0.0683984-0.0447837im    -0.0174591+0.206339im       0.145272+0.145697im    0.0568652+0.129043im      -0.069988-0.142377im      -0.157142+0.13341im        0.155922+0.132041im      0.103887+0.00299927im
  0.0968769+0.00274753im     0.0310042+0.013072im        0.148241+0.0973292im     0.0735765+0.0713762im     0.0342876+0.055636im     0.0489438-0.150714im        0.0470899+0.110386im      0.0135387-0.135422im     -0.0565739-0.10431im        -0.219194+0.0350305im     0.0511071-0.124529im    -0.00434906+0.0421472im     -0.217394-0.120329im     -0.387213-0.0295003im     -0.0689656+0.0931076im     0.146298-0.0873367im      0.157237-0.175119im      -0.153956+0.0429451im      -0.102168+0.108834im    -0.0161962+0.136474im     -0.037239+0.167592im    -0.0591565-0.123739im     -0.111845+0.025433im       0.102188+0.0887778im     0.0659774-0.0797384im     0.0323795-0.0994825im    -0.0417101-0.010224im    -0.103251+0.320066im      -0.224257+0.0766763im    -0.0588902-0.0920539im     -0.149767+0.175994im     -0.267928+0.123151im
 -0.0703757-0.00138786im       0.10175+0.177776im        0.128622-0.165646im      -0.108786+0.0863101im       0.29326-0.0845874im    -0.209701+0.169164im         0.184923-0.104993im        0.13341-0.142894im    -0.00121722-0.182736im       -0.297354-0.136336im     -0.0182017-0.00567674im   -0.0402391-0.145355im      -0.134468-0.0777281im   -0.0290313-0.250052im         0.10428-0.0210301im    -0.311883+0.0230332im    -0.0585085+0.0309158im      0.194913-0.0486795im      0.0888916+0.104125im     0.0179352-0.0428845im   -0.0387442+0.0977214im    -0.138022-0.040157im     -0.172935-0.0797501im     0.0554469-0.0104722im     0.0486453+0.119027im      0.0644683+0.161402im       0.169905-0.0314858im   0.0432866+0.0186933im    -0.0873029-0.0246976im      -0.12362+0.0875872im     0.0978696-0.12601im      0.0841682+0.0340333im
 -0.0369702-0.169636im        0.241952-0.0260301im      0.0805848+0.0100666im     -0.129457+0.0630488im     0.0542926-0.012022im     0.0186753+0.158114im         0.118829-0.0284941im    -0.0870945-0.136604im       0.131394-0.0494992im     -0.0252268+0.00727842im     0.190273-0.133956im       0.117557-0.215323im     -0.0550897+0.048937im      0.011801+0.119673im       -0.159863+0.0714098im     0.172127-0.0330631im      0.203877+0.102772im     -0.0281829+0.0805931im     -0.0837463-0.177719im       0.12809-0.236438im     0.0897214+0.0171305im    0.0636656-0.0880318im    0.0383504+0.209142im     -0.0271061+0.11151im      -0.0260729+0.135171im      -0.196684+0.0543396im    -0.0297734+0.195701im   -0.0984157-0.0961635im     -0.192019+0.0777116im       0.10165+0.169779im       0.172328+0.218467im      0.109071-0.242362im
  -0.104196-0.235724im        0.169444+0.102737im      -0.0191401-0.00138695im     0.236887+0.00236156im    0.0525389+0.117423im      0.125423-0.0507591im       -0.111843-0.133162im      0.0763504+0.119694im       0.229265+0.221008im      -0.0828824+0.14935im        0.120328-0.193305im       0.121633-0.0110013im     0.0124532+0.0706552im    0.0934065-0.126968im       0.0588851+0.204019im     -0.190128+0.139247im      0.0217711-0.00100509im    0.0351267-0.0906891im       0.124229+0.014625im     0.0210631-0.120621im     0.0189199+0.0524952im    -0.175174+0.0149315im    -0.121581-0.203879im       -0.17488-0.142321im      0.0578929-0.249979im       -0.21236-0.224685im         0.1231+0.0370106im  -0.0879853+0.00514017im   -0.0264639+0.0640075im     0.0895998-0.194158im     -0.0369608+0.0612571im   -0.0379111-0.00535809im
   0.136481+0.120617im      -0.0171168-0.165886im        0.129779+0.0134158im     0.0255363-0.142786im      -0.185684-0.0490996im   -0.0842408+0.143776im        -0.154636+0.0699768im      0.250424-0.0891573im    -0.0190936-0.0572836im      0.0114165+0.0438239im      0.197539-0.0126548im     -0.185298-0.00832992im    0.0196078+0.214886im     0.0534069-0.130782im       -0.100863+0.244932im      0.195612-0.0399817im      -0.34453-0.00706419im     0.162654-0.0416923im     -0.0726407-0.0553473im   -0.0054775+0.0383106im   -0.0216026+0.0694566im    0.0230249-0.0414641im    0.0490797-0.0102705im    -0.0698831-0.0312819im     0.0469571+0.183747im      -0.135788-0.144602im       0.307048+0.127629im   -0.0766516+0.0996975im    -0.0448772+0.164161im     -0.0953211+0.109985im       -0.17435-0.0708609im     0.116706+0.0860947im
  0.0903249+0.0795894im     -0.0207669-0.0710123im       0.143716-0.0746718im     -0.157587+0.0488323im     0.0552674-0.211561im      0.100698+0.105032im       -0.0873885+0.108952im      -0.103032-0.1435im       -0.0293706+0.0276957im      0.0924067+0.0880583im      0.238604+0.00742902im   -0.0406058-0.129173im     -0.0649305-0.112366im      0.265729+0.0338028im      -0.192947-0.0648663im    0.0235488-0.248381im      -0.044873-0.0843224im     -0.281899-0.269592im       0.0897001+0.0235659im    0.0191324-0.0688739im   -0.0577836+0.0812415im   -0.0541611+0.236919im     -0.129222-0.351872im      0.0810352+0.10754im       -0.121197-0.251621im      0.0575542+0.0630128im    -0.0198723+0.0243542im  0.00404541-0.0203579im    0.00487406+0.0622418im     -0.102271-0.100662im      0.0690946+0.019196im     0.0480907+0.00904927im
  0.0536588+0.100815im      -0.0194728-0.0731667im      0.0687845+0.109906im      -0.291049-0.0581637im      0.128066+0.0845156im   -0.0697442-0.0767242im       -0.139019+0.013295im      -0.211374+0.195184im      -0.164892+0.32415im        -0.130464+0.0762972im   -0.00568694+0.0121173im     0.0466065-0.19544im        0.016412-0.136847im    -0.0209727+0.0291246im     -0.0364482-0.0130612im   -0.0557182+0.18621im      -0.0518276+0.159771im       0.129666+0.0435961im      0.0462804+0.00438403im   -0.169462-0.18758im      -0.134501+0.0986607im    0.0752269-0.00868395im  -0.0200249-0.0159936im      0.166491+0.166663im     -0.0101189+0.0730486im     -0.188661-0.24578im       0.0226378-0.111297im    0.0543852+0.178555im        0.13583+0.12343im       -0.154653+0.154579im       0.044779-0.0533329im    -0.177209-0.122073im
  -0.100696+0.00860963im    -0.0969636-0.114722im       -0.247895-0.103037im      0.0178436+0.0420787im    -0.0592445-0.0686808im    -0.142517+0.140745im         0.162614+0.213704im     0.00715983+0.0632057im     0.0374987-0.0271818im      -0.181883-0.0939379im   0.000924049+0.0966124im      0.317354+0.0562298im     -0.305115-0.00205535im   -0.033254-0.0546514im       0.193638-0.15014im      0.0682003-0.0170318im     -0.164533-0.016706im     -0.0314366+0.000316401im   -0.0208198-0.209973im     -0.242838-0.135218im     0.0696342-0.0867041im     0.267455-0.0624115im    0.0752679-0.181519im      0.0247939-0.0367067im     0.0585792-0.245795im     -0.0397755-0.015446im        0.07138+0.117591im    0.0274046+0.142469im    -0.00390747+0.181396im       0.138365-0.0107228im    -0.0659721+0.0564457im    0.0582358-0.0435212im
 -0.0923174-0.178733im      -0.0441915-0.066166im       0.0148794-0.318024im      -0.190667-0.0554549im     -0.132079-0.13785im     -0.0432586-0.101364im         0.201392+0.230616im      0.0660398-0.0970152im    -0.0810918-0.0371858im        0.11059+0.190247im     -0.0337348+0.0384744im      0.037114-0.0648902im     0.0977906-0.016806im    -0.0428435+0.131317im     -0.00672237+0.159738im   -0.00431496+0.169689im       0.243715-0.0131698im      0.243281+0.205341im     -0.00212895-0.0886936im   -0.0760948+0.182837im     -0.363706+0.0753547im   -0.0911322-0.0316467im   -0.0350037-0.154269im     -0.0359866+0.00851396im   -0.0696606-0.163603im       0.132966-0.105463im      0.0557402+0.0282675im   -0.196424-0.109146im      0.0489174+0.013284im      0.0164005+0.0542212im    -0.0323143-0.013062im     0.0683691-0.0158938im
  0.0559703-0.121058im       0.0164895+0.123886im      -0.0654736-0.0904428im      0.165764-0.0780927im     -0.109196+0.138417im    -0.0159084-0.0509101im        0.131916+0.0741962im    -0.0626626+0.0405328im     -0.124712-0.0436918im     -0.0348072-0.149389im      0.0797144+0.0856043im      -0.21276+0.232409im     0.00467119+0.0935418im   -0.0593724+0.0314749im      -0.269712-0.24289im      0.0562597+0.0768177im     0.0919106+0.0645796im      0.128582-0.0552375im      0.0746963+0.0183356im   0.00687776-0.199099im     -0.081842-0.0314289im    -0.127076+0.0716203im    -0.219546+0.0464082im   -0.00453183+0.227037im      0.0811602-0.10989im       -0.238397+0.223353im      0.0149102+0.322009im   -0.0357245+0.051625im       0.223173+0.130182im     -0.0199182-0.0073129im    0.00358202-0.154025im    -0.0893189+0.0961964im
  -0.110257+0.0636052im    -0.00879834+0.221169im       0.0879898-0.0336856im    -0.0208863+0.0539325im     -0.203074-0.0187199im    0.0329047-0.151723im        -0.152319+0.0778312im       0.18873-0.205837im     -0.0337871+0.222952im       -0.078379-0.0790259im    -0.0321235-0.060205im      0.0329709+0.0766783im    -0.0662117+0.183972im     0.0337661+0.0865469im      0.0878135-0.115642im       0.16084-0.107169im       0.215613+0.0190007im     0.0451955-0.0219811im     -0.0986012-0.014927im     -0.116936-0.10776im      -0.156164-0.217128im     -0.034913+0.209397im     -0.134453+0.031053im       0.128179-0.182693im    -0.00395341+0.0709216im     -0.041884-0.11525im          0.0845-0.0510379im    0.185932+0.20671im       -0.236493-0.12615im     -0.00334629-0.0372789im      0.223485-0.184006im      0.141456-0.123478im
  0.0470245+0.0640014im      -0.127607-0.137466im       -0.126394-0.133464im      -0.307477+0.0740127im      0.219242+0.0975385im    -0.167534+0.174108im       -0.0333141-0.095244im      0.0440951-0.00632025im    0.0101608+0.139722im       -0.121225-0.105367im     -0.0805464-0.113057im      -0.111801+0.189427im       0.211149+0.139512im     -0.144968-0.0705246im      -0.114374-0.0358533im     0.048136-0.0306175im      0.206424-0.0143619im    -0.0537909+0.034593im       -0.122539+0.0223014im    -0.150462-0.0603117im     0.183662-0.0874247im    -0.123858+0.11291im     -0.0115673-0.149505im      -0.270479-0.180321im      -0.222718+0.0850768im     0.0874769-0.139754im      -0.134874+0.166491im   -0.0410641-0.0202692im    -0.0203292+0.152893im     -0.0591195-0.0461097im     -0.010146+0.106449im    -0.0384379+0.123157im
   0.110985-0.113417im        0.122661-0.00768002im   -0.00699314-0.167008im       0.290338-0.198611im      0.0980631-0.00140573im  -0.0427356+0.374498im        0.0418295-0.0824087im      0.236488+0.022698im      0.0700117+0.141119im        0.243015+0.162958im     -0.0263837+0.0969601im    -0.0796412+0.0535802im     0.0947828-0.218974im    -0.0480217-0.0278204im    -0.00432012-0.1114im      -0.0442448-0.130688im       0.122792+0.0831015im   -0.00336504+0.129176im      -0.0623664+0.0444111im    0.0454144+0.031229im     0.0324745+0.0315389im      0.14666-0.00358741im    0.074723-0.00538855im    0.0791946-0.0244967im    -0.0806983-0.0707575im      0.111108-0.046291im    -0.00783378+0.0620647im   0.0221267+0.358812im      0.0134963+0.00685788im    -0.164308+0.0341809im     0.0725694-0.073791im      -0.10996-0.275946im
   0.183014-0.000246198im   0.00226572+0.0940724im       0.124091-0.0004422im    -0.0716839+0.0111261im     -0.134546-0.041221im    -0.0503641-0.0193106im       0.0422754-0.21883im       -0.126949+0.0299954im     0.0747954-0.156435im       0.0202669-0.00889233im   -0.0447921-0.250467im      0.0992711+0.0953712im     0.0311145-0.382437im     -0.105915+0.110095im      -0.0914287-0.156207im    -0.0221114+0.10145im       -0.191021-0.00489808im   -0.0288749+0.0527452im     -0.0606799-0.204362im    -0.0249068+0.135225im    -0.0407214-0.133754im     -0.286943+0.104233im      0.143862-0.0771248im      0.124627-0.226628im      -0.216437+0.0239234im     -0.224326+0.0613335im     0.0966437+0.0425604im  -0.0242088+0.0510565im     -0.059078+0.0866248im      0.114124-0.0201298im     -0.159655-0.153792im     0.0524513-0.127703im
  -0.119149-0.0258788im       0.147792+0.113602im        0.162022-0.0553408im     -0.123741-0.164851im      -0.191698-0.0413323im    0.0902438+0.249072im        0.0964877+0.000677464im  -0.0109115+0.0754224im    -0.0687435-0.0275607im     -0.0118288-0.020148im       0.205731-0.0823847im       0.12907-0.0583471im      0.101125-0.105529im    -0.0232665-0.0252195im       0.131424+0.0767476im     0.150974+0.0356242im     -0.191233-0.122329im     -0.0083466-0.01554im        0.0384976+0.310554im     -0.216177-0.098429im     -0.129815-0.0851666im    0.0274353-0.0104681im    -0.142704+0.124335im     -0.0662342-0.235837im      0.0584239+0.120307im      0.0218968+0.0613932im     -0.419086+0.0202505im  -0.0957726+0.107368im       0.207358-0.00729928im    0.0730674-0.0834181im     0.0295108+0.0229855im  -0.00464136+0.084973im
   0.208016+0.178449im        0.133712+0.100318im      -0.0306396+0.208005im     -0.0782024-0.212142im     -0.0516629-0.0975481im   -0.0228603+0.0823816im        0.140506+0.140567im      0.0345847+0.203667im       0.120414+0.000973089im     0.126357-0.261474im       -0.11817-0.203691im      0.0229579-0.0649158im     -0.103093-0.0237897im   0.00806995+0.216821im      -0.0247334+0.0126619im   -0.0220044+0.09849im        0.123895+0.0126469im    -0.0792727+0.013892im       -0.173536+0.0845012im   -0.0695307+0.0495115im     0.172702+0.20688im      -0.117147+0.101274im     -0.106754+0.018568im      -0.152196-0.00231296im     0.324335-0.132419im       0.182143-0.119094im         0.1476-0.0393821im  -0.0265529-0.0391237im     0.0627255+0.121601im     -0.0208757+0.0306248im      0.128809-0.129573im      0.154215-0.0269786im
 -0.0439375+0.0714539im     -0.0942221+0.0686405im      0.0177161-0.0591998im    -0.0413764+0.0192043im     -0.103572-0.00751228im  -0.0855271+0.0702717im       -0.299432+0.0861568im     -0.141312+0.14717im       0.0560814-0.118075im      -0.0086327-0.111033im       0.197819-0.00643486im     0.164397-0.042961im      0.0952113+0.149824im     -0.193156+0.022566im       0.0322942-0.0107222im    0.0817127-0.0839017im     0.0260004-0.0449895im      0.270444+0.113157im        0.269649+0.129409im     0.0359631+0.217832im      0.264649+0.0107253im   -0.0336076+0.131455im     -0.110892-0.0253378im      0.136502-0.0971101im     0.0290032-0.125812im      0.0557939+0.113093im       0.115718+0.095765im   -0.0299643-0.119692im     -0.0194367-0.062066im      -0.142694+0.0257284im    0.00485665+0.114801im     -0.219815-0.341236im
  0.0930526-0.0262263im     0.00559913+0.0759189im     -0.0208315-0.223245im      -0.102141+0.0642037im    0.00638302+0.234453im     0.0482046+0.00989575im       0.216257-0.109851im      0.0717345+0.105218im      0.0612968-0.103294im        0.260947+0.0964257im     0.0478426-0.0795833im      0.012207+0.0800916im      -0.11404+0.169202im    -0.0436189+0.0925671im     -0.0953152-0.0191917im   -0.0122233+0.177067im     -0.0839081-0.220653im     -0.0493088-0.161773im       0.0444293-0.0464232im    -0.195862-0.0485352im    0.0186135-0.245211im     0.0372872-0.0415863im    0.0656448-0.144193im       0.104709+0.142862im       0.243926+0.162371im     -0.0369324-0.0636655im   -0.00258634-0.166633im   -0.0182908-0.0675193im     -0.132662-0.0921734im     -0.396222-0.0844694im    0.00290953+0.1185im      -0.0165641-0.0987105im
 -0.0557147-0.0150474im      0.0695087-0.0776658im      0.0547922-0.14575im       0.0350564+0.137197im       0.167474+0.177467im     0.0637857+0.0559955im      -0.0460608+0.089475im     -0.0749395+0.0259835im   -0.00444286+0.225667im        0.127759-0.159085im       0.142848+0.167893im      -0.041986-0.192854im     -0.0341217-0.106735im     -0.146472+0.199944im        0.240016+0.129437im     0.0495805+0.0720106im    -0.0593962+0.0568798im    -0.0848875-0.0403822im      -0.220495+0.125141im     0.0581165+0.0233373im    0.0590879-0.291334im    -0.0820231-0.117992im     -0.177398+0.128029im      0.0862613+0.0717526im     -0.117174-0.0661954im      0.090875+0.0271025im      0.133597+0.117032im    0.0183624-0.154492im     -0.0878863+0.122353im     -0.0497985-0.115948im      -0.279549-0.241279im       0.10129+0.0293581im
  0.0319962-0.0717429im     -0.0930812-0.0853506im     -0.0958377-0.0955149im     0.0886484-0.0887251im     -0.159251-0.0672558im    -0.112029+0.206137im        -0.115694-0.0125072im    -0.0196065-0.0233528im     0.0346908+0.0342519im      -0.283884+0.00691962im   -0.0984925-0.13609im       0.0623167+0.152583im     -0.0796816-0.00736137im   0.0115672+0.283913im        0.133111+0.0855225im    0.0989349-0.116536im     -0.0623809+0.0494961im     -0.129474-0.0025081im     -0.0473447-0.0337241im    0.0345363-0.139529im    -0.0454179+0.20429im      -0.116802-0.267227im    -0.0216227-0.0547669im    -0.0519519+0.0951932im    -0.0937612+0.0303941im      -0.11233+0.00766178im   -0.0812098-0.0759913im    -0.11747-0.248222im     -0.0157966-0.27465im       -0.268787-0.0699733im     0.0917985-0.283038im     -0.165654-0.0170171im</code></pre><p>and then generate the state <span>$ψ$</span></p><pre><code class="language-julia hljs">psi = P[:, 3]</code></pre><pre><code class="nohighlight hljs">32-element Vector{ComplexF64}:
 0.00021913828244710977 + 0.12263360138964861im
    0.09208014909401542 - 0.03893798377073176im
    0.07774772643646066 - 0.16816926588596937im
     0.3379782899622805 + 0.0im
     0.0683700566724899 + 0.06125205765463637im
    0.13015638229833093 + 0.0711951742094575im
    -0.1743768741672791 + 0.06319108661087122im
    0.09890824810845879 - 0.06435111012105378im
   -0.05175141067337092 + 0.00440957720089258im
     0.0719612407008892 - 0.047670430004581626im
    0.11572293347148377 - 0.01965298868512988im
   -0.02077767780522579 - 0.11806126959235627im
    0.05429984946724445 + 0.029422625750701162im
   0.007960551495142777 - 0.24767871941822936im
  -0.014581317626524003 + 5.643704591506158e-5im
   0.048457424095752336 + 0.017139576231821524im
    0.08880316556545374 - 0.10332963916415992im
    0.21394862326116829 - 0.2168654934066714im
   -0.02922508524308929 - 0.1531317278300977im
  -0.026928551591017112 - 0.2731154287705082im
    0.17815152273988105 + 0.03729876995647104im
  -0.035366962225590354 + 0.10515725817807316im
    0.16769760191140282 - 0.15423156325790494im
   -0.14146668396368323 - 0.24403360129650112im
    0.07311285277321884 + 0.24024261701772645im
     0.0596259483820984 - 0.10913312807483892im
   -0.12421135442728526 - 0.06861233686063974im
   -0.17052952422145456 + 0.060286493034778746im
    0.09763892226232003 + 0.2536632120197862im
    -0.1039844784637145 - 0.10122169545462201im
  -0.031945652617086456 + 0.06109160069399665im
   -0.06192464514659515 + 0.13591750752941928im</code></pre><p>In the phase estimation process, we will feed the state to circuit and measure the first <code>n</code> qubits processed by iQFT.</p><pre><code class="language-julia hljs">r = join(ArrayReg(psi), zero_state(N))
r |&gt; PE(N, M, U)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 8/8
    nlevel: 2</code></pre><p>Since our phase can be represented by 3 qubits precisely, we only need to measure once</p><pre><code class="language-julia hljs">results = measure(r, 1:N; nshots=1)</code></pre><pre><code class="nohighlight hljs">1-element Vector{DitStr{2, 3, Int64}}:
 011 ₍₂₎</code></pre><p>Recall that our QFT&#39;s bit numbering is reversed, let&#39;s reverse it back</p><pre><code class="language-julia hljs">using BitBasis
estimated_phase = bfloat(results[]; nbits=N)</code></pre><pre><code class="nohighlight hljs">0.75</code></pre><p>the phase is exactly <code>0.75</code>!</p><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../1.prepare-ghz-state/index.html">« Prepare Greenberger–Horne–Zeilinger state with Quantum Circuit</a><a class="docs-footer-nextpage" href="../3.grover-search/index.html">Grover Search »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.3.0 on <span class="colophon-date" title="Friday 12 April 2024 03:28">Friday 12 April 2024</span>. Using Julia version 1.10.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
