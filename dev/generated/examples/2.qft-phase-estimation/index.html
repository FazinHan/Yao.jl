<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Quantum Fourier Transformation and Phase Estimation · Documentation | Yao</title><script data-outdated-warner src="../../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.044/juliamono.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script><link href="../../../assets/indigo.css" rel="stylesheet" type="text/css"/><link href="https://yaoquantum.org/assets/favicon-light.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../index.html"><img src="../../../assets/logo.png" alt="Documentation | Yao logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../../index.html">Documentation | Yao</a></span></div><form class="docs-search" action="../../../search.html"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../../index.html">Home</a></li><li><a class="tocitem" href="../../../quick-start.html">Quick Start</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../../../man/registers.html">Quantum Registers</a></li><li><a class="tocitem" href="../../../man/blocks.html">Blocks</a></li><li><a class="tocitem" href="../../../man/symbolic.html">Symbolic Computation</a></li><li><a class="tocitem" href="../../../man/automatic_differentiation.html">Automatic Differentiation</a></li><li><a class="tocitem" href="../../../man/simplification.html">Simplification</a></li><li><a class="tocitem" href="../../../man/bitbasis.html">BitBasis</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../1.prepare-ghz-state/index.html">Prepare Greenberger–Horne–Zeilinger state with Quantum Circuit</a></li><li class="is-active"><a class="tocitem" href="index.html">Quantum Fourier Transformation and Phase Estimation</a><ul class="internal"><li><a class="tocitem" href="#Quantum-Fourier-Transformation"><span>Quantum Fourier Transformation</span></a></li><li><a class="tocitem" href="#Wrap-QFT-to-an-external-block"><span>Wrap QFT to an external block</span></a></li><li><a class="tocitem" href="#Phase-Estimation"><span>Phase Estimation</span></a></li></ul></li><li><a class="tocitem" href="../3.grover-search/index.html">Grover Search</a></li><li><a class="tocitem" href="../4.shor-algorithm/index.html">Shor&#39;s Algorithm</a></li><li><a class="tocitem" href="../5.shor-9-code/index.html">Shor&#39;s 9 qubit code</a></li><li><a class="tocitem" href="../6.quantum-circuit-born-machine/index.html">Quantum Circuit Born Machine</a></li><li><a class="tocitem" href="../7.variation-quantum-eigen-solver/index.html">Variational Quantum Eigen Solver</a></li></ul></li><li><a class="tocitem" href="../../../performancetips.html">Performance Tips</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href="index.html">Quantum Fourier Transformation and Phase Estimation</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="index.html">Quantum Fourier Transformation and Phase Estimation</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/QuantumBFS/Yao.jl/blob/master/docs/src/examples/2.qft-phase-estimation/main.jl" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><p><a href="https://mybinder.org/v2/gh/QuantumBFS/Yao.jl/gh-pages?filepath=dev/generated/examples/2.qft-phase-estimation/main.ipynb"><img src="https://mybinder.org/badge_logo.svg" alt/></a> <a href="https://nbviewer.jupyter.org/github/QuantumBFS/Yao.jl/blob/gh-pages/dev/generated/examples/2.qft-phase-estimation/main.ipynb"><img src="https://img.shields.io/badge/show-nbviewer-579ACA.svg" alt/></a> <a href="https://minhaskamal.github.io/DownGit/#/home?url=https://github.com/QuantumBFS/tutorials/tree/gh-pages/dev/generated/examples/2.qft-phase-estimation"><img src="https://img.shields.io/badge/download-project-orange" alt/></a></p><h1 id="example-qft"><a class="docs-heading-anchor" href="#example-qft">Quantum Fourier Transformation and Phase Estimation</a><a id="example-qft-1"></a><a class="docs-heading-anchor-permalink" href="#example-qft" title="Permalink"></a></h1><p>Let&#39;s use Yao first</p><pre><code class="language-julia hljs">using Yao</code></pre><h2 id="Quantum-Fourier-Transformation"><a class="docs-heading-anchor" href="#Quantum-Fourier-Transformation">Quantum Fourier Transformation</a><a id="Quantum-Fourier-Transformation-1"></a><a class="docs-heading-anchor-permalink" href="#Quantum-Fourier-Transformation" title="Permalink"></a></h2><p>The Quantum Fourier Transformation (QFT) circuit is to repeat two kinds of blocks repeatly:</p><p><img src="assets/qft.png" alt="qft-circuit"/></p><p>The basic building block control phase shift gate is defined as</p><p class="math-container">\[R(k)=\begin{bmatrix}
1 &amp; 0\\
0 &amp; \exp\left(\frac{2\pi i}{2^k}\right)
\end{bmatrix}\]</p><p>Let&#39;s define block <code>A</code> and block <code>B</code>, block <code>A</code> is actually a control block.</p><pre><code class="language-julia hljs">A(i, j) = control(i, j=&gt;shift(2π/(1&lt;&lt;(i-j+1))))</code></pre><pre><code class="nohighlight hljs">A (generic function with 1 method)</code></pre><p>Once you construct the blockl you can inspect its matrix using <code>mat</code> function. Let&#39;s construct the circuit in dash box A, and see the matrix of <span>$R_4$</span> gate.</p><pre><code class="language-julia hljs">R4 = A(4, 1)</code></pre><pre><code class="nohighlight hljs">(n -&gt; control(n, 4, 1 =&gt; shift(0.39269908169872414)))</code></pre><p>If you have read about <a href="generated/examples/2.qft-phase-estimation/@ref example-ghz">preparing GHZ state</a>, you probably know that in Yao, we could just leave the number of qubits, and it will be evaluated when possible.</p><pre><code class="language-julia hljs">R4(5)</code></pre><pre><code class="nohighlight hljs">nqubits: 5
control(4)
└─ (1,) shift(0.39269908169872414)</code></pre><p>its matrix will be</p><pre><code class="language-julia hljs">mat(R4(5))</code></pre><pre><code class="nohighlight hljs">32×32 Diagonal{ComplexF64, Vector{ComplexF64}}:
 1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im</code></pre><p>Then we repeat this control block over and over on different qubits, and put a Hadamard gate to <code>i</code>th qubit to construct <code>i</code>-th <code>B</code> block.</p><pre><code class="language-julia hljs">B(n, k) = chain(n, j==k ? put(k=&gt;H) : A(j, k) for j in k:n)</code></pre><pre><code class="nohighlight hljs">B (generic function with 1 method)</code></pre><p>We need to input the total number of qubits <code>n</code> here because we have to iterate through from <code>k</code>-th location to the last.</p><p>Now, let&#39;s construct the circuit by chaining all the <code>B</code> blocks together</p><pre><code class="language-julia hljs">qft(n) = chain(B(n, k) for k in 1:n)
qft(4)</code></pre><pre><code class="nohighlight hljs">nqubits: 4
chain
├─ chain
│  ├─ put on (1)
│  │  └─ H
│  ├─ control(2)
│  │  └─ (1,) shift(1.5707963267948966)
│  ├─ control(3)
│  │  └─ (1,) shift(0.7853981633974483)
│  └─ control(4)
│     └─ (1,) shift(0.39269908169872414)
├─ chain
│  ├─ put on (2)
│  │  └─ H
│  ├─ control(3)
│  │  └─ (2,) shift(1.5707963267948966)
│  └─ control(4)
│     └─ (2,) shift(0.7853981633974483)
├─ chain
│  ├─ put on (3)
│  │  └─ H
│  └─ control(4)
│     └─ (3,) shift(1.5707963267948966)
└─ chain
   └─ put on (4)
      └─ H
</code></pre><h2 id="Wrap-QFT-to-an-external-block"><a class="docs-heading-anchor" href="#Wrap-QFT-to-an-external-block">Wrap QFT to an external block</a><a id="Wrap-QFT-to-an-external-block-1"></a><a class="docs-heading-anchor-permalink" href="#Wrap-QFT-to-an-external-block" title="Permalink"></a></h2><p>In most cases, <code>function</code>s are enough to wrap quantum circuits, like <code>A</code> and <code>B</code> we defined above, but sometimes, we need to dispatch specialized methods on certain kinds of quantum circuit, or we want to define an external block to export, thus, it&#39;s useful to be able to wrap circuit to custom blocks.</p><p>First, we define a new type as subtype of <code>PrimitiveBlock</code> since we are not going to use the subblocks of <code>QFT</code>, if you need to use its subblocks, it&#39;d be better to define it under <code>CompositeBlock</code>.</p><pre><code class="language-julia hljs">struct QFT &lt;: PrimitiveBlock{2}
    n::Int
end

YaoBlocks.nqudits(q::QFT) = q.n</code></pre><p>Now, let&#39;s define its circuit</p><pre><code class="language-julia hljs">circuit(q::QFT) = qft(q.n)</code></pre><pre><code class="nohighlight hljs">circuit (generic function with 1 method)</code></pre><p>And forward <code>mat</code> to its circuit&#39;s matrix</p><pre><code class="language-julia hljs">YaoBlocks.mat(::Type{T}, x::QFT) where T = mat(T, circuit(x))</code></pre><p>You may notice, it is a little ugly to print <code>QFT</code> at the moment, this is because we print the type summary by default, you can define your own printing by overloading <code>print_block</code></p><pre><code class="language-julia hljs">YaoBlocks.print_block(io::IO, x::QFT) = print(io, &quot;QFT($(x.n))&quot;)</code></pre><p>Since it is possible to use FFT to simulate the results of QFT (like cheating), we could define our custom <code>apply!</code> method:</p><pre><code class="language-julia hljs">using FFTW, LinearAlgebra

function YaoBlocks.apply!(r::ArrayReg, x::QFT)
    α = sqrt(length(statevec(r)))
    invorder!(r)
    lmul!(α, ifft!(statevec(r)))
    return r
end</code></pre><p>Now let&#39;s check if our <code>apply!</code> method is correct:</p><pre><code class="language-julia hljs">r = rand_state(5)
r1 = r |&gt; copy |&gt; QFT(5)
r2 = r |&gt; copy |&gt; circuit(QFT(5))
r1 ≈ r2</code></pre><pre><code class="nohighlight hljs">true</code></pre><p>We can get iQFT (inverse QFT) directly by calling <code>adjoint</code></p><pre><code class="language-julia hljs">QFT(5)&#39;</code></pre><pre><code class="nohighlight hljs"> [†]QFT(5)</code></pre><p>QFT and iQFT are different from FFT and IFFT in three ways,</p><ol><li>they are different by a factor of <span>$\sqrt{2^n}$</span> with <span>$n$</span> the number of qubits.</li><li>the <a href="https://quantumbfs.github.io/BitBasis.jl/stable/tutorial/#Conventions-1">bit numbering</a> will exchange after applying QFT or iQFT.</li><li>due to the convention, QFT is more related to IFFT rather than FFT.</li></ol><h2 id="Phase-Estimation"><a class="docs-heading-anchor" href="#Phase-Estimation">Phase Estimation</a><a id="Phase-Estimation-1"></a><a class="docs-heading-anchor-permalink" href="#Phase-Estimation" title="Permalink"></a></h2><p>Since we have QFT and iQFT blocks we can then use them to realize phase estimation circuit, what we want to realize is the following circuit:</p><p><img src="assets/phaseest.png" alt="phase estimation"/></p><p>First we call Hadamard gates repeatly on first <code>n</code> qubits.</p><pre><code class="language-julia hljs">Hadamards(n) = repeat(H, 1:n)</code></pre><pre><code class="nohighlight hljs">Hadamards (generic function with 1 method)</code></pre><p>Then in dashed box <code>B</code>, we have controlled unitaries:</p><pre><code class="language-julia hljs">ControlU(n, m, U) = chain(n+m, control(k, n+1:n+m=&gt;matblock(U^(2^(k-1)))) for k in 1:n)</code></pre><pre><code class="nohighlight hljs">ControlU (generic function with 1 method)</code></pre><p>each of them is a <code>U</code> of power <span>$2^{(k-1)}$</span>.</p><p>Since we will only apply the qft and Hadamard on first <code>n</code> qubits, we could use <code>Subroutine</code>, which creates a context of a sub-scope of the qubits.</p><pre><code class="language-julia hljs">PE(n, m, U) =
    chain(n+m, # total number of the qubits
        subroutine(Hadamards(n), 1:n), # apply H in local scope
        ControlU(n, m, U),
        subroutine(QFT(n)&#39;, 1:n))</code></pre><pre><code class="nohighlight hljs">PE (generic function with 1 method)</code></pre><p>we use the first <code>n</code> qubits as the output space to store phase <span>$ϕ$</span>, and the other <code>m</code> qubits as the input state which corresponds to an eigenvector of oracle matrix <code>U</code>.</p><p>The subroutine here uses <code>focus!</code> and <code>relax!</code> to manage a local scope of quantum circuit, and only activate the first <code>n</code> qubits while applying the block inside the subroutine context, and the scope will be <code>relax!</code>ed back, after the context. This is equivalent to manually <code>focus!</code> then <code>relax!</code></p><p>fullly activated</p><pre><code class="language-julia hljs">r = rand_state(5)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 5/5
    nlevel: 2</code></pre><p>first 3 qubits activated</p><pre><code class="language-julia hljs">focus!(r, 1:3)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 3/5
    nlevel: 2</code></pre><p>relax back to the original</p><pre><code class="language-julia hljs">relax!(r, 1:3)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 5/5
    nlevel: 2</code></pre><p>In this way, we will be able to apply small operator directly on the subset of the qubits.</p><p>Details about the algorithm can be found here: <a href="https://en.wikipedia.org/wiki/Quantum_phase_estimation_algorithm">Quantum Phase Estimation Algorithm</a></p><p>Now let&#39;s check the results of our phase estimation.</p><p>First we need to set up a unitary with known phase, we set the phase to be 0.75, which is <code>0.75 * 2^3 == 6 == 0b110</code> .</p><pre><code class="language-julia hljs">N, M = 3, 5
P = eigen(rand_unitary(1&lt;&lt;M)).vectors
θ = Int(0b110) / 1&lt;&lt;N
phases = rand(1&lt;&lt;M)
phases[0b010+1] = θ
U = P * Diagonal(exp.(2π * im * phases)) * P&#39;</code></pre><pre><code class="nohighlight hljs">32×32 Matrix{ComplexF64}:
    0.143601-0.128536im      0.247953-0.232816im       0.246474+0.00712472im   -0.120061-0.157337im      0.0233954-0.136194im    -0.0138883+0.107291im     0.0113383+0.0389549im    -0.144201-0.13143im        0.10581+0.0492345im      -0.0057635-0.0103694im    -0.0196741+0.117237im      0.185346+0.158106im       0.104915-0.154901im    -0.0240807+0.0461293im      0.0331366+0.0591606im   -0.0332188-0.104818im      0.079572-0.107048im        0.317888+0.100626im     -0.053264+0.103614im      -0.140275-0.0641175im   -0.0643727-0.193435im     0.0924238-0.00557889im   0.0809761+0.10787im       0.0117918-0.0214824im     0.260894-0.0801824im   -0.0310601-0.194302im       0.222389+0.0765352im   -0.203863+0.0502272im      0.259484+0.0502114im    -0.066312+0.0853445im    -0.0014311+0.0140501im     -0.0582231+0.0453554im
  -0.0564861-0.0546255im   -0.0618895-0.163001im      0.0881714-0.0219996im     0.191663-0.151335im      -0.120023-0.0898901im   0.00943353-0.221361im     -0.132747-0.151097im      0.090262-0.105267im    -0.0739127+0.349158im          0.11434-0.176432im     -0.0986352+0.053387im     0.0969008+0.0797221im     0.0687542-0.0427397im   -0.0576778-0.150361im       0.0589952+0.114811im     0.0447067+0.123153im    -0.0573297-0.0963158im      -0.253722+0.131095im    -0.0310729+0.189155im     -0.0611917+0.00592619im  -0.0186331+0.0969917im   -0.0350217+0.0388065im     -0.17009+0.0222287im   -0.00231944+0.218672im    0.00160714+0.0792715im   -0.0125232-0.105531im      0.0720383-0.102557im     0.270818+0.185066im      0.0862018-0.155794im      0.041077-0.0147879im    -0.0192792+0.30469im        0.0163372+0.0755746im
   -0.110671+0.0983598im   0.00867435+0.00886568im    0.0379279+0.115015im      0.195462-0.132206im     -0.0530277+0.171509im      0.321869+0.0664212im    -0.257988+0.0436289im    0.0545936-0.00903136im    0.219297+0.0891358im       -0.143285-0.0118632im     -0.174575+0.201354im    0.00136483-0.060049im      0.0647584+0.0127265im     0.260216-0.0233123im      0.0619859-0.0955641im    -0.123347+0.0267043im    0.0231953+0.0133867im       0.213108-0.208577im     -0.118859-0.0466516im     -0.179661-0.144845im     0.0598036-0.0163994im    0.0950862-0.162852im     -0.149582-0.00439493im   -0.0996996+0.145323im     -0.114781+0.0645754im     0.103585+0.048413im      0.0655335-0.0907052im   -0.109102-0.0851173im      -0.21481-0.110518im    -0.0739492+0.213779im     -0.0198531+0.0240776im   -0.000873794-0.13532im
  -0.0402759-0.0837573im      0.11388+0.0197001im    -0.0601125+0.109202im     0.0686229+0.00857323im    -0.177939-0.150243im      0.142759-0.147053im     -0.011623-0.264108im    -0.0212182-0.0235956im   -0.0173366+0.0735153im       -0.122199-0.0432423im     0.0246212+0.145506im      0.112182+0.0905761im     -0.083178-0.074269im     -0.115164+0.0637174im      0.0376921+0.00369626im   0.0902239+0.140034im      0.160131-0.297451im       0.0738972-0.139701im     -0.234778-0.0221483im     0.0187618+0.0242205im   -0.0431247-0.0709293im    -0.095391+0.0408898im    0.0489299-0.127141im       0.133593-0.260858im     -0.041773+0.247997im     -0.245852+0.17949im       -0.260682+0.0522im     -0.0389889-0.0515156im    -0.0619201+0.0198344im    0.0156036+0.006696im       0.251127-0.133296im       -0.151476+0.0985817im
   0.0516702+0.236455im    -0.0657988+0.173872im       0.136419-0.0971394im    0.0504124+0.212274im       0.156452-0.249349im      0.238025+0.0673753im   -0.0380962-0.0293773im    0.0559516+0.0439022im    0.0239428+0.233359im          0.09832+0.140371im       0.163025+0.0812209im   -0.0704593-0.110523im     -0.0628564+0.195695im     0.0329811+0.0258419im     -0.0576707+0.0348865im    -0.139044-0.102181im     -0.170132-0.0435833im      0.0865075+0.195065im      0.126664+0.110542im      0.0726712-0.0840359im    -0.250276-0.124862im     -0.194334-0.0544891im   -0.0583937+0.0172054im     0.0618077+0.0911935im     0.141613+0.170219im      -0.19959-0.0285525im     0.0254277+0.112824im   -0.0969395+0.0609565im    -0.0576713-0.0763669im     0.122881+0.0698784im      0.161502-0.0398307im       0.184638-0.0636931im
    0.137362+0.0917379im     0.122232-0.127125im      -0.160618+0.194606im     0.0158915+0.0235512im     0.0733546+0.11008im      -0.155356-0.00358517im   -0.153729-0.0260605im     0.199757+0.116363im      0.073349-0.0619967im       0.0668761-0.183951im      0.0214882-0.0278054im    -0.170576-0.0198im         0.174565+0.0463815im    0.0596654+0.126833im       -0.114894-0.0823475im     -0.12315+0.0902157im     0.174359-0.210735im      -0.0201894-0.00446613im    0.171841+0.0358551im     0.0216214+0.15746im     -0.0569352-0.0535979im     0.129242-0.192282im     0.0308148-0.0824784im    -0.0369184+0.113291im     -0.011635+0.0146633im    0.0694986-0.102965im      0.0526446+0.0214376im   0.0850766-0.0370391im        0.2345-0.228414im      0.315523-0.0131821im      0.276064-0.235976im       -0.058873+0.0314682im
   -0.196143+0.0267664im   -0.0136201+0.176346im      -0.128684+0.301556im    -0.0455829+0.043436im       0.230403-0.241931im    -0.0381885+0.0508462im   0.00380814-0.114735im     0.0629165-0.263085im    -0.0172892-0.0260251im        0.113517+0.104048im       0.326052+0.0416521im     0.265037+0.041433im       0.144771+0.0191677im     0.104144+0.147616im      -0.0428608-0.0908744im     0.155482+0.0103273im   -0.0561089-0.0307771im      0.0500982-0.0895323im     0.147528-0.141286im      -0.150368+0.0677726im    0.0330641+0.165737im     0.0111949+0.138836im     -0.144908-0.0168145im     -0.119153-0.0219011im     0.096433-0.0564747im    0.0764076-0.0334427im     0.0709026-0.306561im    0.0401906-0.0273345im    0.00180399+0.0256717im   -0.0240092+0.115375im       0.083156+0.0609734im     -0.0499497+0.0840188im
    0.198451+0.10294im      -0.139588+0.0384651im     -0.159137-0.141988im     0.0328017+0.00811717im   -0.0724758-0.0220565im    0.0891601-0.0433168im   -0.0100646+0.0295675im    0.0862631-0.182399im    -0.0785921+0.0767111im       -0.193164-0.000686251im    0.145902-0.115883im     0.0585031-0.00783148im     -0.10204-0.13558im      -0.123332-0.141974im       -0.186599+0.137544im     -0.109112+0.0840631im     0.110961-0.158663im      -0.0745723+0.0197632im      0.19887-0.094086im      0.0061706-0.0294019im    0.0212943-0.00226605im    0.414778-0.153799im    0.00204044-0.0255528im    -0.0599721-0.277624im       0.22066+0.105953im     0.0302429-0.0110851im     -0.051401-0.0249255im  -0.0441592-0.107007im    -0.00501586-0.0669913im    0.0350697+0.24847im       -0.231719+0.116626im        0.102064-0.087734im
   0.0833258+0.220694im     0.0278841-0.0671725im    -0.0923342-0.0817013im     0.255851+0.0466454im      0.229645+0.0532052im    -0.235189-0.00332204im   0.0518685+0.0202447im   -0.0445835-0.0383087im     -0.13022-0.238839im       -0.0585455-0.0386172im    -0.0128635+0.24805im      0.0823175-0.0608321im    -0.0490204-0.142858im      0.132865+0.0164306im      0.0666783+0.0981513im    0.0422373-0.0255149im    -0.122893-0.166145im     -0.00490991+0.140347im     -0.277277-0.121139im       -0.13465-0.0954037im    -0.205415+0.0336486im     0.105479+0.202081im       0.10438+0.177695im     -0.0883813+0.0498536im   -0.0213506-0.0467162im   -0.0389578+0.161786im       -0.16313-0.0268124im    0.037855+0.0897166im     0.0866097-0.13351im      0.0631782-0.0191193im     0.0475075+0.0484077im      0.0741362-0.306982im
 -0.00703094+0.11898im     -0.0897161+0.0942446im    -0.0359757+0.0183692im    0.0177649-0.0743514im      0.104138-0.109893im    -0.0374321+0.111121im    -0.0213759+0.180115im    -0.0266224-0.0432791im   -0.0117754+0.194924im         0.161957+0.0854601im     -0.313279-0.0852465im    -0.266176+0.0639193im     -0.149608+0.0257866im    0.0726112-0.0685092im     -0.0724508-0.0674779im     0.317572+0.0385689im     0.110625-0.000938572im   0.00631397-0.0945288im   -0.0276027+0.0910492im     -0.208994+0.179881im     -0.186073-0.146506im      0.157195-0.0737315im    -0.141063+0.229203im       -0.03616-0.255972im   -0.00889257-0.105231im     -0.207309+0.186403im       0.111615-0.0972315im    0.117528+0.0517018im     0.0526212-0.0103465im   -0.0780873-0.0442079im    0.00578714-0.111737im      -0.0460747+0.0861838im
    0.208664-0.0328723im  -0.00930727+0.066659im     -0.0307007+0.138322im      0.295909-0.161805im       0.231438+0.0982212im     0.116684-0.178418im      0.251018-0.0182375im    -0.262663-0.0674949im    0.0818105-0.0730644im       0.0561566-0.0932812im      -0.10972-0.0611942im    0.0202513+0.0841751im     -0.251744-0.0565489im   -0.0139376+0.0932113im     0.00710276-0.0801852im   -0.0686901-0.0434595im     -0.14895+0.0668617im     -0.0458502-0.0295463im     0.163746+0.128919im     0.00315356-0.198564im     0.0820722+0.0618352im     0.149666-0.00666882im  -0.0300401-0.14428im        0.121797-0.0109232im   -0.0663616+0.0155743im     0.030309-0.0321042im    -0.0422874-0.124039im    -0.113855+0.150983im      0.0548446-0.0419819im   -0.0737026+0.0100593im      0.172658-0.133359im        0.247301+0.273875im
    0.107565-0.111755im     -0.125207+0.21624im        0.183666-0.054731im    -0.0926161+0.172192im     -0.0209509-0.131921im     -0.203171-0.188839im    0.00723209+0.0873533im  0.000940095-0.0288938im     0.112062+0.0767169im        -0.11696-0.159652im     -0.0675927-0.0181448im   -0.0329716-0.0796384im    -0.0526393+0.175686im      0.113869+0.161448im       -0.334039+0.0634048im   -0.0822297-0.048232im    -0.0865469-0.237245im      -0.0608373-0.0905373im    -0.222527+0.0578149im  -0.000690432+0.0505119im    0.0801444+0.0184689im    0.0883547+0.0732007im    0.0146299-0.0601094im       0.12805-0.112943im     -0.128464-0.0182567im     0.206345-0.0959553im      0.243662-0.0694953im  -0.0995923+0.0844734im    -0.0662045-0.0333384im    -0.194497-0.0473674im      0.181825+0.105533im      -0.0990023-0.18577im
   0.0397955-0.212223im      0.138051-0.142349im      -0.114379-0.173466im    -0.0587624+0.173539im       0.122125+0.0839343im   0.00422962+0.0302454im   -0.0819772+0.214168im    0.00328706+0.0505551im    -0.217626+0.13187im          0.101826-0.198804im      0.0248977-0.0827296im    0.0633555+0.210158im     -0.0170882+0.129554im      0.058798-0.0685252im       0.127424+0.0925747im   -0.0194234-0.0440814im    -0.245635-0.0588248im      0.0423687-0.0196772im    -0.025241-0.236501im      -0.207558+0.244107im      0.193637-0.108004im      0.063603+0.0613247im   -0.0273712+0.0101189im      0.121452+0.0840016im   -0.0199836+0.162723im     0.0211043+0.222473im      0.0888587+0.0301766im  -0.0636817-0.0503047im     -0.135266+0.0864866im     0.111539+0.192249im       0.127468-0.00303762im      0.166951+0.142351im
    0.100381+0.0764657im   -0.0835791-0.0915182im    -0.0568251+0.0404327im   -0.0182411-0.121008im     -0.0800694+0.104165im     -0.116476+0.239863im    -0.0254999+0.0330484im      0.17471-0.22378im       0.105936-0.0331061im         0.24144-0.0431723im    -0.0794906-0.0103617im      0.44042-0.149554im     -0.0695802+0.181422im      0.178575-0.0749999im     -0.0972793+0.0347689im    -0.158721+0.00416512im   0.0154877+0.00322142im     -0.122321+0.0861745im    0.0478813-0.0872115im     0.0289342-0.0885744im   -0.0785731+0.0255351im   -0.0709996-0.216178im    -0.0177149-0.0306809im      0.251334-0.0792052im    -0.145146-0.0234874im   -0.0912409+0.178097im     -0.0541854+0.116217im   -0.0132149+0.175989im      0.0661646+0.235912im    -0.0592178+0.0413855im     0.0257372+0.00216496im       -0.1571+0.0375973im
  0.00603422-0.143324im      0.320234+0.137522im      0.0870417+0.121185im     -0.012555+0.0758813im      0.169025+0.102868im    -0.0160562-0.193173im    -0.0909181+0.0163057im    -0.062588+0.186433im     0.0235234+0.113683im       -0.0142764+0.164855im      0.0755779-0.0967457im    0.0451946-0.120552im      -0.028599-0.0808907im     0.150899-0.0697775im       0.129832-0.139389im     -0.100597+0.172216im    -0.0486058-0.0685978im      0.0199143+0.173918im      0.080252-0.0640008im      0.221264+0.0861204im    -0.249293-0.116218im     0.0565789-0.0596353im    0.0685242+0.080333im        0.25449-0.02552im     -0.0260029-0.00989696im    0.135947+0.195262im     -0.0417758-0.152378im    0.0812721-0.0516073im     0.0777022-0.145019im     -0.228271+0.0649975im     -0.190817+0.147534im       -0.142489+0.0720026im
  -0.0266397-0.261959im     -0.115236-0.0217546im     0.0546095+0.127493im     0.0834139+0.407326im       0.109903-0.122507im    -0.0688153-0.0357314im    -0.164993+0.0937825im    -0.150435-0.0206218im     0.179118-0.164938im       -0.0941535+0.138814im     -0.0682142+0.0130218im     0.116592+0.100449im     -0.0497629+0.109565im      0.109902-0.262553im     -0.00203329-0.0195703im   -0.0631361-0.0846016im     0.240356+0.103163im      0.00745526-0.0661575im    0.0810331+0.0948101im     -0.028961-0.133238im      0.113483+0.12724im       0.173626-0.0294963im    0.0112269+0.109791im      -0.067944+0.0799426im      0.11718+0.205828im      -0.10394+0.131521im     -0.0437389+0.153532im    0.0914169+0.0225305im     0.0628103-0.058631im      0.109526-0.224302im      0.0606559+0.142127im      -0.0563789+0.0641955im
   0.0510995-0.160353im     0.0180657-0.0264354im    -0.0458847-0.0381615im   -0.0310799-0.0478652im     0.0108968+0.0841647im     0.117363+0.148143im     0.0371215-0.236288im      0.264414+0.0898916im    0.0153086+0.0180583im       -0.142208+0.151045im      -0.120289-0.127035im    -0.0402728+0.0214626im      -0.16497-0.220235im     0.0441009-0.0802051im      -0.342003+0.0154008im    -0.247865-0.117819im     -0.129456-0.0324292im      0.0432661-0.0121696im   -0.0244519+0.0478287im     -0.166577+0.0103916im    0.0615478-0.0154696im    -0.224869+0.0792292im   -0.0947459+0.208197im     -0.0196651+0.0295621im     0.216153-0.0830992im     0.184164+0.149891im      -0.154943-0.156973im     0.120443-0.0945127im        0.1347+0.0921624im   -0.0110785-0.113611im       0.204089+0.0387223im      0.0290443+0.0448334im
  -0.0716902-0.173489im    -0.0749473+0.115973im      0.0231347+0.0742164im   -0.0157057-0.0732651im      0.129022-0.0145308im    -0.132282+0.0242528im   -0.0665732-0.231233im      0.124617-0.162635im     0.0217146-0.0124296im       0.0616649-0.256031im     -0.0280441+0.0108146im    -0.270174-0.133756im    -0.00566322-0.129057im     0.0434547-0.199004im        0.168375+0.0110653im    0.0862134-0.160831im     -0.111525-0.098215im       -0.025027-0.354774im      0.172717-0.0780556im      0.207364-0.116882im    -0.0503355-0.204807im     0.0427074-0.012381im      0.230836-0.015811im    -0.00139415+0.141647im      0.188086-0.0112789im   -0.0822372+0.0518334im     0.0164131+0.0973863im   0.0460244+0.096624im     -0.0171671+0.188154im     -0.121088+0.127465im      0.0657608+0.0622926im      0.0207961-0.121946im
    0.111224+0.059597im      0.180037+0.061266im      0.0210082-0.0573351im   -0.0548883-0.164201im       0.052565-0.151157im     0.0620723+0.124313im      0.045235+0.273229im     0.0794642+0.134233im     0.0485857+0.113869im       -0.0830047+0.082628im      0.0230859+0.0880022im     0.130736-0.0342132im     -0.114459+0.138661im     0.0454544-0.0621564im    0.000125266+0.0394952im    0.0958073+0.256321im    -0.0860707-0.16411im         0.042244-0.227871im     0.0452754+0.0462176im      0.250827-0.221677im      0.268955-0.0955406im     0.037482+0.180185im    0.00050113-0.129548im     -0.0936068+0.067058im     -0.119605-0.104083im    -0.0929858+0.0711916im     0.0255453-0.068461im     0.200561-0.148173im        0.26289+0.113556im      0.158801-0.11095im     -0.00569994+0.0807645im       0.104373-0.0703599im
     0.09391-0.0502155im   -0.0199023+0.225147im     -0.0201757-0.0851574im    -0.131328+0.0243676im      0.176738-0.122961im     0.0503767+0.0633384im   -0.0684889+0.0850992im     0.119095+0.175286im       0.12046+0.00174277im   -0.000487154-0.064523im      -0.217836-0.0872736im     0.260541-0.10908im        0.108362-0.223967im     -0.172861+0.10959im       -0.0914136+0.155595im      0.176291+0.0208477im     0.119643+0.101225im       -0.073119+0.0461292im   -0.0546477+0.0688195im    -0.0646083-0.136623im    -0.0418345-0.129123im     0.0501897+0.129939im     0.0874373-0.16111im      -0.0380095+0.209735im      0.090893-0.0581669im     0.132743+0.135638im     -0.0899327+0.0413906im   0.0562669+0.201862im      -0.259363-0.137059im      0.119141+0.169696im     -0.0609896-0.151226im       -0.143579+0.154398im
   0.0406605+0.0555508im    -0.125976-0.0830651im     0.0647107-0.229799im    -0.0316287+0.0249241im    0.00518528-0.0692251im   -0.0370659+0.0681273im   -0.0264029-0.108211im     -0.154539-0.00458307im   0.0966452+0.0617733im       0.0962722-0.130514im       0.238667+0.133903im    -0.0736611+0.114008im      -0.143035-0.0778451im    0.0479239+0.000671388im    0.0181755-0.0217763im   -0.0989348+0.260868im      0.113665+0.0170393im      0.0606124+0.078145im      0.041384-0.214804im       0.089767-0.0694837im    -0.124397-0.263414im      0.131799-0.0276939im    -0.178461+0.0240277im     -0.290484+0.0716321im   -0.0973654+0.00976043im    0.306304+0.0347371im    -0.0584809-0.0273076im   0.0303901+0.106401im      -0.153991+0.200224im    -0.0796862-0.271517im       0.122762-0.0213116im     -0.0919652+0.170169im
   -0.173167-0.172204im   -0.00344205+0.035106im    -0.00440145-0.0183756im     0.101263-0.0665629im    0.00864055+0.046203im    -0.0799188+0.223153im     0.0446261+0.0120103im    -0.280188+0.00945121im    0.149194+0.147628im         0.182449+0.1053im       -0.0414238+0.0727021im   -0.0864301-0.0474756im      0.100947-0.201012im     -0.128889+0.266181im       -0.336263+0.041446im    -0.0502491+0.163431im     -0.146201-0.0194882im     -0.0184971-0.15904im      0.0989733-0.0702085im    -0.0791815+0.0897617im    -0.137818+0.119876im      0.103849+0.0533233im    0.0371136+0.00418039im     0.117229+0.149782im     -0.107324+0.325671im     -0.024563+0.0173726im    -0.0666507+0.149294im    -0.015685-0.0707112im      0.105144+0.108535im      0.113824-0.0229077im     -0.179313+0.0683655im      0.0159683-0.113325im
   0.0223452-0.0782474im     0.150359-0.194837im      0.0119969-0.11054im       0.257936+0.139414im       0.198696+0.0337389im     0.126211+0.115497im    -0.0919322-0.124417im    -0.0937006-0.141709im      0.240894-0.107016im         0.101407-0.0669256im      0.206764-0.194619im     0.0431382+0.0350608im     -0.195878-0.0231822im   -0.0937129+0.0868526im     -0.0596509-0.0361407im     0.187455-0.0543063im     0.109705-0.0613331im     -0.0854868+0.0578811im    0.0111618+0.206545im     -0.0085643+0.0699608im     0.189905-0.195485im     -0.216526-0.0681177im   0.00767881-0.0041085im    0.00358309-0.0833698im    -0.136008-0.0263717im    0.0533049+0.0127897im      0.112256-0.0162877im    0.226957-0.0547958im     -0.103904-0.00874617im  -0.0239631+0.103828im      -0.123403-0.055371im      -0.0348923-0.327548im
  -0.0119887+0.346879im      0.169211-0.0551583im    -0.0161251+0.07725im     -0.0773968+0.147373im     -0.0129286+0.0412585im    -0.102729-0.0937211im   -0.0186289-0.102579im     -0.100223-0.0645903im    -0.192251-0.14098im         -0.113528-0.0792139im     -0.127821+0.012355im      0.104695+0.0359917im    -0.0478857+0.032593im     -0.300604-0.0664899im      -0.170722+0.190691im     0.0839967-0.00491796im   -0.150957+0.156213im        0.375775-0.227794im      0.128693+0.0808153im      0.116038+0.0526303im   -0.0412526-0.052049im    -0.0178219-0.152089im     -0.271069-0.0309446im      0.121215+0.1205im      -0.0182498+0.0725249im    0.0987197+0.125924im      0.0680665+0.0167788im    0.107156+0.0871271im      0.018877-0.0395129im    -0.079579-0.0434214im   -0.00170379+0.0747105im     -0.0843456-0.0548655im
  -0.0679354-0.0535518im     0.139493-0.0800293im     0.0492072-0.204328im      0.110151-0.146402im        0.28587+0.182406im      0.201229+0.0195725im   -0.0575973-0.125945im     -0.030062-0.0508674im    0.0112337+0.0695487im       -0.251276+0.0224647im      0.126213-0.00596105im  -0.0298093-0.0494393im      0.319566+0.277997im    -0.0152598+0.022874im       -0.232538+0.102248im      0.133701-0.154091im      0.075669-0.0152968im     -0.0184501-0.0353006im    -0.023769-0.0636287im     0.0639309+0.0970173im   -0.0946368+0.0679081im     0.202483-0.0212073im    0.0093533-0.056348im      0.0659921-0.0294011im   -0.0243439-0.289638im     -0.139297+0.0235633im     -0.125435+0.104234im    0.0199587+0.0908882im    -0.0995039+0.0487969im   -0.0211211-0.196067im      0.0700309+0.155138im       0.0369646+0.160606im
    0.108161-0.127371im     -0.191755+0.0648407im   -0.00387314+0.165111im    0.00809346-0.0294603im    -0.0695259+0.0419677im    0.0345626+0.177584im     0.0482906-0.0491256im   -0.0682912+0.184142im      0.121593-0.192855im         0.186726+0.0759269im     0.0545996+0.0440369im   -0.0451576+0.180218im        0.10189+0.0236254im    -0.108746-0.155928im       0.0772184+0.0235343im   -0.0553773-0.0525043im   -0.0383225-0.18201im        0.0159337-0.0248766im    -0.124632+0.0173235im      0.205027+0.0588867im   -0.0558945-0.0568352im     0.131121+0.213938im     -0.486398+0.0406282im      0.198948-0.0803787im  -0.00107205-0.228594im     0.0475163-0.063258im     -0.0673074+0.173887im     0.052742+0.00713785im   -0.0742581-0.0901881im    0.0927559+0.219094im       0.018083+0.0839502im      0.0247716-0.0634804im
   -0.170483+0.106897im     0.0418813-0.0574012im    -0.0204311-0.0512908im   -0.0060657-0.0379248im      0.172766+0.00336644im   -0.108321-0.0118045im     0.148287-0.184404im     0.0315282+0.106736im      0.218416+0.191983im       -0.0751138+0.0407971im     0.0127468-0.0564241im   -0.0447442-0.152311im      -0.195152+0.103255im     -0.213969-0.201242im        0.119393+0.121372im    -0.0620451-0.161525im     0.0688683-0.240193im       0.0307609+0.0233649im   0.00526625-0.207637im     -0.0150781-0.0661668im     0.160495+0.210125im     0.0621898+0.0975899im   -0.0976912+0.205991im      0.0569081+0.108225im    -0.0987886+0.051248im    -0.0227652-0.0249166im      0.162338-0.0848419im   -0.169064+0.0770347im      0.026715-0.018151im      0.109473-0.00702557im    -0.178174-0.270631im       -0.239865+0.0797418im
     0.14444+0.173875im    -0.0161794+0.0585021im      0.188406-0.14282im     -0.0176501-0.0357933im   -2.17769e-5+0.0706811im    0.0108148-0.0135321im     0.175117-0.335025im    -0.0384634-0.0939646im    0.0880695-0.0963069im      -0.0436839+0.275851im      -0.237304-0.134012im      0.185253+0.0608293im      0.029176-0.00623803im     0.14259-0.111576im         0.09266-0.0999218im    0.0383298+0.0720822im   -0.0649474-0.00131845im    -0.0582694-0.0629988im   -0.0354524-0.183419im    -0.00364417+0.182522im     -0.113566-0.00958782im    0.079927+0.0856726im     0.146742-0.11339im      -0.0314079+0.0156098im   -0.0101971+0.138797im     0.0407742-0.101684im       0.340896+0.156191im     0.245332-0.202822im      -0.111242-0.0202176im     0.127217+0.0133892im      0.112378-0.00986985im     0.0441306+0.0609712im
  -0.0763082+0.0792486im     0.340127-0.020485im      -0.401863+0.0440816im    -0.188058-0.0873578im     0.0138415-0.0510622im   -0.0555226+0.146824im     0.0615768+0.0421389im    -0.213172-0.074967im    0.00671669+0.0277024im     -0.00114241-0.125817im      -0.036115-0.0811684im    0.0684416-0.0723824im    -0.0348697+0.0325031im    0.0465955-0.097221im      -0.0572236-0.0954278im     -0.25717+0.0640332im     0.064792-0.0841048im      -0.205568-0.152841im    -0.0302442+0.136394im      0.0228877-0.0716512im   -0.0930771-0.0383879im    -0.104421+0.145713im    -0.0267173+0.15018im      -0.0757302-0.0243288im     0.110093+0.0268795im   -0.0678661-0.120286im       0.100508+0.127647im   -0.0370024+0.00470227im    -0.339805-0.214627im     -0.102766-0.138494im      0.0126986+0.107296im        0.110968+0.037632im
   -0.113827-0.019122im     0.0115494-0.036665im        0.19722+0.143057im     -0.175069-0.102972im      0.0374763+0.251607im     0.0280208+0.0212699im    0.0490737+0.162308im     0.0158569-0.0509262im   -0.0468099+0.0253124im        0.221531+0.0665007im     0.0902661-0.199832im    -0.0150834+0.053176im     -0.0550319+0.132845im     -0.112197+0.0356842im      0.0915837+0.245969im     -0.175399-0.149273im       0.16646-0.06378im        0.0951702-0.0509569im    -0.204409+0.0319505im    -0.0231034-0.132503im     -0.201264+0.0296056im     0.135152+0.0236417im    0.0661168-0.182426im     -0.0248502-0.0222426im     0.127821+0.210861im    0.00424672-0.0222622im    -0.0716168-0.315166im     0.286735+0.00746024im    -0.125519+0.0380685im    0.0107697-0.121041im      0.0533287-0.0746672im      0.0913299-0.151752im
   0.0326414+0.0742485im    0.0299176+0.133874im      0.0627425-0.021272im    -0.0262553-0.0232923im    -0.0193584+0.00815045im  -0.0394703+0.244141im      -0.21249-0.108624im        -0.024+0.0848073im   0.00710531-0.000127964im    -0.0867075+0.0185258im     -0.063295-0.16621im      0.0600452+0.0727888im     0.0767219-0.0382906im   -0.0176747-0.159704im        0.260111+0.0796408im       0.1498+0.0336394im    0.0859462-0.150503im      -0.0199724-0.0444177im     0.258297+0.160236im      -0.176826+0.0622906im    -0.110038+0.0681723im   -0.0782631+0.0655152im    0.0525448-0.0919524im      0.112005-0.153878im     -0.175436+0.0596024im     0.264065-0.00274328im   -0.0818235-0.130906im    -0.355619+0.137598im      0.0232382+0.0538076im     0.116239-0.231802im      0.0560659+0.131868im        0.200252-0.155873im
    0.100076+0.0937575im   -0.0143589+0.0873508im    -0.0212619+0.194687im      0.126908+0.0927586im      0.102634+0.0705523im    -0.101459-0.0965066im   -0.0718137+0.0229521im    0.0660987+0.274474im      0.189457+0.121862im        0.0745809-0.164999im       0.128105+0.0732138im      0.12359-0.0234583im    0.00466073-0.132682im     -0.102394-0.223484im      -0.0428424+0.127988im     -0.113079-0.144459im     -0.178762+0.116897im       0.0188889-0.0867454im   -0.0237264-0.0784714im     -0.307811+0.050422im    -0.0841184-0.153798im    -0.0762263+0.0151597im    0.0414427-0.214144im      -0.137789-0.228167im     -0.122901-0.082288im     -0.173863-0.217513im    -0.00373471+0.0902289im   0.0671538-0.199753im      0.0168726+0.0599954im   -0.0760226-0.167655im       -0.13117+0.0823251im     -0.0382411+0.103087im</code></pre><p>and then generate the state <span>$ψ$</span></p><pre><code class="language-julia hljs">psi = P[:, 3]</code></pre><pre><code class="nohighlight hljs">32-element Vector{ComplexF64}:
 -0.005662092946808349 + 0.13926192642057997im
   0.07747936383019503 + 0.1397499160522953im
  -0.07932578005103079 + 0.06870391136371302im
     0.153291147191839 + 0.1595686069681555im
   0.04137991937682313 - 0.06155515983451616im
   0.08912128059659867 + 0.13017631680878025im
   0.08334714623368632 + 0.10560113142203838im
  0.016862825441701538 + 0.0395463484614966im
  -0.11849461624293492 - 0.21454689132472943im
   0.16363332330238956 - 0.08265263673844421im
   0.18160105061800239 + 0.09246468728911549im
   0.14994699357764718 - 0.13541370939200917im
   -0.0589259887164514 + 0.28640180214121336im
   0.15385602326906422 + 0.06397132462074566im
  0.028062761929750185 + 0.18790591883272356im
  -0.04096772950743115 - 0.1416638979430092im
   0.11931917352839838 + 0.017566186141938542im
   0.06608087600743931 - 0.05418879209544085im
   0.04169235095085664 + 0.0391309146304495im
  0.060259026308726656 - 0.19936226920671996im
   0.09253281121647049 + 0.07029444877778317im
 -0.030641558224149438 + 0.09853818611105691im
 -0.028880421136927382 + 0.1605874879704622im
    0.1160231202332834 - 0.11720729001778665im
  -0.15195671882442233 - 0.12099388109515155im
 -0.017726227422986438 - 0.0769238570167343im
    0.3461123012768366 + 0.0im
  -0.14314485030887059 + 0.2569912158098248im
   0.09180308189754516 - 0.10950653979178127im
   0.10980417240184352 - 0.15834332536407922im
    0.1703983395058611 - 0.06449249292302783im
   -0.0874265146503258 - 0.04951264884500647im</code></pre><p>In the phase estimation process, we will feed the state to circuit and measure the first <code>n</code> qubits processed by iQFT.</p><pre><code class="language-julia hljs">r = join(ArrayReg(psi), zero_state(N))
r |&gt; PE(N, M, U)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 8/8
    nlevel: 2</code></pre><p>Since our phase can be represented by 3 qubits precisely, we only need to measure once</p><pre><code class="language-julia hljs">results = measure(r, 1:N; nshots=1)</code></pre><pre><code class="nohighlight hljs">1-element Vector{DitStr{2, 3, Int64}}:
 011 ₍₂₎</code></pre><p>Recall that our QFT&#39;s bit numbering is reversed, let&#39;s reverse it back</p><pre><code class="language-julia hljs">using BitBasis
estimated_phase = bfloat(results[]; nbits=N)</code></pre><pre><code class="nohighlight hljs">0.75</code></pre><p>the phase is exactly <code>0.75</code>!</p><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../1.prepare-ghz-state/index.html">« Prepare Greenberger–Horne–Zeilinger state with Quantum Circuit</a><a class="docs-footer-nextpage" href="../3.grover-search/index.html">Grover Search »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.19 on <span class="colophon-date" title="Friday 10 June 2022 02:18">Friday 10 June 2022</span>. Using Julia version 1.7.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
