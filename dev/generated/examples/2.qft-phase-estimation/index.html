<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Quantum Fourier Transformation and Phase Estimation · Documentation | Yao</title><meta name="title" content="Quantum Fourier Transformation and Phase Estimation · Documentation | Yao"/><meta property="og:title" content="Quantum Fourier Transformation and Phase Estimation · Documentation | Yao"/><meta property="twitter:title" content="Quantum Fourier Transformation and Phase Estimation · Documentation | Yao"/><meta name="description" content="Documentation for Documentation | Yao."/><meta property="og:description" content="Documentation for Documentation | Yao."/><meta property="twitter:description" content="Documentation for Documentation | Yao."/><script data-outdated-warner src="../../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../search_index.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script><link href="../../../assets/indigo.css" rel="stylesheet" type="text/css"/><link href="https://yaoquantum.org/assets/favicon-light.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../index.html"><img src="../../../assets/logo.png" alt="Documentation | Yao logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../../index.html">Documentation | Yao</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../../index.html">Home</a></li><li><a class="tocitem" href="../../../quick-start.html">Quick Start</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../../../man/registers.html">Quantum Registers</a></li><li><a class="tocitem" href="../../../man/blocks.html">Blocks</a></li><li><a class="tocitem" href="../../../man/symbolic.html">Symbolic Computation</a></li><li><a class="tocitem" href="../../../man/cuda.html">CUDA extension - CuYao</a></li><li><a class="tocitem" href="../../../man/plot.html">Quantum Circuit Visualization</a></li><li><a class="tocitem" href="../../../man/automatic_differentiation.html">Automatic Differentiation</a></li><li><a class="tocitem" href="../../../man/yao2einsum.html">Tensor network backend</a></li><li><a class="tocitem" href="../../../man/simplification.html">Simplification</a></li><li><a class="tocitem" href="../../../man/bitbasis.html">BitBasis</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../1.prepare-ghz-state/index.html">Prepare Greenberger–Horne–Zeilinger state with Quantum Circuit</a></li><li class="is-active"><a class="tocitem" href="index.html">Quantum Fourier Transformation and Phase Estimation</a><ul class="internal"><li><a class="tocitem" href="#Quantum-Fourier-Transformation"><span>Quantum Fourier Transformation</span></a></li><li><a class="tocitem" href="#Wrap-QFT-to-an-external-block"><span>Wrap QFT to an external block</span></a></li><li><a class="tocitem" href="#Phase-Estimation"><span>Phase Estimation</span></a></li></ul></li><li><a class="tocitem" href="../3.grover-search/index.html">Grover Search</a></li><li><a class="tocitem" href="../4.shor-algorithm/index.html">Shor&#39;s Algorithm</a></li><li><a class="tocitem" href="../5.shor-9-code/index.html">Shor&#39;s 9 qubit code</a></li><li><a class="tocitem" href="../6.quantum-circuit-born-machine/index.html">Quantum Circuit Born Machine</a></li><li><a class="tocitem" href="../7.variation-quantum-eigen-solver/index.html">Variational Quantum Eigen Solver</a></li><li><a class="tocitem" href="../8.riemannian-gradient-flow/index.html">Riemannian gradient flow optimizer</a></li></ul></li><li><a class="tocitem" href="../../../performancetips.html">Performance Tips</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href="index.html">Quantum Fourier Transformation and Phase Estimation</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="index.html">Quantum Fourier Transformation and Phase Estimation</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/QuantumBFS/Yao.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/QuantumBFS/Yao.jl/blob/master/docs/src/examples/2.qft-phase-estimation/main.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><p><a href="/generated/examples/2.qft-phase-estimation/main.ipynb"><img src="https://mybinder.org/badge_logo.svg" alt/></a></p><h1 id="example-qft"><a class="docs-heading-anchor" href="#example-qft">Quantum Fourier Transformation and Phase Estimation</a><a id="example-qft-1"></a><a class="docs-heading-anchor-permalink" href="#example-qft" title="Permalink"></a></h1><p>Let&#39;s use Yao first</p><pre><code class="language-julia hljs">using Yao</code></pre><h2 id="Quantum-Fourier-Transformation"><a class="docs-heading-anchor" href="#Quantum-Fourier-Transformation">Quantum Fourier Transformation</a><a id="Quantum-Fourier-Transformation-1"></a><a class="docs-heading-anchor-permalink" href="#Quantum-Fourier-Transformation" title="Permalink"></a></h2><p>The Quantum Fourier Transformation (QFT) circuit is to repeat two kinds of blocks repeatly:</p><p><img src="assets/qft.png" alt="qft-circuit"/></p><p>The basic building block control phase shift gate is defined as</p><p class="math-container">\[R(k)=\begin{bmatrix}
1 &amp; 0\\
0 &amp; \exp\left(\frac{2\pi i}{2^k}\right)
\end{bmatrix}\]</p><p>Let&#39;s define block <code>A</code> and block <code>B</code>, block <code>A</code> is actually a control block.</p><pre><code class="language-julia hljs">A(i, j) = control(i, j=&gt;shift(2π/(1&lt;&lt;(i-j+1))))</code></pre><pre><code class="nohighlight hljs">A (generic function with 1 method)</code></pre><p>Once you construct the blockl you can inspect its matrix using <code>mat</code> function. Let&#39;s construct the circuit in dash box A, and see the matrix of <span>$R_4$</span> gate.</p><pre><code class="language-julia hljs">R4 = A(4, 1)</code></pre><pre><code class="nohighlight hljs">(n -&gt; control(n, 4, 1 =&gt; shift(0.39269908169872414)))</code></pre><p>If you have read about <a href="@ref tutorial-ghz">preparing GHZ state</a>, you probably know that in Yao, we could just leave the number of qubits, and it will be evaluated when possible.</p><pre><code class="language-julia hljs">R4(5)</code></pre><pre><code class="nohighlight hljs">nqubits: 5
control(4)
└─ (1,) shift(0.39269908169872414)</code></pre><p>its matrix will be</p><pre><code class="language-julia hljs">mat(R4(5))</code></pre><pre><code class="nohighlight hljs">32×32 Diagonal{ComplexF64, Vector{ComplexF64}}:
 1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im</code></pre><p>Then we repeat this control block over and over on different qubits, and put a Hadamard gate to <code>i</code>th qubit to construct <code>i</code>-th <code>B</code> block.</p><pre><code class="language-julia hljs">B(n, k) = chain(n, j==k ? put(k=&gt;H) : A(j, k) for j in k:n)</code></pre><pre><code class="nohighlight hljs">B (generic function with 1 method)</code></pre><p>We need to input the total number of qubits <code>n</code> here because we have to iterate through from <code>k</code>-th location to the last.</p><p>Now, let&#39;s construct the circuit by chaining all the <code>B</code> blocks together</p><pre><code class="language-julia hljs">qft(n) = chain(B(n, k) for k in 1:n)
qft(4)</code></pre><pre><code class="nohighlight hljs">nqubits: 4
chain
├─ chain
│  ├─ put on (1)
│  │  └─ H
│  ├─ control(2)
│  │  └─ (1,) shift(1.5707963267948966)
│  ├─ control(3)
│  │  └─ (1,) shift(0.7853981633974483)
│  └─ control(4)
│     └─ (1,) shift(0.39269908169872414)
├─ chain
│  ├─ put on (2)
│  │  └─ H
│  ├─ control(3)
│  │  └─ (2,) shift(1.5707963267948966)
│  └─ control(4)
│     └─ (2,) shift(0.7853981633974483)
├─ chain
│  ├─ put on (3)
│  │  └─ H
│  └─ control(4)
│     └─ (3,) shift(1.5707963267948966)
└─ chain
   └─ put on (4)
      └─ H
</code></pre><h2 id="Wrap-QFT-to-an-external-block"><a class="docs-heading-anchor" href="#Wrap-QFT-to-an-external-block">Wrap QFT to an external block</a><a id="Wrap-QFT-to-an-external-block-1"></a><a class="docs-heading-anchor-permalink" href="#Wrap-QFT-to-an-external-block" title="Permalink"></a></h2><p>In most cases, <code>function</code>s are enough to wrap quantum circuits, like <code>A</code> and <code>B</code> we defined above, but sometimes, we need to dispatch specialized methods on certain kinds of quantum circuit, or we want to define an external block to export, thus, it&#39;s useful to be able to wrap circuit to custom blocks.</p><p>First, we define a new type as subtype of <code>PrimitiveBlock</code> since we are not going to use the subblocks of <code>QFT</code>, if you need to use its subblocks, it&#39;d be better to define it under <code>CompositeBlock</code>.</p><pre><code class="language-julia hljs">struct QFT &lt;: PrimitiveBlock{2}
    n::Int
end

YaoBlocks.nqudits(q::QFT) = q.n</code></pre><p>Now, let&#39;s define its circuit</p><pre><code class="language-julia hljs">circuit(q::QFT) = qft(q.n)</code></pre><pre><code class="nohighlight hljs">circuit (generic function with 1 method)</code></pre><p>And forward <code>mat</code> to its circuit&#39;s matrix</p><pre><code class="language-julia hljs">YaoBlocks.mat(::Type{T}, x::QFT) where T = mat(T, circuit(x))</code></pre><p>You may notice, it is a little ugly to print <code>QFT</code> at the moment, this is because we print the type summary by default, you can define your own printing by overloading <code>print_block</code></p><pre><code class="language-julia hljs">YaoBlocks.print_block(io::IO, x::QFT) = print(io, &quot;QFT($(x.n))&quot;)</code></pre><p>Since it is possible to use FFT to simulate the results of QFT (like cheating), we could define our custom <code>apply!</code> method:</p><pre><code class="language-julia hljs">using FFTW, LinearAlgebra

function YaoBlocks.apply!(r::ArrayReg, x::QFT)
    α = sqrt(length(statevec(r)))
    invorder!(r)
    lmul!(α, ifft!(statevec(r)))
    return r
end</code></pre><p>Now let&#39;s check if our <code>apply!</code> method is correct:</p><pre><code class="language-julia hljs">r = rand_state(5)
r1 = r |&gt; copy |&gt; QFT(5)
r2 = r |&gt; copy |&gt; circuit(QFT(5))
r1 ≈ r2</code></pre><pre><code class="nohighlight hljs">true</code></pre><p>We can get iQFT (inverse QFT) directly by calling <code>adjoint</code></p><pre><code class="language-julia hljs">QFT(5)&#39;</code></pre><pre><code class="nohighlight hljs"> [†]QFT(5)</code></pre><p>QFT and iQFT are different from FFT and IFFT in three ways,</p><ol><li>they are different by a factor of <span>$\sqrt{2^n}$</span> with <span>$n$</span> the number of qubits.</li><li>the <a href="https://quantumbfs.github.io/BitBasis.jl/stable/tutorial/#Conventions-1">bit numbering</a> will exchange after applying QFT or iQFT.</li><li>due to the convention, QFT is more related to IFFT rather than FFT.</li></ol><h2 id="Phase-Estimation"><a class="docs-heading-anchor" href="#Phase-Estimation">Phase Estimation</a><a id="Phase-Estimation-1"></a><a class="docs-heading-anchor-permalink" href="#Phase-Estimation" title="Permalink"></a></h2><p>Since we have QFT and iQFT blocks we can then use them to realize phase estimation circuit, what we want to realize is the following circuit:</p><p><img src="assets/phaseest.png" alt="phase estimation"/></p><p>First we call Hadamard gates repeatly on first <code>n</code> qubits.</p><pre><code class="language-julia hljs">Hadamards(n) = repeat(H, 1:n)</code></pre><pre><code class="nohighlight hljs">Hadamards (generic function with 1 method)</code></pre><p>Then in dashed box <code>B</code>, we have controlled unitaries:</p><pre><code class="language-julia hljs">ControlU(n, m, U) = chain(n+m, control(k, n+1:n+m=&gt;matblock(U^(2^(k-1)))) for k in 1:n)</code></pre><pre><code class="nohighlight hljs">ControlU (generic function with 1 method)</code></pre><p>each of them is a <code>U</code> of power <span>$2^{(k-1)}$</span>.</p><p>Since we will only apply the qft and Hadamard on first <code>n</code> qubits, we could use <code>Subroutine</code>, which creates a context of a sub-scope of the qubits.</p><pre><code class="language-julia hljs">PE(n, m, U) =
    chain(n+m, # total number of the qubits
        subroutine(Hadamards(n), 1:n), # apply H in local scope
        ControlU(n, m, U),
        subroutine(QFT(n)&#39;, 1:n))</code></pre><pre><code class="nohighlight hljs">PE (generic function with 1 method)</code></pre><p>we use the first <code>n</code> qubits as the output space to store phase <span>$ϕ$</span>, and the other <code>m</code> qubits as the input state which corresponds to an eigenvector of oracle matrix <code>U</code>.</p><p>The subroutine here uses <code>focus!</code> and <code>relax!</code> to manage a local scope of quantum circuit, and only activate the first <code>n</code> qubits while applying the block inside the subroutine context, and the scope will be <code>relax!</code>ed back, after the context. This is equivalent to manually <code>focus!</code> then <code>relax!</code></p><p>fullly activated</p><pre><code class="language-julia hljs">r = rand_state(5)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 5/5
    nlevel: 2</code></pre><p>first 3 qubits activated</p><pre><code class="language-julia hljs">focus!(r, 1:3)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 3/5
    nlevel: 2</code></pre><p>relax back to the original</p><pre><code class="language-julia hljs">relax!(r, 1:3)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 5/5
    nlevel: 2</code></pre><p>In this way, we will be able to apply small operator directly on the subset of the qubits.</p><p>Details about the algorithm can be found here: <a href="https://en.wikipedia.org/wiki/Quantum_phase_estimation_algorithm">Quantum Phase Estimation Algorithm</a></p><p>Now let&#39;s check the results of our phase estimation.</p><p>First we need to set up a unitary with known phase, we set the phase to be 0.75, which is <code>0.75 * 2^3 == 6 == 0b110</code> .</p><pre><code class="language-julia hljs">N, M = 3, 5
P = eigen(rand_unitary(1&lt;&lt;M)).vectors
θ = Int(0b110) / 1&lt;&lt;N
phases = rand(1&lt;&lt;M)
phases[0b010+1] = θ
U = P * Diagonal(exp.(2π * im * phases)) * P&#39;</code></pre><pre><code class="nohighlight hljs">32×32 Matrix{ComplexF64}:
   -0.119201+0.40113im      0.0876479-0.0160307im   -0.00972301-0.0215745im      0.138512-0.0646025im     -0.139931+0.15227im       0.134962-0.0677495im     -0.142888+0.0248376im    -0.0627992+0.0389294im    -0.058319-0.297133im     -0.0558744+0.123375im      0.132546-0.0918293im    -0.00704497-0.0355766im    0.0318551-0.200494im     -0.148218-0.0579925im    -0.211972-0.0763734im    -0.062704-0.186649im      -0.103971-0.0764196im    -0.070863-0.0033018im       0.124787-0.0787088im      -0.142824-0.103291im     -0.0653566-0.0915091im     0.157296-0.00455823im   -0.0784668-0.200587im      0.0153715+0.146125im      0.153429+0.0289079im    -0.0406307-0.0365349im      0.0469306-0.163394im      -0.121778+0.0919569im    -0.128606-0.226785im     0.0443149-0.085945im       0.0418524-0.115015im   -0.0312525+0.234101im
  -0.0274257-0.0917539im   -0.0765645+0.23369im       0.0581427-0.0634213im    -0.0817262+0.119122im      -0.271108-0.163137im    -0.0305955-0.0283457im     0.0708167+0.0720981im     -0.367562-0.177633im     -0.172839+0.104557im      0.0459908+0.124298im      0.106932+0.0268234im     -0.0618675+0.218677im    -0.0664015-0.256362im     -0.128397-0.0355323im      0.14075+0.105905im        0.1918-0.0652767im   -0.00143002-0.148428im     0.0539478-0.0304366im      0.0446812-0.109799im       -0.072297-0.110431im      -0.137436+0.0522549im     0.157317-0.143253im      0.0374146+0.0720115im      0.203096-0.108387im     -0.114686-0.00326207im     0.121895+0.0087654im       0.062477-0.127839im       0.128459+0.187929im    0.00433568-0.00839973im  -0.0602917-0.00420489im      0.172204+0.0372229im   0.0728385-0.131039im
  -0.0226353+0.114894im      0.134861+0.13657im       -0.188854+0.266889im      0.0359738+0.0830927im     0.0483178-0.0842036im     0.126371+0.111792im       0.113011-0.0325809im    -0.0556402+0.0484856im     -0.24248-0.0129142im    -0.0317049-0.243878im    -0.0137465-0.000265449im    -0.298244-0.018964im     -0.112799-0.0141691im     0.240638+0.115752im    -0.0373914-0.0182564im   -0.0203837+0.0807226im    -0.0880437-0.191274im     0.0715905-0.0524297im       0.187107+0.0700598im     -0.0617576+0.066121im    -0.00209534+0.116404im    0.00550001+0.0144703im     -0.192479-0.127675im      -0.102807-0.0221414im    -0.202875-0.0475234im     -0.177016-0.315999im        0.159217+0.0341199im     0.0199914+0.00787279im  -0.0325666-0.129493im     0.0468757+0.0968814im     -0.0840393+0.216608im   0.00671964-0.108663im
   0.0598837+0.0399817im     0.092807+0.0854391im      0.077435+0.00401908im    -0.232571+0.390417im     -0.0325745-0.175653im      0.142098-0.0644501im      -0.09428-0.0337457im     0.0162593+0.204356im     -0.107743-0.249598im      0.0367693-0.065077im     0.0593005-0.0368578im      -0.140717-0.188229im    -0.0937597+0.144332im    -0.0411546-0.104544im     0.0950007-0.303524im    -0.0904701+0.0526833im     -0.117792-0.0268887im    0.0643003+0.000481628im   -0.0506903-0.122875im       -0.153553+0.0444149im     -0.108777-0.0447848im   0.00704507+0.136139im      0.0150474+0.255531im       0.180091+0.221932im    -0.0894144-0.0494296im      0.108367+0.11617im       -0.0416907+0.0988795im     0.0867496-0.152733im     0.0446122+0.13652im     -0.0550381-0.0441288im      0.0656572-0.0928407im  -0.0386648+0.06667im
  -0.0533647+0.182733im    -0.0615128+0.100921im       0.258451-0.034324im     -0.0683165-0.114791im      -0.193092+0.394288im      0.101066+0.111054im       0.200719+0.23934im      -0.0743704-0.0271188im    -0.163163+0.12631im       -0.111288-0.115239im    0.00807342+0.0178207im      -0.101097-0.191094im     0.0851034+0.114714im     0.0615267+0.127062im     0.0197058+0.0807567im     0.104907-0.0135814im     0.0057629+0.0950248im    -0.188452-0.0347638im      -0.108341-0.180746im    -0.000260577-0.00925692im    -0.140831-0.0236988im    0.0431154+0.241584im     -0.0769548-0.0370527im    -0.0447958+0.054352im      0.104037+0.00457688im     0.047073+0.134655im       0.0144335+0.208374im      0.0910141-0.0175023im     0.264009+0.0134914im    0.0712086-0.00553475im     0.0365501+0.115165im   -0.0392032-0.115609im
  -0.0218198-0.0533225im   -0.0679276-0.175692im      0.0388721+0.0223783im      0.121109+0.11478im       -0.065787-0.0834955im    -0.293152+0.454644im       0.101813-0.110272im      -0.129788+0.210914im     0.0421766-0.00876672im      0.28529-0.148633im    -0.0688441-0.00557621im     -0.115499+0.052202im     0.0750004-0.0292354im     0.088725+0.0564143im   -0.0684053+0.104582im      0.192619+0.0900283im     0.0437606+0.0964516im   -0.0320136-0.00405101im     0.0426817-0.0343764im     -0.0749874+0.127508im    -0.00515879+0.0240164im     0.053657-0.0288197im     -0.122461+0.0959754im     0.0657266+0.194248im      0.100382+0.0508301im     0.0868129+0.185917im       0.0423527-0.0808392im     0.0831737+0.0594709im   -0.0449249-0.226788im     0.0434835-0.196731im       -0.133784-0.0424005im  -0.0822883+0.192989im
    -0.14986-0.0901047im    -0.076523+0.191797im      0.0479143-0.131891im       0.275247-0.129893im       0.227297+0.0550865im     0.162335-0.129817im     -0.0397584+0.236412im      -0.276307+0.0439612im    0.0147468-0.239064im       0.101955+0.00639623im   0.0669781+0.0390564im      0.0383098+0.0690485im    -0.107529+0.212105im      0.174283-0.131831im     0.0620952+0.170147im     0.0219101+0.21649im        -0.11642+0.134051im     0.0262078-0.0945066im    -0.00388065+0.0596122im    -0.00944224+0.0419914im    -0.0424342-0.0826517im     0.130824+0.0160193im     0.0128786+0.119364im     -0.0223529-0.0217233im    -0.122826-0.10734im      -0.0393156+0.115616im     -0.00619674-0.255874im    -0.00702743-0.116625im     0.0921834-0.094929im    -0.0834707+0.183882im       -0.195211-0.0262931im  -0.0746343+0.0707295im
   0.0988055-0.250945im    0.00799886+0.019255im      0.0971501+0.246425im      0.0331424+0.146391im      0.0768594+0.0981147im    0.0129454-0.0393212im     -0.266692+0.222228im      -0.212066+0.34963im     -0.0178682+0.0672868im    -0.0868161+0.0732321im     0.202161+0.192426im       0.0201936-0.0743956im      0.17405-0.0102459im    0.0189119-0.0324618im     -0.11774-0.0777299im   0.00965412-0.0465866im     0.0149367+0.0442386im     0.011843+0.0858584im      0.0594186+0.147803im        0.212058-0.163218im     -0.0596871+0.177147im    -0.0371611-0.12706im       -0.172267-0.0461973im     -0.120158+0.0729469im     0.100586-0.0498554im      0.137664-0.0603539im     -0.0825419-0.0488004im    -0.0173263-0.00538308im   0.0968096-0.0102497im    0.0704518-0.141811im       0.0378805+0.0728007im    0.276579-0.0196135im
    0.231669+0.0606493im   -0.0982113+0.297587im      -0.125623+0.208205im       0.146572-0.149756im     -0.0173812+0.00694468im   -0.163451+0.154823im       0.112251+0.0861646im      0.146767+0.0281546im    0.0345134+0.132264im     -0.0694506+0.0678131im      0.10149+0.237341im       -0.215836-0.0579204im   -0.0703378+0.176447im     -0.148641-0.082422im      0.172803-0.139557im    -0.0569869-0.0978172im    -0.0316369-0.0284634im      0.14376+0.0955104im       0.171726-0.0534439im      0.0262187-0.0802155im     0.0447413+0.0015776im     0.164265+0.253899im       0.115857+0.0824032im    -0.0895178-0.134024im     0.0497579+0.0429386im   -0.00210917+0.0728831im     -0.0566171-0.108297im     -0.0416358+0.085572im    -0.0764309-0.050633im     -0.068273-0.0839715im      -0.111995-0.313882im   -0.0244595-0.00989423im
   0.0254135+0.048261im   0.000899057+0.0219149im     -0.313475-0.0693501im     0.0626325-0.0641667im     -0.150628+0.117079im     0.0518532-0.0628559im    -0.0134861-0.168176im      -0.112425+0.090147im     0.0665548+0.0830221im     -0.180271+0.146606im      0.105544+0.150072im        0.148586-0.131278im   -0.00930096+0.205792im    -0.0835795+0.0667983im    -0.210583+0.155068im     0.0433859+0.122765im       0.136563-0.116032im     0.0905597-0.0297507im     -0.0248997-0.0154755im     -0.0688713-0.198423im       -0.03199-0.0588759im   -0.0309767-0.110305im     -0.0266377+0.17247im        0.204458+0.180907im     -0.236874+0.132047im     -0.0713188+0.0407817im      0.0566612+0.169074im     0.00665147-0.0293727im   -0.0530779-0.0138883im   -0.0741085-0.253373im       -0.280512+0.114494im   -0.0951429-0.142562im
   0.0294572-0.238867im      0.159357+0.0353553im    -0.0174828-0.134865im       0.152779-0.20622im      -0.0306725+0.0280739im      0.11976-0.0498895im     0.0150125+0.0155447im    -0.0582868+0.0192954im   -0.0464355-0.0222258im     0.0235326+0.0432902im    -0.369632+0.274842im       -0.114328-0.0860379im     0.185663-0.242146im    0.00171527-0.0827766im    0.0953303-0.0172339im   -0.0797535+0.0173461im    -0.0968251-0.105272im      0.143722-0.064454im     -0.00948465-0.0572547im      -0.187608-0.10372im      -0.0329232+0.168493im     -0.142412+0.0344739im     0.0589856+0.141412im       0.108048+0.130813im      0.245254+0.116744im      -0.103169-0.106136im        0.010046+0.0911109im      0.141044+0.0182732im   0.00899402+0.078186im      0.273265+0.136498im       -0.116843-0.0559244im  0.00372726+0.127046im
  -0.0430679+0.149554im     0.0405231-0.106413im       0.131653+0.0574422im      0.176358-0.0413513im     0.0557769+0.101496im    -0.0842905-0.105264im     -0.0644344+0.0230166im      0.082196-0.111692im    -0.0223449+0.016563im      0.0560173+0.0486499im    0.0899854+0.150363im       -0.232594+0.260452im     -0.107267-0.0294453im     0.130875-0.0463715im    0.0646579-0.131801im    -0.0309478-0.027595im       0.297162-0.134791im    -0.0909472+0.0873252im       0.122376+0.240029im       -0.117814+0.0359877im      -0.31203-0.159609im     -0.230963-0.0912946im     0.0371686-0.102112im     -0.0238818+0.152567im     -0.053745+0.0996448im       0.18834+0.134499im      -0.0720865-0.0123041im      0.241683-0.134733im    -0.0807863+0.124524im     0.0540286+0.0163788im     -0.0913744-0.0303653im  -0.0673967-0.149608im
    -0.06161-0.094078im      0.180086-0.0502672im   -0.00709072-0.166161im      -0.146464-0.00888427im    0.0952457-0.0266555im    0.0970694-0.0396614im     -0.355637+0.259481im      0.0726686+0.048589im     0.0146292+0.237248im       0.127697-0.105793im     -0.207783+0.0650017im     -0.0961966+0.0619948im    -0.303446+0.165865im     -0.042233+0.132062im    -0.0243061+0.069382im      0.132979-0.139659im       0.197262-0.113491im    -0.0133306+0.0753904im      0.0914257-0.0519499im     -0.0621779-0.0523814im     0.0276658+0.0414476im     0.212391+0.0684821im      0.142086-0.0588868im    -0.0842924+0.169774im    -0.0392941+0.0856926im    -0.0519581-0.0598794im     -0.0764537-0.0110597im    -0.0657715+0.215148im     0.0965769-0.0156775im   -0.0989058-0.0853339im      0.0360511+0.10235im      -0.14564+0.191072im
  -0.0211169+0.0169743im   -0.0105007+0.0119541im    -0.0551559-0.0489209im        0.1147-0.102078im      0.0283439-0.319466im      0.192917-0.0318232im    -0.0732486-0.0389776im      -0.11967+0.0324297im     0.189827+0.266608im      -0.156432+0.0644761im    0.0655798-0.122449im       -0.155003+0.0033092im    0.0423162-0.0309566im   -0.0934313+0.551954im     0.0553243+0.0384484im    0.0397322-0.0543072im     -0.154972+0.0292327im   -0.0404344-0.0631033im          0.087+0.0544455im    -0.00374793+0.0400498im     -0.125914-0.0183025im    -0.173935+0.148013im     -0.0576451-0.00518657im    0.0805639+0.088094im    -0.0344774-0.107595im       0.076718+0.205405im       -0.105367+0.0112819im      -0.14334-0.138358im    -0.0356535-0.0808737im    0.0985336+0.13128im        0.0400993-0.113178im    0.0907804+0.067941im
  -0.0374476-0.0739884im     0.138201-0.0364546im     0.0667502+0.174861im      -0.210683-0.0440196im     0.0351189-0.044461im     0.0224193+0.203941im    -0.00716447-0.00225505im    0.0805659+0.0421644im    -0.238933-0.136685im    -0.00629588+0.297972im     -0.113275+0.0573628im       0.123208+0.102145im    -0.0591994+0.190318im     0.0287319-0.00633123im   -0.122335+0.310976im   -0.00634116-0.216932im       0.148774-0.07627im      0.0758473-0.1712im        -0.0770154-0.0467886im      0.0577322-0.0458483im     -0.086178+0.0788566im   -0.0715814+0.11047im        0.132585-0.0884198im     0.0103487+0.00274562im   -0.142006-0.0698394im     0.0132803+0.0434185im       0.157729+0.0147704im     0.0821925-0.25231im     -0.0159981-0.218836im      0.130093+0.0802296im      0.0731045-0.290364im     0.122735+0.0107235im
  -0.0143412-0.135064im      0.105603+0.155646im     0.00790646+0.0396277im     0.0596984+0.000197329im  -0.0918788-0.0146428im    -0.226708+0.0580373im    0.00663767+0.0602316im     0.0950908+0.0842917im    0.0715614+0.0365333im     -0.346742-0.0734676im   -0.0397781-0.143764im         0.10714-0.0682632im    -0.115656-0.166121im      0.033441+0.00119601im    0.228843+0.0599575im     -0.33817+0.273065im       0.219618-0.132725im     -0.151474-0.282483im      -0.0643692+0.0120299im      0.0697065+0.0486511im     -0.254856+0.0822022im     0.141746-0.0182361im     0.0377286-0.117635im      0.0692092+0.138346im     0.0592178-0.0462868im    -0.0891076+0.0192895im      0.0264848-0.14633im      -0.0570814-0.0734213im    0.0165484+0.0110918im   -0.0816957-0.122077im       0.0549134+0.027367im   -0.0269364+0.132927im
     0.12382+0.022337im      0.240938-0.157177im     -0.0270304-0.164399im     -0.0840556-0.040095im     -0.0775497+0.00712309im  -0.0252318+0.259023im      -0.123676+0.100925im      0.0583764-0.174553im      0.145094+0.0772332im    0.00383635-0.0772538im     0.216789-0.0169786im      0.0157604-0.237622im     -0.141999-0.0532446im    0.0234398-0.150087im     0.0631135+0.100614im     -0.070917-0.00831812im    -0.233108+0.38335im      0.0417172+0.104771im        0.197227+0.184536im       0.0586219-0.0923748im     -0.225757+0.0323346im    0.0902547-0.0542389im      0.132794+0.0175326im      0.136608+0.0393732im   -0.0931647+0.136648im     -0.0410483-0.076247im        0.115331+0.0245421im       0.13609-0.0641207im   -0.0559399-0.102541im     0.0730411+0.144265im       0.0202813+0.0486292im    0.102077-0.0706529im
    0.127352-0.110103im      0.185082+0.18928im       -0.208004+0.0159085im       0.15975-0.0207224im    -0.0503716-0.130433im      0.055722+0.0355922im     0.0260768+0.10336im       0.0917446-0.103703im     -0.181671-0.0544755im     0.0499533-0.0418151im    0.0312148-0.129374im        0.187541+0.0968453im    0.0897755+0.0945016im     0.149318+0.062934im      0.130231-0.0164208im      0.22608-0.0734949im     -0.102328+0.13195im      -0.127346+0.262553im      -0.0874046+0.0557395im      -0.126224-0.144111im      0.0391792+0.00155833im   -0.101814-0.0379953im     0.0642042-0.214514im      0.0356689+0.206218im      0.164646-0.214904im      -0.114522+0.0617046im       0.211097-0.0766861im    0.00132013-0.0826467im    0.0203712+0.210457im    -0.0135798-0.280752im       0.0315218-0.0643482im  -0.0868611-0.0808535im
 -0.00853084-0.0439043im    0.0262196+0.0118084im      -0.16371+0.049478im    -0.00456469+0.124012im     -0.0894428+0.0714823im   -0.0153232+0.22721im        0.013161+0.251019im      -0.108966-0.00762222im  -0.0267693+0.0163436im    -0.0345976+0.0677655im     0.171487-0.06016im       -0.0725665+0.165654im    -0.0671931-0.105005im    0.00885912-0.167438im    -0.0629886+0.0337481im   -0.0786609-0.080448im      0.0432212-0.0397561im    0.0658459+0.0818358im      -0.397722+0.226327im     0.000417258-0.0107247im     0.0676317+0.0415317im   -0.0545311+0.165041im     -0.0219733+0.0463569im     0.0449138+0.0545159im   -0.0154453-0.067692im      -0.110458+0.14866im        -0.213049+0.193797im      -0.253563+0.0800552im    -0.263238+0.0650421im     0.139975+0.233097im      0.00184853+0.124115im    -0.221241+0.0761347im
   0.0927308-0.0230646im    0.0225045+0.0113781im      0.101504-0.0411057im     0.0565169-0.0660493im     -0.175098-0.181188im      0.088595+0.00303402im   -0.0496047+0.038785im    -0.00666908+0.0553597im   -0.0382462+0.0173842im     -0.149516+0.14235im       0.164892+0.195964im        0.128114-0.212839im    -0.0317503+0.072489im    -0.0135194-0.00147446im  -0.0320406+0.124621im   -0.00817717+0.163273im       0.168386+0.02113im      -0.010248+0.144363im         0.03704+0.00782276im     -0.264465+0.487071im       0.167523+0.0504798im    0.0318095-0.0945032im   0.000386156-0.0141014im     -0.177038+0.0686548im     0.114822-0.0917269im      0.249304-0.118522im        0.152934+0.0324546im   -0.00258173+0.115513im     -0.120925-0.0203758im     0.050293+0.169096im        0.124218-0.0421055im   -0.175386-0.0772142im
   -0.172566+0.177428im    -0.0935784+0.139505im      0.0353366+0.0813026im     -0.139347+0.166313im     -0.0357502+0.0717752im     0.102477-0.0905851im     0.0320275-0.07594im        0.150129+0.084269im      0.197093+0.0928675im     0.0872476-0.0692863im   -0.0465678+0.0980471im      0.0848698+0.0169567im     0.171164-0.0827771im   -0.0244543-0.0347069im    -0.162787+0.142629im      0.180805+0.192953im     -0.0163513+0.0615059im     0.215593+0.142486im       0.0375371+0.0240109im     -0.0525485+0.0971115im     -0.389439+0.329411im     0.0238924+0.00452129im     0.152501-0.108005im     -0.0951767+0.0117542im    -0.031289-0.16304im       -0.253431+0.0926062im        -0.0938-0.0636511im    0.00679022+0.0763257im   -0.0869844+0.127922im     -0.025605+0.0399952im     -0.0138316-0.152065im   -0.0382244-0.0142113im
    0.161441-0.182541im     -0.153891+0.0645188im    -0.0271995+0.0718867im    -0.0869978+0.166208im      0.0429735-0.0325523im     0.189504-0.12092im        0.229821+0.023687im     -0.0238206-0.0172152im    0.0385194+0.0259958im    -0.0766541+0.110976im    -0.0196078-0.0651115im      0.0752045-0.0057901im    -0.149372-0.0882612im   -0.0303045-0.160243im     -0.084281-0.0426314im    0.0741836-0.075169im     -0.0832402+0.102548im     -0.279638-0.0942389im      0.0426392+0.0588005im      0.0260201+0.162788im     -0.0324917+0.0157783im    -0.294413+0.200322im       0.184887-0.178259im      0.0197924+0.204637im     0.0250925+0.168956im    -0.00976052-0.0621852im     -0.0667374-0.0235412im        0.1245+0.253413im     0.0180253-0.269334im     -0.152117-0.0174055im      -0.260416+0.0202866im    0.017409+0.0230167im
   0.0580778-0.158235im     0.0270192-0.00170732im  -0.00476728-0.0411825im     0.0625668+0.0683166im      0.111179-0.0593227im    0.0730276+0.0608517im       0.10664+0.154394im        0.25684-0.00901761im   0.0826568-0.157612im     0.00564592+0.051412im     0.0493947+0.11229im         0.216597-0.0756359im   -0.0870855-0.0891948im    -0.105727+0.176086im    -0.0456734-0.199475im      0.209404-0.228311im      0.0998258-0.0474711im   -0.0507346-0.0399374im      -0.117525-0.019841im      -0.0345977+0.163184im      -0.327073-0.0768589im     0.115667+0.0110154im     -0.329236+0.193446im     -0.0141063-0.202764im    -0.0541126+0.152466im      -0.163558+0.0225835im       0.130904-0.159916im     -0.0402468+0.0432555im    0.0175152+0.0310624im     0.205376+0.000991039im    -0.088711+0.0909386im  -0.0296881-0.0687841im
  -0.0305468-0.103825im     0.0130021-0.0920099im     0.0584244+0.0653761im     0.0276762-0.0780908im      -0.11867+0.174704im    -0.0790249-0.0194503im    -0.0534586-0.0488622im    -0.0305279-0.00896402im   0.0874705-0.307439im     -0.0492684-0.0858435im    -0.129594-0.0164088im     -0.0816453+0.215162im     0.0623886+0.0975331im    -0.376505+0.0798359im      0.29288+0.0959858im     -0.12001-0.0775158im     -0.150649-0.0307296im    0.0157626+0.261743im       -0.072766+0.066493im      -0.0404711+0.213803im     -0.0689343+0.0950501im   -0.0474874+0.0123855im     0.0574597+0.104228im      -0.132526+0.209958im     -0.185187-0.0206233im    -0.0649022-0.0276327im       0.064883+0.0186012im     -0.169776+0.0720381im    0.0959953-0.176832im    -0.0204847-0.0889343im    0.000772011+0.111157im     0.139558-0.219789im
    -0.12496-0.231145im     -0.243942+0.13858im      -0.0589548+0.0512959im     -0.186571-0.0555566im    -0.0684586+0.108108im    -0.0333967-0.0400986im     0.0738165-0.0948403im      0.143533-0.0283569im    -0.129992-0.0635733im    -0.0854535-0.067542im      0.154943+0.0935968im     -0.0700196+0.102576im    -0.0496689-0.0886894im   0.00208516+0.127162im    -0.0298226+0.135036im   -0.00639657-0.00326988im   -0.0454979+0.17874im      -0.170389+0.16113im        0.0569445+0.0940598im      -0.169951-0.0563246im     0.0914671+0.0575392im    0.0879315-0.114875im      -0.203459-0.012434im    -0.00135066+0.122745im     -0.153451+0.341472im    0.000600993-0.129758im      -0.0889661+0.0172561im     -0.061775-0.199369im       0.10012+0.160907im     -0.029061+0.106035im        0.049819-0.227127im   -0.0404537+0.302921im
    0.164136+0.174293im     -0.197996+0.10253im        0.201332-0.13965im      -0.0489454-0.192611im      -0.221177-0.194339im     0.0523278+0.0345097im    -0.0978968+0.0219586im    -0.0132588+0.12618im       0.016954+0.0209434im      0.155677+0.0847177im    0.0830261-0.0857604im     -0.0329243+0.0423427im    0.0790063+0.0758653im   -0.0164138+0.0270541im   0.00993894-0.217024im     -0.141655-0.00746703im     0.240985+0.0068061im   -0.0285361+0.054809im       -0.134621+0.249865im      -0.0671737-0.0410097im      0.122043+0.200104im    -0.0746952-0.0201746im    -0.0139389-0.0133218im     0.0166436-0.0851898im   -0.0862683+0.0387771im     -0.375253+0.0633338im       0.195014-0.00509639im     0.188113-0.0172255im     0.157321-0.0914872im   -0.0757881+0.0456169im       -0.06206+0.0971046im    0.128194+0.177164im
    0.128568-0.0504263im    0.0934887-0.135691im      0.0568557-0.15089im      -0.0180453+0.0100918im    -0.0511361-0.0900091im    0.0541805+0.0128061im     0.0231781-0.0409471im     -0.142265+0.0953758im   -0.0869483-0.167357im     -0.0954656+0.0807992im   0.00294692+0.0048389im     -0.0481997+0.020829im     0.0887947-0.0443026im    0.0895555+0.00707778im   0.0964697+0.129851im      0.155765-0.0747613im    0.00475695-0.0664265im    0.0399349-0.0911841im       0.147833+0.296026im     -0.00536839+0.18101im      -0.0498198-0.128946im      0.243299+0.0508153im      -0.02841-0.0617899im    -0.0290414-0.151716im      0.196658+0.0727632im     -0.298254-0.057289im        -0.34652+0.28093im       0.0091133-0.121809im     0.0365362+0.0218612im    -0.242253-0.174666im      0.00665284-0.158332im   -0.0208923-0.146175im
    0.202514-0.202083im     -0.122734+0.0543227im      0.303556-0.0342091im     0.0790499-0.0416728im     -0.070796+0.125472im     -0.052791-0.115115im       0.102959-0.224475im      0.0396659-0.019246im    0.00286022-0.0541573im      0.121786-0.15382im       0.106796+0.123398im      0.00106665-0.138395im     -0.225092+0.181433im      0.154175+0.0446966im    0.0323675-0.0646242im    0.0937754-0.0467256im   -0.00540693-0.0514486im     0.161029-0.0921985im    -0.00435059+0.0250125im      -0.114571-0.128047im      -0.113646-0.0786161im    -0.106544-0.172858im      0.0904777-0.196942im       0.181484+0.00194101im  0.00793398-0.1274im       -0.0917156+0.000634691im   -0.0782456+0.098773im      -0.353433+0.092791im    -0.0828168-0.194739im      0.140954+0.00757115im      0.179447+0.036564im    0.0136393+0.079246im
  -0.0587712-0.0474735im    -0.096611-0.0202707im      0.217664+0.0379im        0.0170968-0.0421424im      0.163594+0.0323078im    -0.181126+0.0141281im     0.0740067+0.134109im      -0.280193+0.0177028im    0.0496062+0.0308214im     -0.159777-0.0538066im   -0.0892617-0.103889im        0.013171-0.218908im    -0.0143492-0.12154im      0.0766374+0.0309212im    -0.125187-0.14146im       0.125951-0.180682im     -0.0197242-0.144157im    -0.0850888+0.14649im        0.0390377-0.0657541im     -0.0785465+0.113325im       0.102299-0.011786im      0.133417-0.0463756im      0.330273+0.00677143im   -0.0337689+0.077263im      -0.19742+0.0530182im     -0.138548+0.0416943im       0.196279+0.0665397im    -0.0709696-0.194614im     -0.307024+0.219528im    -0.0109884-0.00729295im      -0.12893-0.0407269im    0.185094+0.0245721im
  -0.0874842+0.0452756im    0.0122355+0.158677im     -0.0934384+0.0916529im      0.053442-0.195666im     0.00377936-0.0297384im    0.0714474-0.0540075im     0.0149441+0.0704575im    -0.0522735-0.123308im     0.0990481+0.0955977im      0.294375-0.0064415im   -0.0955491+0.0050246im     -0.0523212-0.0414888im    -0.109328+0.00124162im  -0.0680534-0.123129im    -0.0555487-0.135692im      0.096881+0.0314471im     0.0226032+0.115033im       0.13483-0.266536im       -0.223107+0.0755841im       0.100988+0.150034im     -0.0594856+0.0712419im    0.0388423-0.0359113im     -0.202184-0.019026im     -0.0660379+0.262089im      0.103161+0.23565im       0.0785083-0.0358638im       0.156199+0.172825im      -0.139715-0.133341im     -0.157283-0.00644843im   -0.257035-0.08048im         0.229771-0.103205im     0.186147-0.119554im
  -0.0672029+0.0199482im    -0.112687-0.179327im      0.0503211-0.143239im      -0.113946+0.0602376im     -0.153924+0.0265482im    -0.165116-0.100801im      0.0705392-0.0448059im     0.0764616+0.0379875im   -0.0836806+0.026763im       -0.25899+0.0854418im   -0.0374606-0.10914im       -0.0165611+0.0372528im    -0.141087+0.14638im      0.0219938+0.0349935im     0.101502-0.0230914im     0.229752-0.0438009im      -0.12847+0.0235587im     0.306647-0.145836im      -0.0757295+0.226757im       -0.142154-0.198762im      -0.042438+0.059448im     0.0200993+0.135246im     -0.0942116+0.0490977im     -0.259752+0.0895579im     0.226417-0.0599747im      0.148763-0.0943091im       0.135435-0.197065im      0.0445754-0.0357022im    -0.142863+0.0754484im   -0.0996698+0.0915646im      -0.197438+0.146222im     0.100377+0.087181im
  -0.0351445+0.0886304im     0.123313+0.261793im       0.188813-0.0489782im     -0.129516+0.129959im     -0.0722039-0.0148329im   -0.0542606+0.0143605im     0.0841577+0.231747im     -0.0135031-0.122999im     0.0873776-0.040159im     -0.0563943+0.108686im     -0.244152+0.181204im      -0.0766036+0.0470564im     0.044846+0.0470961im    -0.113673+0.056326im    -0.0327881+0.0374952im   -0.0698163-0.0496697im    -0.0798636+0.201739im   -0.00552441-0.0482064im        0.17088+0.104355im       0.0661086+0.046991im      0.0134469-0.0526805im    -0.265578-0.191366im     -0.0761124+0.0637681im    -0.0169738-0.206734im    -0.0358225-0.104528im      0.0467238-0.0747885im      0.0438396+0.0833881im    -0.0827032-0.172673im      -0.20275-0.0453074im   -0.0754842-0.282614im      -0.0557777+0.164175im    -0.221653+0.251639im</code></pre><p>and then generate the state <span>$ψ$</span></p><pre><code class="language-julia hljs">psi = P[:, 3]</code></pre><pre><code class="nohighlight hljs">32-element Vector{ComplexF64}:
  -0.06683302589652866 + 0.030722406402397297im
   0.06939813708942169 + 0.13220677642578643im
  -0.04996146320076963 - 0.07722910619174259im
   -0.1165557485153734 + 0.03023855930223604im
  0.030462274157930288 + 0.06488994695291429im
   0.12355720014121135 - 0.07177906135348229im
  -0.12683659782846415 - 0.22714183343217625im
  0.042974877931073976 + 0.01535876101308847im
  -0.15235867489999547 - 0.12339559638139425im
   0.05418954310508115 - 0.21095198897475043im
  -0.09551026180580363 + 0.1978866318828899im
  0.007786052399533512 - 0.18117241664808956im
  0.034926524717066684 + 0.18766716441224415im
  -0.13263910350519914 + 0.01015285591892831im
   0.03917955250518006 + 0.12302087636292165im
  -0.01947128899432969 - 0.10162728464332674im
  -0.06463671362492068 - 0.024481047209210106im
   0.14351782467016252 - 0.06004921958824329im
  -0.25332790923438436 + 0.25475252892567785im
 -0.025399144086333085 - 0.003793746346845338im
   0.05985876422018261 - 0.06228961118035625im
    0.1410876116073813 - 0.08062039709272595im
    0.1231549931166773 + 0.023797916306889207im
  -0.07552737049186278 + 0.03356114148949495im
  -0.07225591916663622 - 0.08965457989482468im
   0.11722744297383572 - 0.007214938108752313im
   0.02355584710569169 - 0.24965615423916654im
    0.0334165767247211 - 0.21301155831574015im
   0.05779331625811892 - 0.01636480146922517im
    0.4364878102234348 + 0.0im
   0.11989817716365335 - 0.08535913262324957im
   0.10936765648553304 - 0.1616603165152215im</code></pre><p>In the phase estimation process, we will feed the state to circuit and measure the first <code>n</code> qubits processed by iQFT.</p><pre><code class="language-julia hljs">r = join(ArrayReg(psi), zero_state(N))
r |&gt; PE(N, M, U)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 8/8
    nlevel: 2</code></pre><p>Since our phase can be represented by 3 qubits precisely, we only need to measure once</p><pre><code class="language-julia hljs">results = measure(r, 1:N; nshots=1)</code></pre><pre><code class="nohighlight hljs">1-element Vector{DitStr{2, 3, Int64}}:
 011 ₍₂₎</code></pre><p>Recall that our QFT&#39;s bit numbering is reversed, let&#39;s reverse it back</p><pre><code class="language-julia hljs">using BitBasis
estimated_phase = bfloat(results[]; nbits=N)</code></pre><pre><code class="nohighlight hljs">0.75</code></pre><p>the phase is exactly <code>0.75</code>!</p><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../1.prepare-ghz-state/index.html">« Prepare Greenberger–Horne–Zeilinger state with Quantum Circuit</a><a class="docs-footer-nextpage" href="../3.grover-search/index.html">Grover Search »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.4.1 on <span class="colophon-date" title="Thursday 30 May 2024 11:13">Thursday 30 May 2024</span>. Using Julia version 1.10.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
