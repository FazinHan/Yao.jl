<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Quantum Fourier Transformation and Phase Estimation · Documentation | Yao</title><meta name="title" content="Quantum Fourier Transformation and Phase Estimation · Documentation | Yao"/><meta property="og:title" content="Quantum Fourier Transformation and Phase Estimation · Documentation | Yao"/><meta property="twitter:title" content="Quantum Fourier Transformation and Phase Estimation · Documentation | Yao"/><meta name="description" content="Documentation for Documentation | Yao."/><meta property="og:description" content="Documentation for Documentation | Yao."/><meta property="twitter:description" content="Documentation for Documentation | Yao."/><script data-outdated-warner src="../../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../search_index.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script><link href="../../../assets/indigo.css" rel="stylesheet" type="text/css"/><link href="https://yaoquantum.org/assets/favicon-light.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../index.html"><img src="../../../assets/logo.png" alt="Documentation | Yao logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../../index.html">Documentation | Yao</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../../index.html">Home</a></li><li><a class="tocitem" href="../../../quick-start.html">Quick Start</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../../../man/registers.html">Quantum Registers</a></li><li><a class="tocitem" href="../../../man/blocks.html">Blocks</a></li><li><a class="tocitem" href="../../../man/symbolic.html">Symbolic Computation</a></li><li><a class="tocitem" href="../../../man/cuda.html">CUDA extension - CuYao</a></li><li><a class="tocitem" href="../../../man/plot.html">Quantum Circuit Visualization</a></li><li><a class="tocitem" href="../../../man/automatic_differentiation.html">Automatic Differentiation</a></li><li><a class="tocitem" href="../../../man/simplification.html">Simplification</a></li><li><a class="tocitem" href="../../../man/bitbasis.html">BitBasis</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../1.prepare-ghz-state/index.html">Prepare Greenberger–Horne–Zeilinger state with Quantum Circuit</a></li><li class="is-active"><a class="tocitem" href="index.html">Quantum Fourier Transformation and Phase Estimation</a><ul class="internal"><li><a class="tocitem" href="#Quantum-Fourier-Transformation"><span>Quantum Fourier Transformation</span></a></li><li><a class="tocitem" href="#Wrap-QFT-to-an-external-block"><span>Wrap QFT to an external block</span></a></li><li><a class="tocitem" href="#Phase-Estimation"><span>Phase Estimation</span></a></li></ul></li><li><a class="tocitem" href="../3.grover-search/index.html">Grover Search</a></li><li><a class="tocitem" href="../4.shor-algorithm/index.html">Shor&#39;s Algorithm</a></li><li><a class="tocitem" href="../5.shor-9-code/index.html">Shor&#39;s 9 qubit code</a></li><li><a class="tocitem" href="../6.quantum-circuit-born-machine/index.html">Quantum Circuit Born Machine</a></li><li><a class="tocitem" href="../7.variation-quantum-eigen-solver/index.html">Variational Quantum Eigen Solver</a></li><li><a class="tocitem" href="../8.riemannian-gradient-flow/index.html">Riemannian gradient flow optimizer</a></li></ul></li><li><a class="tocitem" href="../../../performancetips.html">Performance Tips</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href="index.html">Quantum Fourier Transformation and Phase Estimation</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="index.html">Quantum Fourier Transformation and Phase Estimation</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/QuantumBFS/Yao.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/QuantumBFS/Yao.jl/blob/master/docs/src/examples/2.qft-phase-estimation/main.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><p><a href="/generated/examples/2.qft-phase-estimation/main.ipynb"><img src="https://mybinder.org/badge_logo.svg" alt/></a></p><h1 id="example-qft"><a class="docs-heading-anchor" href="#example-qft">Quantum Fourier Transformation and Phase Estimation</a><a id="example-qft-1"></a><a class="docs-heading-anchor-permalink" href="#example-qft" title="Permalink"></a></h1><p>Let&#39;s use Yao first</p><pre><code class="language-julia hljs">using Yao</code></pre><h2 id="Quantum-Fourier-Transformation"><a class="docs-heading-anchor" href="#Quantum-Fourier-Transformation">Quantum Fourier Transformation</a><a id="Quantum-Fourier-Transformation-1"></a><a class="docs-heading-anchor-permalink" href="#Quantum-Fourier-Transformation" title="Permalink"></a></h2><p>The Quantum Fourier Transformation (QFT) circuit is to repeat two kinds of blocks repeatly:</p><p><img src="assets/qft.png" alt="qft-circuit"/></p><p>The basic building block control phase shift gate is defined as</p><p class="math-container">\[R(k)=\begin{bmatrix}
1 &amp; 0\\
0 &amp; \exp\left(\frac{2\pi i}{2^k}\right)
\end{bmatrix}\]</p><p>Let&#39;s define block <code>A</code> and block <code>B</code>, block <code>A</code> is actually a control block.</p><pre><code class="language-julia hljs">A(i, j) = control(i, j=&gt;shift(2π/(1&lt;&lt;(i-j+1))))</code></pre><pre><code class="nohighlight hljs">A (generic function with 1 method)</code></pre><p>Once you construct the blockl you can inspect its matrix using <code>mat</code> function. Let&#39;s construct the circuit in dash box A, and see the matrix of <span>$R_4$</span> gate.</p><pre><code class="language-julia hljs">R4 = A(4, 1)</code></pre><pre><code class="nohighlight hljs">(n -&gt; control(n, 4, 1 =&gt; shift(0.39269908169872414)))</code></pre><p>If you have read about <a href="@ref tutorial-ghz">preparing GHZ state</a>, you probably know that in Yao, we could just leave the number of qubits, and it will be evaluated when possible.</p><pre><code class="language-julia hljs">R4(5)</code></pre><pre><code class="nohighlight hljs">nqubits: 5
control(4)
└─ (1,) shift(0.39269908169872414)</code></pre><p>its matrix will be</p><pre><code class="language-julia hljs">mat(R4(5))</code></pre><pre><code class="nohighlight hljs">32×32 Diagonal{ComplexF64, Vector{ComplexF64}}:
 1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im</code></pre><p>Then we repeat this control block over and over on different qubits, and put a Hadamard gate to <code>i</code>th qubit to construct <code>i</code>-th <code>B</code> block.</p><pre><code class="language-julia hljs">B(n, k) = chain(n, j==k ? put(k=&gt;H) : A(j, k) for j in k:n)</code></pre><pre><code class="nohighlight hljs">B (generic function with 1 method)</code></pre><p>We need to input the total number of qubits <code>n</code> here because we have to iterate through from <code>k</code>-th location to the last.</p><p>Now, let&#39;s construct the circuit by chaining all the <code>B</code> blocks together</p><pre><code class="language-julia hljs">qft(n) = chain(B(n, k) for k in 1:n)
qft(4)</code></pre><pre><code class="nohighlight hljs">nqubits: 4
chain
├─ chain
│  ├─ put on (1)
│  │  └─ H
│  ├─ control(2)
│  │  └─ (1,) shift(1.5707963267948966)
│  ├─ control(3)
│  │  └─ (1,) shift(0.7853981633974483)
│  └─ control(4)
│     └─ (1,) shift(0.39269908169872414)
├─ chain
│  ├─ put on (2)
│  │  └─ H
│  ├─ control(3)
│  │  └─ (2,) shift(1.5707963267948966)
│  └─ control(4)
│     └─ (2,) shift(0.7853981633974483)
├─ chain
│  ├─ put on (3)
│  │  └─ H
│  └─ control(4)
│     └─ (3,) shift(1.5707963267948966)
└─ chain
   └─ put on (4)
      └─ H
</code></pre><h2 id="Wrap-QFT-to-an-external-block"><a class="docs-heading-anchor" href="#Wrap-QFT-to-an-external-block">Wrap QFT to an external block</a><a id="Wrap-QFT-to-an-external-block-1"></a><a class="docs-heading-anchor-permalink" href="#Wrap-QFT-to-an-external-block" title="Permalink"></a></h2><p>In most cases, <code>function</code>s are enough to wrap quantum circuits, like <code>A</code> and <code>B</code> we defined above, but sometimes, we need to dispatch specialized methods on certain kinds of quantum circuit, or we want to define an external block to export, thus, it&#39;s useful to be able to wrap circuit to custom blocks.</p><p>First, we define a new type as subtype of <code>PrimitiveBlock</code> since we are not going to use the subblocks of <code>QFT</code>, if you need to use its subblocks, it&#39;d be better to define it under <code>CompositeBlock</code>.</p><pre><code class="language-julia hljs">struct QFT &lt;: PrimitiveBlock{2}
    n::Int
end

YaoBlocks.nqudits(q::QFT) = q.n</code></pre><p>Now, let&#39;s define its circuit</p><pre><code class="language-julia hljs">circuit(q::QFT) = qft(q.n)</code></pre><pre><code class="nohighlight hljs">circuit (generic function with 1 method)</code></pre><p>And forward <code>mat</code> to its circuit&#39;s matrix</p><pre><code class="language-julia hljs">YaoBlocks.mat(::Type{T}, x::QFT) where T = mat(T, circuit(x))</code></pre><p>You may notice, it is a little ugly to print <code>QFT</code> at the moment, this is because we print the type summary by default, you can define your own printing by overloading <code>print_block</code></p><pre><code class="language-julia hljs">YaoBlocks.print_block(io::IO, x::QFT) = print(io, &quot;QFT($(x.n))&quot;)</code></pre><p>Since it is possible to use FFT to simulate the results of QFT (like cheating), we could define our custom <code>apply!</code> method:</p><pre><code class="language-julia hljs">using FFTW, LinearAlgebra

function YaoBlocks.apply!(r::ArrayReg, x::QFT)
    α = sqrt(length(statevec(r)))
    invorder!(r)
    lmul!(α, ifft!(statevec(r)))
    return r
end</code></pre><p>Now let&#39;s check if our <code>apply!</code> method is correct:</p><pre><code class="language-julia hljs">r = rand_state(5)
r1 = r |&gt; copy |&gt; QFT(5)
r2 = r |&gt; copy |&gt; circuit(QFT(5))
r1 ≈ r2</code></pre><pre><code class="nohighlight hljs">true</code></pre><p>We can get iQFT (inverse QFT) directly by calling <code>adjoint</code></p><pre><code class="language-julia hljs">QFT(5)&#39;</code></pre><pre><code class="nohighlight hljs"> [†]QFT(5)</code></pre><p>QFT and iQFT are different from FFT and IFFT in three ways,</p><ol><li>they are different by a factor of <span>$\sqrt{2^n}$</span> with <span>$n$</span> the number of qubits.</li><li>the <a href="https://quantumbfs.github.io/BitBasis.jl/stable/tutorial/#Conventions-1">bit numbering</a> will exchange after applying QFT or iQFT.</li><li>due to the convention, QFT is more related to IFFT rather than FFT.</li></ol><h2 id="Phase-Estimation"><a class="docs-heading-anchor" href="#Phase-Estimation">Phase Estimation</a><a id="Phase-Estimation-1"></a><a class="docs-heading-anchor-permalink" href="#Phase-Estimation" title="Permalink"></a></h2><p>Since we have QFT and iQFT blocks we can then use them to realize phase estimation circuit, what we want to realize is the following circuit:</p><p><img src="assets/phaseest.png" alt="phase estimation"/></p><p>First we call Hadamard gates repeatly on first <code>n</code> qubits.</p><pre><code class="language-julia hljs">Hadamards(n) = repeat(H, 1:n)</code></pre><pre><code class="nohighlight hljs">Hadamards (generic function with 1 method)</code></pre><p>Then in dashed box <code>B</code>, we have controlled unitaries:</p><pre><code class="language-julia hljs">ControlU(n, m, U) = chain(n+m, control(k, n+1:n+m=&gt;matblock(U^(2^(k-1)))) for k in 1:n)</code></pre><pre><code class="nohighlight hljs">ControlU (generic function with 1 method)</code></pre><p>each of them is a <code>U</code> of power <span>$2^{(k-1)}$</span>.</p><p>Since we will only apply the qft and Hadamard on first <code>n</code> qubits, we could use <code>Subroutine</code>, which creates a context of a sub-scope of the qubits.</p><pre><code class="language-julia hljs">PE(n, m, U) =
    chain(n+m, # total number of the qubits
        subroutine(Hadamards(n), 1:n), # apply H in local scope
        ControlU(n, m, U),
        subroutine(QFT(n)&#39;, 1:n))</code></pre><pre><code class="nohighlight hljs">PE (generic function with 1 method)</code></pre><p>we use the first <code>n</code> qubits as the output space to store phase <span>$ϕ$</span>, and the other <code>m</code> qubits as the input state which corresponds to an eigenvector of oracle matrix <code>U</code>.</p><p>The subroutine here uses <code>focus!</code> and <code>relax!</code> to manage a local scope of quantum circuit, and only activate the first <code>n</code> qubits while applying the block inside the subroutine context, and the scope will be <code>relax!</code>ed back, after the context. This is equivalent to manually <code>focus!</code> then <code>relax!</code></p><p>fullly activated</p><pre><code class="language-julia hljs">r = rand_state(5)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 5/5
    nlevel: 2</code></pre><p>first 3 qubits activated</p><pre><code class="language-julia hljs">focus!(r, 1:3)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 3/5
    nlevel: 2</code></pre><p>relax back to the original</p><pre><code class="language-julia hljs">relax!(r, 1:3)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 5/5
    nlevel: 2</code></pre><p>In this way, we will be able to apply small operator directly on the subset of the qubits.</p><p>Details about the algorithm can be found here: <a href="https://en.wikipedia.org/wiki/Quantum_phase_estimation_algorithm">Quantum Phase Estimation Algorithm</a></p><p>Now let&#39;s check the results of our phase estimation.</p><p>First we need to set up a unitary with known phase, we set the phase to be 0.75, which is <code>0.75 * 2^3 == 6 == 0b110</code> .</p><pre><code class="language-julia hljs">N, M = 3, 5
P = eigen(rand_unitary(1&lt;&lt;M)).vectors
θ = Int(0b110) / 1&lt;&lt;N
phases = rand(1&lt;&lt;M)
phases[0b010+1] = θ
U = P * Diagonal(exp.(2π * im * phases)) * P&#39;</code></pre><pre><code class="nohighlight hljs">32×32 Matrix{ComplexF64}:
 -0.0623505+0.0830042im        0.1201-0.0222898im    -0.0857866+0.149657im     0.00125651-0.190937im      -0.014517-0.044842im       0.109647-0.0532808im    -0.232728-0.139278im      -0.188807-0.225614im     -0.149562-0.0199802im      0.312083+0.0395301im    -0.0816441+0.0902688im   0.0396142-0.0406909im      0.0400041-0.0986812im     -0.222028+0.0440387im    -0.0532366+0.0626527im    -0.0165492+0.152557im     -0.128503-0.0693279im       0.178983+0.0228463im     -0.133218+0.00288688im    -0.101078-0.042665im     0.0483726+0.0430313im      0.108811-0.014489im     0.0364741-0.243398im   -0.0146962+0.152196im        0.084512-0.0416489im    -0.0907407+0.183669im      0.0780492+0.120283im       -0.238783+0.0851733im    0.0930742-0.346549im      -0.074042+0.107463im      0.0971235-0.14313im     0.0492874+0.0238624im
   0.155905+0.121729im       0.278532+0.18701im      -0.0177894+0.0342321im      0.168775-0.0507821im     -0.173192+0.16074im     -0.00821099-0.0284216im    0.0707376-0.00189637im    0.0429194+0.143346im     -0.201719-0.161876im      0.0288941+0.0461616im       0.14888-0.0400868im    0.141751+0.0212809im      0.0840024-0.0559408im    -0.0657228-0.0719553im     0.0272738+0.0851724im      0.263079-0.142167im      0.290062+0.10333im        -0.170052+0.0839928im       0.11688-0.116136im      -0.168918+0.012751im      0.171209+0.0841821im      0.161407+0.0856078im    -0.131662+0.0901269im  -0.0589981+0.0394914im     -0.0495079-0.0957557im    0.00562368+0.176756im      0.0472806+0.0877135im      -0.160232-0.149079im     -0.158257+0.128614im      0.0649208+0.114187im      0.0474702-0.197023im   -0.0656306-0.092384im
  -0.191593-0.144061im    -0.00158167+0.0142219im     -0.101797+0.271284im       0.120342-0.145462im      0.0888649-0.0175113im      0.206796-0.17662im      0.0282739+0.247631im      0.0866821-0.0448939im    0.0240182+0.25551im      -0.0393957+0.0116726im     0.0329966-0.225244im     0.015531-0.130175im      0.00932337+0.0081342im     0.0150833+0.0592311im     -0.101615-0.119537im       0.136029-0.142743im    -0.0765518-0.0174051im      -0.108456+0.0434585im   -0.00512758+0.0351691im   -0.00998199-0.0945343im    -0.229984+0.367364im      0.0664391+0.172602im      0.016159-0.0284468im    0.149895+0.106183im      -0.0329698-0.00542793im   -0.0908557+0.0575013im      0.139739+0.166055im        0.111823+0.114664im     -0.035048+0.177465im      -0.198122+0.10125im      -0.0245879+0.0722387im  -0.0620303-0.0258533im
 -0.0979963+0.033213im       -0.15232-0.0797921im    -0.0471111+0.111876im        0.16714-0.0254658im     0.0352291-0.286953im        0.23899-0.113403im     -0.125256-0.129819im     -0.0910439+0.209175im     0.0420872-0.100283im       0.185464-0.16742im      -0.0494274+0.0250098im  -0.0710288-0.0350036im      -0.177354-0.0973332im     0.0899214+0.0271697im      0.061804-0.212942im      0.0812605-0.0480808im     0.214877-0.147579im       0.0702699+0.130498im      0.0382153+0.0303535im      -0.18793+0.00416708im   0.0685627-0.0937847im       0.21048+0.0249438im    -0.189112+0.219578im    -0.158555-0.130283im        0.183668-0.070077im     -0.0264691+0.0955596im     -0.183419-0.0330817im      0.0990449-0.0338053im     0.103604+0.0102148im    -0.0680063-0.113205im      -0.106405+0.195718im    0.0134806-0.0493457im
 -0.0583909-0.076221im      0.0206476-0.120185im      0.0516015-0.26128im        0.138205+0.294191im      0.0125614-0.210406im     0.00575075+0.0054787im    -0.018045+0.0541432im     0.0748748-0.0767455im    -0.112383-0.00494463im    0.0786622+0.180179im      0.0229556-0.149364im   -0.0989504+0.138931im       -0.173112+0.0322746im     0.0456848-0.0624455im      0.128354-0.0240328im      0.025243-0.0363525im    -0.189188+0.0294079im      0.0416803-0.0391764im    -0.0282776+0.068028im      0.0321104-0.177196im      0.215858+0.214992im       0.101844-0.0824509im    0.0762306+0.338494im    0.0120043+0.125472im        0.147896-0.119297im      0.0477972-0.0566281im      0.205339+0.245348im       -0.101752+0.0319881im    -0.154489-0.119968im       0.166985+0.0231416im     -0.112826-0.0233162im    0.118396+0.0865566im
  -0.102107+0.0386102im      0.110566-0.200018im    -0.00131297+0.159863im       0.116335+0.0200574im      0.103964-0.0571517im     0.0763956-0.183236im     -0.100514-0.0950641im   -0.00657238+0.127138im     -0.499367-0.0115287im     -0.121238+0.04197im       0.0796619+0.0903724im    0.031396+0.0274577im        0.15361-0.0270283im     0.0332339-0.0757156im     -0.153332-0.0890306im     -0.214437-0.0415856im    -0.166001+0.151161im      -0.0141705+0.0805024im      0.173913+0.119018im      0.0963555-0.123818im      0.116806-0.0873641im     -0.158223+0.0058092im    0.0188678+0.0686179im   0.0438972-0.0649983im     -0.0757182+0.0838291im    -0.0114432+0.00552946im   -0.0828525-0.052584im         0.34998-0.105256im     0.0444724-0.061914im      0.0306813+0.0368647im    -0.0340607-0.245483im   -0.0527344+0.0537594im
 -0.0555321+0.00960274im    0.0580087+0.0525361im    -0.0288044-0.0115786im    -0.0549089+0.0681246im    -0.0297894+0.0972518im     -0.114345-0.0566159im    0.0176674+0.0565541im   -0.00808221+0.0127789im   -0.0642135-0.0218732im      0.223201-0.0516342im     -0.134113-0.225202im      0.17872-0.147568im      -0.0632162+0.101746im     -0.0541841-0.0870953im      0.162231-0.318888im      -0.111731-0.0251963im    -0.003499-0.21019im       -0.0870776+0.11175im        0.209368+0.167822im       0.139045-0.00758721im   -0.144683+0.0349617im    -0.0586163-0.0437572im    -0.136497-0.104835im     0.129288-0.0728982im     -0.0656215+0.0701086im    -0.0758554+0.0266506im    -0.0151414-0.122452im       -0.117027-0.324906im     -0.227392-0.261386im       0.196676+0.102323im      0.0263372+0.207903im     -0.05165+0.0739294im
   0.301853+0.186927im        0.15419-0.140622im      -0.083574+0.201981im      -0.173674+0.17429im      -0.0793122+0.0129557im     0.0156878+0.152085im      0.123117+0.170488im     -0.0151671-0.133673im    -0.0272717+0.0252329im     0.0839469-0.0507718im    -0.0830653+0.0475128im   -0.174621-0.0119652im      -0.117205-0.0654788im    -0.0270167-0.0277692im     0.0629242+0.0626215im      0.155844-0.114876im    -0.0718266-0.0440648im      0.0608961+0.0477931im      0.214615-0.0335302im     -0.149662-0.0611278im   -0.0274116-0.165461im      -0.208819+0.290258im      0.134452+0.218506im     0.158242+0.069361im        0.141391-0.0872702im     -0.174489-0.0489897im     0.0529147-0.0319048im       0.104661+0.0129261im     0.161212-0.112291im     -0.0298894+0.0606014im      0.101431+0.119698im    -0.181018+0.0147202im
 -0.0412002-0.163652im      0.0812366+0.0250546im    -0.0337223-0.271241im        0.11803-0.0422578im      0.153782+0.0728667im    -0.0629873+0.201661im    -0.0421867-0.00881433im   -0.0495517+0.04253im       0.252083-0.048204im    -0.00680222-0.150842im       0.145492+0.1554im       0.248342-0.23227im        -0.155055-0.117484im       -0.17246+0.00169814im    -0.358562+0.0686487im    -0.0923282-0.0216933im   -0.0445731+0.115878im       0.0026751+0.199333im      0.0967977+0.106492im     -0.0206366+0.0694181im    0.0234586+0.0206842im     0.0413123+0.0577153im      0.10165+0.105215im    0.0749586+0.23859im        0.0552298-0.138942im    -0.00844422+0.088988im     -0.0871164+0.0215097im       0.196683-0.0283819im    0.0291107-0.100697im       0.146612+0.17216im      -0.0891639+0.0999382im  -0.0231114-0.0715956im
    -0.1863+0.0121214im     -0.197314-0.131784im     -0.0291242+0.00747091im      0.10023+0.0238683im   -0.00252925+0.183929im      -0.157442+0.121985im       0.25175-0.0901092im      0.209162+0.161011im     -0.231495-0.00916322im    0.0166674-0.0959765im    -0.0199074-0.135019im    0.0565745+0.0902833im    -0.00774794+0.0496143im      0.067853-0.0464737im    -0.0691114+0.255248im       0.145276-0.108449im     -0.110162-0.124056im       0.0543961-0.0081585im      0.115957-0.0319225im     -0.240213+0.0570961im    0.0792072+0.180474im     -0.0510581+0.0227066im    -0.141168-0.193522im    0.0912414+0.0297426im     0.00826763-0.05417im       0.0039705-0.125251im      -0.247334-0.0378243im     -0.0495511+0.17764im       0.106492-0.267743im     -0.0735493-0.0232957im     -0.123837+0.0848401im    0.171719-0.081071im
 -0.0936119-0.294587im      0.0431155-0.00203959im   0.00325397+0.100496im     -0.0661089+0.00254453im    -0.171089+0.0876204im      -0.12819-0.0257092im    -0.207778+0.166789im     -0.0941884-0.126986im     0.0652528+0.036687im       0.150133-0.0213739im        0.0792+0.253429im   -0.0815271+0.0496925im     -0.0699795+0.0137109im     -0.122295-0.194719im       0.185914+0.0658139im      0.053323-0.329237im     -0.076013+0.0944219im       0.141398+0.178264im      0.0403732-0.0950257im     0.0767027-0.0539561im     0.087313+0.160091im      -0.134678-0.152118im    -0.0895217-0.160051im   -0.0108975-0.111666im       0.0336532-0.0823948im    -0.0444208-0.0616869im     -0.175255+0.16918im         0.077053-0.158791im     0.0529862+0.128136im      0.0531207-0.26478im      -0.0248104-0.0149096im  0.00292589-0.13382im
  0.0771844-0.035393im       0.176645+0.0646288im      0.143057+0.0394742im     0.0488841+0.0776396im     0.0224559-0.294446im       0.180471-0.110517im      0.145645+0.0805906im     0.0471372-0.112824im     0.0762596+0.0700856im    -0.0110172-0.147982im      0.0388206-0.0898482im    0.290489+0.00601546im    -0.0842123+0.107738im       0.152685+0.1153im       -0.0811556+0.135463im      0.0339274+0.116103im     -0.132325-0.173016im      -0.0779837+0.0934947im    -0.0522402-0.078465im      0.0559359-0.0856493im     0.158569-0.0776304im     -0.218564+0.0185557im    -0.020805-0.195089im    -0.249436-0.187412im       -0.143478-0.256249im      -0.154643-0.0538428im    -0.0790156+0.0574555im     -0.0879408+0.0525059im    0.0549846-0.00924396im     0.180817+0.0132208im     -0.144098-0.067355im    -0.184515-0.0744459im
   0.188186+0.0523724im    0.00188407-0.00506794im   -0.0426385+0.0821046im     0.0881613-0.062574im      -0.160705+0.00509858im     0.045282+0.0683007im   -0.0325559+0.0605692im     0.0430351+0.219558im      0.192663+0.0295379im     -0.105105-0.173084im     -0.0250609+0.0479595im    0.126123-0.0476137im      0.0259848+0.208045im     -0.0300665-0.118258im       0.201257+0.145935im      -0.249329+0.0850777im    -0.143974-0.192275im      -0.0680868+0.119681im      -0.213283+0.0375778im     -0.078483-0.394905im     0.0691294-0.00141545im     0.204139+0.0136087im   0.00197345+0.0659458im    0.276692+0.0403547im       0.123822+0.179568im      0.0383398-0.0981789im    -0.0888247-0.00663972im   -0.00217069-0.0663931im   -0.0324342-0.0279663im     -0.113608+0.00234582im   -0.0476936-0.212233im   -0.0295674-0.12347im
  -0.135927-0.0726598im     0.0641788-0.115378im      0.0139453+0.181048im    -0.00276287-0.0997006im    -0.0155761-0.140306im       -0.12681+0.234704im      0.183925+0.174726im     -0.0194691-0.07655im      -0.126625-0.095558im       0.170032+0.261787im      -0.120009+0.258318im     0.197367-0.106925im       0.0250456+0.186386im        0.25133+0.111059im     -0.0069844-0.0054545im   -0.00764455-0.118049im     0.0531246+0.0847074im       0.106989-0.211639im      -0.169261-0.0461684im    0.00692475-0.0740227im    -0.084787-0.0521754im     0.0527504-0.0459358im    0.0969704+0.111187im   -0.0828333+0.019664im       0.0589927+0.0814988im      0.120369+0.0935844im     -0.252279-0.0299632im     -0.0295439-0.025632im     -0.170294+0.0279972im    -0.0157827+0.229964im     -0.0914192+0.100392im    -0.120509-0.116003im
   0.179195+0.0587307im     -0.122029+0.0364488im     -0.175035-0.234013im      -0.119351-0.156752im       0.317739-0.141887im      0.0235537-0.00465957im    0.199809+0.287278im     -0.0808172+0.0265679im    -0.196304+0.00885215im    -0.069344-0.00418447im   -0.0273404+0.154316im    -0.146177+0.0712317im      0.0554306-0.0245864im    -0.0309323-0.139127im     -0.0604821-0.02764im       0.0438827-0.208768im     -0.176878+0.0458933im      -0.240259+0.193752im      -0.157675+0.0970547im    -0.0493785-0.0896086im   -0.0277021-0.16475im        0.140052+0.0355253im   -0.0687769-0.173695im    -0.085732-0.0892929im     -0.0431063-0.0457301im      0.173844+0.0969751im      0.086479+0.0790383im      -0.118801-0.125318im     0.0467373-0.0981782im    -0.0339982-0.0406216im   -0.00945775+0.141881im    0.0614296-0.0782834im
  -0.125684+0.022973im      0.0939443+0.192374im     -0.0713551+0.0634622im      0.101629+0.0880453im     0.0184124+0.200825im       0.155378+0.180788im    -0.0270601+0.0495728im      0.142044-0.00937254im    0.146083+0.137169im      0.0836621-0.0345702im   -0.00375986+0.1397im      -0.135356+0.158446im       0.0902174-0.138149im       0.130271-0.0471778im      -0.13204-0.0985262im      0.192706+0.0364168im   -0.0402284-0.11834im          0.21861-0.0709735im    -0.0139898-0.00590826im    -0.120044-0.176012im    -0.0368714-0.0245413im      0.168048-0.0624132im   0.00488573+0.032951im   -0.0991324-0.0623863im       -0.36529+0.19361im        0.163099-0.0733297im      0.143279-0.0165754im       0.139765-0.0881422im    0.0335326-0.232948im       0.233808-0.0610006im    -0.0883695-0.0322346im   -0.168515-0.0365375im
  -0.060168+0.30579im       0.0581795-0.0161203im     -0.049164-0.00341929im   0.00170918+0.424234im      -0.003539+0.0769188im    -0.0864154-0.0198807im   -0.0903916-0.0399334im     0.0152753+0.021616im     -0.112449-0.0522726im    -0.0691087+9.03265e-5im    -0.172435-0.0921329im   0.0109607-0.181574im       -0.149474-0.00962179im    -0.153067-0.16933im       -0.160896+0.0699414im    -0.0663016-0.12022im      0.0478364+0.0446217im        0.15418+0.00219962im    -0.247204-0.0152343im    -0.0371926-0.0449529im    -0.221186-0.030277im        0.20019-0.0699782im   0.00947612-0.260135im    -0.130424-0.106006im        0.112496-0.18447im      -0.0204872-0.118725im       0.100063-0.0202065im        0.14344+0.0248425im    -0.129226+0.163362im     -0.0783882+0.0366626im      -0.14987-0.0080803im   -0.161812-0.0302148im
   0.137297-0.0319999im    -0.0836856-0.0601227im    -0.0289649-0.0118321im     0.0761139-0.0527396im     -0.170243+0.104862im      0.0946669-0.0588006im    0.0325503+0.00771024im   -0.0914565-0.232668im     0.0286082-0.0309352im    -0.0773501-0.0310512im      0.090797+0.0123072im   0.0169524-0.0708466im       0.288012-0.107204im       0.134638+0.0956766im      -0.27149+0.0655362im     0.0348649-0.232805im      0.142715-0.113255im        0.236251-0.0242899im    -0.0327118+0.215349im       0.288226-0.0840043im    0.0801642-0.119159im       0.114329+0.070593im     -0.136102+0.0886927im   0.0997014-0.151594im        0.058449-0.119989im      -0.144119-0.291904im       0.037967+0.0129497im       -0.12087-0.0926967im    -0.110544-0.0642661im    -0.0868814+0.0800178im    -0.0795053+0.0459968im    0.228934+0.0381309im
 0.00995946-0.0412992im     0.0788861-0.0826524im      0.134684-0.0632382im      0.109864-0.14114im      -0.0694188-0.00550657im    -0.156272+0.0250541im     0.115236-0.220536im    -0.00399759+0.0379054im    0.0509932-0.0177219im      0.256975+0.153191im      0.0608959+0.0135898im   -0.133674-0.166508im       -0.251708+0.0555376im     -0.221252+0.213058im     -0.0857981+0.01401im         0.12941-0.0135211im    -0.186828-0.107364im       -0.216621-0.104348im       0.114895+0.148785im      0.0481294-0.0120535im   -0.0322613-0.0915081im     0.0607016+0.0897522im    0.0173924+0.0209446im  -0.0752918-0.270752im       -0.106822+0.0399146im      0.140718-0.235898im      0.0794085+0.139416im        0.102954-0.0617853im   -0.0680419-0.0233571im     -0.276655-0.0829754im     0.0741588-0.144892im   -0.0784666-0.133373im
    0.10072-0.00204551im   -0.0629846-0.0777308im    9.19449e-6+0.00605085im    -0.041032+0.0913763im     0.0314696+0.12936im       0.0378805-0.041861im     0.0478447-0.0959883im     -0.323406-0.0836607im   -0.0234966+0.0981963im    -0.0356246+0.159519im        0.18224-0.120641im   -0.0120049+0.165663im       0.0305074+0.159716im     -0.0740782-0.0833215im     -0.140139-0.061201im       0.181386+0.22392im      -0.101672-0.0728343im      0.0107739+0.0471888im      0.137479-0.192723im       0.161696-0.0786082im     0.224273-0.0700987im      0.206164-0.21785im     -0.0868832-0.048489im     0.124603+0.148227im     -0.00339148+0.0174448im     0.0733787+0.0350421im      -0.17249-0.00125528im     0.0368973+0.00878717im  -0.0265164+0.0939069im     -0.172844+0.0617493im    -0.0645328+0.287238im    -0.316622-0.0321333im
 -0.0371302+0.193802im       0.213163-0.0472448im     -0.069795+0.03723im       -0.132475+0.0353027im     0.0319589-0.181842im     -0.0884458+0.132362im     0.0288852+0.0487648im    -0.0381989+0.177449im     0.0990211+0.0937501im     0.0376273-0.0281868im      0.120867+0.0499719im     0.14146+0.0478879im       0.250594+0.223016im      -0.221876-0.110446im      0.0577014+0.0736399im      0.117374-0.0413843im   -0.0307452-0.0822266im      0.0306762-0.0718819im      0.188695+0.0737398im      0.162487+0.129903im    -0.0852694+0.039602im       0.231587-0.0843652im     0.160879+0.0898021im   -0.062615-0.236381im      -0.0782097+0.0822839im     -0.214252+0.169364im     0.00836149+0.120857im       0.0635799+0.15441im       0.113005+0.00261549im   -0.0104919-0.0542459im     -0.199393+0.0454816im    0.242398+0.162522im
   0.006313+0.00915538im    -0.194876-0.0563811im     -0.306109+0.179178im      0.0464425+0.038417im      -0.168753-0.0818926im     -0.138015+0.148981im     0.0814753+0.15358im       -0.140294+0.144656im    0.00998611-0.0456948im      -0.04786-0.00165565im    0.0168152-0.0685357im  -0.0124844-0.084928im      -0.0955576-0.354316im      0.0135415+0.00833276im    0.0123426-0.133034im      0.0145101+0.0679261im    -0.254867-0.0624334im     -0.0634634-0.0276993im     -0.146731-0.0551927im      0.059668+0.322885im      0.249939+0.0151483im     0.0951492+0.0204992im    0.0622969-0.0602542im  -0.0948554+0.0518688im       -0.11141+0.150226im      -0.188052-0.158724im     -0.0779592+0.0996227im     -0.0310014-0.127076im    -0.0119733+0.125826im       0.100579+0.131363im     -0.0280226-0.141499im   -0.0206446+0.130188im
  0.0521814+0.176123im     -0.0109533-0.0575034im      0.257076+0.0313376im     0.0588184+0.0436946im     -0.047067-0.108249im       0.148555+0.0516515im   -0.0791869+0.104854im     -0.0876295-0.118265im     0.0522813-0.274319im       0.166391+0.0262198im     -0.100064-0.20933im    -0.0367253+0.165737im       0.0732723-0.0815167im     -0.094596-0.0292103im    -0.0660388-0.00715285im    -0.132202+0.00219414im   -0.113713+0.15728im     -0.000363635+0.148675im      0.0386848-0.0309976im    -0.0648768+0.12262im      -0.268677-0.0520863im    0.00970278+0.0119506im   -0.0544649+0.0988897im    0.212919+0.0604585im      -0.365205+0.0476373im     0.0944414-0.113885im      -0.208685+0.119469im       -0.107647+0.0373995im    0.0596506+0.144557im      0.0422163+0.0527342im     -0.156907-0.0132211im    0.156611-0.234619im
  -0.181553-0.102247im      -0.133023+0.275818im      0.0757234-0.00695433im      0.07323+0.159395im      0.0320722-0.00389793im   -0.0148223-0.0894186im     0.236148+0.105247im     -0.0330309-0.178488im    -0.0996729-0.00339585im     0.107911-0.242665im      -0.146796-0.0924255im   -0.171507+0.023252im        0.207208-0.0772655im     -0.252037+0.157183im        0.11144+0.25671im       0.0780766+0.0236696im    0.0513104-0.11594im       -0.0102121+0.127058im     -0.0186951+0.171715im      0.0873035+0.0213649im    0.0266963-0.130698im    -0.00587402-0.0302724im      0.20345+0.108972im   -0.0841915+0.145314im       0.0804349+0.092837im      0.0438026+0.159864im      -0.195182-0.0456695im       0.122033-0.0680796im    -0.165966+0.0364113im    -0.0905093-0.0466555im    -0.0920206-0.144925im   -0.0850985+0.0768056im
  -0.113308-0.051233im      0.0944867-0.0556566im      0.124019+0.165385im        0.29663+0.101673im      0.0177537-0.0524148im     -0.332089+0.174012im      -0.12896+0.087967im     -0.0674153-0.196071im      -0.10323+0.00451511im   -0.0699164-0.104733im       0.214504-0.0970768im   0.0239927+0.0890451im       0.101508+0.000898131im    0.215636+0.0432593im   -0.00697031+0.110596im     -0.0129822+0.139673im    -0.0454773-0.076259im       -0.111626+0.201691im     -0.0721544+0.0772308im    -0.0661956+0.159761im     -0.118088-0.147411im       0.141323-0.0317137im   -0.0768858-0.010515im    0.0469058-0.130556im        0.207108+0.116453im    -0.00734481+0.0588036im      0.231332+0.0258492im      0.0358043+0.0159581im    0.0690589+0.0208739im     0.0977861-0.0841202im      0.267748+0.141124im   -0.0054477-0.161799im
  0.0248038-0.0174308im    -0.0391483-0.266128im      -0.231963+0.222229im     -0.0775479+0.0290476im     0.0362818+0.279619im      0.0683841-0.0109859im   -0.0526907-0.0964102im     -0.113572-0.0545187im     0.139362-0.0113503im    -0.0645058-0.0616019im     -0.197715-0.0812035im    0.144515+0.214521im      -0.0949513+0.0983162im     0.0447732-0.108789im     -0.0317525+0.172383im     0.00771589+0.140049im     0.0652066+0.00756139im    -0.0410076+0.0953462im    -0.0150174+0.283998im      0.0111096+0.0671906im     0.037875+0.0810581im     -0.167959+0.107461im     0.0805816+0.104813im    -0.243849-0.143469im      -0.0132235-0.0133016im      0.343256+0.115361im      0.0268834+0.249712im      -0.0221101-0.122176im    -0.0617404+0.0519131im    -0.0109331+0.100028im     -0.0154588+0.0347297im   0.0861715+0.0069059im
  -0.085153-0.260589im       0.100494-0.0429235im   -0.00305342-0.0569706im     -0.054084+0.0334795im      -0.12111-0.152976im       0.119837+0.145342im    -0.0138415+0.0656383im     -0.159701-0.10377im     -0.0175271+0.101708im      -0.283981-0.0612333im     -0.300505-0.133068im   -0.0722172-0.030222im       0.0092243+0.150913im      -0.146612-0.0570924im     -0.139592-0.068247im    -0.00573606-0.0862305im     0.193009-0.0570635im       -0.14967-0.288637im       0.224564-0.0263101im     -0.194578+0.0339227im    0.0184899-0.170897im      0.0608815-0.113608im     -0.166143-0.108786im   -0.0252292+0.0803467im       0.136066+0.13023im      0.00541615-0.082078im    0.000402252+0.188249im       0.0429109-0.0671428im     0.131275-0.065792im       0.105431+0.106439im    0.000418109-0.177273im    0.0555862-0.106141im
  0.0768105+0.022282im     -0.0364892-0.140981im       0.137739-0.116015im     -0.0783673-0.0641863im     0.0944339-0.0121278im     0.0371707+0.0705955im     0.147673+0.0436363im     0.0373599+0.10225im      0.0231299-0.048874im       0.069972+0.162183im     -0.0155402+0.0735062im  -0.0120095+0.137913im       -0.064298+0.0486206im     0.0781308+0.00283977im    -0.068781-0.0516928im     0.0154652+0.0728529im     0.147008-0.301679im        0.254974+0.242207im    -0.00275747+0.0237869im     -0.149562+0.00454006im   0.0221001-0.0766443im     -0.131925-0.0791112im   -0.0349295-0.195838im   0.00591911+0.155103im      -0.0506095+0.119213im      -0.271147+0.0843589im      0.126128+0.228358im        0.285731-0.0277946im    -0.321233+0.157243im     -0.0464523+0.0256853im      0.129285-0.102349im     0.185655-0.0315675im
  -0.161171+0.0286018im      0.208229-0.0530099im     0.0713209-0.212559im     -0.0692857+0.0843935im     -0.153157+0.162657im       0.295182-0.0832548im     -0.12142+0.182993im      0.0844072+0.176607im    -0.0364248+0.216399im      0.0249291+0.173839im     -0.0140404-0.0309404im   0.0167526+0.0797098im    -0.00128058+0.035304im     -0.0773788+0.184539im      0.0595051+0.0836325im    -0.0306252-0.0388189im    -0.174475+0.0244391im      0.0810268+0.0167007im    -0.0402021+0.192972im     -0.0260917+0.110787im       0.14644-0.108111im       0.170024+0.223539im     0.0343077-0.0913565im    -0.12752-0.000324043im     0.082186+0.0904832im   -0.00586091-0.059776im      -0.213139-0.154291im      -0.0423397+0.0016907im    0.0300142+0.146991im       0.100668+0.0747694im      0.296162+0.184997im    0.0838495-0.0948892im
  -0.221562+0.0630337im    0.00517158-0.302361im      0.0271816-0.0233433im     0.0167128+0.01221im       0.0560221-0.0381724im    -0.0194334-0.11776im        0.12005-0.152956im      0.0539912-0.0852345im   0.00628457+0.0910676im     -0.185019-0.197884im      0.0984899+0.153954im   -0.0860691-0.000838537im    -0.109548+0.00779709im    -0.225574-0.109455im       0.123166-0.0762587im      0.337563+0.0685863im    0.0979598+0.0369714im     -0.0269387+0.0382416im     -0.250016-0.0183624im     0.0938988-0.0986895im   -0.0836062-0.0194563im    -0.0759174-0.112793im     0.0530474+0.124947im    0.0336418+0.00413978im     -0.151391+0.0430639im     -0.183687-0.0494474im     -0.034413-0.143567im       -0.132489-0.113826im     0.0338354+0.000918765im   0.0845018+0.295534im       0.126971-0.0200969im     0.10865-0.26953im
 -0.0596785-0.0520287im    -0.0235419-0.154326im      0.0125788+0.0669371im      -0.20047-0.283574im     -0.0681005-0.0486788im     -0.116122+0.0926737im    0.0211178-0.0395065im      0.192303-0.0574684im   -0.0823451-0.174762im     -0.0127947-0.102288im      -0.100132-0.0369992im    0.151793+0.358322im       0.0420489-0.144869im        -0.2648+0.101553im     -0.0174643-0.0161898im   0.000958324+0.0911756im   -0.0175996-0.0307456im     -0.0776039-0.138315im      -0.078211+0.0067715im     0.0923913-0.21695im     -0.0738194+0.00545699im     0.212796+0.149906im     -0.158218+0.0126328im   -0.011012+0.0907511im      0.0354929-0.226611im     -0.0518687-0.0820503im    0.00595083-0.000638152im     0.198258-0.00825213im  -0.0601306+0.123877im       0.254041-0.15586im       0.0512569+0.109612im    -0.119256+0.12979im
   0.074468+0.129975im     -0.0257086+0.205334im       -0.10393+0.0439134im   -0.00579819-0.14557im      0.00152343+0.19083im       0.0163807-0.117533im      0.186522+0.0228593im     -0.248228-0.154866im     -0.100408+0.00637727im    0.0222176+0.0430722im      0.195606-0.125955im    0.0199143-0.109754im      -0.0836305+0.23669im      -0.0927263+0.122837im      0.0665219-0.0805026im    -0.0253002+0.0525189im    -0.103577-0.021189im       0.0899886+0.0448272im     -0.105183-0.234015im      -0.109527-0.0396283im    -0.136089+0.0382319im    -0.0188547+0.00730242im  -0.0654052+0.150988im    -0.207437-0.00706144im      0.154407+0.0175331im     0.0981465-0.173763im     -0.0279479-0.0358835im       0.287242+0.0057197im    0.0885767-0.00733896im     0.296171+0.0390562im    -0.0348994-0.0434238im    0.330499+0.00622691im</code></pre><p>and then generate the state <span>$ψ$</span></p><pre><code class="language-julia hljs">psi = P[:, 3]</code></pre><pre><code class="nohighlight hljs">32-element Vector{ComplexF64}:
   0.03527587894152637 + 0.0055552028445816195im
  -0.08933162472508319 - 0.11585514556167276im
   0.01669725319173065 - 0.05955015032153385im
  -0.16116375978798578 - 0.017044916875312902im
    0.1798820589342793 + 0.1978868494166586im
  -0.11929056636424185 - 0.0032579467770358812im
  -0.11303477484061963 + 0.01211975919616414im
   0.39060900722909386 + 0.0im
  -0.15916085466806762 + 0.0930336952791007im
  -0.07491594876806831 + 0.035440668736832916im
  0.013307336366373709 - 0.03525230301417363im
   0.10529207948445438 + 0.2095573893665514im
  -0.26863747524881554 - 0.05894443333239813im
   0.05160479911762964 - 0.04019059837520879im
  -0.04764961347148552 - 0.07985401365093454im
 -0.014865852667631626 - 0.2676979266184029im
  -0.11208150620088873 - 0.00833325535039155im
   0.14152821548246874 - 0.11879891395822863im
 -0.033014327093320375 - 0.12812806976060676im
  0.015375065508239059 - 0.1513654648877651im
    0.1736617325404181 - 0.06653444686347444im
   -0.2699278198328928 + 0.11601682822141501im
  -0.07112417868674337 - 0.10726749102400908im
   0.04942980990816376 - 0.06832428486388782im
   0.15505811013839177 + 0.018718655460669156im
  -0.13468363925335988 + 0.02107362878665439im
   0.09957941446943573 - 0.156721634977338im
  -0.22996482249969424 + 0.07289985490277062im
   0.08335865552653297 - 0.155108847414396im
   0.04985539285359898 - 0.007060061826700251im
  -0.15618030415129502 - 0.046526937906882726im
 -0.004357756467081293 - 0.10230406459873002im</code></pre><p>In the phase estimation process, we will feed the state to circuit and measure the first <code>n</code> qubits processed by iQFT.</p><pre><code class="language-julia hljs">r = join(ArrayReg(psi), zero_state(N))
r |&gt; PE(N, M, U)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 8/8
    nlevel: 2</code></pre><p>Since our phase can be represented by 3 qubits precisely, we only need to measure once</p><pre><code class="language-julia hljs">results = measure(r, 1:N; nshots=1)</code></pre><pre><code class="nohighlight hljs">1-element Vector{DitStr{2, 3, Int64}}:
 011 ₍₂₎</code></pre><p>Recall that our QFT&#39;s bit numbering is reversed, let&#39;s reverse it back</p><pre><code class="language-julia hljs">using BitBasis
estimated_phase = bfloat(results[]; nbits=N)</code></pre><pre><code class="nohighlight hljs">0.75</code></pre><p>the phase is exactly <code>0.75</code>!</p><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../1.prepare-ghz-state/index.html">« Prepare Greenberger–Horne–Zeilinger state with Quantum Circuit</a><a class="docs-footer-nextpage" href="../3.grover-search/index.html">Grover Search »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.3.0 on <span class="colophon-date" title="Tuesday 12 March 2024 14:19">Tuesday 12 March 2024</span>. Using Julia version 1.10.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
