<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Quantum Fourier Transformation and Phase Estimation · Documentation | Yao</title><meta name="title" content="Quantum Fourier Transformation and Phase Estimation · Documentation | Yao"/><meta property="og:title" content="Quantum Fourier Transformation and Phase Estimation · Documentation | Yao"/><meta property="twitter:title" content="Quantum Fourier Transformation and Phase Estimation · Documentation | Yao"/><meta name="description" content="Documentation for Documentation | Yao."/><meta property="og:description" content="Documentation for Documentation | Yao."/><meta property="twitter:description" content="Documentation for Documentation | Yao."/><script data-outdated-warner src="../../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../search_index.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script><link href="../../../assets/indigo.css" rel="stylesheet" type="text/css"/><link href="https://yaoquantum.org/assets/favicon-light.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../index.html"><img src="../../../assets/logo.png" alt="Documentation | Yao logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../../index.html">Documentation | Yao</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../../index.html">Home</a></li><li><a class="tocitem" href="../../../quick-start.html">Quick Start</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../../../man/registers.html">Quantum Registers</a></li><li><a class="tocitem" href="../../../man/blocks.html">Blocks</a></li><li><a class="tocitem" href="../../../man/symbolic.html">Symbolic Computation</a></li><li><a class="tocitem" href="../../../man/cuda.html">CUDA extension - CuYao</a></li><li><a class="tocitem" href="../../../man/plot.html">Quantum Circuit Visualization</a></li><li><a class="tocitem" href="../../../man/automatic_differentiation.html">Automatic Differentiation</a></li><li><a class="tocitem" href="../../../man/yao2einsum.html">Tensor network backend</a></li><li><a class="tocitem" href="../../../man/simplification.html">Simplification</a></li><li><a class="tocitem" href="../../../man/bitbasis.html">BitBasis</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../1.prepare-ghz-state/index.html">Prepare Greenberger–Horne–Zeilinger state with Quantum Circuit</a></li><li class="is-active"><a class="tocitem" href="index.html">Quantum Fourier Transformation and Phase Estimation</a><ul class="internal"><li><a class="tocitem" href="#Quantum-Fourier-Transformation"><span>Quantum Fourier Transformation</span></a></li><li><a class="tocitem" href="#Wrap-QFT-to-an-external-block"><span>Wrap QFT to an external block</span></a></li><li><a class="tocitem" href="#Phase-Estimation"><span>Phase Estimation</span></a></li></ul></li><li><a class="tocitem" href="../3.grover-search/index.html">Grover Search</a></li><li><a class="tocitem" href="../4.shor-algorithm/index.html">Shor&#39;s Algorithm</a></li><li><a class="tocitem" href="../5.shor-9-code/index.html">Shor&#39;s 9 qubit code</a></li><li><a class="tocitem" href="../6.quantum-circuit-born-machine/index.html">Quantum Circuit Born Machine</a></li><li><a class="tocitem" href="../7.variation-quantum-eigen-solver/index.html">Variational Quantum Eigen Solver</a></li><li><a class="tocitem" href="../8.riemannian-gradient-flow/index.html">Riemannian gradient flow optimizer</a></li></ul></li><li><a class="tocitem" href="../../../performancetips.html">Performance Tips</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href="index.html">Quantum Fourier Transformation and Phase Estimation</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="index.html">Quantum Fourier Transformation and Phase Estimation</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/QuantumBFS/Yao.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/QuantumBFS/Yao.jl/blob/master/docs/src/examples/2.qft-phase-estimation/main.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><p><a href="/generated/examples/2.qft-phase-estimation/main.ipynb"><img src="https://mybinder.org/badge_logo.svg" alt/></a></p><h1 id="example-qft"><a class="docs-heading-anchor" href="#example-qft">Quantum Fourier Transformation and Phase Estimation</a><a id="example-qft-1"></a><a class="docs-heading-anchor-permalink" href="#example-qft" title="Permalink"></a></h1><p>Let&#39;s use Yao first</p><pre><code class="language-julia hljs">using Yao</code></pre><h2 id="Quantum-Fourier-Transformation"><a class="docs-heading-anchor" href="#Quantum-Fourier-Transformation">Quantum Fourier Transformation</a><a id="Quantum-Fourier-Transformation-1"></a><a class="docs-heading-anchor-permalink" href="#Quantum-Fourier-Transformation" title="Permalink"></a></h2><p>The Quantum Fourier Transformation (QFT) circuit is to repeat two kinds of blocks repeatly:</p><p><img src="assets/qft.png" alt="qft-circuit"/></p><p>The basic building block control phase shift gate is defined as</p><p class="math-container">\[R(k)=\begin{bmatrix}
1 &amp; 0\\
0 &amp; \exp\left(\frac{2\pi i}{2^k}\right)
\end{bmatrix}\]</p><p>Let&#39;s define block <code>A</code> and block <code>B</code>, block <code>A</code> is actually a control block.</p><pre><code class="language-julia hljs">A(i, j) = control(i, j=&gt;shift(2π/(1&lt;&lt;(i-j+1))))</code></pre><pre><code class="nohighlight hljs">A (generic function with 1 method)</code></pre><p>Once you construct the blockl you can inspect its matrix using <code>mat</code> function. Let&#39;s construct the circuit in dash box A, and see the matrix of <span>$R_4$</span> gate.</p><pre><code class="language-julia hljs">R4 = A(4, 1)</code></pre><pre><code class="nohighlight hljs">(n -&gt; control(n, 4, 1 =&gt; shift(0.39269908169872414)))</code></pre><p>If you have read about <a href="@ref tutorial-ghz">preparing GHZ state</a>, you probably know that in Yao, we could just leave the number of qubits, and it will be evaluated when possible.</p><pre><code class="language-julia hljs">R4(5)</code></pre><pre><code class="nohighlight hljs">nqubits: 5
control(4)
└─ (1,) shift(0.39269908169872414)</code></pre><p>its matrix will be</p><pre><code class="language-julia hljs">mat(R4(5))</code></pre><pre><code class="nohighlight hljs">32×32 Diagonal{ComplexF64, Vector{ComplexF64}}:
 1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im</code></pre><p>Then we repeat this control block over and over on different qubits, and put a Hadamard gate to <code>i</code>th qubit to construct <code>i</code>-th <code>B</code> block.</p><pre><code class="language-julia hljs">B(n, k) = chain(n, j==k ? put(k=&gt;H) : A(j, k) for j in k:n)</code></pre><pre><code class="nohighlight hljs">B (generic function with 1 method)</code></pre><p>We need to input the total number of qubits <code>n</code> here because we have to iterate through from <code>k</code>-th location to the last.</p><p>Now, let&#39;s construct the circuit by chaining all the <code>B</code> blocks together</p><pre><code class="language-julia hljs">qft(n) = chain(B(n, k) for k in 1:n)
qft(4)</code></pre><pre><code class="nohighlight hljs">nqubits: 4
chain
├─ chain
│  ├─ put on (1)
│  │  └─ H
│  ├─ control(2)
│  │  └─ (1,) shift(1.5707963267948966)
│  ├─ control(3)
│  │  └─ (1,) shift(0.7853981633974483)
│  └─ control(4)
│     └─ (1,) shift(0.39269908169872414)
├─ chain
│  ├─ put on (2)
│  │  └─ H
│  ├─ control(3)
│  │  └─ (2,) shift(1.5707963267948966)
│  └─ control(4)
│     └─ (2,) shift(0.7853981633974483)
├─ chain
│  ├─ put on (3)
│  │  └─ H
│  └─ control(4)
│     └─ (3,) shift(1.5707963267948966)
└─ chain
   └─ put on (4)
      └─ H
</code></pre><h2 id="Wrap-QFT-to-an-external-block"><a class="docs-heading-anchor" href="#Wrap-QFT-to-an-external-block">Wrap QFT to an external block</a><a id="Wrap-QFT-to-an-external-block-1"></a><a class="docs-heading-anchor-permalink" href="#Wrap-QFT-to-an-external-block" title="Permalink"></a></h2><p>In most cases, <code>function</code>s are enough to wrap quantum circuits, like <code>A</code> and <code>B</code> we defined above, but sometimes, we need to dispatch specialized methods on certain kinds of quantum circuit, or we want to define an external block to export, thus, it&#39;s useful to be able to wrap circuit to custom blocks.</p><p>First, we define a new type as subtype of <code>PrimitiveBlock</code> since we are not going to use the subblocks of <code>QFT</code>, if you need to use its subblocks, it&#39;d be better to define it under <code>CompositeBlock</code>.</p><pre><code class="language-julia hljs">struct QFT &lt;: PrimitiveBlock{2}
    n::Int
end

YaoBlocks.nqudits(q::QFT) = q.n</code></pre><p>Now, let&#39;s define its circuit</p><pre><code class="language-julia hljs">circuit(q::QFT) = qft(q.n)</code></pre><pre><code class="nohighlight hljs">circuit (generic function with 1 method)</code></pre><p>And forward <code>mat</code> to its circuit&#39;s matrix</p><pre><code class="language-julia hljs">YaoBlocks.mat(::Type{T}, x::QFT) where T = mat(T, circuit(x))</code></pre><p>You may notice, it is a little ugly to print <code>QFT</code> at the moment, this is because we print the type summary by default, you can define your own printing by overloading <code>print_block</code></p><pre><code class="language-julia hljs">YaoBlocks.print_block(io::IO, x::QFT) = print(io, &quot;QFT($(x.n))&quot;)</code></pre><p>Since it is possible to use FFT to simulate the results of QFT (like cheating), we could define our custom <code>apply!</code> method:</p><pre><code class="language-julia hljs">using FFTW, LinearAlgebra

function YaoBlocks.apply!(r::ArrayReg, x::QFT)
    α = sqrt(length(statevec(r)))
    invorder!(r)
    lmul!(α, ifft!(statevec(r)))
    return r
end</code></pre><p>Now let&#39;s check if our <code>apply!</code> method is correct:</p><pre><code class="language-julia hljs">r = rand_state(5)
r1 = r |&gt; copy |&gt; QFT(5)
r2 = r |&gt; copy |&gt; circuit(QFT(5))
r1 ≈ r2</code></pre><pre><code class="nohighlight hljs">true</code></pre><p>We can get iQFT (inverse QFT) directly by calling <code>adjoint</code></p><pre><code class="language-julia hljs">QFT(5)&#39;</code></pre><pre><code class="nohighlight hljs"> [†]QFT(5)</code></pre><p>QFT and iQFT are different from FFT and IFFT in three ways,</p><ol><li>they are different by a factor of <span>$\sqrt{2^n}$</span> with <span>$n$</span> the number of qubits.</li><li>the <a href="https://quantumbfs.github.io/BitBasis.jl/stable/tutorial/#Conventions-1">bit numbering</a> will exchange after applying QFT or iQFT.</li><li>due to the convention, QFT is more related to IFFT rather than FFT.</li></ol><h2 id="Phase-Estimation"><a class="docs-heading-anchor" href="#Phase-Estimation">Phase Estimation</a><a id="Phase-Estimation-1"></a><a class="docs-heading-anchor-permalink" href="#Phase-Estimation" title="Permalink"></a></h2><p>Since we have QFT and iQFT blocks we can then use them to realize phase estimation circuit, what we want to realize is the following circuit:</p><p><img src="assets/phaseest.png" alt="phase estimation"/></p><p>First we call Hadamard gates repeatly on first <code>n</code> qubits.</p><pre><code class="language-julia hljs">Hadamards(n) = repeat(H, 1:n)</code></pre><pre><code class="nohighlight hljs">Hadamards (generic function with 1 method)</code></pre><p>Then in dashed box <code>B</code>, we have controlled unitaries:</p><pre><code class="language-julia hljs">ControlU(n, m, U) = chain(n+m, control(k, n+1:n+m=&gt;matblock(U^(2^(k-1)))) for k in 1:n)</code></pre><pre><code class="nohighlight hljs">ControlU (generic function with 1 method)</code></pre><p>each of them is a <code>U</code> of power <span>$2^{(k-1)}$</span>.</p><p>Since we will only apply the qft and Hadamard on first <code>n</code> qubits, we could use <code>Subroutine</code>, which creates a context of a sub-scope of the qubits.</p><pre><code class="language-julia hljs">PE(n, m, U) =
    chain(n+m, # total number of the qubits
        subroutine(Hadamards(n), 1:n), # apply H in local scope
        ControlU(n, m, U),
        subroutine(QFT(n)&#39;, 1:n))</code></pre><pre><code class="nohighlight hljs">PE (generic function with 1 method)</code></pre><p>we use the first <code>n</code> qubits as the output space to store phase <span>$ϕ$</span>, and the other <code>m</code> qubits as the input state which corresponds to an eigenvector of oracle matrix <code>U</code>.</p><p>The subroutine here uses <code>focus!</code> and <code>relax!</code> to manage a local scope of quantum circuit, and only activate the first <code>n</code> qubits while applying the block inside the subroutine context, and the scope will be <code>relax!</code>ed back, after the context. This is equivalent to manually <code>focus!</code> then <code>relax!</code></p><p>fullly activated</p><pre><code class="language-julia hljs">r = rand_state(5)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 5/5
    nlevel: 2</code></pre><p>first 3 qubits activated</p><pre><code class="language-julia hljs">focus!(r, 1:3)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 3/5
    nlevel: 2</code></pre><p>relax back to the original</p><pre><code class="language-julia hljs">relax!(r, 1:3)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 5/5
    nlevel: 2</code></pre><p>In this way, we will be able to apply small operator directly on the subset of the qubits.</p><p>Details about the algorithm can be found here: <a href="https://en.wikipedia.org/wiki/Quantum_phase_estimation_algorithm">Quantum Phase Estimation Algorithm</a></p><p>Now let&#39;s check the results of our phase estimation.</p><p>First we need to set up a unitary with known phase, we set the phase to be 0.75, which is <code>0.75 * 2^3 == 6 == 0b110</code> .</p><pre><code class="language-julia hljs">N, M = 3, 5
P = eigen(rand_unitary(1&lt;&lt;M)).vectors
θ = Int(0b110) / 1&lt;&lt;N
phases = rand(1&lt;&lt;M)
phases[0b010+1] = θ
U = P * Diagonal(exp.(2π * im * phases)) * P&#39;</code></pre><pre><code class="nohighlight hljs">32×32 Matrix{ComplexF64}:
   0.214024-0.184957im       -0.119398+0.273744im     0.0229904-0.0105052im   -0.0166617-0.0943354im    0.0973338+0.0086536im   -0.0507548+0.155305im   -0.00620848-0.00616163im   -0.0362557+0.226599im       0.0662434+0.0841346im     -0.153551+0.135154im       0.224269-0.0440578im     0.0859081-0.0128062im   -0.0916107+0.0522346im     -0.145854-0.17971im       0.138999+0.0424202im      0.122108+0.119447im       0.0785766+0.127926im     -0.052058-0.0600698im    -0.0836856-0.0069952im      0.0255012-0.110162im      0.138308-0.171795im       0.150177+0.103355im        0.29122-0.140621im      0.0759717+0.160185im      0.0150254+0.0709637im      -0.10056+0.101197im      -0.0693536-0.11473im      0.0720369-0.213511im       0.187247-0.0415787im    0.0987572-0.156554im     0.121618-0.191148im       0.0295902-0.140373im
  -0.244181-0.120373im        0.207796-0.0656753im     0.120825+0.0258758im   -0.0357978+0.126322im      -0.12825-0.120294im     -0.154323+0.18923im     -0.0034432+0.0459454im    -0.0577143+0.119113im      -0.0332936+0.0650478im     -0.038796-0.122361im       0.228093-0.0644219im      0.206228+0.171722im      0.111802-0.105038im      0.0811208+0.208306im      0.106732+0.0590694im     0.0224535+0.139466im         0.09315-0.141569im    0.00240767-0.068294im     -0.0148452-0.127262im      -0.0256846+0.0502439im   -0.0459288-0.305769im      -0.068744-0.0557195im      0.200863+0.156164im         0.1202+0.0498033im    0.00597504+0.0990728im    -0.0229565-0.234451im      -0.0353376+0.00735617im   -0.226467+0.046999im     -0.0421702+0.0916564im    0.0392008+0.214612im    0.0277833+0.0452321im       0.241851-0.00607787im
  0.0361173+0.0770987im       0.044754+0.0684086im     0.105855-0.251552im     0.0063798+0.0492881im    0.0837351-0.00786933im    0.121031-0.148332im     0.0397514-0.158388im     -0.0789198-0.0367234im      0.0786526-0.144571im      0.0604564-0.130383im      0.0229984+0.129077im      0.0664632+0.0979034im    -0.209219+0.0557073im    -0.0348798-0.134037im     -0.106972-0.000799537im    0.105597-0.0186727im       0.101106-0.34612im      0.0683408+0.1681im        0.0123135+0.138394im       -0.180377+0.187766im    -0.0732151-0.0014017im      0.110639+0.251124im     -0.0537845+0.106199im      0.0900167+0.111772im      -0.207411+0.061688im      -0.251201+0.0629375im      -0.110148+0.184331im     -0.171865-0.0523479im      0.182066-0.139692im     0.0412422+0.0262608im   0.0513219-0.0280099im       0.149426+0.157026im
  0.0387213+0.153391im       0.0418778-0.019337im     0.0693761-0.0262381im      0.22279-0.28656im     -0.0399559-0.0487012im   -0.0514104+0.152394im     -0.156336-0.140486im      -0.070159-0.333621im      -0.0446509-0.146568im      0.0436581+0.123453im      0.0343236+0.0525345im      0.146041-0.220721im      0.150284-0.192771im      -0.014842-0.0750337im    0.0571294+0.125008im      0.0935906-0.059909im        0.210941+0.159616im    -0.0116196+0.0724836im     -0.148486-0.116678im      -0.0240006+0.138675im    -0.0532384-0.186955im       0.220308-0.106206im     -0.0682955+0.124331im      -0.159852+0.0108168im     0.0172532-0.0145255im      0.128659-0.0370538im       0.147348+0.061605im     -0.147048+0.0681453im     0.0700712+0.0228961im    0.0736893-0.214133im    0.0116463-0.119358im        0.035315+0.130887im
   0.207731+0.0965656im      0.0563976+0.0201235im   -0.0165267-0.148935im     0.0377187-0.16729im      0.0471118-0.18563im      0.0487064+0.158914im       0.14281-0.0693677im      -0.18756-0.0140915im       0.118773+0.034753im       -0.11395-0.000502724im   0.0317693-0.0922835im    -0.0924941-0.0659387im   -0.0333895-0.00292276im   -0.0640903+0.211145im     0.0722424+0.127662im       0.167465+0.0434013im      -0.113817-0.0369187im    0.0655895+0.196136im     -0.0956796-0.150823im       0.0232316+0.0934344im    0.0359161-0.00586805im   -0.0977674-0.0647773im     0.0141764-0.0691061im    -0.0119288-0.261841im     -0.0736443-0.107893im    -0.00619672+0.118982im       -0.244039-0.082602im    -0.0205781-0.225343im      -0.204429-0.0168542im    0.0603692-0.02259im     0.0254507+0.480396im       0.0239058+0.0333368im
   0.254869-0.021413im      0.00604788+0.00239008im   0.0598049+0.0574685im    0.0725113+0.0626936im    0.0076277-0.114412im     -0.077567-0.236753im     -0.174388-0.0683317im     0.0202199-0.00388222im      0.111637+0.0333578im     -0.230214+0.261983im      -0.179444+0.00410963im    0.0975915-0.0498334im   -0.0422306-0.11131im      -0.0868919+0.0831148im     0.112946+0.0442012im    -0.0392956+0.113408im       0.0372434-0.197766im      0.227724-0.0693567im     0.0692649-0.136939im       -0.152692-0.132201im      -0.10071-0.0305803im    -0.0173481+0.010143im      0.0602759+0.0622494im     -0.250882+0.0776971im      0.267476-0.156014im      -0.162763+0.0904063im       -0.03496-0.0904799im    -0.166568+0.127307im       0.070865-0.0510296im    -0.155133+0.270766im   -0.0587837+0.00142101im     -0.166693-0.0305553im
 -0.0803954+0.0693793im     -0.0242646+0.319205im      0.139582+0.115516im      0.059484-0.0974504im     0.128513-0.029917im     -0.133652+0.151071im      0.127292-0.0337631im    -0.0414111+0.0183025im      -0.108546+0.0572963im      0.144549+0.116388im     -0.0250883+0.0763016im    -0.0482918-0.0572912im    0.0400365+0.13569im        0.191794+0.0289766im    0.0350096+0.111849im     -0.0222441-0.100145im       0.0186986-0.194845im     -0.116149-0.27183im        0.157488+0.377046im       0.0322128+0.193728im    -0.0389117-0.0126125im     0.0225245-0.0179797im      0.101766+0.0944544im     -0.302917-0.26356im        0.202076+0.00429847im   -0.0747587-0.031123im       -0.173629+0.109647im     0.0441112-0.0252942im    0.00983148-0.0257529im   -0.0478079+0.0127082im   0.0250402+0.0130177im     0.00974194-0.0944574im
  0.0991568-0.00939124im      0.276553-0.0176234im   -0.0589788+0.115466im      0.263983+0.205155im     -0.102365+0.217451im      0.111509+0.215183im     -0.160242+0.0197947im    -0.0570094-0.271219im       -0.095306+0.108894im        0.19559-0.054449im      0.0808385-0.0582501im     -0.159999-0.0784063im   -0.0152209+0.252425im      -0.038277+0.0221593im    0.0543119-0.16587im       0.0916998-0.0450521im      0.0051728-0.076855im      0.243356+0.0519492im      0.105876-0.0422974im      -0.133593+0.0080817im    0.0454813-0.110527im      -0.203456+0.137338im      0.0208361+0.198145im     -0.0150888+0.0422599im     0.0673945+0.103712im     -0.0138373+0.116205im     -0.00688862-0.186213im     0.0863151-0.0964153im     0.0112328-0.00101877im   0.0480735-0.0457104im    0.150681-0.0515187im     -0.0959568-0.141792im
  -0.102248+0.00292157im     0.0143216-0.0174513im     0.230771+0.0269528im   -0.0289721+0.0660445im     0.194378+0.0227162im     0.201613-0.0574046im   -0.0812718-0.163888im      0.0597068-0.184019im        0.128639-0.0243217im    -0.0576662+0.117513im     -0.0438433+0.177762im      -0.145708+0.126422im      0.202292+0.106833im       0.163681+0.038841im     0.0262176-0.0690143im      0.247282+0.122867im        0.178086-0.0278102im   -0.0373645-0.221469im      -0.107552-0.112097im        0.216938-0.10667im      0.0956776+0.0730406im     0.0620219-0.176878im      0.0687356+0.0252826im      0.116072+0.0317489im    -0.0993116+0.0411969im     -0.203347+0.109797im        0.113656-0.0629811im    0.0733677+0.140568im      -0.172145-0.209543im     -0.152932-0.0660041im    0.169258+0.110952im        0.125733-0.0967052im
  0.0824849+0.155381im       0.0537977+0.0450463im   -0.0774394-0.0712555im    -0.211979+0.0818945im  -0.00931146-0.125019im     -0.101788-0.0617545im     0.140409+0.0856613im     -0.075768-0.126699im       -0.325077+0.104879im     -0.0267651-0.115655im       0.130317+0.117944im       0.137419-0.277123im     0.0484209-0.0317532im      0.240274+0.0454739im   -0.0740864-0.0520278im     0.0118679+0.0797425im       0.138298+0.102913im       0.18887-0.193528im     0.00857206-0.128188im     -0.00569098-0.192758im    -0.0646944+0.0613406im    -0.0276749+0.140029im      0.0180637-0.0890992im    0.00124668+0.0289706im     -0.177314-0.00777603im   -0.0733089-0.0296022im        -0.2136+0.132288im     -0.126966-0.0608587im     -0.202259-0.216233im     0.0224186-0.107311im   -0.0499288-0.14829im        -0.211829-0.0615205im
  -0.124221+0.000263104im  -0.00209949+0.0311835im    0.0643237+0.091965im     0.0488318-0.113214im     0.0873597-0.0921369im   -0.0252764-0.0952502im    -0.088099+0.191612im      0.0291971-0.161803im        0.193074+0.287086im      -0.037147-0.131391im      0.0991661-0.0998014im     0.0939828-0.296119im    -0.0552467+0.0557724im   -4.51041e-5+0.100765im      0.266624-0.169245im     -0.0292047-0.163426im      -0.0367909-0.082461im    -0.0553295+0.0389976im   -0.00225804+0.122116im        0.214398-0.181231im      0.226806+0.149088im       0.156649+0.155757im      -0.142172-0.00812162im   -0.0459716-0.0944138im     -0.150832-0.0308814im    -0.0308359+0.0302066im    -0.00135935-0.16894im      -0.181036+0.0269938im     0.0467679+0.0563601im    0.0367168+0.179982im    0.0881241-0.0876251im       0.171925+0.168025im
    -0.1447+0.0884734im     0.00564827+0.00286365im    0.149105+0.13392im      0.0511005+0.0224356im    -0.161289-0.0140091im    -0.111603-0.180927im     -0.135874-0.118892im    0.000553673+0.188744im      -0.0030459-0.025932im     -0.0457594-0.226156im     -0.0132297+0.101558im    -0.00470526-0.152038im     0.0135496+0.119201im      -0.145037-0.257954im      0.221756-0.118105im      -0.120753-0.278677im       0.0636738+0.157021im    -0.0610916+0.00463604im    -0.126022-0.174292im       -0.062061+0.184075im     0.0253265-0.00170096im   -0.0291316-0.20148im       0.0285334-0.0256381im     0.0214413+0.0469704im     0.0556581+0.165475im      -0.123656-0.0920333im      -0.335782-0.011349im     0.0705028+0.0361901im     0.0120232-0.163223im    -0.0255658+0.044329im     0.118847+0.182109im       -0.170173+0.0408987im
  0.0275474-0.161546im       0.0274361+0.0571458im    -0.213307+0.0309825im     0.191733+0.276936im    -0.0337981-0.031154im     0.0787643+0.150794im     -0.120166+0.0394961im     -0.336162+0.0224849im      0.0448175-0.224759im     -0.0277455-0.034987im      -0.179961+0.00335706im    0.0914817-0.0680634im     0.119509-0.156493im      0.0752146+0.0458659im     0.123335+0.0637643im     -0.196332+0.0108987im     -0.0387903+0.109508im     -0.110596-0.0333034im     0.0820483+0.0192777im       0.101092+0.00729224im    0.130555-0.150115im      -0.092564+0.0793728im     -0.121839-0.114925im      0.0888502-0.14438im      -0.0712239-0.167874im      -0.307659+0.0516004im      -0.100917+0.0789567im     0.151343+0.0724795im     0.0575153-0.136727im     -0.169927-0.0751186im  -0.0503638-0.113482im        0.135895+0.152474im
  0.0720624+0.234887im     -0.00574921+0.154463im     0.0476498+0.200269im     0.0147795+0.0385678im   -0.0194565+0.0262543im    -0.235553+0.125736im     0.0436949+0.0271895im     -0.168382+0.000217818im   -0.0559388-0.0426882im    -0.0577106+0.100502im        -0.0329-0.121771im      0.0642818+0.288662im     -0.067282-0.0657685im      0.171656-0.223147im     0.0668653-0.346901im      0.0878444+0.051437im       -0.214819-0.0189088im    0.0566678+0.0947804im    -0.0695419+0.104278im        0.178979+0.0633727im   -0.0729137-0.0901407im      0.119054+0.121908im      -0.171177-0.0412646im      0.150042+0.10942im       0.0852103-0.0559506im      0.140828-0.0568673im      0.0725884-0.125457im     -0.171005+0.0155524im    -0.0938078-0.201208im     -0.198758-0.028474im    0.0390931+0.120514im      -0.0958976+0.0776751im
   0.190128-0.0917101im     -0.0429916-0.0862343im    -0.176771-0.132962im      0.260932+0.25698im       0.293223-0.140678im     0.0694948-0.134858im     0.0576874+0.0672285im    -0.0175205-0.0356215im      -0.107719-0.0963616im    0.00323366-0.0331714im     0.0597859+0.0242294im    -0.0775638-0.144069im     -0.108817+0.0622631im    -0.0632509+0.0228963im    0.0326434-0.241589im      0.0251838+0.195052im      -0.0102637-0.0552024im    -0.318313-0.0996924im    -0.0470154-0.00383233im      0.150546-0.0235042im    -0.106718-0.0586398im      0.070646-0.20027im      -0.0798913+0.12248im       -0.019536+0.0192902im     0.0677634-0.0134224im      0.140899-0.313124im      -0.0426674+0.0922895im    -0.111114-0.0767972im      0.160177+0.0173361im    0.0883139+0.0177459im    0.144997+0.103401im       -0.070992-0.0980244im
    -0.1606+0.00623862im     0.0683692+0.219459im       0.02838-0.184977im      0.140964-0.0647008im    -0.199297-0.0518007im   -0.0818434-0.15004im      -0.131365+0.146662im      -0.131562-0.167884im        0.147884+0.108412im      -0.103165+0.0682903im     0.0444789+0.0913861im    -0.0686634+0.0293112im    -0.163088-0.00749248im   -0.0626107+0.0335387im    -0.176252-0.0662687im     0.0892154-0.0301241im     -0.0236851+0.146083im      0.152636-0.23433im        0.259417-0.06656im         0.111869-0.0035623im    -0.276224-0.0936206im    0.00883523-0.0120403im    -0.0663961-0.275612im    -0.00481189+0.00559104im   -0.0508018+0.161492im     -0.0881729-0.143646im        0.103881+0.0663616im     0.125763-0.137209im       0.125175+0.201302im     -0.130424-0.0396072im   0.0398379+0.167193im       0.0498254+0.041813im
  -0.208693-0.179416im        -0.14209-0.175398im      0.116234-0.0103214im   0.00861666+0.0754986im    -0.112931+0.256702im    -0.0216322-0.0169329im     0.330931-0.174066im       -0.21134-0.172855im     -0.00540008-0.109609im     -0.0324214+0.285455im      0.0815157+0.0333965im     0.0739021-0.233805im     0.0208586+0.0961077im      -0.11833-0.151769im     0.0138105+0.035613im      -0.151082-0.121708im      -0.0952933-0.153614im     0.0681452+0.0863531im     0.0385802-0.0154426im       0.126292-0.186285im     0.0227304-0.0477356im    -0.0619949-0.0224898im      0.228433-0.0388215im     0.0147965-0.018105im     -0.0595725-0.0730504im      0.107949-0.0713218im       0.115997+0.115646im    -0.0774504-0.218354im     -0.0070128-0.10407im       -0.12714+0.105147im    0.0493746+0.0653487im     -0.0319258+0.0371925im
   0.227803+0.101375im       -0.156553+0.108011im     0.0767876-0.00738692im    0.155362+0.0521804im    -0.144016-0.120856im    -0.0824009-0.0197951im     0.097676-0.0903709im     0.0576823+0.128836im        0.319635-0.0448036im      0.173579-0.211802im     -0.0707754+0.0294515im     0.0789838-0.14017im      0.0349086+0.205245im       0.158499+0.0436634im    -0.036171-0.122098im     -0.0485035+0.00932516im     0.0585687+0.0289778im    0.0947333-0.0637854im      -0.15102-0.0534541im      0.0309505+0.213033im    -0.0391354+0.0120673im     -0.170633-0.151822im      0.0737913-0.0176736im     0.0556292-0.00510257im     -0.12529-0.137856im      0.0449657+0.0165773im       0.250387-0.0332309im   -0.0959424-0.235184im     -0.0470644+0.0904203im    -0.197526+0.0894798im   -0.144607-0.240142im       0.0943078-0.162748im
  0.0437469-0.019528im        0.141486+0.116837im     0.0339394-0.155373im     0.0481965-0.0400052im   -0.0507374+0.032675im      0.003281-0.018633im      0.313883-0.202899im     -0.0369712+0.03563im        -0.225069+0.00317631im    -0.128935-0.103494im      -0.154224+0.289272im      0.0916017+0.0107455im    -0.065972+0.0647072im    -0.0250603+0.38139im      0.0829785-0.225476im      -0.112343-0.204867im     -0.00494402-0.0251409im    -0.188178+0.0139038im    -0.0991378-0.0427679im     -0.0806092-0.069128im     0.0170576-0.0814426im      0.119753+0.142863im      0.0915361-0.0501525im     0.0445906+0.080041im       0.134673+0.0192078im    -0.0255723+0.0913695im       0.161423-0.196533im     0.0561086+0.151954im    -0.00992039+0.219471im    -0.0909734-0.157907im   0.00931937+0.0310831im     -0.0401141+0.0696737im
  0.0494484+0.00836924im    -0.0654325-0.0957377im   -0.0608613+0.0994111im    0.0244535-0.017027im      -0.18819+0.0273244im    -0.185022+0.0998623im    -0.205694-0.283538im        0.01087-0.132747im      -0.0231046-0.00613743im   0.00216381-0.114571im      -0.154162-0.170753im      0.0911166+0.219743im     0.0217659+0.0462311im     -0.171832+0.126874im       0.03104-0.080505im     -0.0464598-0.0112355im     0.00968184-0.200966im     -0.140269-0.125744im      -0.119566+0.00515946im     0.0215622-0.249681im      -0.20041+0.125781im        0.23845+0.0607095im   -0.00134723+0.019778im      -0.180525+0.0339196im     -0.239705-0.0256201im    0.00396957-0.10823im        -0.165255+0.0474635im     0.232031-0.232572im     -0.0719133-0.0423957im    0.0388586-0.0533208im   -0.124372-0.0135116im       0.109944-0.131983im
 -0.0294442+0.0624764im      0.0248715+0.109378im     -0.151855-0.240758im      0.086954-0.0132194im     -0.26988+0.223504im     0.0398983-0.139905im      0.144307+0.125999im      0.0680271+0.069407im      -0.0960244+0.193174im      0.0706014+0.102392im      -0.185049-0.0807216im      -0.08454+0.00484101im     0.17632-0.161773im     -0.0403478+0.0510483im   -0.0367773+0.0914432im     0.0834919+0.073387im    -0.000703179-0.136983im     0.0164989+0.0728783im    -0.0467027-0.0230791im        0.11651+0.233997im      0.257973-0.12059im        0.313451-0.10072im       -0.046803+0.0220577im    -0.0387959+0.0593729im      -0.16831-0.0547714im     -0.118575-0.163428im      -0.0675824-0.113082im     0.0595583-0.0443399im    -0.0732763-0.0353865im   -0.0639656+0.173611im     0.150537-0.126403im       -0.166137-0.12507im
   0.100297-0.211559im      -0.0270139+0.0874334im   -0.0915716-0.0736713im    0.0170099-0.0978187im     0.227164+0.220759im    -0.0594645-0.0244585im    0.0646305+0.0911495im      -0.12837-0.151621im        0.052996+0.145334im     -0.0470716-0.067449im      0.0558802-0.117383im       0.238391+0.202988im    -0.0225345+0.202994im      0.0477201-0.0657902im    0.0345957-0.0988796im     -0.127881-0.0462099im       0.229004+0.0599282im   -0.0331163+0.151708im     -0.0312271-0.067956im       -0.153689+0.120204im    -0.0414491-0.113149im     -0.0757431-0.0660536im    -0.0531654-0.234102im       -0.26433-0.069226im      -0.173981+0.00514154im    0.0138497-0.034189im        0.132336+0.11109im      0.0658893+0.29991im       -0.129262-0.123302im     0.0527321+0.151362im   0.00332301+0.0968605im     -0.0163387-0.171802im
   0.102397-0.063836im       0.0565134-0.162164im    -0.0369976+0.226222im     -0.012278+0.0365392im   -0.0139467-0.145847im     -0.105339+0.0574701im    0.0279648+0.0816188im    -0.0398504-0.141526im        0.113919-0.127947im       0.256613-0.0393324im    -0.0438575+0.250529im      -0.159891+0.0130804im   -0.0583277-0.078292im      -0.013399-0.0209635im   0.00855512+0.0680157im     -0.145676+0.0577972im       0.186589+0.00819083im   0.0632699+0.244855im      0.0119876+0.0362713im      0.0753708+0.0342889im   -0.0491767+0.102128im       0.339383+0.152549im       0.156542-0.324814im       0.127556-0.0766152im       0.19805+0.0784351im     -0.132497-0.0912319im     0.00109413+0.0133832im   -0.0523457+0.00189908im    -0.156753+0.122954im     0.0713503+0.12629im      0.119093+0.0240155im     -0.0161889-0.223325im
  -0.312248-0.0357708im       0.034488-0.0305386im   -0.0732567-0.356996im    0.00115251+0.0490533im    0.0258295-0.0812087im   -0.0718734+0.134774im     -0.158965+0.0799633im     -0.065592+0.0179978im       0.118174+0.0692735im    -0.0404407+0.11192im        -0.11641+0.139714im      -0.057691+0.155609im     -0.217946+0.259401im      0.0284839-0.174969im      0.145749+0.0447435im     -0.165792+0.134345im       0.0230637+0.086702im      0.011129+0.0894611im     -0.149897-0.041956im        0.111384-0.0243251im   -0.0452762+0.054532im      0.0493491+0.0541434im      0.093346+0.272897im     -0.0627545-0.169465im     -0.0438142-0.0689181im    -0.0496367+0.000362355im   -0.0524565-0.0838586im    -0.153176+0.0150935im     -0.140157+0.128153im    -0.0486362-0.165315im    -0.161514-0.117267im       -0.244317-0.0304457im
  -0.146601+0.0357915im     -0.0306947+0.154695im     -0.254626+0.0330111im    0.0967657-0.0722553im  -0.00443124+0.0370946im     0.128628-0.0180423im    0.0235788-0.00442166im  -0.00566407-0.111805im       -0.104171+0.0502504im     -0.182015-0.0266658im     -0.130774+0.12044im      -0.0145451+0.0121381im   0.00267143+0.133784im    -0.00998017-0.247044im   -0.00488073+0.0661779im     0.0255109-0.0771416im      0.0406409-0.0992253im    0.0558706-0.0565064im    -0.0316385-0.0281095im     -0.0577168-0.0409035im    0.0514528+0.00949619im   -0.0869146-0.089915im      -0.117773-0.124585im      0.0823677+0.287391im       0.258489-0.296445im      0.0381343-0.0573267im      -0.191201-0.00736551im    -0.15716-0.0583755im      -0.24061+0.157281im      0.132786-0.004001im   -0.0546598-0.0285061im       0.409457-0.116637im
  0.0311105+0.0169736im       0.176751+0.156918im    -0.0398233+0.0870787im    -0.164722-0.115731im    0.00165228+0.00838074im   0.0869564-0.029994im     -0.143698-0.0574242im    -0.0964134+0.0478088im     -0.0758844-0.00378467im   0.00833983+0.102091im      -0.172829+0.0814204im      0.027645+0.0147203im   -0.0556214+0.034241im      0.0589022-0.0855106im   -0.0295196-0.240923im       0.113233+0.0649329im     -0.0242138-0.236847im     0.0313019+0.0195666im    -0.0852829-0.368072im       0.0300842+0.0186774im     0.264958+0.0918026im     -0.065103+0.0239858im      0.109029-0.093432im       0.035565-0.372688im       0.109821+0.0840468im      0.103182-0.242833im       0.0992087+0.177101im      0.115037-0.0638354im      0.136873+0.00875843im    0.164884+0.0764065im   -0.127633-0.1543im         0.0340943+0.133238im
  0.0135442+0.0164616im        0.15738-0.0980029im   -0.0837183+0.00203846im    0.188608-0.0301479im   -0.0330583+0.0380417im     0.105976-0.0087721im    0.0818863-0.0600719im     0.0631865+0.108843im        0.214527-0.112596im      -0.161409+0.164764im       0.284365+0.15151im        0.045203+0.122516im    -0.0967914-0.255029im     -0.0410079+0.0590402im     0.136362-0.164264im     -0.0717625-0.0786053im      0.0309994+0.00816553im   0.0689206-0.131537im       0.179935+0.151252im       -0.173248+0.128706im      0.115197+0.268266im     -0.0569529-0.0380327im     0.0144003-0.0130841im     -0.104528-0.0410188im    -0.0681036+0.0111857im   -0.00996515-0.289664im       0.0528888-0.156952im    -0.0107144-0.081236im      -0.259983-0.185624im      0.118245-0.170267im   -0.0460834-0.120559im    -0.000211716-0.00219066im
   0.122923-0.104157im       -0.149992+0.0958787im   -0.0255298-0.122401im     -0.099526-0.0523395im    0.0451723+0.0313845im    0.0869148-0.040704im    0.00488379+0.0697419im     0.0982612-0.00314142im    -0.0456579-0.117232im      0.0209574+0.0938261im      0.205115-0.0661471im    -0.0770625+0.0263567im     0.305568+0.0862642im      0.179204-0.0302992im     0.276285-0.126392im      0.0208324-0.222985im      -0.0621875+0.0975547im     0.116749+0.075671im      0.0127873-0.0562996im     -0.0904848-0.0669934im    -0.191763-0.0320026im      0.185942+0.0694307im     -0.105066+0.239722im       0.130078-0.0268328im      0.125628-0.0537641im     -0.313689-0.155357im        0.107581+0.102059im       0.15735-0.168369im     -0.0927171+0.13281im      0.0832006+0.147235im    -0.191032+0.0873241im     -0.0158258+0.0722708im
   0.142825+0.123466im       0.0482082+0.0451432im     0.178837+0.0313151im     0.271737+0.165641im    -0.0315578-0.0625628im    0.0772552-0.109132im    -0.0636445+0.073615im     -0.0480002+0.196242im       -0.116239+0.0744308im     0.0704633+0.291563im     -0.0340558-0.092093im      0.0180171+0.134025im     0.0477919+0.143903im       0.196718+0.0890506im   -0.0381629+0.160562im      -0.240702-0.215472im        0.222025-0.0984928im    0.0741114+0.105394im      0.0102287+0.000585354im     0.247444-0.111868im     0.0151104+0.0376877im   -0.00517421-0.0885931im     0.0194951-0.115908im      0.0705713+0.140371im       -0.13859+0.0935158im     0.0700793+0.0107829im     -0.0261753-0.0292849im   -0.0566804+0.0114422im     0.0663876+0.0176471im     0.327894-0.11919im     -0.180133+0.105891im       -0.012481+0.0944202im
  0.0533132-0.0809835im      -0.311486-0.241682im    -0.0452994-0.0990974im    -0.134617+0.0777276im   -0.0668414+0.090342im     -0.209234+0.0499551im   -0.0623768-0.0297277im    -0.0755916+0.163118im       0.0155051+0.19021im       0.0558468+0.0888735im     -0.127925+0.229666im      0.0218806-0.0199542im     0.235879-0.022497im     -0.0828148-0.0127426im    0.0134485-0.239971im       0.260383-0.0718161im       0.214619-0.0512281im    -0.104223+0.0763687im      0.384057-0.0606401im      0.0805254+0.115391im    -0.0550613-0.0421629im    -0.0854074+0.0634441im     -0.116353-0.00466916im   -0.0270913-0.108434im      0.0222882+0.0130679im     0.0138582+0.100942im      -0.0566384-0.127689im     -0.172102-0.0159929im     0.0340124+0.00570163im    0.124977-0.145249im   -0.0637016+0.0264896im      0.0966817-0.0287615im
   0.107125-0.0147092im      -0.103666-0.0780682im     0.072932+0.0619949im   -0.0189413+0.0271041im    0.0511837-0.222345im      0.103046+0.208356im      0.180975+0.125874im       0.151239-0.193994im       -0.205793+0.070549im      -0.093213+0.200465im     -0.0292018+0.125484im     -0.0957062+0.135833im      0.098873+0.0346162im     -0.102561-0.114228im       0.09393+0.00820672im    -0.173152-0.0231067im      -0.246962-0.0703033im   -0.0248964-0.0203623im    -0.0711561-0.191041im      -0.0727579+0.179757im     -0.172581+0.0447327im    -0.0862353-0.0824711im      -0.10429-0.142696im     -0.0792685-0.0328025im     -0.228979+0.285438im     -0.0927862+0.0209114im      -0.109265-0.167737im    -0.0678264-0.0150366im      0.101923+0.046637im     -0.114374+0.0746293im   0.0221791-0.239717im        0.140343+0.0647083im
 -0.0895904-0.0207376im       0.097949-0.235111im    0.00724543-0.209999im      0.186528-0.0543618im     0.276107-0.131417im     -0.236148+0.247456im     0.0646839-0.0737971im     0.0507809+0.06858im        -0.133493+0.0349606im   -0.00244528+0.014537im     -0.0980234-0.0454184im     -0.072578+0.0458266im   -0.0237383-0.133023im     0.00707348-0.015583im     0.0403616-0.0977548im      0.136852-0.230248im       0.0713639+0.0918875im     0.269886-0.0278134im    -0.0532203+0.0373934im       0.028012-0.0295277im     0.300689+0.143722im     -0.0374704+0.00977597im   -0.0493006-0.0675891im    0.00327055+0.163654im    -0.00656263+0.0207255im     -0.041846-0.0271513im     -0.0113833+0.2037im       0.0681044-0.0300526im      0.240412+0.0276515im    -0.193433+0.138638im    -0.164149+0.0591321im      0.0218761-0.20478im</code></pre><p>and then generate the state <span>$ψ$</span></p><pre><code class="language-julia hljs">psi = P[:, 3]</code></pre><pre><code class="nohighlight hljs">32-element Vector{ComplexF64}:
  -0.17830149332396572 + 0.20120948428057417im
  -0.12029044629011171 + 0.03105466966932204im
      0.13461610196902 - 0.025639244595693292im
 -0.013119759299917037 - 0.18789618228934887im
   0.06314206451421836 - 0.07025912811219746im
   0.04058143627788643 - 0.17025050327641902im
   0.14347163704610902 + 0.05354130081753524im
   0.23529243930292962 - 0.15771833217792203im
 0.0002981527326604144 + 0.1558121608225417im
   0.02851864441255173 - 0.20394399306854716im
   0.16246473091704988 + 0.0008472499604557787im
  -0.01774170068009565 - 0.1455675352943031im
   -0.2110301519008715 + 0.14217373733477656im
  0.005626979915119221 + 0.14849586829692843im
   0.20421510071065962 - 0.026283010747709987im
   0.07555904252333175 - 0.1670560986349388im
   0.11585485763938581 + 0.07641832876793823im
   -0.0577225366649834 - 0.08820539961024867im
  -0.04676223467238754 - 0.09363166949132379im
     0.310275010910159 + 0.0im
   0.04721583992046899 - 0.04858043794272391im
  0.015157797754816908 - 0.12389432740892264im
  -0.17600223223743594 + 0.1132796849367235im
   0.11432972516259318 + 0.15342752904605303im
    0.0684535818305898 + 0.043857807743411206im
   0.03763955292461753 - 0.044335061799009715im
  -0.15805919435737054 + 0.13978643336168212im
   0.14199347491984038 - 0.03058867535432382im
  -0.05278773042704347 - 0.004192852974549919im
  -0.15179507337569556 + 0.0975221051288894im
  -0.14394200155708076 + 0.10620955477213621im
   0.21276703545987133 + 0.10458374635826582im</code></pre><p>In the phase estimation process, we will feed the state to circuit and measure the first <code>n</code> qubits processed by iQFT.</p><pre><code class="language-julia hljs">r = join(ArrayReg(psi), zero_state(N))
r |&gt; PE(N, M, U)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 8/8
    nlevel: 2</code></pre><p>Since our phase can be represented by 3 qubits precisely, we only need to measure once</p><pre><code class="language-julia hljs">results = measure(r, 1:N; nshots=1)</code></pre><pre><code class="nohighlight hljs">1-element Vector{DitStr{2, 3, Int64}}:
 011 ₍₂₎</code></pre><p>Recall that our QFT&#39;s bit numbering is reversed, let&#39;s reverse it back</p><pre><code class="language-julia hljs">using BitBasis
estimated_phase = bfloat(results[]; nbits=N)</code></pre><pre><code class="nohighlight hljs">0.75</code></pre><p>the phase is exactly <code>0.75</code>!</p><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../1.prepare-ghz-state/index.html">« Prepare Greenberger–Horne–Zeilinger state with Quantum Circuit</a><a class="docs-footer-nextpage" href="../3.grover-search/index.html">Grover Search »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.4.1 on <span class="colophon-date" title="Thursday 2 May 2024 21:32">Thursday 2 May 2024</span>. Using Julia version 1.10.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
