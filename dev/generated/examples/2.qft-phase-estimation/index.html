<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Quantum Fourier Transformation and Phase Estimation · Documentation | Yao</title><script data-outdated-warner src="../../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.044/juliamono.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script><link href="../../../assets/indigo.css" rel="stylesheet" type="text/css"/><link href="https://yaoquantum.org/assets/favicon-light.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../index.html"><img src="../../../assets/logo.png" alt="Documentation | Yao logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../../index.html">Documentation | Yao</a></span></div><form class="docs-search" action="../../../search.html"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../../index.html">Home</a></li><li><a class="tocitem" href="../../../quick-start.html">Quick Start</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../../../man/registers.html">Quantum Registers</a></li><li><a class="tocitem" href="../../../man/blocks.html">Blocks</a></li><li><a class="tocitem" href="../../../man/symbolic.html">Symbolic Computation</a></li><li><a class="tocitem" href="../../../man/automatic_differentiation.html">Automatic Differentiation</a></li><li><a class="tocitem" href="../../../man/simplification.html">Simplification</a></li><li><a class="tocitem" href="../../../man/bitbasis.html">BitBasis</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../1.prepare-ghz-state/index.html">Prepare Greenberger–Horne–Zeilinger state with Quantum Circuit</a></li><li class="is-active"><a class="tocitem" href="index.html">Quantum Fourier Transformation and Phase Estimation</a><ul class="internal"><li><a class="tocitem" href="#Quantum-Fourier-Transformation"><span>Quantum Fourier Transformation</span></a></li><li><a class="tocitem" href="#Wrap-QFT-to-an-external-block"><span>Wrap QFT to an external block</span></a></li><li><a class="tocitem" href="#Phase-Estimation"><span>Phase Estimation</span></a></li></ul></li><li><a class="tocitem" href="../3.grover-search/index.html">Grover Search</a></li><li><a class="tocitem" href="../4.shor-algorithm/index.html">Shor&#39;s Algorithm</a></li><li><a class="tocitem" href="../5.shor-9-code/index.html">Shor&#39;s 9 qubit code</a></li><li><a class="tocitem" href="../6.quantum-circuit-born-machine/index.html">Quantum Circuit Born Machine</a></li><li><a class="tocitem" href="../7.variation-quantum-eigen-solver/index.html">Variational Quantum Eigen Solver</a></li></ul></li><li><a class="tocitem" href="../../../performancetips.html">Performance Tips</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href="index.html">Quantum Fourier Transformation and Phase Estimation</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="index.html">Quantum Fourier Transformation and Phase Estimation</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/QuantumBFS/Yao.jl/blob/master/docs/src/examples/2.qft-phase-estimation/main.jl" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><p><a href="https://mybinder.org/v2/gh/QuantumBFS/Yao.jl/gh-pages?filepath=dev/generated/examples/2.qft-phase-estimation/main.ipynb"><img src="https://mybinder.org/badge_logo.svg" alt/></a> <a href="https://nbviewer.jupyter.org/github/QuantumBFS/Yao.jl/blob/gh-pages/dev/generated/examples/2.qft-phase-estimation/main.ipynb"><img src="https://img.shields.io/badge/show-nbviewer-579ACA.svg" alt/></a> <a href="https://minhaskamal.github.io/DownGit/#/home?url=https://github.com/QuantumBFS/tutorials/tree/gh-pages/dev/generated/examples/2.qft-phase-estimation"><img src="https://img.shields.io/badge/download-project-orange" alt/></a></p><h1 id="example-qft"><a class="docs-heading-anchor" href="#example-qft">Quantum Fourier Transformation and Phase Estimation</a><a id="example-qft-1"></a><a class="docs-heading-anchor-permalink" href="#example-qft" title="Permalink"></a></h1><p>Let&#39;s use Yao first</p><pre><code class="language-julia hljs">using Yao</code></pre><h2 id="Quantum-Fourier-Transformation"><a class="docs-heading-anchor" href="#Quantum-Fourier-Transformation">Quantum Fourier Transformation</a><a id="Quantum-Fourier-Transformation-1"></a><a class="docs-heading-anchor-permalink" href="#Quantum-Fourier-Transformation" title="Permalink"></a></h2><p>The Quantum Fourier Transformation (QFT) circuit is to repeat two kinds of blocks repeatly:</p><p><img src="assets/qft.png" alt="qft-circuit"/></p><p>The basic building block control phase shift gate is defined as</p><p class="math-container">\[R(k)=\begin{bmatrix}
1 &amp; 0\\
0 &amp; \exp\left(\frac{2\pi i}{2^k}\right)
\end{bmatrix}\]</p><p>Let&#39;s define block <code>A</code> and block <code>B</code>, block <code>A</code> is actually a control block.</p><pre><code class="language-julia hljs">A(i, j) = control(i, j=&gt;shift(2π/(1&lt;&lt;(i-j+1))))</code></pre><pre><code class="nohighlight hljs">A (generic function with 1 method)</code></pre><p>Once you construct the blockl you can inspect its matrix using <code>mat</code> function. Let&#39;s construct the circuit in dash box A, and see the matrix of <span>$R_4$</span> gate.</p><pre><code class="language-julia hljs">R4 = A(4, 1)</code></pre><pre><code class="nohighlight hljs">(n -&gt; control(n, 4, 1 =&gt; shift(0.39269908169872414)))</code></pre><p>If you have read about <a href="generated/examples/2.qft-phase-estimation/@ref example-ghz">preparing GHZ state</a>, you probably know that in Yao, we could just leave the number of qubits, and it will be evaluated when possible.</p><pre><code class="language-julia hljs">R4(5)</code></pre><pre><code class="nohighlight hljs">nqubits: 5
control(4)
└─ (1,) shift(0.39269908169872414)</code></pre><p>its matrix will be</p><pre><code class="language-julia hljs">mat(R4(5))</code></pre><pre><code class="nohighlight hljs">32×32 Diagonal{ComplexF64, Vector{ComplexF64}}:
 1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im</code></pre><p>Then we repeat this control block over and over on different qubits, and put a Hadamard gate to <code>i</code>th qubit to construct <code>i</code>-th <code>B</code> block.</p><pre><code class="language-julia hljs">B(n, k) = chain(n, j==k ? put(k=&gt;H) : A(j, k) for j in k:n)</code></pre><pre><code class="nohighlight hljs">B (generic function with 1 method)</code></pre><p>We need to input the total number of qubits <code>n</code> here because we have to iterate through from <code>k</code>-th location to the last.</p><p>Now, let&#39;s construct the circuit by chaining all the <code>B</code> blocks together</p><pre><code class="language-julia hljs">qft(n) = chain(B(n, k) for k in 1:n)
qft(4)</code></pre><pre><code class="nohighlight hljs">nqubits: 4
chain
├─ chain
│  ├─ put on (1)
│  │  └─ H
│  ├─ control(2)
│  │  └─ (1,) shift(1.5707963267948966)
│  ├─ control(3)
│  │  └─ (1,) shift(0.7853981633974483)
│  └─ control(4)
│     └─ (1,) shift(0.39269908169872414)
├─ chain
│  ├─ put on (2)
│  │  └─ H
│  ├─ control(3)
│  │  └─ (2,) shift(1.5707963267948966)
│  └─ control(4)
│     └─ (2,) shift(0.7853981633974483)
├─ chain
│  ├─ put on (3)
│  │  └─ H
│  └─ control(4)
│     └─ (3,) shift(1.5707963267948966)
└─ chain
   └─ put on (4)
      └─ H
</code></pre><h2 id="Wrap-QFT-to-an-external-block"><a class="docs-heading-anchor" href="#Wrap-QFT-to-an-external-block">Wrap QFT to an external block</a><a id="Wrap-QFT-to-an-external-block-1"></a><a class="docs-heading-anchor-permalink" href="#Wrap-QFT-to-an-external-block" title="Permalink"></a></h2><p>In most cases, <code>function</code>s are enough to wrap quantum circuits, like <code>A</code> and <code>B</code> we defined above, but sometimes, we need to dispatch specialized methods on certain kinds of quantum circuit, or we want to define an external block to export, thus, it&#39;s useful to be able to wrap circuit to custom blocks.</p><p>First, we define a new type as subtype of <code>PrimitiveBlock</code> since we are not going to use the subblocks of <code>QFT</code>, if you need to use its subblocks, it&#39;d be better to define it under <code>CompositeBlock</code>.</p><pre><code class="language-julia hljs">struct QFT &lt;: PrimitiveBlock{2}
    n::Int
end

YaoBlocks.nqudits(q::QFT) = q.n</code></pre><p>Now, let&#39;s define its circuit</p><pre><code class="language-julia hljs">circuit(q::QFT) = qft(q.n)</code></pre><pre><code class="nohighlight hljs">circuit (generic function with 1 method)</code></pre><p>And forward <code>mat</code> to its circuit&#39;s matrix</p><pre><code class="language-julia hljs">YaoBlocks.mat(::Type{T}, x::QFT) where T = mat(T, circuit(x))</code></pre><p>You may notice, it is a little ugly to print <code>QFT</code> at the moment, this is because we print the type summary by default, you can define your own printing by overloading <code>print_block</code></p><pre><code class="language-julia hljs">YaoBlocks.print_block(io::IO, x::QFT) = print(io, &quot;QFT($(x.n))&quot;)</code></pre><p>Since it is possible to use FFT to simulate the results of QFT (like cheating), we could define our custom <code>apply!</code> method:</p><pre><code class="language-julia hljs">using FFTW, LinearAlgebra

function YaoBlocks.apply!(r::ArrayReg, x::QFT)
    α = sqrt(length(statevec(r)))
    invorder!(r)
    lmul!(α, ifft!(statevec(r)))
    return r
end</code></pre><p>Now let&#39;s check if our <code>apply!</code> method is correct:</p><pre><code class="language-julia hljs">r = rand_state(5)
r1 = r |&gt; copy |&gt; QFT(5)
r2 = r |&gt; copy |&gt; circuit(QFT(5))
r1 ≈ r2</code></pre><pre><code class="nohighlight hljs">true</code></pre><p>We can get iQFT (inverse QFT) directly by calling <code>adjoint</code></p><pre><code class="language-julia hljs">QFT(5)&#39;</code></pre><pre><code class="nohighlight hljs"> [†]QFT(5)</code></pre><p>QFT and iQFT are different from FFT and IFFT in three ways,</p><ol><li>they are different by a factor of <span>$\sqrt{2^n}$</span> with <span>$n$</span> the number of qubits.</li><li>the <a href="https://quantumbfs.github.io/BitBasis.jl/stable/tutorial/#Conventions-1">bit numbering</a> will exchange after applying QFT or iQFT.</li><li>due to the convention, QFT is more related to IFFT rather than FFT.</li></ol><h2 id="Phase-Estimation"><a class="docs-heading-anchor" href="#Phase-Estimation">Phase Estimation</a><a id="Phase-Estimation-1"></a><a class="docs-heading-anchor-permalink" href="#Phase-Estimation" title="Permalink"></a></h2><p>Since we have QFT and iQFT blocks we can then use them to realize phase estimation circuit, what we want to realize is the following circuit:</p><p><img src="assets/phaseest.png" alt="phase estimation"/></p><p>First we call Hadamard gates repeatly on first <code>n</code> qubits.</p><pre><code class="language-julia hljs">Hadamards(n) = repeat(H, 1:n)</code></pre><pre><code class="nohighlight hljs">Hadamards (generic function with 1 method)</code></pre><p>Then in dashed box <code>B</code>, we have controlled unitaries:</p><pre><code class="language-julia hljs">ControlU(n, m, U) = chain(n+m, control(k, n+1:n+m=&gt;matblock(U^(2^(k-1)))) for k in 1:n)</code></pre><pre><code class="nohighlight hljs">ControlU (generic function with 1 method)</code></pre><p>each of them is a <code>U</code> of power <span>$2^{(k-1)}$</span>.</p><p>Since we will only apply the qft and Hadamard on first <code>n</code> qubits, we could use <code>Subroutine</code>, which creates a context of a sub-scope of the qubits.</p><pre><code class="language-julia hljs">PE(n, m, U) =
    chain(n+m, # total number of the qubits
        subroutine(Hadamards(n), 1:n), # apply H in local scope
        ControlU(n, m, U),
        subroutine(QFT(n)&#39;, 1:n))</code></pre><pre><code class="nohighlight hljs">PE (generic function with 1 method)</code></pre><p>we use the first <code>n</code> qubits as the output space to store phase <span>$ϕ$</span>, and the other <code>m</code> qubits as the input state which corresponds to an eigenvector of oracle matrix <code>U</code>.</p><p>The subroutine here uses <code>focus!</code> and <code>relax!</code> to manage a local scope of quantum circuit, and only activate the first <code>n</code> qubits while applying the block inside the subroutine context, and the scope will be <code>relax!</code>ed back, after the context. This is equivalent to manually <code>focus!</code> then <code>relax!</code></p><p>fullly activated</p><pre><code class="language-julia hljs">r = rand_state(5)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 5/5
    nlevel: 2</code></pre><p>first 3 qubits activated</p><pre><code class="language-julia hljs">focus!(r, 1:3)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 3/5
    nlevel: 2</code></pre><p>relax back to the original</p><pre><code class="language-julia hljs">relax!(r, 1:3)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 5/5
    nlevel: 2</code></pre><p>In this way, we will be able to apply small operator directly on the subset of the qubits.</p><p>Details about the algorithm can be found here: <a href="https://en.wikipedia.org/wiki/Quantum_phase_estimation_algorithm">Quantum Phase Estimation Algorithm</a></p><p>Now let&#39;s check the results of our phase estimation.</p><p>First we need to set up a unitary with known phase, we set the phase to be 0.75, which is <code>0.75 * 2^3 == 6 == 0b110</code> .</p><pre><code class="language-julia hljs">N, M = 3, 5
P = eigen(rand_unitary(1&lt;&lt;M)).vectors
θ = Int(0b110) / 1&lt;&lt;N
phases = rand(1&lt;&lt;M)
phases[0b010+1] = θ
U = P * Diagonal(exp.(2π * im * phases)) * P&#39;</code></pre><pre><code class="nohighlight hljs">32×32 Matrix{ComplexF64}:
   -0.150684-0.0407818im    -0.0335223+0.184548im      -0.212836+0.0870866im     0.0467316+0.0434892im   0.0396155-0.114938im      0.0108135-0.191485im      0.143032+0.223268im        0.249644-0.143176im     -0.153736+0.134434im     -0.0593299-0.0326437im     0.103019-0.0352129im      0.16751+0.0755051im     0.179948-0.04505im       0.045666-0.188787im    -0.0408119+0.311904im      0.0614631-0.0183506im      0.0475703-0.0310191im     0.0164032-0.0308204im      0.328874+0.0141162im     0.113007-0.0205029im   0.0371978+0.00530501im     0.149123+0.162319im     0.0643692+0.0262721im    -0.0451114-0.108556im      0.0606868+0.0368746im    0.220447+0.00439023im    0.0209194-0.0736609im     -0.126236-0.229107im     -0.0812974+0.0180186im     -0.175625-0.0324813im     0.0360007-0.14232im        0.151203-0.0765139im
   0.0298175-0.164527im      0.0862278+0.142605im      -0.119445+0.101377im      0.0824856-0.0479039im   -0.116448+0.0832774im      -0.16892-0.08798im     -0.0759934-0.124563im        0.126753+0.0654512im    -0.120194-0.143419im      -0.246679+0.0691593im   -0.0200511+0.15622im       0.108675-0.223063im      0.183807-0.113658im      -0.07737-0.0576036im     -0.24444-0.00129829im    -0.311472+0.0990558im      0.0126743-0.0332016im      0.160383+0.00711577im     0.115072-0.0300984im   -0.0257345+0.0300177im   -0.141098+0.126845im      0.0425665-0.0131583im     0.122753-0.0308001im     -0.131314-0.0399814im      0.106264+0.0196577im  -0.0835501+0.0551012im      0.101687+0.106319im     -0.0167635+0.378172im       0.146137-0.148882im      0.0617111-0.0645669im    -0.0184466-0.089806im     -0.0967238+0.176414im
  -0.0725768+0.0021407im     -0.165484-0.0425004im     0.0323532+0.000964879im   0.0481191+0.0866591im  -0.0912064+0.284374im      0.0544253+0.0518058im     0.142359+0.113332im       0.0347254+0.0848398im    -0.074393+0.00560573im  -0.00954441-0.0181989im    0.0269119-0.163467im    0.00340822-0.0861638im    -0.233833-0.271773im    -0.0552086-0.302992im    0.00942423+0.0876784im     -0.206807-0.017905im       -0.297697-0.0338956im     0.0465472-0.031179im      -0.195167+0.104492im     -0.171397+0.0501225im  -0.0435809-0.0928135im     -0.095216+0.222328im     -0.046388-0.0988063im     0.0647169-0.0586192im     0.0836443-0.0260513im   -0.028776+0.0195548im      0.196172+0.0704314im    -0.0306411-8.22374e-5im    0.0803739+0.00149828im    -0.113925-0.1128im         0.117862+0.131059im     -0.0825774-0.342803im
   0.0146807-0.0740521im      0.114135-0.0109654im      0.112446+0.182354im      -0.150272-0.0935063im  -0.0838234-0.0774995im    -0.0354634-0.193963im      0.124155-0.0732414im     -0.0633993+0.102167im      0.214501-0.147023im      -0.208045-0.221517im      0.239359-0.0862611im   0.00313275+0.0883218im    -0.171634-0.00155764im     0.19206+0.0834162im  -0.00266716+0.0451375im    -0.0235234-0.0308907im      0.0172967+0.0494752im      0.137029-0.0806875im      0.061938+0.128671im     0.0222468+0.150588im   -0.0591166+0.057564im     -0.0593707+0.170575im      0.066804-0.0702143im    -0.0896827+0.277728im      -0.158318-0.27688im    -0.0245344-0.00549824im   -0.0882721-0.0913304im     -0.141853+0.0372087im     -0.278169-0.15563im       -0.100648-0.195228im     -0.0596955+0.0866554im    -0.0285241-0.00883211im
   0.0174746-0.192062im      0.0913364+0.00269449im    -0.138549+0.103268im        0.18929+0.298599im   -0.0857154-0.086255im       0.155227-0.0826263im    -0.158291-0.141605im       -0.127817+0.153385im      -0.12693-0.122127im       0.165063-0.102793im    -0.0247292-0.149606im     0.0203585+0.144387im     -0.129401+0.0649728im   -0.0555323+0.0307477im  -0.00401849+0.324296im     -0.0494842+0.0743327im     -0.0780352-0.139873im      0.0053219+0.214734im      0.0409391-0.237174im     -0.174018-0.154754im    0.0366452-0.132993im     -0.0633166-0.00764767im  -0.0799104+0.101783im     -0.0868385+0.0650311im    -0.0858815+0.0776209im    0.131871-0.0909042im     0.0498222-0.237167im       0.069865+0.100105im      -0.102817+0.0120977im   0.000313757-0.00113249im    0.0334183+0.0854579im     -0.184418+0.127576im
    0.140454-0.05321im      -0.0600744-0.164143im     -0.0476253+0.049286im        0.15254+0.129273im     0.136448-0.0729565im     -0.048003-0.00320151im     0.10954+0.00626607im       0.20754-0.00741684im   -0.141058+0.319669im     -0.0466713-0.220909im    -0.0664214-0.102951im     -0.144814+0.0553428im   -0.0553622-0.243141im      0.071342+0.0672856im   -0.0232979-0.0610116im     -0.204147-0.153031im        0.318357-0.00147121im    -0.102731-0.00106455im     0.156383-0.00301976im  -0.0434387+0.0938907im  -0.0657161-0.0244703im    -0.0231187+0.0638686im   -0.0818117+0.0940626im      0.154385+0.243623im      0.0705652-0.139708im    0.0356448-0.0282632im    -0.0227694+0.174257im       0.176869+0.0933599im     0.0213475-0.0147945im     0.0453668+0.269937im     -0.0560448+0.178098im     -0.0280843+0.0590861im
     0.12203-0.0705089im      0.248789+0.13816im        0.152748-0.0298984im    -0.0233584+0.0996169im   0.0533272-0.153744im        -0.1383-0.185767im    -0.0700937+0.0286075im       0.109979-0.00578214im  -0.0689875-0.0288981im      0.109947+0.0762762im   -0.0828005-0.150535im      0.168112-0.14665im       -0.09694+0.0296412im    -0.126321+0.0235577im    -0.140563+0.0288409im     -0.153593-0.0186651im     -0.0672788+0.0730969im     -0.355694+0.103853im     -0.0430373+0.124436im     -0.146927-0.04104im     -0.148104+0.0672388im     0.0544279-0.198687im      0.031809-0.0093828im     0.0693175+0.0684435im    -0.0980104-0.239057im   -0.0510365-0.090143im      -0.131935-0.00414715im    0.0849288-0.246107im       0.223847-0.00268826im   -0.0319497-0.247029im       0.045571+0.0397986im      0.206291-0.06362im
   0.0130048-0.13118im       0.0144383+0.0991909im     -0.146456-0.245883im     -0.0742817+0.0087519im     0.16888-0.232002im    -0.00505367-0.24031im      0.0515067+0.117062im       -0.343847+0.146349im    -0.0413481+0.0740751im    -0.0041971+0.0243339im     0.136866+0.0807773im   -0.0724975+0.0382528im   -0.0174632+0.045412im    -0.0672529-0.165423im      0.202556+0.0512809im    -0.0794628+0.0436041im     -0.0408329-0.0312818im    -0.0389629-0.0666466im     -0.112344-0.143039im     -0.121843-0.0300707im  -0.0352749+0.143308im      0.0810835+0.141304im    0.00230201-0.35756im        0.196473-0.0631665im     0.0361895+0.0409218im    -0.03152+0.0104537im     -0.182981+0.236517im      0.0697909+0.0195094im    -0.0244039-0.242488im     -0.0122227+0.122148im    -0.00131859-0.0421967im    -0.0279225+0.105082im
  -0.0440249-0.117397im      0.0596577-0.3989im      -0.00351075-0.0373622im      0.095508-0.0232522im  -0.0971535+0.110771im      0.0875266-0.297806im     0.0739807+0.0942632im     -0.0989379-0.263522im      -0.11064+0.0375256im    -0.0966374+0.0914851im    0.0168588-0.031253im      0.309293-0.0246949im    -0.127645+0.0180689im   -0.0460052+0.0550966im   -0.0181149-0.0995203im      0.197772-0.0926055im      0.0542025+0.115771im      -0.173938-0.0393092im      0.040798+0.0139746im    -0.130159-0.0292677im   0.0783679-0.0781343im     0.0329137-0.055437im     0.0180262+0.0488294im       0.12949-0.128765im      0.0490017-0.0153489im   0.0901826+0.34599im       0.0180979-0.0343151im   -0.00417617+0.160817im      -0.101478-0.152647im       0.208856-0.138522im     -0.0504948-0.0105214im     -0.114357-0.0052716im
   0.0507992+0.128149im      -0.169026-0.0105808im      0.200701+0.0862575im     -0.191208+0.176648im    -0.277177+0.0184567im      0.182955-0.0749972im     0.113174+0.0650162im        0.05712-0.0268341im    -0.194518+0.0829966im    -0.0531983-0.176075im    -0.0969706+0.124545im    -0.0868559+0.0945597im    -0.150281+0.0947683im    -0.010993-0.118802im      0.100375-0.09938im       -0.140385-0.0506988im      -0.082371+0.00171799im      0.11179+0.143311im      0.0819153-0.0807201im     0.143584-0.0415433im   0.0473845+0.135036im      0.0995162-0.403213im    -0.0377265-0.190961im      -0.200455+0.105565im       0.084342+0.0248926im   0.0930932+0.150602im     -0.0457136+0.100736im       0.105131-0.0756718im    -0.0242097-0.0846494im    -0.0206242-0.102001im       0.172731-0.0685817im     0.0105199+0.112508im
  -0.0414989+0.0875431im      -0.12267+0.0148062im      0.105008+0.0308176im     0.0724981+0.10515im       0.15192-0.25734im       0.0292357+0.11551im     -0.0260351-0.0789071im      -0.145158-0.125041im    -0.0624654-0.140016im      -0.160867+0.121097im     -0.428058+0.0668514im     0.118608+0.132739im      0.276564-0.142115im     0.0264211+0.0626193im    0.0553093+0.146521im      0.0179673-0.0184937im     -0.0657892+0.0122232im   -0.00500399-0.0442433im     -0.124163+0.270823im     -0.211588+0.0749843im    0.160225-0.0571735im     0.0554702-0.0654145im    0.0785448-0.116335im     -0.0143973+0.2002im        0.0666139-0.101176im     0.108267-0.0728122im      0.186688+0.121936im     -0.0419752+0.0119697im     -0.207602-0.12477im     -0.00588195-0.036575im      0.0635902-0.00693115im   -0.0246578-0.00694066im
   0.0110478+0.0877594im    -0.0121083-0.0604706im    -0.0412395+0.0218309im     -0.018203+0.0136625im  -0.0166696-0.0558131im     -0.175011-0.103624im      0.180051+0.299353im    -0.000936812-0.120321im    -0.0352186-0.267666im      -0.162979-0.0732773im    0.0234343+0.109881im     -0.355337-0.0658921im    0.0668542-0.172065im    -0.0718876-0.122432im     -0.227986-0.0733534im     0.0152637+0.0783892im     -0.0763311+0.0332552im     0.0357919+0.105092im      -0.203903-0.00420004im   -0.135769-0.0887453im  -0.0909625-0.133871im      0.0823535-0.0966385im   -0.0346519+0.0341363im        0.1607+0.0210484im     -0.190658-0.0674777im    0.106487+0.0674985im   -0.00862386-0.273551im      -0.108851-0.12178im      -0.0461685+0.123614im      0.0694526+0.204924im      0.0148687-0.0247206im    -0.0468471+0.233761im
   -0.217468+0.0191108im    -0.0666383+0.141602im     -0.0481558+0.202356im      -0.106729+0.0996845im  -0.0718709+0.00241626im    0.0359054+0.0591092im    0.0068404-0.313372im      -0.0330976-0.0437358im   -0.0358484+0.0648557im    -0.0719448-0.166914im    -0.0613824+0.180959im     0.0352325-0.141245im     0.0197792-0.102247im     -0.167269+0.0506743im     0.053063-0.0826916im     0.0111621+0.0797269im       0.208151+0.117425im      -0.152572-0.118115im     -0.0315837+0.028839im    -0.0575071-0.27467im     -0.159764-0.199053im      -0.113307+0.138216im     0.0219943-0.075699im      0.0576079-0.0291791im    -0.0968506+0.253058im    -0.107424+0.210121im     -0.0560194-0.0350104im    -0.0284937-0.193943im      -0.059345-0.136942im      -0.125296-0.0575161im     0.0685197+0.266806im       0.133053+0.0955057im
   0.0611106+0.144399im       0.118353+0.104913im      0.0154051+0.111341im     -0.0660519-0.0773394im  -0.0560022-0.18988im      -0.0304267-0.0609495im     0.182911-0.0454424im      0.0109635-0.180419im     -0.180995-0.230535im       0.123147-0.0819668im     -0.12632-0.0280049im    -0.127036-0.075204im    -0.0387937+0.156239im    -0.0687727+0.0232953im     0.137505-0.183617im       0.104394-0.0193188im       0.106129-0.276103im       0.229794-0.140057im        0.15192-0.0179281im    -0.246004-0.0393519im   0.0818572+0.0938729im     -0.214628+0.217432im     -0.120884+0.0811371im      0.177437-0.100547im      0.0695525-0.105273im     0.065866+0.0222318im     0.0901348+0.0499577im      0.193646+0.0652535im      0.135819+0.098154im     -0.0830198-0.19674im       0.0548921-0.0834588im   -0.00116184-0.0131428im
   -0.183397+0.00155434im    -0.104732+0.0102866im      0.183723+0.022065im       0.304417+0.0413114im   0.0313888+0.0112832im     0.0681557+0.0391412im     0.116365-0.250296im      -0.0334935+0.056758im      -0.11566-0.0605024im      0.145126-0.0829698im    0.0367634-0.0620533im   -0.0908271-0.0759186im    0.0931605+0.0923618im     0.288517-0.0932178im   -0.0310208-0.0600852im      0.194753+0.0862107im      -0.120487+0.0611725im     -0.049614+0.158453im      0.0461856-0.0412081im     0.149354-0.0751091im   -0.062289-0.00496405im     0.140162+0.068147im     -0.153861-0.189655im       0.174737+0.00131725im     0.105856-0.265035im    0.0500535+0.0393456im      0.086174-0.044126im      -0.218999+0.114156im       0.233613-0.150106im      0.0540872-0.0179232im     -0.127882+0.0313737im      0.225022+0.12411im
  -0.0442945-0.0138075im     0.0267197-0.0890228im    0.00191467+0.0480651im     0.0500831+0.0134907im   -0.130551-0.239625im       0.273383+0.0869335im    -0.103768+0.133217im      -0.0112238+0.042099im    -0.0507841+0.0413253im     -0.115714+0.351531im    -0.0203392-0.165617im    -0.0747946-0.0870622im   -0.0122483+0.139722im     -0.313057+0.0924638im   -0.0573805-0.102361im     -0.0248114-0.104726im       -0.121998+0.0415756im      0.246052+0.0145298im     0.0519019-0.0248269im     0.215268-0.060078im    -0.251234-0.208301im      -0.128527+0.128591im      0.105507+0.0236136im    -0.0417388-0.0122244im    -0.0682514-0.229295im     0.170031+0.0377812im    -0.0397163+0.194428im     -0.0537234-0.044352im     -0.0114463-0.0677765im     -0.049117+0.135458im     -0.0531578+0.110553im      0.0818744+0.0193176im
   0.0090902+0.00966253im   -0.0530148-0.0649357im    -0.0990059+0.167305im     -0.0771663+0.0337564im     0.15902+0.0597456im     0.0913726-0.130858im      0.138573-0.012415im       0.0775316+0.048323im    0.00121951+0.0466614im     -0.111615+0.353641im    -0.0970315+0.10169im     -0.0204311-0.0207423im    -0.142379+0.0712012im     0.264618+0.0200624im    -0.129557+0.00108875im     0.129398-0.0774168im     -0.0590926-0.13622im        0.160566+0.0717209im     0.0821323-0.0252933im    -0.218304-0.102411im    -0.124644-0.139069im       0.140722-0.125985im     -0.271225+0.091926im    -0.00868028+0.0146731im    0.00559901+0.0872236im   -0.395283-0.136045im     -0.0360104+0.0673031im     0.0386158-0.115002im     -0.0370991-0.173126im      -0.188214+0.00901801im    -0.166977-0.0296139im    -0.0128851-0.0144129im
   0.0711968-0.125807im     -0.0533073-0.0819269im     -0.141732-0.140582im      0.0474025-0.220681im    0.0911282-0.049368im       0.112555+0.164302im    -0.0645526-0.0194503im       0.164236-0.109889im     -0.190046-0.0675906im   -0.00161087+0.004864im     -0.157976+0.0552039im    0.0374641+0.0834466im   -0.0746219-0.0351041im   -0.0263406-0.0686722im  -0.00889643-0.139116im      -0.068426+0.056049im        0.038032-0.081112im      -0.133056-0.0926278im     -0.126248-0.280183im    -0.0424976+0.0942259im   -0.222285+0.197336im     -0.0480493+0.0507429im    -0.250319-0.126076im      -0.181062+0.0889834im     0.0304152-0.0041822im     0.09495+0.0161024im    -0.0667039-0.0148398im     -0.317179-0.139007im      -0.169924+0.153702im     -0.0334156-0.253278im      -0.230949+0.0567872im    -0.0691851+0.0484713im
    0.261938+0.009498im       0.153796-0.131172im     -0.0394287+0.00847587im     0.122016+0.189412im     0.025115-0.0786056im    -0.0659346-0.0918057im   -0.0441678+0.06813im       -0.0228856-0.11986im      0.0545743+0.0411752im     0.0854964+0.0637237im    -0.126746+0.0220784im   -0.0526817+0.0779764im     -0.18869+0.106289im     0.0825847-0.202659im      0.010794-0.0752321im    -0.0918275+0.0330628im       0.340919+0.0836975im      0.152545-0.0146973im     -0.277991+0.046919im      0.121011+0.0247593im   0.0383946-0.150197im       0.111507+0.099725im      0.156607-0.146795im      -0.163186-0.161438im      0.0777927+0.0552062im  -0.0931487-0.0436821im      0.187748-0.150888im     -0.0516018+0.15687im      -0.0320417+0.0380573im     -0.199532-0.0824073im   -0.00823486+0.0457641im      0.314969+0.0581685im
     0.21226-0.132519im      -0.194456-0.177365im      -0.177048+0.0378832im    -0.0321634-0.0177049im    -0.10367+0.0269461im    -0.0209743+0.0406706im     -0.13247-0.0688361im       0.128465+0.0568549im     0.105845+0.0895626im     -0.053792+0.0860849im    0.0396615+0.0650037im    -0.237162-0.0936106im   -0.0224186+0.117718im    -0.0562297-0.255796im      0.158074-0.081239im       0.186847+0.072885im       -0.124199+0.121252im      -0.143589-0.0609627im      0.301374+0.0912711im    -0.345849-0.160089im     0.169636+0.0814235im   -0.00584951+0.027669im      0.239042-0.00352337im   -0.0962522+0.0796521im     0.0050055-0.109067im    0.0133892-0.183959im      0.0193955+0.0201781im     -0.145611+0.00569853im    0.0134074+0.0451758im     0.0790821-0.0406286im     0.0857993+0.0997678im      0.100354+0.0999802im
  0.00213326+0.263344im     -0.0860773-0.107087im       0.145978+0.0284249im      0.122052+0.112394im     0.175457-0.183887im       -0.14922+0.115983im     0.0213192+0.24493im       -0.0341476-0.0232723im   -0.0179707+0.0181985im    -0.0839364-0.193627im      0.142955+0.237846im     0.0607145+0.106079im   -0.00599373+0.152481im    -0.0406737+0.112594im    -0.0979879+0.0813163im    -0.0916137+0.191005im       -0.191626+0.155049im      -0.113927-0.0267533im      0.164761-0.153398im    -0.0182409-0.18094im    -0.0472397-0.136687im      0.0112902+0.109586im    -0.0645501+0.0403439im     -0.119274-0.132403im     -0.0437428-0.0632892im   -0.192183-0.0216383im    -0.0133387+0.210027im      0.0513274+0.220259im     -0.0831145+0.177297im      0.0244642-0.207875im     -0.0408952+0.0742804im     4.2252e-5-0.083038im
 0.000560066-0.200696im       0.129086+0.0513293im      0.065698-0.0105751im    -0.0435847-0.327508im     0.165237+0.0110091im     -0.231898-0.110882im      0.023502+0.0624594im     -0.0166175+0.0593883im   0.00561492-0.00932718im    -0.050697+0.0692714im    -0.124113+0.00594148im  -0.0442599+0.290813im     -0.104681-0.111841im      0.122387+0.126525im      0.188856-0.0795824im    -0.0426804-0.12632im        -0.246464-0.0087829im     -0.121055+0.0922405im      0.138316+0.0122316im    0.0431406-0.182371im   -0.0180967-0.121851im      -0.168421-0.0251172im   -0.0661441-0.0127718im     -0.176379-0.000837785im  -0.0419456+0.119821im      0.13006+0.214805im       0.237082+0.0294825im    -0.0538059+0.0951845im      0.161438+0.0341281im     -0.185413+0.121324im       0.141094+0.0817516im      0.146512+0.102954im
    0.234882-0.0111234im     -0.245205-0.00815661im    0.0367939+0.144772im       0.111931+0.0693913im   -0.127287-0.0216305im     -0.156288+0.0527627im   -0.0655498-0.0536607im       0.266096-0.113012im     0.0711988-0.143746im      0.0699695+0.167524im     0.0677462+0.158458im      0.121657+0.0849208im   -0.0254999-0.126559im     0.0064936+0.112513im      0.110494+0.0447328im     -0.011566-0.204491im      -0.0585621+0.053338im     -0.0732016+0.157682im      -0.193468+0.0152096im     0.111527-0.210862im     0.126965+0.172708im     -0.0917245+0.260742im     -0.103427-0.064557im      0.0155044-0.187372im     0.00230327-0.174295im   -0.0023191+0.0242359im     -0.271333-0.0661615im     0.0947946-0.00835555im   -0.0477462-0.154977im      -0.141077+0.100786im      0.0329066-0.119381im      -0.124142+0.0743939im
   -0.403134+0.0938011im    -0.0563552+0.0434039im     0.0449617-0.438165im       0.185688+0.100476im    -0.172526-0.143028im      0.0910629-0.16798im       0.142622-0.0575171im       0.192961-0.0735293im     0.161412-0.182531im     -0.0275867+0.0598327im  -0.00479739+0.0318965im    -0.104839+0.026393im     -0.153099-0.101162im    0.00653611+0.0212539im   -0.0502776-0.0738132im   -0.00949643+0.0172143im    -0.00408337-0.0945849im     -0.158708-0.0933218im     0.0256917+0.00721312im  -0.0866685+0.114253im     0.127825-0.01446im      -0.0899748+0.00136164im   0.0892573+0.0909874im      -0.30866-0.0157916im     0.0361889+0.0531416im  -0.0386372-0.0895136im      -0.15724+0.00680738im     0.108088+0.091237im      0.0605331-0.0612461im     -0.110152+0.0885675im    -0.0938257+0.0751426im     0.0803019+0.0760859im
    0.158895-0.0964927im    -0.0491507+0.295553im     -0.0599228-0.231791im      -0.264365+0.11891im     -0.105331+0.126502im     -0.0498848+0.0259958im    0.0922879+0.053646im        0.161458+0.0233109im   0.00338208+0.109952im     -0.0298166-0.0145454im    -0.238132+0.00744951im   -0.018801-0.0185989im     0.050051+0.0605723im    0.0645329+0.230995im      0.127242+0.0467757im     0.0575442+0.178295im       -0.121182-0.114325im      0.0555627+0.14274im     -0.00167579-0.0362366im   -0.0814287+0.0277766im  -0.0508714-0.14011im       0.0971949+0.02312im       0.130523-0.0162746im      0.101339-0.0970707im      0.130686-0.176527im    0.0195889+0.219577im      -0.146945-0.147585im     0.00345012+0.20451im        -0.18564+0.0611552im     0.0565583+0.0311222im     -0.218756+0.201556im       0.116999-0.150015im
   0.0251724+0.055297im    -0.00364724+0.105086im      -0.146388+0.0379006im     0.0210786+0.0437065im  -0.0895976+0.125295im      0.0699975+0.240873im    0.00242694+0.248296im       -0.179315-0.152421im      0.055066-0.0765269im    -0.0877806-0.144676im    -0.0540655-0.231851im       0.19279-0.0431717im   -0.0138953+0.0922833im      0.11464+0.0215373im   -0.0441482-0.00156882im    -0.011213-0.0758942im     -0.0656705+0.0479518im     -0.131401-0.178032im       0.127599+0.00049536im  -0.0717403+0.0604622im   -0.153987+0.204917im      -0.216398-0.190719im    -0.0864474-0.0730423im     0.0310162-0.245369im      0.0889099-0.109957im    -0.127905-0.153411im      0.0667762-0.121872im      0.0228687+0.0623072im      -0.12184-0.119699im      -0.151499+0.228477im      0.0906767+0.119994im       0.128356+0.249774im
   0.0239754+0.150601im      -0.270367-0.105768im       -0.10782+0.11586im       -0.148834+0.0466072im   0.0538261-0.105995im      0.0210953-0.240577im      -0.28454-0.0785641im     -0.0167011-0.0911832im   -0.0464985-0.0138891im     -0.045811+0.0437653im    0.0731736-0.171515im      0.080431+0.0015361im    0.0549624-0.0883876im     0.183812+0.0995734im     0.128735-0.0166856im     -0.167928+0.346552im       0.0501867+0.0318274im       0.10081-0.121905im      0.0225764-0.00729353im   -0.104819+0.166711im    0.0572518-0.0930498im      -0.10929-0.100798im     -0.171984-0.116922im      -0.142129-0.158534im      -0.189437-0.105706im    0.0497059+0.112468im     -0.0892859-0.0662489im    -0.0748185-0.0295787im      0.298986+0.0436959im     0.0529432+0.15733im      -0.0204869-0.00707067im    0.0428401-0.122106im
 -0.00431788-0.188048im     -0.0631928-0.0361028im       0.12491-0.0477302im    -0.0920802-0.0525358im    0.110228-0.0415953im    -0.0177419-0.151562im     0.0743874-0.107639im         0.03055-0.0799799im    -0.354081-0.0942243im     0.0400915+0.0329032im     0.194969-0.104388im    -0.0428887+0.040869im      0.123798-0.104409im     0.0269654+0.0405475im    0.0518563-0.226142im      0.0878518+0.235154im       0.0540924-0.0283445im    -0.0403772+0.121943im     -0.0595174-0.0316617im     0.157254-0.0552163im  -0.0952157-0.0580965im     -0.108765-0.106474im      0.177004+0.100908im     -0.0557675-0.163182im        0.19056-0.0827089im   -0.174527-0.311444im       0.040072+0.0163277im     -0.021097-0.0259395im     -0.264273-0.0352095im    -0.0203038+0.0503248im       0.29617+0.095126im      -0.120625-0.124216im
   -0.159396+0.00892272im    -0.029452-0.010504im      -0.204992+0.0407591im    -0.0298862+0.109068im    -0.042974+0.140784im      0.0569125+0.107846im    -0.0147259+0.0273007im     -0.0543202+0.0321414im   -0.0259354-0.0416789im     0.0233436+0.0237466im    0.0249368+0.0502747im    -0.135348+0.137012im      0.022271+0.0174796im    0.0967905-0.05807im       0.305396-0.00175897im    -0.127149+0.0375065im       0.115984-0.0891008im     -0.250043-0.0626268im     -0.134786+0.0319811im   0.00738594-0.0706809im   -0.267047-0.0652403im     0.0140703-0.0982138im     0.123186+0.338183im      0.0395919+0.0323672im     -0.167314-0.251352im   0.00937228+0.0836718im     0.0289186+0.113697im      -0.024544+0.152089im      -0.021879-0.074901im       -0.11614-0.110644im     -0.0104801-0.45145im       0.0738395-0.0290114im
   0.0964998-0.0708492im    -0.0436719-0.0515662im    -0.0828877-0.079687im      0.0224115+0.131692im    0.0352793-0.157352im      0.0446148-0.0528127im   -0.0195541-0.112706im      0.00790566-0.341346im     0.0731336+0.0967117im    -0.0772254-0.0280479im     0.129794-0.171589im      -0.18618-0.184075im      0.179217+0.00882097im   0.0102366+0.0659245im     0.159787-0.0795493im     -0.140223-0.130931im       -0.342187-0.00869451im   -0.0272567+0.0727295im     0.0168585+0.166292im      0.111041+0.0509727im   -0.178194+0.0348857im   -0.00714853+0.0957573im    -0.188389+0.00198307im  -0.00779013+0.116268im     -0.0286631+0.332799im   -0.0846421-0.0308599im     0.0443551-0.181316im        0.13344+0.120875im      -0.125562-0.00668332im      0.12726-0.156639im    -0.00523696-0.146691im       0.157583-0.0280169im
  -0.0269085-0.182683im     0.00498527+0.0188858im      0.119126+0.103174im      -0.182459-0.108724im    -0.165027-0.0486717im     0.0558108-0.144083im     -0.124912-0.108365im       0.0751103-0.128392im     0.0248991-0.0880436im     -0.121633-0.168299im    -0.0996195+0.0691932im    -0.152401-0.0242962im   -0.0966417+0.140094im     0.0583764-0.107255im    -0.0803728+0.289599im       0.148352-0.0311672im      0.0432281+0.207301im      -0.182084+0.0344258im     -0.102182+0.0664165im    0.0136779+0.0222922im   -0.175919-0.107306im      -0.159158+0.00899868im  -0.0597293-0.138713im    -0.00776921-0.144262im       0.145772+0.0250537im   0.0739955-0.147303im        0.14016+0.218815im        0.16862+0.0102848im   -0.00547264+0.172509im      0.0407889+0.191604im      -0.280838-0.179578im     -0.0567806-0.107358im
   -0.111161+0.0891814im      0.182582+0.159116im      0.0401811+0.133451im       0.080593-0.169389im    -0.151636-0.0868155im     0.0355341+0.104251im     0.0552468+0.0788633im      0.0907036-0.0169492im   -0.0882492+0.27053im      -0.0412626+0.219782im     0.0744742-0.0739399im    -0.184544+0.104624im      0.163228+0.28541im       0.252172-0.100139im    -0.0490067-0.047315im      -0.269391-0.000586258im    0.0644728-0.00323385im    -0.200625-0.0221223im    -0.0881664+0.127347im    -0.0956549-0.0558002im    0.151022-0.16366im       -0.157388-0.0289106im   -0.0017298-0.165023im      0.0283027-0.0353987im     0.0392358+0.0387254im   0.0123131+0.0123086im     -0.142276-0.166207im     -0.0358841+0.0741978im    -0.0143625-0.0385775im     0.0568553-0.0870449im     0.0136053+0.0731282im     -0.313174-0.0167088im</code></pre><p>and then generate the state <span>$ψ$</span></p><pre><code class="language-julia hljs">psi = P[:, 3]</code></pre><pre><code class="nohighlight hljs">32-element Vector{ComplexF64}:
    0.07147736420613215 + 0.11550056202057442im
   0.024901795649475242 + 0.07510516807895663im
  -0.060459959558266003 - 0.13942670766470033im
   0.036230139654932755 + 0.05427450443621655im
    -0.1011245360169784 + 0.25557396009994404im
 -0.0022704648831038746 + 0.12353572786318953im
    -0.1552927187931343 + 0.19547723326648342im
     0.0127824550676541 - 0.09096353667038262im
   -0.03766487992200078 - 0.09036926164019247im
    0.11936301010398484 + 0.24640926488603804im
   -0.08608727464757243 + 0.06545914606127168im
  -0.004837367614537923 - 0.06089117792767594im
  -0.004874963868455429 + 0.2083377358708829im
  -0.001386638961823311 - 0.14598958630545436im
   -0.00941629867529363 - 0.10209771698551963im
   -0.13787900704566403 - 0.05473850878373236im
   -0.05602521951978584 - 0.2686989945313424im
   -0.06260491846743539 - 0.05223492235848877im
    0.11584694027364391 - 0.017542299091240304im
    0.11344434468018137 + 0.04200333035819642im
    -0.1279861723994047 - 0.11539619535018603im
   0.004262539552907188 + 0.2512492764686757im
    0.18990210786890604 - 0.06517646615902559im
    0.03418776432996732 - 0.12994345950208808im
   -0.01128563220144109 - 0.24463081873428572im
    0.21680508197721612 - 0.03222976044205683im
    0.08544970950128089 + 0.02290521076045972im
    0.02056953866205631 + 0.09922206629406066im
   0.024342473398179822 - 0.011920420614732868im
   -0.24698953101637208 + 0.10147255818835338im
    0.33628439412713657 + 0.0im
  -0.004399822567634125 - 0.12773293584558215im</code></pre><p>In the phase estimation process, we will feed the state to circuit and measure the first <code>n</code> qubits processed by iQFT.</p><pre><code class="language-julia hljs">r = join(ArrayReg(psi), zero_state(N))
r |&gt; PE(N, M, U)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 8/8
    nlevel: 2</code></pre><p>Since our phase can be represented by 3 qubits precisely, we only need to measure once</p><pre><code class="language-julia hljs">results = measure(r, 1:N; nshots=1)</code></pre><pre><code class="nohighlight hljs">1-element Vector{DitStr{2, 3, Int64}}:
 011 ₍₂₎</code></pre><p>Recall that our QFT&#39;s bit numbering is reversed, let&#39;s reverse it back</p><pre><code class="language-julia hljs">using BitBasis
estimated_phase = bfloat(results[]; nbits=N)</code></pre><pre><code class="nohighlight hljs">0.75</code></pre><p>the phase is exactly <code>0.75</code>!</p><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../1.prepare-ghz-state/index.html">« Prepare Greenberger–Horne–Zeilinger state with Quantum Circuit</a><a class="docs-footer-nextpage" href="../3.grover-search/index.html">Grover Search »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.19 on <span class="colophon-date" title="Friday 10 June 2022 03:12">Friday 10 June 2022</span>. Using Julia version 1.7.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
