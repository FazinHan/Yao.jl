<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Quantum Fourier Transformation and Phase Estimation · Documentation | Yao</title><script data-outdated-warner src="../../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.044/juliamono.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script><link href="../../../assets/indigo.css" rel="stylesheet" type="text/css"/><link href="https://yaoquantum.org/assets/favicon-light.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../index.html"><img src="../../../assets/logo.png" alt="Documentation | Yao logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../../index.html">Documentation | Yao</a></span></div><form class="docs-search" action="../../../search.html"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../../index.html">Home</a></li><li><a class="tocitem" href="../../../quick-start.html">Quick Start</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../../../man/registers.html">Quantum Registers</a></li><li><a class="tocitem" href="../../../man/blocks.html">Blocks</a></li><li><a class="tocitem" href="../../../man/symbolic.html">Symbolic Computation</a></li><li><a class="tocitem" href="../../../man/automatic_differentiation.html">Automatic Differentiation</a></li><li><a class="tocitem" href="../../../man/simplification.html">Simplification</a></li><li><a class="tocitem" href="../../../man/bitbasis.html">BitBasis</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../1.prepare-ghz-state/index.html">Prepare Greenberger–Horne–Zeilinger state with Quantum Circuit</a></li><li class="is-active"><a class="tocitem" href="index.html">Quantum Fourier Transformation and Phase Estimation</a><ul class="internal"><li><a class="tocitem" href="#Quantum-Fourier-Transformation"><span>Quantum Fourier Transformation</span></a></li><li><a class="tocitem" href="#Wrap-QFT-to-an-external-block"><span>Wrap QFT to an external block</span></a></li><li><a class="tocitem" href="#Phase-Estimation"><span>Phase Estimation</span></a></li></ul></li><li><a class="tocitem" href="../3.grover-search/index.html">Grover Search</a></li><li><a class="tocitem" href="../4.shor-algorithm/index.html">Shor&#39;s Algorithm</a></li><li><a class="tocitem" href="../5.shor-9-code/index.html">Shor&#39;s 9 qubit code</a></li><li><a class="tocitem" href="../6.quantum-circuit-born-machine/index.html">Quantum Circuit Born Machine</a></li><li><a class="tocitem" href="../7.variation-quantum-eigen-solver/index.html">Variational Quantum Eigen Solver</a></li></ul></li><li><a class="tocitem" href="../../../performancetips.html">Performance Tips</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href="index.html">Quantum Fourier Transformation and Phase Estimation</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="index.html">Quantum Fourier Transformation and Phase Estimation</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/QuantumBFS/Yao.jl/blob/master/docs/src/examples/2.qft-phase-estimation/main.jl" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><p><a href="https://mybinder.org/v2/gh/QuantumBFS/Yao.jl/gh-pages?filepath=dev/generated/examples/2.qft-phase-estimation/main.ipynb"><img src="https://mybinder.org/badge_logo.svg" alt/></a> <a href="https://nbviewer.jupyter.org/github/QuantumBFS/Yao.jl/blob/gh-pages/dev/generated/examples/2.qft-phase-estimation/main.ipynb"><img src="https://img.shields.io/badge/show-nbviewer-579ACA.svg" alt/></a> <a href="https://minhaskamal.github.io/DownGit/#/home?url=https://github.com/QuantumBFS/tutorials/tree/gh-pages/dev/generated/examples/2.qft-phase-estimation"><img src="https://img.shields.io/badge/download-project-orange" alt/></a></p><h1 id="example-qft"><a class="docs-heading-anchor" href="#example-qft">Quantum Fourier Transformation and Phase Estimation</a><a id="example-qft-1"></a><a class="docs-heading-anchor-permalink" href="#example-qft" title="Permalink"></a></h1><p>Let&#39;s use Yao first</p><pre><code class="language-julia hljs">using Yao</code></pre><h2 id="Quantum-Fourier-Transformation"><a class="docs-heading-anchor" href="#Quantum-Fourier-Transformation">Quantum Fourier Transformation</a><a id="Quantum-Fourier-Transformation-1"></a><a class="docs-heading-anchor-permalink" href="#Quantum-Fourier-Transformation" title="Permalink"></a></h2><p>The Quantum Fourier Transformation (QFT) circuit is to repeat two kinds of blocks repeatly:</p><p><img src="assets/qft.png" alt="qft-circuit"/></p><p>The basic building block control phase shift gate is defined as</p><p class="math-container">\[R(k)=\begin{bmatrix}
1 &amp; 0\\
0 &amp; \exp\left(\frac{2\pi i}{2^k}\right)
\end{bmatrix}\]</p><p>Let&#39;s define block <code>A</code> and block <code>B</code>, block <code>A</code> is actually a control block.</p><pre><code class="language-julia hljs">A(i, j) = control(i, j=&gt;shift(2π/(1&lt;&lt;(i-j+1))))</code></pre><pre><code class="nohighlight hljs">A (generic function with 1 method)</code></pre><p>Once you construct the blockl you can inspect its matrix using <code>mat</code> function. Let&#39;s construct the circuit in dash box A, and see the matrix of <span>$R_4$</span> gate.</p><pre><code class="language-julia hljs">R4 = A(4, 1)</code></pre><pre><code class="nohighlight hljs">(n -&gt; control(n, 4, 1 =&gt; shift(0.39269908169872414)))</code></pre><p>If you have read about <a href="generated/examples/2.qft-phase-estimation/@ref example-ghz">preparing GHZ state</a>, you probably know that in Yao, we could just leave the number of qubits, and it will be evaluated when possible.</p><pre><code class="language-julia hljs">R4(5)</code></pre><pre><code class="nohighlight hljs">nqubits: 5
control(4)
└─ (1,) shift(0.39269908169872414)</code></pre><p>its matrix will be</p><pre><code class="language-julia hljs">mat(R4(5))</code></pre><pre><code class="nohighlight hljs">32×32 Diagonal{ComplexF64, Vector{ComplexF64}}:
 1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im</code></pre><p>Then we repeat this control block over and over on different qubits, and put a Hadamard gate to <code>i</code>th qubit to construct <code>i</code>-th <code>B</code> block.</p><pre><code class="language-julia hljs">B(n, k) = chain(n, j==k ? put(k=&gt;H) : A(j, k) for j in k:n)</code></pre><pre><code class="nohighlight hljs">B (generic function with 1 method)</code></pre><p>We need to input the total number of qubits <code>n</code> here because we have to iterate through from <code>k</code>-th location to the last.</p><p>Now, let&#39;s construct the circuit by chaining all the <code>B</code> blocks together</p><pre><code class="language-julia hljs">qft(n) = chain(B(n, k) for k in 1:n)
qft(4)</code></pre><pre><code class="nohighlight hljs">nqubits: 4
chain
├─ chain
│  ├─ put on (1)
│  │  └─ H
│  ├─ control(2)
│  │  └─ (1,) shift(1.5707963267948966)
│  ├─ control(3)
│  │  └─ (1,) shift(0.7853981633974483)
│  └─ control(4)
│     └─ (1,) shift(0.39269908169872414)
├─ chain
│  ├─ put on (2)
│  │  └─ H
│  ├─ control(3)
│  │  └─ (2,) shift(1.5707963267948966)
│  └─ control(4)
│     └─ (2,) shift(0.7853981633974483)
├─ chain
│  ├─ put on (3)
│  │  └─ H
│  └─ control(4)
│     └─ (3,) shift(1.5707963267948966)
└─ chain
   └─ put on (4)
      └─ H
</code></pre><h2 id="Wrap-QFT-to-an-external-block"><a class="docs-heading-anchor" href="#Wrap-QFT-to-an-external-block">Wrap QFT to an external block</a><a id="Wrap-QFT-to-an-external-block-1"></a><a class="docs-heading-anchor-permalink" href="#Wrap-QFT-to-an-external-block" title="Permalink"></a></h2><p>In most cases, <code>function</code>s are enough to wrap quantum circuits, like <code>A</code> and <code>B</code> we defined above, but sometimes, we need to dispatch specialized methods on certain kinds of quantum circuit, or we want to define an external block to export, thus, it&#39;s useful to be able to wrap circuit to custom blocks.</p><p>First, we define a new type as subtype of <code>PrimitiveBlock</code> since we are not going to use the subblocks of <code>QFT</code>, if you need to use its subblocks, it&#39;d be better to define it under <code>CompositeBlock</code>.</p><pre><code class="language-julia hljs">struct QFT &lt;: PrimitiveBlock{2}
    n::Int
end

YaoBlocks.nqudits(q::QFT) = q.n</code></pre><p>Now, let&#39;s define its circuit</p><pre><code class="language-julia hljs">circuit(q::QFT) = qft(q.n)</code></pre><pre><code class="nohighlight hljs">circuit (generic function with 1 method)</code></pre><p>And forward <code>mat</code> to its circuit&#39;s matrix</p><pre><code class="language-julia hljs">YaoBlocks.mat(::Type{T}, x::QFT) where T = mat(T, circuit(x))</code></pre><p>You may notice, it is a little ugly to print <code>QFT</code> at the moment, this is because we print the type summary by default, you can define your own printing by overloading <code>print_block</code></p><pre><code class="language-julia hljs">YaoBlocks.print_block(io::IO, x::QFT) = print(io, &quot;QFT($(x.n))&quot;)</code></pre><p>Since it is possible to use FFT to simulate the results of QFT (like cheating), we could define our custom <code>apply!</code> method:</p><pre><code class="language-julia hljs">using FFTW, LinearAlgebra

function YaoBlocks.apply!(r::ArrayReg, x::QFT)
    α = sqrt(length(statevec(r)))
    invorder!(r)
    lmul!(α, ifft!(statevec(r)))
    return r
end</code></pre><p>Now let&#39;s check if our <code>apply!</code> method is correct:</p><pre><code class="language-julia hljs">r = rand_state(5)
r1 = r |&gt; copy |&gt; QFT(5)
r2 = r |&gt; copy |&gt; circuit(QFT(5))
r1 ≈ r2</code></pre><pre><code class="nohighlight hljs">true</code></pre><p>We can get iQFT (inverse QFT) directly by calling <code>adjoint</code></p><pre><code class="language-julia hljs">QFT(5)&#39;</code></pre><pre><code class="nohighlight hljs"> [†]QFT(5)</code></pre><p>QFT and iQFT are different from FFT and IFFT in three ways,</p><ol><li>they are different by a factor of <span>$\sqrt{2^n}$</span> with <span>$n$</span> the number of qubits.</li><li>the <a href="https://quantumbfs.github.io/BitBasis.jl/stable/tutorial/#Conventions-1">bit numbering</a> will exchange after applying QFT or iQFT.</li><li>due to the convention, QFT is more related to IFFT rather than FFT.</li></ol><h2 id="Phase-Estimation"><a class="docs-heading-anchor" href="#Phase-Estimation">Phase Estimation</a><a id="Phase-Estimation-1"></a><a class="docs-heading-anchor-permalink" href="#Phase-Estimation" title="Permalink"></a></h2><p>Since we have QFT and iQFT blocks we can then use them to realize phase estimation circuit, what we want to realize is the following circuit:</p><p><img src="assets/phaseest.png" alt="phase estimation"/></p><p>First we call Hadamard gates repeatly on first <code>n</code> qubits.</p><pre><code class="language-julia hljs">Hadamards(n) = repeat(H, 1:n)</code></pre><pre><code class="nohighlight hljs">Hadamards (generic function with 1 method)</code></pre><p>Then in dashed box <code>B</code>, we have controlled unitaries:</p><pre><code class="language-julia hljs">ControlU(n, m, U) = chain(n+m, control(k, n+1:n+m=&gt;matblock(U^(2^(k-1)))) for k in 1:n)</code></pre><pre><code class="nohighlight hljs">ControlU (generic function with 1 method)</code></pre><p>each of them is a <code>U</code> of power <span>$2^{(k-1)}$</span>.</p><p>Since we will only apply the qft and Hadamard on first <code>n</code> qubits, we could use <code>Subroutine</code>, which creates a context of a sub-scope of the qubits.</p><pre><code class="language-julia hljs">PE(n, m, U) =
    chain(n+m, # total number of the qubits
        subroutine(Hadamards(n), 1:n), # apply H in local scope
        ControlU(n, m, U),
        subroutine(QFT(n)&#39;, 1:n))</code></pre><pre><code class="nohighlight hljs">PE (generic function with 1 method)</code></pre><p>we use the first <code>n</code> qubits as the output space to store phase <span>$ϕ$</span>, and the other <code>m</code> qubits as the input state which corresponds to an eigenvector of oracle matrix <code>U</code>.</p><p>The subroutine here uses <code>focus!</code> and <code>relax!</code> to manage a local scope of quantum circuit, and only activate the first <code>n</code> qubits while applying the block inside the subroutine context, and the scope will be <code>relax!</code>ed back, after the context. This is equivalent to manually <code>focus!</code> then <code>relax!</code></p><p>fullly activated</p><pre><code class="language-julia hljs">r = rand_state(5)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 5/5
    nlevel: 2</code></pre><p>first 3 qubits activated</p><pre><code class="language-julia hljs">focus!(r, 1:3)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 3/5
    nlevel: 2</code></pre><p>relax back to the original</p><pre><code class="language-julia hljs">relax!(r, 1:3)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 5/5
    nlevel: 2</code></pre><p>In this way, we will be able to apply small operator directly on the subset of the qubits.</p><p>Details about the algorithm can be found here: <a href="https://en.wikipedia.org/wiki/Quantum_phase_estimation_algorithm">Quantum Phase Estimation Algorithm</a></p><p>Now let&#39;s check the results of our phase estimation.</p><p>First we need to set up a unitary with known phase, we set the phase to be 0.75, which is <code>0.75 * 2^3 == 6 == 0b110</code> .</p><pre><code class="language-julia hljs">N, M = 3, 5
P = eigen(rand_unitary(1&lt;&lt;M)).vectors
θ = Int(0b110) / 1&lt;&lt;N
phases = rand(1&lt;&lt;M)
phases[0b010+1] = θ
U = P * Diagonal(exp.(2π * im * phases)) * P&#39;</code></pre><pre><code class="nohighlight hljs">32×32 Matrix{ComplexF64}:
  -0.0290109-0.280506im      0.0274672+0.0344063im      0.260393-0.0641119im     -0.0506474+0.0707084im       0.118429+0.0453762im    0.0166118+0.0508094im     0.00542861+0.152422im        0.176758+0.00182305im     0.0357433-0.241763im      0.0343181+0.0405927im    -0.0811608+0.0761342im       -0.16744-0.153341im      -0.106395-0.0459705im    -0.101593-0.0182261im    -0.0329393-0.0301649im    0.0122773+0.0492916im     0.0300009-0.0540553im    -0.0200972-0.00676348im    0.026687-0.0847623im    -0.341781-0.0543545im    0.114574+0.0662101im     0.11707+0.172221im      0.0166701-0.022523im       0.230721-0.0865804im     0.0231674+0.0342145im     0.259507-0.0866618im     -0.235678-0.136im        -0.0119674-0.110884im     -0.0144809-0.0773276im   -0.00226982+0.175929im      -0.174832+0.335208im      -0.0913982-0.0682838im
  -0.0911211+0.03966im       0.0579783-0.240567im        0.34113+0.125901im       -0.127394+0.133476im        0.106489+0.0408357im     0.084563-0.0108987im      -0.191029-0.0406588im       -0.12598-0.080748im       0.0119315+0.0671345im     -0.112086-0.148267im      -0.120808+0.0331611im      -0.108777-0.12038im         0.10755+0.0916804im    -0.151303-0.229635im      0.0315573-0.0845421im    -0.307033-0.00884333im     0.105101+0.0633281im     0.0127149+0.00777021im   0.0154198+0.0296884im      0.23933-0.225897im   -0.0805943+0.0115423im    0.122249-0.157004im     -0.0226163-0.0801217im    -0.0629758-0.240407im      0.0785232-0.0132097im   -0.0260289-0.290783im      0.0216507-0.0461394im     0.0893819+0.0732312im      -0.10064-0.122913im       0.120203+0.0102397im     0.0634181-0.0641833im      0.0338449-0.0792974im
  -0.0904889-0.201172im       0.113346-0.237908im      -0.124341-0.263789im      -0.0780113+0.0404874im       0.186038-0.0557722im     -0.14478+0.0591507im      -0.103347-0.0324674im       0.204693-0.166091im       0.0587791-0.0174583im      0.057271+0.0949105im     0.0562736+0.0919899im       0.171815+0.0696379im      0.101815+0.0246268im  -0.00619468-0.0683907im   -0.00667854+0.0173695im    -0.051743+0.0497957im     -0.250717+0.0477246im      0.040565+0.0899504im     0.127007+0.0369547im      0.23658-0.0739509im  0.00258926+0.106723im     0.136449+0.0838978im     -0.264226+0.0878241im     -0.157799+0.146372im    -0.00298017+0.0822371im     0.115804+0.0688039im     -0.225682+0.0215365im       0.30466+0.0328984im     0.0943667+0.212778im     -0.0697279+0.046414im      0.0142572-0.00283518im      0.122944+0.0321558im
    0.197577+0.0744992im     0.0389835+0.101852im     0.00439069-0.0583883im     -0.0354077-0.197278im        0.281022-0.00195668im  -0.0716242+0.164057im       0.0471496-0.0264606im      -0.352838+0.0400477im     -0.0434406+0.0780264im    -0.0967751-0.0878714im     -0.157541-0.0181413im     -0.0269388-0.0568917im    -0.0508462-0.217511im    -0.0677197+0.095471im     0.00114213-0.189502im     -0.113798+0.0430551im     -0.111781+0.320097im     -0.0288032+0.0232257im   -0.0838136-0.00114992im  -0.0238608+0.0343656im    0.120288-0.0834228im    0.170019+0.208696im    -0.00489923+0.139924im     -0.0694753-0.222397im      -0.157437+0.050653im    -0.0991579+0.129432im     -0.0191409-0.0468192im     -0.091457-0.0785373im    -0.0271814+0.245233im     -0.0520936+0.149881im      0.0866601+0.0503487im       0.156799-0.0824233im
   0.0565153+0.173789im        0.13327+0.07236im     -0.00244645-0.0776923im     -0.0447309-0.164406im        -0.13625-0.252476im       0.16517+0.0273136im      -0.165071+0.0450333im      0.0427353+0.0356031im     -0.0735342-0.0367464im     0.0504159-0.162117im      -0.227951-0.300133im        0.117844+0.0302852im    -0.0102251+0.137897im      -0.10005-0.10207im      -0.0234254+0.151049im     -0.101314-0.0565157im      0.139077-0.232349im      -0.029229+0.0887424im   -0.0406739+0.102566im     -0.161404+0.0698023im  -0.0412987+0.330359im    0.0748538+0.136941im      0.0311624+0.0389044im     -0.141217+0.0399855im     -0.210724-0.0580055im     0.037406-0.107693im      0.0836826+0.105188im       0.203838-0.16234im        0.032799+0.128331im     -0.0785657+0.0517775im     0.0929979+0.0765597im     -0.0398284-0.153029im
   0.0172268-0.19886im      -0.0652576+0.113921im      -0.259212-0.124682im       0.0768419+0.0207686im      0.0325003-0.0995715im    -0.242704-0.196382im        0.155278+0.0579701im     -0.0397762-0.132965im        0.045888-0.0448745im   -0.00750481-0.214579im     -0.0963071-0.0898329im     -0.0935624-0.109827im     -0.0689859+0.0373803im    0.0764121-0.16442im       -0.143104+0.0818288im    -0.138314-0.0653706im      0.193869-0.0213686im      0.160975-0.220675im    -0.0513541+0.0970916im    0.0637444-0.193173im     0.111079-0.129233im   -0.0794458+0.117868im       0.142484-0.0510911im     0.0445154-0.0993287im     -0.113258+0.302193im     -0.117082-0.00890088im   -0.0642319-0.115875im        0.19526+0.0637535im     0.0259685+0.00615693im   -0.0195826-0.235298im        0.10919+0.0317579im      -0.147899+0.0405024im
     0.14176-0.135671im     -0.0143545+0.0528921im      0.123637-0.228303im         0.20604+0.0306338im       0.169078+0.109131im      0.180828+0.304041im     -0.00937689-0.162197im     -0.00592977-0.137489im       0.0792142+0.0742673im      0.114897-0.130354im      -0.140458-0.0682294im     -0.0874719-0.309937im      0.0886735+0.14207im     0.00552909-0.0443558im   -0.00134941+0.113641im      0.154285+0.0794235im     0.0898347-0.0395849im      0.106844+0.00601973im   0.0111269+0.035311im    0.00587277-0.0752932im   0.0243593+0.12554im      0.104413-0.169653im     -0.0502102-0.138058im      0.0315069+0.0999548im      0.109087-0.0742499im    0.0169912+0.241836im      0.0978433+0.0999774im     -0.228409-0.0167271im     0.0705027+0.0444753im     -0.109571-0.197831im       0.193524+0.0304954im       0.041164+0.174448im
    0.122729+0.0344838im     0.0720394+0.0981246im    -0.0664332-0.0345222im    0.000163482+0.305619im      -0.0486274+0.0348012im     0.171844-0.171509im       0.0237067+0.0491656im      -0.144327-0.263331im        0.119083-0.0247993im    -0.0907924-0.213736im      0.0172745+0.113701im        0.139444-0.0837744im    -0.0946672-0.065875im     0.0885503+0.0572929im      0.146241+0.0552735im   -0.0273491-0.0437374im     0.0373368+0.0520548im     -0.158458+0.0126437im    -0.147094-0.218136im     -0.148629-0.0436931im   -0.163332-0.0342556im   0.0737855+0.252481im      0.0884072-0.191262im       -0.27264+0.263577im      0.0475252-0.16157im      0.0258511-0.0745468im     -0.199834-0.112229im     -0.0145791+0.100831im      0.0671974-0.0213227im     0.0657445+0.0652822im     0.0912218-0.0548742im       0.132474+0.0808598im
  -0.0135081+0.236315im      -0.102903-0.18174im        0.268245+0.00616471im    -0.0162947+0.00950654im    -0.0531731-0.181629im     0.0423163+0.103086im        0.167334+0.151477im       -0.024644+0.167713im        0.133906-0.322249im       0.060862-0.0172674im   0.000266009+0.0451631im     -0.0922003+0.026546im      -0.025212+0.121309im      0.142239+0.0656511im     0.0645693-0.0275057im    -0.326442-0.0184691im     0.0483444+0.116859im     -0.0232633-0.191695im     0.0147529-0.196656im      0.128479+0.202015im    0.0875981+0.0122463im  -0.0906064+0.111989im      -0.126428-0.0128369im     0.0730074+0.104951im      -0.084624+0.0542589im     0.172131+0.0563146im    -0.0380707+0.0181926im    -0.0156581-0.0639131im      0.103872+0.0727746im     -0.117994-0.218716im       0.111061-0.108553im       0.0353629+0.220352im
   0.0126661+0.0680938im     0.0832185+0.223737im      0.0341397-0.00728647im     -0.135509+0.0714247im      0.0941693-0.00167867im  -0.0626596-0.265038im      -0.0270523-0.188336im       0.0857386+0.0185777im     -0.0493472-0.159817im      0.0116459-0.219589im      0.0932866-0.000802702im    0.0922662+0.0457865im      0.138403-0.176566im     -0.177551+0.0488072im     -0.109088+0.190579im     -0.197343+0.0826522im      0.032621+0.219483im       0.104331-0.0622231im     0.140076-0.0647099im    -0.128217+0.184094im   -0.0215434+0.328221im   -0.0108719-0.170983im      0.0225736-0.0808648im      0.136575-0.120977im       0.123446+0.0934221im    -0.095593+0.217019im     -0.0590314+0.160867im     0.00826614+0.101517im       0.154731-0.0609892im      0.117932+0.0418992im     -0.107221-0.068023im        0.116362+0.0614446im
   -0.163846-0.136934im      -0.137697+0.139642im       0.038337+0.124342im       0.0301809-0.179015im     -0.00682702+0.0949735im    0.0843378+0.0351625im     -0.0356381+0.0514298im       0.160725-0.129566im       0.0326767+0.145015im     -0.0647019+0.198607im      -0.323054-0.280554im       -0.129994+0.00347163im   0.00486195-0.0155822im     0.202572+0.14227im       -0.154896+0.0876231im    -0.156099+0.109334im     -0.0516473+0.124569im      -0.171974-0.038383im     -0.101435-0.0614252im    0.0650437+0.024074im      0.12145+0.0921098im   -0.187497-0.00799416im    -0.136459-0.104166im     -0.0322411+0.0806047im     0.0633643-0.0322699im    -0.174695-0.0908355im     -0.308601+0.0412188im    -0.0617701+0.0477521im      0.158616-0.0503457im     0.0707904+0.0266042im     0.0479091-0.13229im        0.0530238-0.201033im
   -0.122391+0.232227im       0.157461+0.0082077im     0.0632904+0.0767875im       0.118298+0.0300571im       0.187524-0.14408im     -0.0155015-0.157774im        0.186322-0.20982im        0.0397135+0.0829082im      0.0399222+0.135942im      -0.131916+0.114802im       0.019904+0.138946im     -0.00953635-0.105967im       0.243919+0.0198935im    0.0784859+0.00401614im    -0.188091+0.141145im      0.116058+0.0811918im   -0.00614068-0.113822im        0.14244+0.0419168im   -0.0497794-0.185293im      0.120404-0.0184087im   0.0657943+0.135386im   -0.0263841+0.182092im       0.251726+0.0884282im      0.163591+0.0745891im      0.180419-0.0375193im     0.103968-0.063039im      -0.071884-0.191141im     -0.0259112-0.106909im      -0.117734+0.174596im     -0.0334989-0.00906199im     0.198538-0.046284im      0.00326378-0.231733im
  -0.0437224+0.252789im     -0.0389776+0.126873im      -0.115641-0.0654097im     -0.0362219-0.0585288im       0.148076+0.204462im    -0.0385912+0.0988986im     -0.0145623+0.0965365im      0.0756144-0.042059im        0.121266+0.012786im      -0.110103-0.0433102im      0.100508-0.0500467im      -0.111982+0.135544im      0.0530953-0.348834im      0.126328-0.163808im      0.0558361-0.120825im     -0.147492-0.146066im       0.392421-0.280014im      -0.012364+0.111705im      0.179217+0.0954175im     0.147304+0.0567948im    0.153519-0.0248424im   0.0978812-0.113487im    -0.00227721-0.037836im     -0.0127027+0.181471im      0.0946235+0.00833815im   0.0266847-0.0464578im     -0.123727-0.0177484im      -0.11656-0.104863im      0.0439324+0.135853im      0.0802967+0.0807991im      -0.05766+0.114559im       0.0369257+0.0777572im
   0.0303666-0.0881572im     0.0317246+0.0228537im      0.104884+0.0391907im       0.243223-0.122298im        0.052541-0.196991im     0.0311409-0.192678im       -0.072982+0.034983im        0.365729-0.119643im        0.317983-0.016661im     -0.0626177+0.0367914im    0.00752379+0.0338964im      0.0900066-0.146355im      -0.139299-0.158454im     -0.150399-0.150201im      0.0396177-0.0194218im    0.0118508-0.00425428im    0.0514488+0.106196im      -0.223499+0.0744014im   -0.0446119+0.0854925im   -0.0608981+0.192527im    -0.100639-0.168146im   0.00120024+0.029639im      -0.092343+0.181729im      0.0262153-0.0424002im      0.158533+0.138999im     -0.136823-0.0989927im      0.244063-0.0249123im    -0.0411946-0.196624im     -0.0428625+0.0470998im     0.0526163-0.0708351im      0.107335-0.102714im        0.150632+0.0820193im
   -0.149559+0.00107533im     0.255838+0.0448305im    -0.0863677+0.125469im         0.14469+0.110494im       -0.116363-0.0421506im     0.162863+0.150589im       -0.149389-0.0831718im       0.145407+0.0155781im      -0.198069-0.143419im      0.0841411+0.0751904im    -0.0450901+0.0989426im       0.034362+0.0916483im     0.0702572-0.0563397im    -0.109748-0.186569im       0.159309-0.368303im     0.0976606-0.0245751im     0.0609743+0.0578835im     0.0421472+0.0381034im   -0.0829993-0.0548567im   -0.0340665-0.108779im     0.136531+0.160698im    -0.128904+0.0815298im     0.0925775+0.00917224im   -0.0750815-0.0606461im     -0.175133+0.170423im     -0.132845+0.110105im      -0.216254-0.105476im      -0.177241-0.0116542im     0.0155457+0.0156626im       0.13588-0.295796im      0.0103932-0.0699958im      0.0962949+0.00875059im
     0.25716-0.118561im      0.0747714-0.15737im      -0.0503119+0.0455857im       0.120324-0.0535808im         0.0609-0.132529im     0.0105591+0.0779108im       0.141747-0.000390154im    0.0123457-0.0549223im      0.0928557-0.0314414im    -0.0825713+0.0309196im    0.00741083-0.0778579im      0.0597499+0.0207355im      0.295177-0.0916834im   -0.0328892+0.135411im       0.142705-0.00382621im    -0.19803-0.0731529im     0.0432771+0.0134561im     -0.208712+0.16675im      0.0104367+0.0923878im    0.0223918-0.0138152im  -0.0811426+0.0830574im   -0.132227-0.0716098im      0.240669+0.289455im     -0.0347335-0.00541801im   0.00765151+0.0291709im    0.0582213+0.0735248im     -0.247136+0.151757im      -0.069466+0.157492im      -0.151519-0.29391im       -0.106047+0.0392614im      0.115815+0.0974852im      -0.271354+0.0739566im
   0.0220117-0.128605im     -0.0279526+0.230988im     -0.0154542+0.00574132im     -0.207001+0.213237im       0.0154069-0.398932im    -0.0752407+0.100451im      -0.0776761+0.102583im        -0.10437+0.0153264im      0.0354302+0.074541im       0.153604+0.0465198im     0.0374709-0.161675im        0.128136-0.119278im       0.360697+0.1011im      -0.0745546+0.15037im      -0.0995056-0.150147im    -0.0217941-0.130316im      0.0873591-0.172205im     0.00153567+0.142046im    -0.0514953-0.0431189im   0.00507342+0.095379im     0.143885-0.187597im    0.0830355+0.127134im      -0.213385-0.111131im        0.11615-0.0134038im      0.123599+0.0109im      -0.0772298-0.00948796im   -0.0119777-0.0210258im    -0.0791539+0.0341859im     -0.144991-0.0312082im     0.0605468+0.00874931im    -0.125182-0.175im          0.0427467+0.0577599im
    0.125027+0.00307719im   -0.0354309+0.0246689im    -0.0268403+0.0974178im      0.0563218-0.105479im       -0.137535+0.111705im     0.0651431+0.214836im       -0.163803+0.00804771im      0.027863-0.0504968im       0.262584+0.0142294im    -0.0936867+0.0472829im       0.21376+0.128079im      -0.0594516+0.0933726im     0.0737625+0.290494im   -0.00387973+0.0278538im    -0.0414216+0.313478im     -0.138898+0.0775071im     0.0218944-0.0285486im      0.167982+0.063605im    -0.0245638-0.0252861im    -0.121442+0.0277258im    0.274352-0.106745im    0.0795944+0.0683994im       0.17476+0.156236im     -0.0109816-0.0370552im     -0.116098+0.0500695im    -0.110144-0.0358573im      -0.04042+0.0225894im     0.0801591+0.1567im        -0.111636-0.0382647im      0.145706-0.0323954im     -0.066829+0.111196im        0.393511+0.0264006im
  -0.0656369-0.0192093im    -0.0746129-0.106056im      -0.229554-0.087432im       -0.123516-0.160123im       -0.127188+0.0993456im    0.0123952+0.000639796im   -0.0598652-0.121555im       0.0905714+0.0660189im       0.267194+0.109186im     -0.0327317-0.146535im      0.0984838+0.00817354im    -0.0812682-0.0976465im     0.0107886+0.0996495im   -0.0114677-0.0990705im      0.113658-0.247097im      -0.13062+0.0919508im      0.024452-0.102788im      0.0478091+0.0488593im    -0.226917-0.505712im    -0.0286902+0.0595876im   -0.100798+0.0677309im  -0.0110859+0.0777087im     -0.131415+0.0112135im    0.00924855-0.11169im        0.134642+0.0561764im    -0.110407+0.162756im      0.0700622+0.127931im     -0.0166596+0.0639675im   -0.00950507+0.0571793im   -0.00167918+0.0476822im    -0.0137947+0.139253im       -0.241524-0.146399im
  0.00409013-0.00236416im      0.25441+0.0968754im      0.206944-0.0682192im      -0.197492-0.0982479im      -0.175081-0.0801003im     0.129359-0.204543im        0.150632-0.228238im      -0.0163084-0.205343im       0.0557707+0.137293im      -0.257362+0.164176im       0.138075-0.146463im      -0.0312493-0.0980464im     0.0669108+0.154486im      0.106202+0.0545932im     0.0237065-0.288345im     0.0325071-0.0124091im     0.0625951+0.0331331im     0.0692503-0.235489im      0.091695+0.071135im     -0.088193-0.129118im    0.0721827-0.0950679im  -0.0581564-0.072522im     -0.0385007+0.140529im     -0.0133037+0.0143503im    -0.0735089-0.125632im    -0.0321329+0.0523524im    -0.0722277+0.112801im       0.112136-0.161058im       0.116396+0.066324im       0.017412+0.0319914im    -0.0768389+0.144273im       0.0220266+0.218003im
   -0.207431+0.0580391im      0.166305+0.0972385im     -0.064611-0.00372207im      0.013349-0.0949721im       0.130387+0.145184im     -0.066326-0.149195im       0.0856482+0.0125921im        0.16728+0.174423im       -0.081377-0.0406254im      0.192512-0.0307783im       0.17469-0.172429im      -0.0740872-0.307628im    -0.00886732+0.0805073im    -0.105653-0.0178794im     0.0193301+0.0740307im    -0.211044+0.14279im      -0.0886007-0.0215344im     -0.183768+0.147964im     0.0629225-0.104828im    -0.0721246-0.151598im     0.206681-0.228629im     0.110709-0.0896862im     0.0913187+0.0449034im     -0.238197+0.0500904im     -0.234322-0.16496im       0.130287+0.079388im      0.0360898-0.0103601im    -0.0578263+0.00887414im   -0.0424249-0.0290539im     0.0429156+0.00156575im  0.000651902-0.242656im      -0.0899781+0.0573874im
    0.179377-0.0301448im      0.127686-0.0381514im     0.0980253+0.294317im      -0.0966057+0.0499842im     -0.0468619+0.0609022im   -0.0507986-0.0302966im    0.000365489+0.0828457im      -0.059875-0.0368214im      -0.133443-0.0890502im      0.212824+0.039128im       0.124502+0.0341107im      -0.176845-0.108801im     0.00893383-0.0888051im     0.120675+0.0194577im    -0.0175121+0.0778649im     0.209684+0.0156236im      0.200156-0.0723161im     -0.109436+0.146342im     0.0386493-0.200769im    -0.0901151-0.0516449im   0.0873778+0.0678417im  -0.0440516-0.161506im      -0.206363+0.163604im    -0.00597557-0.0439936im   -0.00393142+0.127347im     -0.259148-0.0617245im   -0.00511456-0.0759589im       0.22106+0.164876im       0.107082+0.189612im      -0.192503+0.146741im       0.298127+0.00408105im  -0.000772256+0.085121im
   0.0452805-0.0622315im     0.0896379-0.0566752im    -0.0275452+0.138578im        0.157624-0.037888im       0.0637547-0.192125im     0.0587753+0.00442739im       0.14494+0.191699im       0.0814932-0.247844im      -0.0404048+0.109213im      0.0729414+0.1093im         0.189796+0.0982765im      -0.119824+0.159174im       0.121928-0.0543864im     0.175399-0.0935465im     -0.162435+0.00475357im   -0.152799+0.0906486im     0.0339825+0.00985898im      0.09108-0.012258im    -0.0275083-0.0889221im    0.0409499-0.0410922im  -0.0974768+0.122923im     0.111263+0.0162846im    -0.0642156-0.295267im      -0.121756-0.104367im      -0.246105-0.0246697im    -0.051721+0.223633im       0.229152-0.0943862im    -0.0722706-0.233606im     0.00571745-0.253924im     -0.0557621+0.227476im     -0.0253692+0.0490138im      0.0324526-0.015823im
    0.258006+0.182168im     -0.0484557-0.102187im       -0.24085-0.0200344im     -0.0672257+0.0421848im       0.012535-0.076177im      0.173664-0.0908194im      0.0793405+0.0113912im     -0.0529167+0.02489im       -0.0353504+0.0249095im      0.133501+0.113548im      -0.023589-0.121063im       -0.218299-0.10587im      -0.0706359+0.0577847im     0.232764-0.254923im      0.0276101-0.0769554im   -0.0236798+0.0534568im      -0.18685+0.111672im      0.0061658+0.115696im      0.139291+0.125912im     -0.183279+0.150962im     0.130654+0.102121im    0.0398296-0.0354884im    -0.0220052-0.00939008im    -0.130872-0.148287im       0.381818-0.045598im     0.0408284+0.0404142im    -0.0989795-0.163735im       0.169658-0.0653523im     -0.128682-0.113553im      0.0409701-0.182414im       -0.11846-0.0185847im      0.0457826-0.00976662im
 -0.00407829-0.0382603im     -0.116796-0.238961im     -0.0799123+0.0824157im      -0.301983-0.0807827im      0.0689837+0.0571942im   -0.0833355+0.0302312im       0.201661-0.19874im         0.226917+0.0325717im      0.0142447-0.0847321im   -0.00732995-0.156698im     -0.0814962+0.157211im        0.202724-0.0523764im     0.0140439-0.127058im      0.147232+0.186191im     -0.0236376-0.0106098im   -0.0191632-0.119326im       0.131176-0.114679im        0.10273+0.026407im    -0.0995365+0.115484im     -0.247399-0.0815657im  0.00259448-0.0346641im   0.0218057-0.0740286im     -0.178967-0.00322738im   -0.0236962-0.105751im      -0.125198-0.240026im    -0.0692813-0.00682146im    -0.064244-0.0443118im    -0.0297328-0.158317im     -0.0925204-0.155282im     -0.0537171-0.224799im       0.140082-0.0511844im       0.213829-0.158839im
   0.0628686-0.0875173im      0.176911-0.0399557im    -0.0524724-0.0647309im      -0.182076-0.156419im       0.0474906+0.121602im      0.101882+0.273627im        0.169633+0.123773im      -0.0746041+0.0436925im      0.0575979-0.00500691im   -0.0536792-0.0889353im      0.210282+0.0351689im     -0.0621918-0.228806im      0.0682978-0.167747im     -0.142497-0.145741im      -0.233573+0.0514702im     0.239388+0.0779278im   -0.00431385-0.0160847im   -0.00905069-0.171808im     0.0605563-0.0256072im     0.128062+0.226917im    -0.104854+0.117755im    -0.165157+0.192441im    -0.00341175+0.00707865im   -0.0955847+0.00703067im    -0.107752-0.0366967im    -0.092258-0.283661im     -0.0667955+0.10407im       0.0565346-0.0580288im    0.00457701-0.153469im      0.0836518-0.0947931im     -0.131029-0.202069im      -0.0496257+0.0447945im
   -0.111137+0.102032im      -0.365576+0.0317016im      0.134581+0.0940575im      0.0514106+0.000584941im   -0.0524326-0.105668im    -0.0849213-0.0792191im       0.125752+0.0172325im      0.0260741+0.0348728im      0.0900832+0.099059im      -0.178422+0.0304081im    -0.0832628-0.100947im     -0.00277131-0.0883722im      0.111661-0.0950217im   -0.0843454-0.103588im      0.0823136-0.0669625im     0.297959+0.0332077im    -0.0479494-0.11442im      -0.0152431+0.146408im      0.246208-0.0904583im    0.0381702+0.0851428im  -0.0176487+0.0180831im    0.235598+0.133486im      0.0250278-0.0089388im      -0.12717-0.189297im      -0.208575-0.0032356im    0.0734712+0.115351im      -0.052275+0.00887543im     0.100889+0.240698im       0.308534-0.202027im      0.0322095-0.128955im      0.0748395+0.0912432im      0.0958029+0.0173673im
   0.0690239-0.00934622im  -0.00402144+0.0815003im   -0.00236594-0.0117603im     -0.0595034+0.0169105im      -0.132015+0.0727014im    0.0850731-0.0762152im     -0.0966791+0.0547828im     -0.0816726+0.0132369im     0.00854821-0.0643245im     -0.263728-0.083149im       0.187983-0.0146804im     -0.0495539+0.00917992im     0.017098+0.0322121im    0.0405065+0.0155596im     -0.118308+0.179434im     0.0576357-0.0921823im    -0.0826178+0.11318im      -0.0213419+0.50039im      0.0278166+0.0148455im    0.0675241-0.171336im   -0.0516305-0.092654im    -0.247203+0.0400311im     -0.172232-0.173151im      0.0450816-0.226235im     -0.0567622+0.141007im      0.231319+0.0418002im     -0.112324+0.13263im        -0.09414-0.302115im      0.0464293+0.0971881im     0.0132571-0.149388im       0.101236+0.0122495im     -0.0621934-0.0171205im
   0.0730616+0.0274374im    -0.0475232+0.0167458im    -0.0440405+0.00727462im        0.0766-0.0964233im    -0.00920796+0.084335im      0.172215-0.0576708im      -0.330772-0.18424im      -0.00963396+0.000160098im    -0.150695+0.0477624im     0.0917159-0.00259383im    0.0507379-0.0464558im      -0.106522+0.047479im     -0.0542997-0.0891872im   -0.0475985+0.23633im       0.0073013+0.026524im     -0.069668+0.166257im       0.120825-0.0295441im      0.158318-0.047098im       0.20037-0.00914849im   0.0906961+0.0538615im   -0.187433-0.147481im      0.15123+0.272669im      -0.177305+0.143858im       0.186616+0.0799569im    -0.0479874-0.0497595im   -0.0171805+0.0857752im     -0.131833-0.210943im       0.134337-0.136336im      -0.058409-0.238813im       0.161028-0.0601674im      0.205801-0.0664804im      -0.188393+0.108646im
  -0.0595378-0.233903im     0.00461722+0.149195im       0.135622+0.0517698im     -0.0554651-0.0940646im      0.0770283-0.0594322im   -0.0376818-0.0155221im     -0.0749211-0.156037im       -0.192527-0.0144903im    -0.00665346+0.181334im       0.154481-0.0803236im      0.181428+0.111996im      -0.0425623+0.156503im      0.0385264-0.137233im      0.110268+0.0949952im     0.0373244-0.0233103im    -0.194114+0.0818489im     -0.153885-0.0913949im      -0.12263+0.129409im    -0.0877777-0.00778507im  -0.0489675+0.0334479im   0.0523972+0.11948im     0.0604069-0.0113321im     0.0871252+0.0822967im    -0.0769908+0.0958634im     0.0479032+0.0164217im    0.0334231-0.262521im       0.173323-0.120758im    -0.00345943-0.0690283im      0.295381-0.0286208im     -0.108412-0.437468im        -0.1163+0.165421im      -0.0753611+0.0114871im
  -0.0618607+0.0213514im     0.0293957-0.00961498im    -0.134873+0.000238643im    0.0715653+0.253927im       0.0102351+0.17196im       0.161316+0.0175042im       0.195023-0.0972087im     -0.0895551-0.105267im        0.300879+0.193278im       0.175488+0.185621im     -0.0221028-0.0584649im      0.0908633+0.070211im      -0.147279+0.0161097im    -0.229502+0.174048im       0.107205-0.0178818im   -0.0634099+0.146734im       0.198348-0.0518263im     0.0313184+0.0851196im   -0.0706946+0.0696237im    0.0214195+0.160753im    0.0117534+0.0609946im  -0.0328585-0.101673im      0.0279002-0.0544999im       0.12076-0.311696im      -0.163669+0.0406061im     0.139456-0.0839924im    -0.0983522-0.0922635im      0.149703-0.0838181im     0.0938394+0.0880231im     -0.215224+0.0271659im    -0.0884274-0.200391im      -0.0160899+0.0174171im
   0.0575191-0.0424649im      0.141357-0.0025697im     0.0442311+0.00471634im      0.109796+0.144849im      -0.0567608+0.0960091im    -0.062144+0.132562im         0.10758-0.0487336im      0.0944227-0.115147im        0.213874-0.117249im      -0.086537-0.257763im      0.0598041-0.167288im       -0.072728+0.340178im    -0.00428932+0.0788458im     0.121204+0.126084im      -0.112365-0.215947im      0.100632+0.024668im     -0.0506469+0.0964207im     -0.106408-0.00609492im    0.326454+0.00946722im   -0.129991-0.107959im      0.15562+0.0753459im    0.171107+0.128105im     -0.0257486+0.0129632im     0.0668321-0.0156741im     0.0462118-0.0303821im    0.0134098-0.0809233im      0.214697+0.0417577im    0.00558144+0.092571im     -0.0462338+0.0311639im     0.0604666-0.0358433im     0.0864537-0.266767im       -0.164357-0.239977im</code></pre><p>and then generate the state <span>$ψ$</span></p><pre><code class="language-julia hljs">psi = P[:, 3]</code></pre><pre><code class="nohighlight hljs">32-element Vector{ComplexF64}:
   0.13629405066311492 + 0.008248259536325901im
  0.030805961051134055 + 0.06893100475718784im
   -0.0650092376744712 - 0.04351319681125927im
    0.1146340482011206 - 0.007987563462454692im
 -0.048748964857916945 - 0.13977736365582324im
 -0.035121326318596095 + 0.022583052656098057im
  -0.11117178937523865 + 0.023477896940834863im
   -0.0245678717485954 - 0.06754289086332918im
   0.12189835316255968 - 0.19133111950859744im
  -0.14682524289628332 + 0.021692470311485086im
    0.1565559155692968 - 0.0021429630878006325im
   -0.1450239682062308 + 0.14393488353202738im
    0.3469838317234785 + 0.0im
   0.30526298551870834 - 0.0738893372843909im
   0.17077431304290785 - 0.18587571912001188im
    0.1372109448309022 + 0.10949509364841199im
   -0.0671607346393481 - 0.09882415755772565im
   -0.2281176092472099 + 0.2223013188561926im
   0.20458121222468778 + 0.029699453102801227im
  -0.08916522579029376 + 0.12828919120024307im
   0.12203870288703672 - 0.03431910697295285im
   0.08170343407718654 + 0.16174387313888944im
   0.08741775015737326 + 0.03235741640625231im
   0.15762793873805214 + 0.1756987925700056im
   0.03569677179816409 - 0.025531584209112775im
   -0.0176663430468926 - 0.06854646269208654im
  0.034848755625727264 + 0.044524257901577144im
    0.2677854763343692 + 0.040799741617976094im
  -0.12173645361818315 - 0.011782308727161815im
    0.1138558507903933 - 0.07602594170465955im
   0.02429335649309538 - 0.11467152331326899im
  0.029253791840035744 + 0.18240615839254984im</code></pre><p>In the phase estimation process, we will feed the state to circuit and measure the first <code>n</code> qubits processed by iQFT.</p><pre><code class="language-julia hljs">r = join(ArrayReg(psi), zero_state(N))
r |&gt; PE(N, M, U)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 8/8
    nlevel: 2</code></pre><p>Since our phase can be represented by 3 qubits precisely, we only need to measure once</p><pre><code class="language-julia hljs">results = measure(r, 1:N; nshots=1)</code></pre><pre><code class="nohighlight hljs">1-element Vector{DitStr{2, 3, Int64}}:
 011 ₍₂₎</code></pre><p>Recall that our QFT&#39;s bit numbering is reversed, let&#39;s reverse it back</p><pre><code class="language-julia hljs">using BitBasis
estimated_phase = bfloat(results[]; nbits=N)</code></pre><pre><code class="nohighlight hljs">0.75</code></pre><p>the phase is exactly <code>0.75</code>!</p><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../1.prepare-ghz-state/index.html">« Prepare Greenberger–Horne–Zeilinger state with Quantum Circuit</a><a class="docs-footer-nextpage" href="../3.grover-search/index.html">Grover Search »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.19 on <span class="colophon-date" title="Friday 17 June 2022 17:39">Friday 17 June 2022</span>. Using Julia version 1.7.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
