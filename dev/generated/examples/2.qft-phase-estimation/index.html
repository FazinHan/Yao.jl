<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Quantum Fourier Transformation and Phase Estimation · Documentation | Yao</title><meta name="title" content="Quantum Fourier Transformation and Phase Estimation · Documentation | Yao"/><meta property="og:title" content="Quantum Fourier Transformation and Phase Estimation · Documentation | Yao"/><meta property="twitter:title" content="Quantum Fourier Transformation and Phase Estimation · Documentation | Yao"/><meta name="description" content="Documentation for Documentation | Yao."/><meta property="og:description" content="Documentation for Documentation | Yao."/><meta property="twitter:description" content="Documentation for Documentation | Yao."/><script data-outdated-warner src="../../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../search_index.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script><link href="../../../assets/indigo.css" rel="stylesheet" type="text/css"/><link href="https://yaoquantum.org/assets/favicon-light.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../index.html"><img src="../../../assets/logo.png" alt="Documentation | Yao logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../../index.html">Documentation | Yao</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../../index.html">Home</a></li><li><a class="tocitem" href="../../../quick-start.html">Quick Start</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../../../man/registers.html">Quantum Registers</a></li><li><a class="tocitem" href="../../../man/blocks.html">Blocks</a></li><li><a class="tocitem" href="../../../man/symbolic.html">Symbolic Computation</a></li><li><a class="tocitem" href="../../../man/cuda.html">CUDA extension - CuYao</a></li><li><a class="tocitem" href="../../../man/plot.html">Quantum Circuit Visualization</a></li><li><a class="tocitem" href="../../../man/automatic_differentiation.html">Automatic Differentiation</a></li><li><a class="tocitem" href="../../../man/yao2einsum.html">Tensor network backend</a></li><li><a class="tocitem" href="../../../man/simplification.html">Simplification</a></li><li><a class="tocitem" href="../../../man/bitbasis.html">BitBasis</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../1.prepare-ghz-state/index.html">Prepare Greenberger–Horne–Zeilinger state with Quantum Circuit</a></li><li class="is-active"><a class="tocitem" href="index.html">Quantum Fourier Transformation and Phase Estimation</a><ul class="internal"><li><a class="tocitem" href="#Quantum-Fourier-Transformation"><span>Quantum Fourier Transformation</span></a></li><li><a class="tocitem" href="#Wrap-QFT-to-an-external-block"><span>Wrap QFT to an external block</span></a></li><li><a class="tocitem" href="#Phase-Estimation"><span>Phase Estimation</span></a></li></ul></li><li><a class="tocitem" href="../3.grover-search/index.html">Grover Search</a></li><li><a class="tocitem" href="../4.shor-algorithm/index.html">Shor&#39;s Algorithm</a></li><li><a class="tocitem" href="../5.shor-9-code/index.html">Shor&#39;s 9 qubit code</a></li><li><a class="tocitem" href="../6.quantum-circuit-born-machine/index.html">Quantum Circuit Born Machine</a></li><li><a class="tocitem" href="../7.variation-quantum-eigen-solver/index.html">Variational Quantum Eigen Solver</a></li><li><a class="tocitem" href="../8.riemannian-gradient-flow/index.html">Riemannian gradient flow optimizer</a></li></ul></li><li><a class="tocitem" href="../../../performancetips.html">Performance Tips</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href="index.html">Quantum Fourier Transformation and Phase Estimation</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="index.html">Quantum Fourier Transformation and Phase Estimation</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/QuantumBFS/Yao.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/QuantumBFS/Yao.jl/blob/master/docs/src/examples/2.qft-phase-estimation/main.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><p><a href="/generated/examples/2.qft-phase-estimation/main.ipynb"><img src="https://mybinder.org/badge_logo.svg" alt/></a></p><h1 id="example-qft"><a class="docs-heading-anchor" href="#example-qft">Quantum Fourier Transformation and Phase Estimation</a><a id="example-qft-1"></a><a class="docs-heading-anchor-permalink" href="#example-qft" title="Permalink"></a></h1><p>Let&#39;s use Yao first</p><pre><code class="language-julia hljs">using Yao</code></pre><h2 id="Quantum-Fourier-Transformation"><a class="docs-heading-anchor" href="#Quantum-Fourier-Transformation">Quantum Fourier Transformation</a><a id="Quantum-Fourier-Transformation-1"></a><a class="docs-heading-anchor-permalink" href="#Quantum-Fourier-Transformation" title="Permalink"></a></h2><p>The Quantum Fourier Transformation (QFT) circuit is to repeat two kinds of blocks repeatly:</p><p><img src="assets/qft.png" alt="qft-circuit"/></p><p>The basic building block control phase shift gate is defined as</p><p class="math-container">\[R(k)=\begin{bmatrix}
1 &amp; 0\\
0 &amp; \exp\left(\frac{2\pi i}{2^k}\right)
\end{bmatrix}\]</p><p>Let&#39;s define block <code>A</code> and block <code>B</code>, block <code>A</code> is actually a control block.</p><pre><code class="language-julia hljs">A(i, j) = control(i, j=&gt;shift(2π/(1&lt;&lt;(i-j+1))))</code></pre><pre><code class="nohighlight hljs">A (generic function with 1 method)</code></pre><p>Once you construct the blockl you can inspect its matrix using <code>mat</code> function. Let&#39;s construct the circuit in dash box A, and see the matrix of <span>$R_4$</span> gate.</p><pre><code class="language-julia hljs">R4 = A(4, 1)</code></pre><pre><code class="nohighlight hljs">(n -&gt; control(n, 4, 1 =&gt; shift(0.39269908169872414)))</code></pre><p>If you have read about <a href="@ref tutorial-ghz">preparing GHZ state</a>, you probably know that in Yao, we could just leave the number of qubits, and it will be evaluated when possible.</p><pre><code class="language-julia hljs">R4(5)</code></pre><pre><code class="nohighlight hljs">nqubits: 5
control(4)
└─ (1,) shift(0.39269908169872414)</code></pre><p>its matrix will be</p><pre><code class="language-julia hljs">mat(R4(5))</code></pre><pre><code class="nohighlight hljs">32×32 Diagonal{ComplexF64, Vector{ComplexF64}}:
 1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im</code></pre><p>Then we repeat this control block over and over on different qubits, and put a Hadamard gate to <code>i</code>th qubit to construct <code>i</code>-th <code>B</code> block.</p><pre><code class="language-julia hljs">B(n, k) = chain(n, j==k ? put(k=&gt;H) : A(j, k) for j in k:n)</code></pre><pre><code class="nohighlight hljs">B (generic function with 1 method)</code></pre><p>We need to input the total number of qubits <code>n</code> here because we have to iterate through from <code>k</code>-th location to the last.</p><p>Now, let&#39;s construct the circuit by chaining all the <code>B</code> blocks together</p><pre><code class="language-julia hljs">qft(n) = chain(B(n, k) for k in 1:n)
qft(4)</code></pre><pre><code class="nohighlight hljs">nqubits: 4
chain
├─ chain
│  ├─ put on (1)
│  │  └─ H
│  ├─ control(2)
│  │  └─ (1,) shift(1.5707963267948966)
│  ├─ control(3)
│  │  └─ (1,) shift(0.7853981633974483)
│  └─ control(4)
│     └─ (1,) shift(0.39269908169872414)
├─ chain
│  ├─ put on (2)
│  │  └─ H
│  ├─ control(3)
│  │  └─ (2,) shift(1.5707963267948966)
│  └─ control(4)
│     └─ (2,) shift(0.7853981633974483)
├─ chain
│  ├─ put on (3)
│  │  └─ H
│  └─ control(4)
│     └─ (3,) shift(1.5707963267948966)
└─ chain
   └─ put on (4)
      └─ H
</code></pre><h2 id="Wrap-QFT-to-an-external-block"><a class="docs-heading-anchor" href="#Wrap-QFT-to-an-external-block">Wrap QFT to an external block</a><a id="Wrap-QFT-to-an-external-block-1"></a><a class="docs-heading-anchor-permalink" href="#Wrap-QFT-to-an-external-block" title="Permalink"></a></h2><p>In most cases, <code>function</code>s are enough to wrap quantum circuits, like <code>A</code> and <code>B</code> we defined above, but sometimes, we need to dispatch specialized methods on certain kinds of quantum circuit, or we want to define an external block to export, thus, it&#39;s useful to be able to wrap circuit to custom blocks.</p><p>First, we define a new type as subtype of <code>PrimitiveBlock</code> since we are not going to use the subblocks of <code>QFT</code>, if you need to use its subblocks, it&#39;d be better to define it under <code>CompositeBlock</code>.</p><pre><code class="language-julia hljs">struct QFT &lt;: PrimitiveBlock{2}
    n::Int
end

YaoBlocks.nqudits(q::QFT) = q.n</code></pre><p>Now, let&#39;s define its circuit</p><pre><code class="language-julia hljs">circuit(q::QFT) = qft(q.n)</code></pre><pre><code class="nohighlight hljs">circuit (generic function with 1 method)</code></pre><p>And forward <code>mat</code> to its circuit&#39;s matrix</p><pre><code class="language-julia hljs">YaoBlocks.mat(::Type{T}, x::QFT) where T = mat(T, circuit(x))</code></pre><p>You may notice, it is a little ugly to print <code>QFT</code> at the moment, this is because we print the type summary by default, you can define your own printing by overloading <code>print_block</code></p><pre><code class="language-julia hljs">YaoBlocks.print_block(io::IO, x::QFT) = print(io, &quot;QFT($(x.n))&quot;)</code></pre><p>Since it is possible to use FFT to simulate the results of QFT (like cheating), we could define our custom <code>apply!</code> method:</p><pre><code class="language-julia hljs">using FFTW, LinearAlgebra

function YaoBlocks.apply!(r::ArrayReg, x::QFT)
    α = sqrt(length(statevec(r)))
    invorder!(r)
    lmul!(α, ifft!(statevec(r)))
    return r
end</code></pre><p>Now let&#39;s check if our <code>apply!</code> method is correct:</p><pre><code class="language-julia hljs">r = rand_state(5)
r1 = r |&gt; copy |&gt; QFT(5)
r2 = r |&gt; copy |&gt; circuit(QFT(5))
r1 ≈ r2</code></pre><pre><code class="nohighlight hljs">true</code></pre><p>We can get iQFT (inverse QFT) directly by calling <code>adjoint</code></p><pre><code class="language-julia hljs">QFT(5)&#39;</code></pre><pre><code class="nohighlight hljs"> [†]QFT(5)</code></pre><p>QFT and iQFT are different from FFT and IFFT in three ways,</p><ol><li>they are different by a factor of <span>$\sqrt{2^n}$</span> with <span>$n$</span> the number of qubits.</li><li>the <a href="https://quantumbfs.github.io/BitBasis.jl/stable/tutorial/#Conventions-1">bit numbering</a> will exchange after applying QFT or iQFT.</li><li>due to the convention, QFT is more related to IFFT rather than FFT.</li></ol><h2 id="Phase-Estimation"><a class="docs-heading-anchor" href="#Phase-Estimation">Phase Estimation</a><a id="Phase-Estimation-1"></a><a class="docs-heading-anchor-permalink" href="#Phase-Estimation" title="Permalink"></a></h2><p>Since we have QFT and iQFT blocks we can then use them to realize phase estimation circuit, what we want to realize is the following circuit:</p><p><img src="assets/phaseest.png" alt="phase estimation"/></p><p>First we call Hadamard gates repeatly on first <code>n</code> qubits.</p><pre><code class="language-julia hljs">Hadamards(n) = repeat(H, 1:n)</code></pre><pre><code class="nohighlight hljs">Hadamards (generic function with 1 method)</code></pre><p>Then in dashed box <code>B</code>, we have controlled unitaries:</p><pre><code class="language-julia hljs">ControlU(n, m, U) = chain(n+m, control(k, n+1:n+m=&gt;matblock(U^(2^(k-1)))) for k in 1:n)</code></pre><pre><code class="nohighlight hljs">ControlU (generic function with 1 method)</code></pre><p>each of them is a <code>U</code> of power <span>$2^{(k-1)}$</span>.</p><p>Since we will only apply the qft and Hadamard on first <code>n</code> qubits, we could use <code>Subroutine</code>, which creates a context of a sub-scope of the qubits.</p><pre><code class="language-julia hljs">PE(n, m, U) =
    chain(n+m, # total number of the qubits
        subroutine(Hadamards(n), 1:n), # apply H in local scope
        ControlU(n, m, U),
        subroutine(QFT(n)&#39;, 1:n))</code></pre><pre><code class="nohighlight hljs">PE (generic function with 1 method)</code></pre><p>we use the first <code>n</code> qubits as the output space to store phase <span>$ϕ$</span>, and the other <code>m</code> qubits as the input state which corresponds to an eigenvector of oracle matrix <code>U</code>.</p><p>The subroutine here uses <code>focus!</code> and <code>relax!</code> to manage a local scope of quantum circuit, and only activate the first <code>n</code> qubits while applying the block inside the subroutine context, and the scope will be <code>relax!</code>ed back, after the context. This is equivalent to manually <code>focus!</code> then <code>relax!</code></p><p>fullly activated</p><pre><code class="language-julia hljs">r = rand_state(5)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 5/5
    nlevel: 2</code></pre><p>first 3 qubits activated</p><pre><code class="language-julia hljs">focus!(r, 1:3)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 3/5
    nlevel: 2</code></pre><p>relax back to the original</p><pre><code class="language-julia hljs">relax!(r, 1:3)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 5/5
    nlevel: 2</code></pre><p>In this way, we will be able to apply small operator directly on the subset of the qubits.</p><p>Details about the algorithm can be found here: <a href="https://en.wikipedia.org/wiki/Quantum_phase_estimation_algorithm">Quantum Phase Estimation Algorithm</a></p><p>Now let&#39;s check the results of our phase estimation.</p><p>First we need to set up a unitary with known phase, we set the phase to be 0.75, which is <code>0.75 * 2^3 == 6 == 0b110</code> .</p><pre><code class="language-julia hljs">N, M = 3, 5
P = eigen(rand_unitary(1&lt;&lt;M)).vectors
θ = Int(0b110) / 1&lt;&lt;N
phases = rand(1&lt;&lt;M)
phases[0b010+1] = θ
U = P * Diagonal(exp.(2π * im * phases)) * P&#39;</code></pre><pre><code class="nohighlight hljs">32×32 Matrix{ComplexF64}:
  -0.0389099+0.00264526im   -0.155914+0.207088im      0.0802655+0.00333463im   0.00218915+0.159661im     -0.0208071-0.0957086im    -0.0454201-0.159625im       0.180394-0.0653951im     0.0489883-0.0363807im    -0.137783-0.00729283im    -0.146921+0.159832im    -0.0226029+0.12092im      -0.0111318-0.0841497im    -0.220632+0.157148im        0.136831-0.226356im      -0.153895+0.11716im     0.0241746-0.0317448im    0.00965365+0.189274im    -0.0147826-0.0308309im    -0.143716+0.0917002im     -0.221883+0.0713958im    -0.121954+0.00357109im      0.123109+0.0846174im     0.085162+0.123191im       0.119829-0.0407293im      0.279625+0.0284112im      0.276165-0.0204005im     0.034024-0.186264im       0.122027+0.0526052im   -0.0396279+0.0522255im    -0.0820955+0.0450681im     -0.14753-0.216459im       0.227358+0.110069im
    0.222665-0.0783523im     -0.20544+0.112487im     -0.0168273+0.0842163im    -0.0839328-0.00885874im    0.0826933+0.011874im     -0.0951562-0.0110509im     -0.307011-0.0422975im      0.261357-0.0643718im   -0.0225625-0.0631817im      0.163179-0.101078im     0.0421338+0.101131im      0.0197648-0.135713im    -0.0183867+0.135091im      -0.0864313+0.201574im      -0.212247-0.0284623im  -0.0295805+0.0412907im      0.187163+0.165512im       0.19201-0.203129im      0.208919+0.024906im      0.0764077-0.203925im      -0.17694-0.00144097im    -0.0920726-0.00662919im  -0.0647941-0.0366967im     -0.106369-0.177733im    0.000330151-0.0227952im     0.0439217-0.165534im     0.0486087+0.00686492im  -0.00635757+0.121229im      -0.10173+0.11289im       -0.227917+0.104091im       0.16745+0.0933445im      0.102353+0.0486078im
   -0.122289-0.236351im    -0.0201601-0.0938268im    -0.0322555+0.201997im      0.0151793-0.194863im       0.130757-0.199565im    -0.00344744-0.207897im     -0.0806188+0.138884im      0.0297174+0.0554967im     0.192807-0.137825im      -0.159966-0.0517183im   0.00424402-0.168299im      0.0250493+0.131292im    -0.0393568+0.0956695im     -0.0648058+0.0389227im     0.0161753-0.123175im    -0.187136-0.121069im      0.0698706-0.147363im    -0.0152926+0.00220541im   0.0292808+0.0815339im    -0.0362832+0.224422im     0.0661202-0.0414425im       0.206445+0.160487im     0.0827003-0.0228754im     -0.104894-0.0482998im      0.333352-0.111892im     -0.0318842+0.0338188im     0.141808-0.112816im       0.131498+0.0127673im    -0.168753+0.0456643im     -0.156041-0.00148878im  0.00145463+0.210797im      -0.164293-0.119272im
  -0.0184419+0.0652112im   -0.0300108-0.10583im       -0.144827-0.030231im      -0.108787-0.140451im       0.127905+0.0741538im     -0.222677+0.296308im       0.165306-0.0645021im     -0.110487-0.270952im     0.0673902-0.00642957im   -0.0728739-0.0246704im    -0.107736+0.115447im     -0.0275038+0.0988382im     0.201846+0.0658544im     -0.0227327+0.101275im      -0.146134-0.0818352im  -0.0282489+0.172364im      0.0438265+0.144062im       0.07109+0.0692362im   -0.0612743+0.0396319im     -0.109755+0.0772387im   -0.0625527-0.00344346im     -0.135879-0.206598im     0.0586315+0.22127im       -0.192575+0.0339326im      0.188138-0.0498945im     -0.065832+0.21254im       -0.12061+0.122968im       0.215311+0.183721im     -0.215167-0.0592608im   -0.00588577-0.109835im     -0.081649-0.0740351im     0.0140321-0.100712im
    0.330575+0.196784im      -0.08364+0.00226059im   -0.0804311-0.00146592im    0.0835731-0.0336488im     -0.079293-0.099033im      0.0561108+0.109525im     0.00929632-0.0840689im    -0.0089139-0.283511im    -0.0902527+0.105968im      -0.277427-0.0316907im   0.00484918-0.0234152im     0.0577417-0.129247im    -0.0162944+0.163798im       -0.158536-0.0519234im    -0.0528475-0.14211im     0.0520829+0.0769851im     -0.174256+0.0837179im   -0.0148228+0.0867214im    0.0521989-0.177755im    -0.00996892-0.091296im      0.332977-0.00784456im    -0.0047175+0.170484im     -0.023325+0.0759405im      0.109891-0.101525im      0.0544386+0.0116887im    -0.0732464+0.110955im     0.0488829-0.159635im         0.1438-0.196949im      0.183846+0.00765177im   -0.0527152+0.205293im     0.0439489+0.214061im     -0.0810928-0.0960929im
  -0.0352644-0.105532im    -0.0313268+0.0254366im    -0.0242074+0.0191262im     -0.175468+0.194246im     -0.0294919-0.00837554im    -0.163102+0.142004im      -0.149477+0.0976632im    -0.0428076+0.177839im     0.0524971+0.0830145im     0.0145866+0.212053im      0.163478-0.223934im      -0.287625+0.0328247im    -0.124956+0.0482258im      -0.187532+0.0934595im     0.0342992+0.0141941im   -0.184725+0.360171im     -0.0701748-0.0739512im   0.00460949-0.0172431im    -0.150618-0.071968im      0.0982021+0.0307719im   -0.0556789-0.0233807im      -0.149464+0.0667095im    -0.026157+0.151226im       0.244333-0.150987im     -0.0212091+0.0780646im      0.074699+0.100168im   -0.00930042-0.0512598im     0.0243163+0.181137im      0.143132+0.161972im     -0.0647941+0.00530198im   -0.142002-0.0578767im     -0.186748-0.0873752im
    0.139996+0.0255906im    0.0869546+0.102344im      0.0757067-0.000736148im   0.0415797+0.16531im       -0.122416-0.104707im      0.0200972+0.0909634im      0.020491+0.00714976im    -0.096163+0.0032579im    0.0732628+0.171544im        0.25399-0.229469im    -0.0652968-0.0202516im      0.130195+0.0818312im   -0.0953001+0.0209617im      -0.108481-0.0381328im    -0.0697902-0.145228im    -0.132367-0.0319688im    -0.0321255-0.247331im       0.01396-0.19692im      0.0672814+0.178779im     -0.0568969+0.192717im      0.292519-0.0946627im      -0.207766-0.0457297im   -0.0801795+0.0530677im    -0.0504407+0.0342411im      0.132356-0.144384im       0.242462+0.0533339im   -0.0465912-0.104712im     -0.0338896+0.086772im     0.0710634-0.149931im     -0.0729209-0.073118im      0.269184-0.265443im      0.0348044+0.0104987im
    0.139028+0.0554142im     0.107025-0.0715509im     -0.135184+0.303864im      -0.155313-0.0721795im    -0.0325572-0.00749529im    0.0769396-0.136239im       0.121079+0.260567im      -0.022326+0.103497im     -0.206338+0.0757884im     0.0961028-0.192507im     -0.127118-0.0844003im     -0.126197+0.0776574im   -0.0374562-0.00980246im   -0.00252636+0.117797im     -0.0379897+0.257185im    0.0595978+0.021233im     -0.0554362+0.127673im      0.251204+0.13965im       0.287588+0.0235276im     -0.104258+0.0641093im     0.106043+0.0538864im      0.0088951-0.130458im      0.112163+0.06502im        0.337478+0.034699im      0.0295889+0.00595527im   -0.0306756-0.144957im     -0.135485-0.093973im      0.0853111+0.0497212im    -0.117905+0.0566206im      0.174572+0.00141739im   0.0289741-0.0126873im   -0.00298745-0.0559762im
   -0.104975-0.101907im    -0.0427614+0.164872im      -0.156717-0.17063im        0.157676-0.135796im      0.0992401+0.0161145im     -0.240727+0.017062im       0.226649+0.0132255im    -0.0244287+0.0260324im    -0.135165+0.228879im     0.00528834+0.0356042im   -0.0233571-0.195352im      -0.186353-0.0313406im    0.0305104-0.0761252im      0.0282446-0.121506im      -0.131205-0.095622im     0.105564+0.0366058im   -0.00196423-0.142153im      0.137836+0.130023im      0.319514-0.0114236im      0.149338-0.0432883im   -0.0519891-0.116973im       0.0160787+0.19024im       0.196598+0.00575928im  -6.85955e-5-0.0851204im     0.0476522-0.0412907im     0.0415233+0.0308884im       0.2963+0.250125im     -0.0603403-0.112413im     0.0271196+0.0855876im   -0.00228848-0.0617491im     0.187885-0.121882im       0.085687-0.00050537im
    0.261783+0.123406im      0.122762-0.137174im       0.314469+0.06887im       -0.146329-0.138149im       0.153153+0.0136388im     0.0406514-0.123559im     -0.0143592+0.0325069im     0.0208356-0.0870345im    -0.121051+0.122143im      0.0178399+0.404209im     0.0583886-0.000808153im    0.149786+0.0851044im    0.0229766-0.000235526im     0.030097+0.120167im       0.117178+0.0155039im   0.0369012+0.0774663im     -0.155943-0.0802768im    -0.230481+0.00558806im    0.177404-0.0492329im     0.0172662-0.0295967im   -0.0294307+0.0537493im     -0.0994088+0.098565im      0.248766+0.0208298im     -0.107045+0.038425im       0.132659-0.0857428im     0.0367418-0.0513955im     0.145891+0.042872im      -0.159042+0.320963im    0.00326016-0.114877im      0.0284054+0.0648408im   -0.0153271-0.0318413im     0.0825738-0.0237749im
    0.071436+0.0773033im    -0.058239+0.221623im    -0.00899831+0.0437457im      0.229695+0.00131002im     0.284747+0.0825285im     -0.216712-0.134337im       0.170058-0.0419705im     -0.201786-0.0568138im   -0.0739087-0.276531im       0.157862-0.0157816im    0.0934989-0.0142363im     0.0531366+0.249358im      0.105058-0.109029im      -0.0335768+0.205559im     -0.0645709+0.101507im    -0.112949-0.0984852im    -0.0400723+0.0707922im    -0.067679+0.0634685im    -0.145926-0.256541im        0.21129+0.0442929im     0.125411-0.0497621im      -0.192485+0.0772566im    -0.143002+0.0474676im    0.00575582-0.00912901im     0.058113+0.0634602im     0.0839338-0.183212im     0.0629881-0.228875im     -0.0303104-0.0526527im   -0.0225559+0.082386im      0.0816753-0.0840799im   -0.0348847+0.0447268im     0.0178014+0.0650489im
   0.0856231+0.0586859im      -0.2661-0.210403im      0.0856708+0.0968348im      0.136269+0.0582642im      0.111268+0.0573919im      0.114679-0.0748415im     0.0105934+0.212982im     -0.0762851-0.0773528im    0.0888956-0.0229528im      0.167625-0.0544901im    -0.114437-0.130472im      0.0463645+0.0565634im   -0.0568627-0.0505829im      0.0141396-0.231323im     -0.0716043-0.0655203im  -0.0535792+0.132804im       0.105807-0.0839872im     0.210134-0.0624335im    -0.155501-0.137011im       0.185729+0.00944374im   -0.153468-0.0168515im      0.0647324-0.00865727im    0.163031+0.188665im     -0.0185209+0.0884311im     -0.069721-0.0833212im    -0.0867728+0.0899168im    -0.108456-0.0643692im     -0.195093-0.130104im      0.056825-0.054707im     -0.0650237+0.171805im     -0.102594-0.0194647im      0.323897-0.288091im
    0.135594+0.154608im     -0.022549+0.0495107im     0.0756122+0.012844im      -0.137159-0.00978697im    0.0234255+0.226868im      -0.155061+0.0355096im     0.0231537+0.0234275im     -0.147122+0.276803im     0.0941002-0.0351281im      0.109083+0.0760278im    -0.257992+0.0725886im     -0.137268-0.132305im      0.203588+0.0316157im       0.231894+0.0271542im    -0.0731437-0.0607951im  -0.0305333-0.190681im    -0.00203935-0.132216im    -0.0453753-0.0164389im     0.100408+0.0120627im    -0.0144456-0.113793im     0.0876617+0.234762im        0.106157+0.25299im       -0.22839+0.02434im         0.10107-0.0607154im       0.21038-0.0356538im    -0.0491158+0.0661158im    -0.184954+0.0816891im    -0.0841323-0.107088im    -0.0415926-0.0329901im      -0.22657+0.123769im     -0.148354-0.0786103im     -0.112917-0.0629962im
  0.00370244+0.155056im     0.0918471+0.0237901im      0.181584-0.0408781im      0.133488-0.0518037im    -0.0428118-0.190903im      0.0634251-0.186351im    -0.00177426-0.199046im       0.111025-0.0890667im     0.109568-0.0318058im    -0.0328044+0.0524436im     0.129243+0.0516826im     -0.258883+0.112137im     0.0897763-0.251538im       0.0345167+0.0896785im     0.0286032-0.348004im   -0.0622083+0.215202im        0.13905+0.090687im      0.251163-0.170459im     0.0644908-0.02578im       0.0129963-0.10544im      0.0106463+0.0933376im       0.171067+0.110666im    -0.0268145+0.0634702im      0.105302+0.222659im      0.0715184+0.037772im      0.0738864-0.171662im     -0.107885+0.0398254im      0.140286-0.0173899im  -0.00627931-0.0763731im      0.146106-0.00838213im  0.00498245-0.171865im      -0.142785-0.0541344im
    0.114739-0.141238im    -0.0340446-0.0696442im     -0.147124-0.10631im       0.0148574-0.20272im      0.00396606-0.0134061im     -0.204926-0.00886038im    0.0726764+0.292622im       0.100423-0.079789im      0.180129+0.12675im      -0.0503956+0.153801im     0.0674611+0.080419im      0.0506283-0.0478204im    0.0104383-0.238116im      -0.0365696-0.0603357im      0.120887+0.270309im    -0.131801-0.0594829im     -0.143496-0.0183446im     0.173942-0.173491im    -0.0705164+0.0882644im      0.110487-0.0991476im    0.0974084+0.0809691im     -0.0909963-0.0860818im     0.101821-0.0609617im    -0.0348567+0.15209im       0.0625663+0.128585im       0.139769-0.105794im     -0.113521+0.0241457im      0.182751-0.147085im      0.140498-0.178169im      -0.239466+0.0910581im   -0.0677856+0.0252826im    -0.0202982+0.217579im
   -0.140747-0.156811im    -0.0181704+0.0117926im    -0.0570354+0.133279im       0.147966-0.242697im      0.0515928+0.325047im       0.082225+0.0126303im     -0.101742-0.144631im      -0.188482+0.0195136im   -0.0401295+0.0616093im     0.0842981-0.0159221im  -0.00610621+0.218521im      0.0983166-0.0203836im  -0.00646591+0.105766im       0.0602165-0.151767im       0.083563-0.12913im     -0.038471+0.1986im         -0.14555-0.191852im     0.0356802-0.0600306im   -0.0929851-0.226572im     -0.0595292+0.105415im       -0.1034+0.243808im        0.061096+0.0143106im     0.057096+0.0470346im      0.239952-0.0518588im   -0.00679889-0.024264im      0.0496815-0.106619im    -0.0594433+0.00238219im     0.198478+0.138578im    0.00762122-0.0126867im    -0.0140281+0.0582819im     0.302527+0.104722im      0.0291502+0.191644im
  -0.0976063-0.00848655im   0.0744243+0.0620549im      0.224773+0.070527im      0.0577968-0.17069im       -0.110875+0.082913im      0.0936776+0.119302im      0.0119461+0.158709im      -0.217851-0.0794116im     0.148772+0.113189im     -0.0436084-0.0673216im    0.0443228-0.0744886im    -0.0462484+0.0309522im    -0.170033-0.147518im        0.132171-0.273889im       -0.14823-0.0235529im   0.0782354-0.00257397im    0.0432035+0.401742im    -0.0805575+0.0429376im     0.087276+0.0057217im      0.245212+0.0241085im     0.091715+0.00461505im  -0.000692805-0.096622im     -0.195101-0.0826542im    -0.0793585-0.00767027im     0.151141+0.0408612im      0.107211-0.079831im    -0.0564482+0.0958589im     -0.092092+0.27958im       0.103261+0.205331im     -0.0863724+0.0586125im    0.0169519+0.154313im     -0.0859791-0.0487345im
    0.171136+0.0647472im   0.00299547-0.0894682im      0.249652-0.0754416im       0.13577+0.0382787im     0.0570904+0.0313299im     0.0802697+0.459981im       0.119731+0.134967im      0.0633199+0.0614653im   -0.0440767-0.208617im      -0.139212+0.0578095im    0.0538904-0.211776im      0.0484182-0.188063im     0.0522473-0.0895351im     -0.0994421-0.0405519im     -0.125028-0.0585254im     -0.1054-0.0733741im     0.0425907-0.131317im      0.133699+0.0771517im   -0.0547297-0.0922131im     -0.177926+0.145061im     -0.156925+0.035605im       0.0145907-0.102948im     0.0696382-0.257829im      0.0843238-0.136447im       0.121574+0.153216im      0.0148866-0.287674im    0.00447897-0.0175638im    -0.0146048-0.0132967im     -0.11812-0.0351375im     0.0341648-0.0193263im    0.0847059-0.0724068im    -0.0675508+0.00119753im
    0.302705-0.0559416im   -0.0049956+0.131296im     -0.0545674+0.149714im     -0.0648433+0.0488674im      0.132545-0.124414im     -0.0949776+0.0429026im     0.0131164+0.00542662im    -0.107238+0.0190599im     0.262014-0.138635im         -0.186+0.0828493im    -0.264912-0.0419077im     -0.193217-0.0624181im    -0.116251+0.0557526im      0.0825114-0.114362im     -0.0332714-0.187541im   -0.0717458-0.0244825im    -0.0745535-0.0148532im   -0.0857072-0.0333928im    0.0843006+0.165806im      0.0410188+0.100012im    -0.0235372+0.172168im     -0.00909443+0.00968585im   0.0783789+0.0744292im     -0.114897+0.0603964im     -0.310403+0.000183267im   -0.108474-0.171741im    -0.0309915-0.0288035im       0.05055+0.0534957im       0.1768+0.0705593im      0.179845-0.269154im    0.00782667+0.098194im       0.174176+0.183515im
   0.0785259+0.0670135im    -0.198666+0.220272im     -0.0969828+0.172119im       0.143726-0.0445253im     -0.150943-0.0615878im     -0.030005+0.0827711im      0.045158+0.0948548im      0.257411+0.224826im     0.0461658+0.117192im       0.102776+0.137108im    -0.0379596-0.00790994im     0.123277-0.116247im     0.0809336-0.168806im       -0.122364+0.0537087im     0.0608128-0.0271621im     0.16705-0.102643im      0.0134526+0.170233im     -0.251341-0.0958573im   -0.0815207-0.155206im      -0.016736+0.240237im     -0.124583-0.0479494im      0.0561675-0.0763517im   -0.0691738+0.275529im      0.0906531+0.210534im      0.0721097-0.08986im       -0.231022-0.0624877im     0.103351+0.113987im      0.0861059+0.0372397im    0.0599913-0.0356595im    -0.0680996-0.0872053im     0.122102-0.0269216im    -0.0785476-0.118539im
  -0.0489521-0.15013im     -0.0446378-0.132147im      0.0129021+0.0161078im     -0.099242-0.0412839im     -0.164108+0.0771614im    -0.0330291+0.181465im     -0.0469876+0.0150914im    0.00953702-0.0162824im   -0.0789496-0.0647687im     0.0689283+0.0166631im   -0.0171151+0.0636167im      0.247561-0.16061im       0.118473-0.0811895im      -0.111654-0.0774873im     0.0337621+0.0108288im  0.00145571-0.0728933im     0.0930897-0.0262381im    0.0554172-0.203683im      0.157783+0.108265im       0.323948+0.00921943im   0.0553419+0.104451im        0.153381+0.151284im    -0.0487978+0.239972im     -0.0162688-0.106543im       0.131475+0.210978im      0.0535384+0.0924885im     0.153468-0.193629im      0.0576419+0.0319941im   -0.0105919+0.0367838im      0.471296-0.067632im     -0.150689-0.0494834im     0.0288639+0.0331627im
  -0.0647547-0.0260445im    -0.240143+0.138411im      0.0690154+0.037215im      0.0209301-0.215053im       0.245217+0.13027im       0.0266956+0.213325im      -0.135499+0.0846796im      0.165787-0.0846054im    -0.172797-0.0287932im   -0.00878655+0.149109im     0.0477463-0.0243216im     -0.104571+0.135885im    -0.0492984+0.13996im         0.107469-0.230744im       0.151669-0.0491351im    0.180592-0.104742im      0.0723604-0.0476063im     0.082938-0.065409im      0.127174+0.0808964im   -0.00519908+0.0230872im      0.15077-0.267257im      -0.0725852+0.0834975im   -0.0938703-0.0541473im     0.0641896+0.119221im      -0.220788-0.101546im     -0.0516146+0.0199458im      -0.1632-0.24507im       0.0421376+0.0814651im   -0.0887283-0.134556im    -0.00895324-0.0728112im    -0.122587-0.136286im       -0.20056+0.00806049im
   -0.121134-0.0785161im    -0.126155-0.199802im      -0.192578+0.132689im      0.0202195-0.0658597im     -0.070596-0.386431im     0.00939128+0.0134505im      0.084838+0.00267068im    0.0538621-0.051717im   -0.00778415+0.0218388im    -0.0206076+0.136105im    0.00843148+0.118843im     -0.0109621-0.065385im    -0.0807304-0.0292447im      0.0336221+0.00377521im   -0.0520514-0.0741777im    0.158658-0.0993981im      0.195313-0.198295im     -0.110259+0.252924im    -0.0284279-0.185345im      0.0994063-0.0600973im     0.127992+0.187619im       -0.126849-0.0349729im    -0.104404+0.17044im      -0.0448218-0.262141im      -0.120284-0.0313389im      0.232035-0.235661im     -0.199428+0.0610919im     -0.127021+0.0755807im    -0.104134-0.102074im     -0.0223146+0.0267374im    -0.012227-0.0957086im    -0.0453145-0.0287397im
  -0.0714533-0.115774im     0.0810158-0.00749125im     0.139117-0.109342im     -0.0457676+0.00307573im     0.117205+0.00273595im     -0.11792+0.033253im     -0.0831382-0.164805im       0.073412-0.0550331im    0.0467135-0.13742im       0.0280292-0.0956322im   -0.0250715-0.20993im       0.0163651-0.164674im     -0.160426+0.164147im        -0.19135+0.099975im       0.100209+0.0705219im    0.297645-0.0612804im    -0.0655285+0.0551359im     0.193043+0.0225564im    0.0491869-0.229505im     -0.0339645+0.223886im      0.135122+0.188051im       0.0494174+0.0509991im    0.0932509+0.194503im     -0.0819282+0.316392im      0.0816601+0.0669082im     0.0958036+0.0633124im    -0.187437+0.115685im      -0.260611-0.0358622im    0.0117294+0.111828im     -0.0768163+0.00461465im  -0.0244157-0.00969647im   -0.0365797+0.185327im
   -0.180307+0.121041im     0.0119647-0.00971139im   -0.0484325-0.234133im      -0.131163-0.0403512im     0.0433314+0.195633im     -0.0342116+0.0470156im     0.0182801+0.0857695im      0.115184+0.0617456im   -0.0272537+0.187053im     -0.0257914+0.106449im     -0.164346+0.218374im      0.0697343+0.0670051im    -0.286967-0.152646im      -0.0102519+0.222912im      -0.197984-0.0779813im   -0.138092-0.0053865im      0.157872+0.0652473im   -0.0443552-0.0387125im   -0.0161207-0.00232188im    -0.120788+0.283437im      0.130226-0.0192201im    -0.00781553+0.278827im      0.153105-0.00805055im    -0.103352+0.024283im      -0.187586+0.180905im      0.0226997-0.123014im     -0.118949-0.0971251im    -0.0268669-0.0599657im  -0.00409499+0.0802601im     0.0610549+0.105477im      0.100224+0.146696im       0.015215-0.185426im
   0.0864298+0.140688im      0.150006-0.137568im     -0.0889689-0.134418im      0.0879389-0.204404im      -0.176749-0.0358654im     0.0502725+0.0259964im      0.311799+0.0929051im     0.0660888+0.114695im      0.129419-0.209274im       0.091633+0.0712965im     0.355488-0.00356274im    -0.128987-0.0482452im    0.0682841+0.101972im       0.0854594+0.0223296im   -0.00463705+0.0363161im    0.112096-0.113356im     -0.0514431+0.0110945im    0.0505495-0.263868im    -0.0292074-0.0191233im    -0.0597189+0.00560084im  0.00631994-0.0017458im      0.0169689+0.160276im     0.0510684+0.0641844im    0.00220236-0.116643im      -0.178338-0.102737im      0.0475376+0.238158im      -0.11505-0.147435im     -0.0174346+0.171137im    -0.0693849+0.224441im     -0.0796169-0.101636im      0.163053+0.0990189im      0.162468-0.0323242im
   0.0406287+0.0389387im     0.115982+0.159019im      -0.137027-0.00481451im    0.0211632+0.119012im     -0.0568958+0.0165427im    -0.0646562-0.0162595im     -0.224705-0.0274225im     0.0566405+0.0650706im    -0.025219-0.188205im      -0.101981+0.0911645im   -0.0155346+0.0011052im     -0.029606+0.0655449im    -0.289808-0.216749im       0.0180936-0.02563im       0.0554818-0.0594932im    0.122249-0.229077im      -0.202865-0.109062im     0.0766868+0.0401917im    0.0646789-0.149332im       0.155245-0.0243394im    -0.168056-0.068208im       -0.141935-0.0189605im     0.023221-0.125872im      -0.103743-0.0786646im      0.229191-0.0663093im    -0.0214198+0.202054im     -0.306472+0.0657855im      0.245273+0.0580087im   -0.0478346-0.0355242im      0.224748+0.16982im      0.0913538-0.00666747im     0.139907-0.150193im
    0.202319-0.18188im       0.197384+0.106611im      -0.109506+0.0364042im     -0.172073+0.00971526im   -0.0640541+0.181207im      0.0228936-0.0219588im      0.209733+0.101003im      0.0900003+0.204662im     -0.149474+0.107424im      -0.115558-0.0192443im    0.0969536+0.0701725im     0.0213925+0.0525393im    0.0153538+0.146145im       0.0437988+0.0441899im     0.0281317-0.405776im     0.218707+0.0776535im     0.0785106-0.173883im     0.0753407+0.0136018im    -0.185548-0.0433451im      0.139961-0.0369757im    0.0358587-0.0510396im     0.00544282-0.227031im    -0.0926879-0.0557068im      -0.14705+0.228775im      0.0638641+0.0805727im      0.104426-0.116109im     0.0935137-0.110896im     -0.0088242-0.0498025im   -0.0771663+0.135912im     -0.0473754+0.0997977im    -0.174626+0.0672708im     0.0905678-0.0392753im
   0.0412556+0.075253im    -0.0693342-0.182734im     -0.0717099+0.160651im       0.110998+0.0362657im    -0.0759148-0.0456114im      -0.10905+0.00289893im    0.0182035-0.00884107im    0.0460918+0.177696im     -0.154696+0.167894im     0.00591147-0.147188im     0.0620998+0.00382973im    -0.190916+0.0506765im    0.0534426+0.0161581im      -0.204761-0.160996im      -0.176006-0.0497093im  -0.0664402+0.0209361im      0.187655+0.0872103im    -0.217259-0.0381461im   -0.0664159-0.0837777im     0.0709407-0.00177562im  -0.0451411+0.105044im       -0.133102+0.202192im      0.174064-0.273802im       -0.11255+0.177566im      0.0969588-0.0279558im     -0.142888+0.14947im      -0.148995-0.0893161im    -0.0641214+0.0661653im   -0.0987412-0.055836im       0.112163+0.102689im    -0.0448461-0.00690026im   -0.0430623+0.411624im
 0.000894642+0.0730934im   -0.0787679-0.0529303im      0.242922-0.0649884im     0.0446196-0.25im        -0.00679934-0.177102im     -0.0109789+0.0739178im    -0.0682995-0.154965im      0.0619812+0.212523im     0.0543109+0.155786im      0.0997346-0.0621536im   -0.0441952-0.109154im      -0.237867-0.0415674im   -0.0687207+0.221404im        0.281462+0.0561422im    -0.0669064+0.132296im   -0.0842028-0.00268287im   -0.0512073-0.065702im      -0.12628-0.0827922im    0.0430536-0.121237im      0.0569409+0.0551199im   -0.0612359-0.085112im       -0.157016-0.217256im    -0.0568872+0.112723im     -0.0415263+0.0740152im     0.0207059+0.216325im       0.179839+0.0684554im    0.0949336-0.0308208im      0.145481-0.219029im     -0.128743-0.157409im       0.177656+0.0758906im   -0.0024323+0.238174im      0.0787103-0.0363845im
   0.0397195+0.0934104im      0.23296-0.130277im      0.0988029+0.131059im      -0.110574+0.136637im      0.0167669+0.0445722im     -0.157077-0.0516913im     0.0162733-0.00124708im  0.000732459-0.210866im     -0.149636-0.0258428im     0.0183014-0.0505752im     -0.17459+0.0409266im     -0.270542-0.173903im    -0.0233938-0.172993im       -0.133803-0.158384im      0.0110252+0.177957im     0.241327+0.0997717im   -0.00664206-0.130213im     -0.021857-0.118271im     -0.219757+0.0308421im      0.122831+0.108793im    -0.0545357-0.155575im       0.0966281+0.196715im     -0.185543+0.0116753im    -0.0401925+0.00327809im   -0.0674553-0.0128476im     0.0864861-0.0932853im     0.121074+0.0138543im      0.104993+0.0276774im    -0.231981-0.179434im      -0.130675-0.107066im      0.140544+0.214918im     -0.0186633-0.0622358im
   0.0250214-0.0233414im   -0.0972301-0.156361im       0.104794+0.0168125im    -0.0931431-0.255904im     -0.0324191-0.0874374im    -0.0581822+0.0143279im   -0.00229332+0.0961902im    -0.0173466-0.072242im    -0.0586196-0.130559im       0.176163-0.188122im     0.0455355+0.34723im        -0.17989-0.0263312im    -0.029274-0.0341218im     -0.0988548+0.0708382im    0.00836135-0.103091im     0.135387-0.0334006im    -0.0701469-0.106018im   -0.00811839+0.134031im    0.00484565+0.0483724im     -0.171685+0.145455im     -0.251308-0.190566im      -0.0905748+0.093791im    -0.0819006-0.0763411im     0.0184798-0.00668329im     0.164174-0.0453022im      0.046809-0.0372505im    0.0123968+0.0234894im    -0.0352572-0.0871754im      0.51221+0.0957121im     0.0739437-0.0434267im    -0.157867+0.0148541im     0.0103424+0.00664142im</code></pre><p>and then generate the state <span>$ψ$</span></p><pre><code class="language-julia hljs">psi = P[:, 3]</code></pre><pre><code class="nohighlight hljs">32-element Vector{ComplexF64}:
   0.16741568649891972 - 0.1817630947037373im
   -0.1351201722823494 + 0.08619869820218036im
   0.29032257873600853 - 0.09009959679123605im
   -0.2354550335480015 + 0.13472834205620468im
   0.25450449337543607 - 0.08276971068722162im
    0.3143374594419165 + 0.0im
  -0.05665323944206926 + 0.01940901881297989im
  -0.14420597854806677 + 0.16620669594876017im
   0.06781256645028616 - 0.1444023527243733im
   0.04121642019472767 + 0.2689115770061337im
   0.10904841546457698 - 0.04453723467810655im
  -0.05967480365103425 + 0.06453041100565528im
  0.041542763566273656 + 0.055169745257463536im
   0.06860723139153217 - 0.03703533189267781im
   0.08094949279744457 - 0.16461583119264653im
  -0.06770908378819591 + 0.03515808933770084im
 -0.011105255628256129 + 0.13119183044341537im
  -0.09798894593901704 + 0.03820306791138874im
     0.180291559580323 + 0.02151066770046693im
  -0.07384824361450879 - 0.04540841897869219im
  -0.13039962252164938 - 0.05330616936322257im
  -0.21701812059417713 + 0.057757412061984106im
  -0.07718498032093742 - 0.0960872619453769im
   0.08769341977529074 - 0.03570835905896279im
    -0.073165143250311 - 0.09797264862324369im
  -0.06559914772253693 - 0.021835897503945913im
   0.06349426847438393 - 0.1844464893205715im
  0.018390921969848442 - 0.1777397022346729im
  -0.09864638047688074 - 0.16711890400283042im
  -0.03468268913670887 + 0.1755478342766602im
   -0.0796303879879677 + 0.036508163989790385im
 -0.018270391455076612 + 0.15071753656348813im</code></pre><p>In the phase estimation process, we will feed the state to circuit and measure the first <code>n</code> qubits processed by iQFT.</p><pre><code class="language-julia hljs">r = join(ArrayReg(psi), zero_state(N))
r |&gt; PE(N, M, U)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 8/8
    nlevel: 2</code></pre><p>Since our phase can be represented by 3 qubits precisely, we only need to measure once</p><pre><code class="language-julia hljs">results = measure(r, 1:N; nshots=1)</code></pre><pre><code class="nohighlight hljs">1-element Vector{DitStr{2, 3, Int64}}:
 011 ₍₂₎</code></pre><p>Recall that our QFT&#39;s bit numbering is reversed, let&#39;s reverse it back</p><pre><code class="language-julia hljs">using BitBasis
estimated_phase = bfloat(results[]; nbits=N)</code></pre><pre><code class="nohighlight hljs">0.75</code></pre><p>the phase is exactly <code>0.75</code>!</p><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../1.prepare-ghz-state/index.html">« Prepare Greenberger–Horne–Zeilinger state with Quantum Circuit</a><a class="docs-footer-nextpage" href="../3.grover-search/index.html">Grover Search »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.4.0 on <span class="colophon-date" title="Tuesday 30 April 2024 20:50">Tuesday 30 April 2024</span>. Using Julia version 1.10.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
