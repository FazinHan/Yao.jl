<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Quantum Fourier Transformation and Phase Estimation · Documentation | Yao</title><meta name="title" content="Quantum Fourier Transformation and Phase Estimation · Documentation | Yao"/><meta property="og:title" content="Quantum Fourier Transformation and Phase Estimation · Documentation | Yao"/><meta property="twitter:title" content="Quantum Fourier Transformation and Phase Estimation · Documentation | Yao"/><meta name="description" content="Documentation for Documentation | Yao."/><meta property="og:description" content="Documentation for Documentation | Yao."/><meta property="twitter:description" content="Documentation for Documentation | Yao."/><script data-outdated-warner src="../../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../search_index.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script><link href="../../../assets/indigo.css" rel="stylesheet" type="text/css"/><link href="https://yaoquantum.org/assets/favicon-light.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../index.html"><img src="../../../assets/logo.png" alt="Documentation | Yao logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../../index.html">Documentation | Yao</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../../index.html">Home</a></li><li><a class="tocitem" href="../../../quick-start.html">Quick Start</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../../../man/registers.html">Quantum Registers</a></li><li><a class="tocitem" href="../../../man/blocks.html">Blocks</a></li><li><a class="tocitem" href="../../../man/symbolic.html">Symbolic Computation</a></li><li><a class="tocitem" href="../../../man/cuda.html">CUDA extension - CuYao</a></li><li><a class="tocitem" href="../../../man/plot.html">Quantum Circuit Visualization</a></li><li><a class="tocitem" href="../../../man/automatic_differentiation.html">Automatic Differentiation</a></li><li><a class="tocitem" href="../../../man/simplification.html">Simplification</a></li><li><a class="tocitem" href="../../../man/bitbasis.html">BitBasis</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../1.prepare-ghz-state/index.html">Prepare Greenberger–Horne–Zeilinger state with Quantum Circuit</a></li><li class="is-active"><a class="tocitem" href="index.html">Quantum Fourier Transformation and Phase Estimation</a><ul class="internal"><li><a class="tocitem" href="#Quantum-Fourier-Transformation"><span>Quantum Fourier Transformation</span></a></li><li><a class="tocitem" href="#Wrap-QFT-to-an-external-block"><span>Wrap QFT to an external block</span></a></li><li><a class="tocitem" href="#Phase-Estimation"><span>Phase Estimation</span></a></li></ul></li><li><a class="tocitem" href="../3.grover-search/index.html">Grover Search</a></li><li><a class="tocitem" href="../4.shor-algorithm/index.html">Shor&#39;s Algorithm</a></li><li><a class="tocitem" href="../5.shor-9-code/index.html">Shor&#39;s 9 qubit code</a></li><li><a class="tocitem" href="../6.quantum-circuit-born-machine/index.html">Quantum Circuit Born Machine</a></li><li><a class="tocitem" href="../7.variation-quantum-eigen-solver/index.html">Variational Quantum Eigen Solver</a></li><li><a class="tocitem" href="../8.riemannian-gradient-flow/index.html">Riemannian gradient flow optimizer</a></li></ul></li><li><a class="tocitem" href="../../../performancetips.html">Performance Tips</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href="index.html">Quantum Fourier Transformation and Phase Estimation</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="index.html">Quantum Fourier Transformation and Phase Estimation</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/QuantumBFS/Yao.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/QuantumBFS/Yao.jl/blob/master/docs/src/examples/2.qft-phase-estimation/main.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><p><a href="/generated/examples/2.qft-phase-estimation/main.ipynb"><img src="https://mybinder.org/badge_logo.svg" alt/></a></p><h1 id="example-qft"><a class="docs-heading-anchor" href="#example-qft">Quantum Fourier Transformation and Phase Estimation</a><a id="example-qft-1"></a><a class="docs-heading-anchor-permalink" href="#example-qft" title="Permalink"></a></h1><p>Let&#39;s use Yao first</p><pre><code class="language-julia hljs">using Yao</code></pre><h2 id="Quantum-Fourier-Transformation"><a class="docs-heading-anchor" href="#Quantum-Fourier-Transformation">Quantum Fourier Transformation</a><a id="Quantum-Fourier-Transformation-1"></a><a class="docs-heading-anchor-permalink" href="#Quantum-Fourier-Transformation" title="Permalink"></a></h2><p>The Quantum Fourier Transformation (QFT) circuit is to repeat two kinds of blocks repeatly:</p><p><img src="assets/qft.png" alt="qft-circuit"/></p><p>The basic building block control phase shift gate is defined as</p><p class="math-container">\[R(k)=\begin{bmatrix}
1 &amp; 0\\
0 &amp; \exp\left(\frac{2\pi i}{2^k}\right)
\end{bmatrix}\]</p><p>Let&#39;s define block <code>A</code> and block <code>B</code>, block <code>A</code> is actually a control block.</p><pre><code class="language-julia hljs">A(i, j) = control(i, j=&gt;shift(2π/(1&lt;&lt;(i-j+1))))</code></pre><pre><code class="nohighlight hljs">A (generic function with 1 method)</code></pre><p>Once you construct the blockl you can inspect its matrix using <code>mat</code> function. Let&#39;s construct the circuit in dash box A, and see the matrix of <span>$R_4$</span> gate.</p><pre><code class="language-julia hljs">R4 = A(4, 1)</code></pre><pre><code class="nohighlight hljs">(n -&gt; control(n, 4, 1 =&gt; shift(0.39269908169872414)))</code></pre><p>If you have read about <a href="@ref tutorial-ghz">preparing GHZ state</a>, you probably know that in Yao, we could just leave the number of qubits, and it will be evaluated when possible.</p><pre><code class="language-julia hljs">R4(5)</code></pre><pre><code class="nohighlight hljs">nqubits: 5
control(4)
└─ (1,) shift(0.39269908169872414)</code></pre><p>its matrix will be</p><pre><code class="language-julia hljs">mat(R4(5))</code></pre><pre><code class="nohighlight hljs">32×32 Diagonal{ComplexF64, Vector{ComplexF64}}:
 1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im</code></pre><p>Then we repeat this control block over and over on different qubits, and put a Hadamard gate to <code>i</code>th qubit to construct <code>i</code>-th <code>B</code> block.</p><pre><code class="language-julia hljs">B(n, k) = chain(n, j==k ? put(k=&gt;H) : A(j, k) for j in k:n)</code></pre><pre><code class="nohighlight hljs">B (generic function with 1 method)</code></pre><p>We need to input the total number of qubits <code>n</code> here because we have to iterate through from <code>k</code>-th location to the last.</p><p>Now, let&#39;s construct the circuit by chaining all the <code>B</code> blocks together</p><pre><code class="language-julia hljs">qft(n) = chain(B(n, k) for k in 1:n)
qft(4)</code></pre><pre><code class="nohighlight hljs">nqubits: 4
chain
├─ chain
│  ├─ put on (1)
│  │  └─ H
│  ├─ control(2)
│  │  └─ (1,) shift(1.5707963267948966)
│  ├─ control(3)
│  │  └─ (1,) shift(0.7853981633974483)
│  └─ control(4)
│     └─ (1,) shift(0.39269908169872414)
├─ chain
│  ├─ put on (2)
│  │  └─ H
│  ├─ control(3)
│  │  └─ (2,) shift(1.5707963267948966)
│  └─ control(4)
│     └─ (2,) shift(0.7853981633974483)
├─ chain
│  ├─ put on (3)
│  │  └─ H
│  └─ control(4)
│     └─ (3,) shift(1.5707963267948966)
└─ chain
   └─ put on (4)
      └─ H
</code></pre><h2 id="Wrap-QFT-to-an-external-block"><a class="docs-heading-anchor" href="#Wrap-QFT-to-an-external-block">Wrap QFT to an external block</a><a id="Wrap-QFT-to-an-external-block-1"></a><a class="docs-heading-anchor-permalink" href="#Wrap-QFT-to-an-external-block" title="Permalink"></a></h2><p>In most cases, <code>function</code>s are enough to wrap quantum circuits, like <code>A</code> and <code>B</code> we defined above, but sometimes, we need to dispatch specialized methods on certain kinds of quantum circuit, or we want to define an external block to export, thus, it&#39;s useful to be able to wrap circuit to custom blocks.</p><p>First, we define a new type as subtype of <code>PrimitiveBlock</code> since we are not going to use the subblocks of <code>QFT</code>, if you need to use its subblocks, it&#39;d be better to define it under <code>CompositeBlock</code>.</p><pre><code class="language-julia hljs">struct QFT &lt;: PrimitiveBlock{2}
    n::Int
end

YaoBlocks.nqudits(q::QFT) = q.n</code></pre><p>Now, let&#39;s define its circuit</p><pre><code class="language-julia hljs">circuit(q::QFT) = qft(q.n)</code></pre><pre><code class="nohighlight hljs">circuit (generic function with 1 method)</code></pre><p>And forward <code>mat</code> to its circuit&#39;s matrix</p><pre><code class="language-julia hljs">YaoBlocks.mat(::Type{T}, x::QFT) where T = mat(T, circuit(x))</code></pre><p>You may notice, it is a little ugly to print <code>QFT</code> at the moment, this is because we print the type summary by default, you can define your own printing by overloading <code>print_block</code></p><pre><code class="language-julia hljs">YaoBlocks.print_block(io::IO, x::QFT) = print(io, &quot;QFT($(x.n))&quot;)</code></pre><p>Since it is possible to use FFT to simulate the results of QFT (like cheating), we could define our custom <code>apply!</code> method:</p><pre><code class="language-julia hljs">using FFTW, LinearAlgebra

function YaoBlocks.apply!(r::ArrayReg, x::QFT)
    α = sqrt(length(statevec(r)))
    invorder!(r)
    lmul!(α, ifft!(statevec(r)))
    return r
end</code></pre><p>Now let&#39;s check if our <code>apply!</code> method is correct:</p><pre><code class="language-julia hljs">r = rand_state(5)
r1 = r |&gt; copy |&gt; QFT(5)
r2 = r |&gt; copy |&gt; circuit(QFT(5))
r1 ≈ r2</code></pre><pre><code class="nohighlight hljs">true</code></pre><p>We can get iQFT (inverse QFT) directly by calling <code>adjoint</code></p><pre><code class="language-julia hljs">QFT(5)&#39;</code></pre><pre><code class="nohighlight hljs"> [†]QFT(5)</code></pre><p>QFT and iQFT are different from FFT and IFFT in three ways,</p><ol><li>they are different by a factor of <span>$\sqrt{2^n}$</span> with <span>$n$</span> the number of qubits.</li><li>the <a href="https://quantumbfs.github.io/BitBasis.jl/stable/tutorial/#Conventions-1">bit numbering</a> will exchange after applying QFT or iQFT.</li><li>due to the convention, QFT is more related to IFFT rather than FFT.</li></ol><h2 id="Phase-Estimation"><a class="docs-heading-anchor" href="#Phase-Estimation">Phase Estimation</a><a id="Phase-Estimation-1"></a><a class="docs-heading-anchor-permalink" href="#Phase-Estimation" title="Permalink"></a></h2><p>Since we have QFT and iQFT blocks we can then use them to realize phase estimation circuit, what we want to realize is the following circuit:</p><p><img src="assets/phaseest.png" alt="phase estimation"/></p><p>First we call Hadamard gates repeatly on first <code>n</code> qubits.</p><pre><code class="language-julia hljs">Hadamards(n) = repeat(H, 1:n)</code></pre><pre><code class="nohighlight hljs">Hadamards (generic function with 1 method)</code></pre><p>Then in dashed box <code>B</code>, we have controlled unitaries:</p><pre><code class="language-julia hljs">ControlU(n, m, U) = chain(n+m, control(k, n+1:n+m=&gt;matblock(U^(2^(k-1)))) for k in 1:n)</code></pre><pre><code class="nohighlight hljs">ControlU (generic function with 1 method)</code></pre><p>each of them is a <code>U</code> of power <span>$2^{(k-1)}$</span>.</p><p>Since we will only apply the qft and Hadamard on first <code>n</code> qubits, we could use <code>Subroutine</code>, which creates a context of a sub-scope of the qubits.</p><pre><code class="language-julia hljs">PE(n, m, U) =
    chain(n+m, # total number of the qubits
        subroutine(Hadamards(n), 1:n), # apply H in local scope
        ControlU(n, m, U),
        subroutine(QFT(n)&#39;, 1:n))</code></pre><pre><code class="nohighlight hljs">PE (generic function with 1 method)</code></pre><p>we use the first <code>n</code> qubits as the output space to store phase <span>$ϕ$</span>, and the other <code>m</code> qubits as the input state which corresponds to an eigenvector of oracle matrix <code>U</code>.</p><p>The subroutine here uses <code>focus!</code> and <code>relax!</code> to manage a local scope of quantum circuit, and only activate the first <code>n</code> qubits while applying the block inside the subroutine context, and the scope will be <code>relax!</code>ed back, after the context. This is equivalent to manually <code>focus!</code> then <code>relax!</code></p><p>fullly activated</p><pre><code class="language-julia hljs">r = rand_state(5)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 5/5
    nlevel: 2</code></pre><p>first 3 qubits activated</p><pre><code class="language-julia hljs">focus!(r, 1:3)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 3/5
    nlevel: 2</code></pre><p>relax back to the original</p><pre><code class="language-julia hljs">relax!(r, 1:3)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 5/5
    nlevel: 2</code></pre><p>In this way, we will be able to apply small operator directly on the subset of the qubits.</p><p>Details about the algorithm can be found here: <a href="https://en.wikipedia.org/wiki/Quantum_phase_estimation_algorithm">Quantum Phase Estimation Algorithm</a></p><p>Now let&#39;s check the results of our phase estimation.</p><p>First we need to set up a unitary with known phase, we set the phase to be 0.75, which is <code>0.75 * 2^3 == 6 == 0b110</code> .</p><pre><code class="language-julia hljs">N, M = 3, 5
P = eigen(rand_unitary(1&lt;&lt;M)).vectors
θ = Int(0b110) / 1&lt;&lt;N
phases = rand(1&lt;&lt;M)
phases[0b010+1] = θ
U = P * Diagonal(exp.(2π * im * phases)) * P&#39;</code></pre><pre><code class="nohighlight hljs">32×32 Matrix{ComplexF64}:
    -0.158583-0.0157703im      0.157378+0.188275im      0.100879+0.0266629im      0.213972-0.145195im     -0.0632119-0.225621im      0.0676351-0.0087986im    -0.0804354+0.0506159im    -0.0618899-0.0861623im       0.049226-0.0661512im     -0.018954-0.273395im     0.0326126+0.189847im       0.159932-0.0045464im     -0.0458619+0.0352105im    -0.289449-0.136415im    -0.109803-0.0567454im      0.12565-0.104917im        -0.10829+0.0636162im    -0.107245-0.0570215im     0.147559-0.107308im       0.158407+0.139407im     -0.0707687+0.276531im     0.0761349-0.211624im   -0.0543517-0.226967im      0.190592-0.0863437im   -0.0289169+0.0576281im    -0.0157733+0.14526im       0.0135183-0.23931im      -0.0239762-0.0498208im  -0.0773508+0.0195795im  -0.0633534+0.121796im       -0.110608-0.0386786im   -0.00877347+0.0263753im
   -0.0310675+0.141522im      -0.183627-0.177169im      0.124585-0.049147im       0.212338+0.0520925im    0.00908456-0.0175468im      0.120734+0.167532im     -0.0493259+0.0436394im     0.0283824-0.11084im         0.152667-0.119419im       -0.13134+0.0821056im    0.0061421-0.00364603im   -0.0409965+0.237499im         0.26152-0.0223868im    -0.065028-0.171499im     0.120956+0.0797108im   -0.0264368-0.222777im       -0.037861-0.0740463im    -0.189709-0.100561im     -0.147326+0.09374im        0.115555+0.0621239im      0.121473-0.0508763im     -0.07497+0.0163184im   0.0190371-0.137355im     -0.164291-0.0976567im    -0.128749+0.287277im      -0.209928-0.173199im      0.0552314-0.037277im     -0.0821656-0.100078im    0.0698242+0.0799782im     0.27478-0.0531172im       0.152263-0.0597851im   -0.00924445-0.0601919im
    -0.152199-0.0737955im    -0.0331468+0.00409371im  0.00912485-0.106702im       0.202633-0.139815im      -0.141399+0.177508im       0.016015-0.036651im      -0.193503-0.0578133im     0.0553013-0.0183251im      0.0154363+0.152554im      0.0467955+0.230441im     -0.108336+0.225385im      0.0210444-0.00579811im      0.233413-0.117405im       0.29941+0.190675im    0.0930147+0.0608536im   -0.0568658+0.185752im       -0.137157-0.0508465im    -0.173646+0.165771im      0.198174-0.0483261im    -0.0299358+0.00319206im   0.00625971+0.1038im        0.152254+0.137656im   0.00979026-0.0673849im    0.0227874-0.212997im      0.059374-0.133404im     -0.0148457-0.0767833im     -0.107072-0.0820185im     0.0995885-0.126602im    -0.160443+0.265781im   -0.0174391+0.0995166im      0.0167439-0.0726656im    0.00466715+0.0773236im
     0.103906+0.10077im      -0.0673696-0.0157717im    -0.127954+0.0579837im      -0.18284-0.0420163im    -0.0369987+0.109318im     -0.0036899+0.0461204im    -0.0996979+0.0266729im      0.196521-0.0953093im       0.282599+0.090242im      0.0209953+0.105606im     0.0619907-0.00509568im    -0.209155-0.159655im       0.0883587+0.160776im     0.0151669+0.104089im   -0.0671363-0.199062im    -0.0705614-0.19749im        0.0185135+0.0382552im   -0.0825791+0.0780851im     0.154399-0.0121682im       0.22979+0.0940182im     -0.146932+0.00416309im   0.0416161-0.0511593im    0.033597+0.321763im      0.183027+0.0165844im   -0.0621299+0.131958im      0.0321627+0.235282im       0.262664-0.170669im       0.119957+0.0145844im   0.0463605+0.135265im     0.138024-0.155672im      -0.0953046-0.0999441im    -0.0413165+0.0184009im
   -0.0592182+0.14832im        0.160653+0.1776im       -0.186705+0.00940296im    0.0067193+0.124506im     -0.0397825-0.283639im      -0.110225+0.0470917im    -0.0149777-0.170747im      0.0901421+0.20462im         0.253042+0.00900765im    0.0843322+0.17196im      0.0938619+0.0935999im     0.0938814+0.0536782im     0.00998736-0.119973im    0.00741919+0.100944im     -0.10315-0.0660196im  -0.00776166+0.0338941im      -0.243551-0.293147im     0.0387093+0.0256789im   0.00602209-0.222114im      -0.156775+0.0231856im     0.0294452-0.0679187im    -0.015932-0.0225815im   -0.147155+0.0168899im    -0.122711-0.0172414im   0.00698008+0.117687im      0.0922826-0.121939im      0.0292387-0.209754im     -0.0301031+0.16419im    -0.0256185-0.0773426im   0.0535964-0.156339im        0.108843+0.220221im     -0.0332202-0.221434im
     -0.13923-0.172814im     0.00609376+0.143411im      0.149661+0.108226im     -0.0290475-0.222356im     0.00859034+0.0890481im      -0.25518-0.12986im        -0.16487+0.310023im       0.251632-0.0557068im      0.0135426-0.063019im     0.00863102+0.121801im     0.0406438-0.038232im     -0.0420977+0.0311665im      0.0745101+0.0382325im   -0.0996522+0.130191im     0.015797+0.0324966im    0.0414872-0.00138351im    -0.0467391-0.0337817im     0.122924-0.119481im     0.0166729+0.218135im      0.0609016-0.0888138im    -0.0357749-0.083879im      0.080942-0.0799136im  -0.0357349-0.220849im      0.126261+0.188135im     0.0484991+0.175476im       0.171644-0.172993im       -0.02725+0.0713135im       0.07885+0.221264im     0.148792+0.122879im   -0.0367753-0.016902im         0.15341+0.0651107im      0.239545-0.108741im
   -0.0178975-0.111599im      -0.129307+0.228249im      0.282999+0.0347619im    -0.0547556-0.125806im      0.0755354-0.243336im      -0.138699-0.0430363im     -0.157304-0.0134858im       0.15104+0.00787456im     0.0161039+0.0892307im     -0.111014-0.0689466im   -0.0256362-0.108727im      0.0274721+0.0206316im       0.114619-0.0943533im    0.0240403-0.0842819im    0.199562+0.0895859im   -0.0658987-0.190637im     -0.00896512+0.11084im      0.0593823+0.133538im    -0.0810033-0.253526im     -0.0882745+0.0149302im      0.210298-0.111779im    -0.0908063+0.215222im   0.00837413+0.157267im    -0.0735399-0.134412im    0.00154802-0.044045im     -0.0156445+0.152793im       0.163246-0.0994053im      0.196814+0.0898311im     0.15511-0.125108im    -0.179881+0.203227im       0.0988431-0.0852943im    -0.0941263+0.0835305im
   -0.0201149-0.181687im     -0.0334556+0.186275im        0.1241-0.0757679im   -0.00290771-0.167401im    -0.00468463-0.00608437im      0.11094-0.0843188im    -0.0673841-0.0065586im    -0.0976059-0.153345im       -0.124474-0.266369im       0.151718-0.0137732im    0.0538193+0.14674im       -0.185486-0.14717im        -0.163399+0.110112im     0.0334954+0.136525im   -0.0218092-0.226948im    -0.0115132-0.234967im        0.110231-0.34429im      -0.117643+0.022691im    0.00505815-0.125846im      -0.234788-0.00396255im  -0.00903257-0.0355833im   -0.0687371-0.14539im      0.152526+0.0891711im   -0.0547465+0.001798im    -0.0493584+0.0187093im    -0.0998921-0.143342im     -0.0256003+0.151759im      0.0044793+0.010359im   -0.0409647+0.0405995im    0.132825+0.0361018im       0.166152+0.0975259im     -0.219624+0.161912im
   -0.0472877+0.0613763im     -0.238808-0.0344241im    -0.123051+0.193782im     -0.0186222-0.105446im      -0.183644-0.237336im     -0.0099319-0.0311413im      0.152167+0.121654im      -0.093656-0.0899803im      -0.241137-0.000669068im   0.0497924-0.0233354im     0.084391-0.163458im     -0.0345955+0.124793im       0.0746899-0.0330615im     0.127911+0.219869im    0.0677425-0.0463918im     0.110953-0.0275609im     -0.0634073+0.0335729im   -0.0124747-0.10177im     -0.0473694-0.0336819im    -0.0321416+0.0525938im    -0.0374133-0.0672595im    0.0754349-0.0633869im    0.221912-0.174496im     -0.183209-0.0497308im    -0.184679-0.0949291im      0.131332+0.191236im     0.00554391-0.0170253im      0.112241+0.168106im     -0.11815+0.160264im    0.0876917+0.0125625im      -0.206211-0.0842223im     -0.190885-0.311204im
    -0.108078-0.179159im     0.00548609-0.0273437im    -0.151412-0.00194244im   -0.0919651-0.101768im      -0.105713+0.057527im      0.0936045+0.127492im      0.0718876-0.261593im      0.0612046-0.0629486im      0.0520425-0.109945im      -0.102041-0.123852im      0.133758+0.0432305im    0.00821458+0.355456im       -0.176795+0.222704im      0.119487+0.0249326im   0.0607054-0.0962497im     0.217766+0.000150172im    0.0726807-0.128722im      0.240255+0.177339im     0.0566969+0.272884im        0.10655-0.0991327im     0.0408853+0.0735794im    0.0907705+0.117531im    -0.159087-0.00162064im   -0.115516-0.163046im     0.0784512+0.0652775im     0.0431742-0.0411055im    -0.0159143-0.158312im      0.0594847+0.169722im     0.102546-0.0537767im  0.00858659+0.0915687im      0.0393071-0.18345im      -0.0925793+0.0922857im
    -0.113582+0.0158561im   0.000263854-0.200318im     0.0545991+0.0975397im     -0.117485+0.0395655im      0.145765-0.217173im     -0.0395985-0.18423im        0.149532-0.184281im       0.140735-0.14889im         0.115027-0.135052im      -0.199996+0.0872181im     -0.25651+0.0578885im     -0.173649-0.00337695im     -0.173364-0.148088im     0.0160075+0.0523349im   -0.174713+0.0621758im      0.10216-0.0828427im      -0.157431+0.071831im    -0.0152655-0.00515963im   0.0373118-0.160445im       0.109999-0.072128im      -0.115484-0.230564im        0.1848+0.056428im   -0.0826676-0.229074im    0.00642139-0.072911im      0.134498-0.00494717im   -0.0770002+0.126376im     -0.0690592+0.202858im      0.0673189+0.0239927im  -0.0352277+0.0609155im    0.121105-0.0684796im     -0.0255117+0.0386862im    -0.0102253+0.266164im
     0.104689+0.184124im      0.0293548+0.148001im       0.12568-0.055312im     -0.0465354+0.142173im      -0.150649-0.0520007im      0.307814-0.12383im      0.00691113+0.00421656im      0.27203+0.169688im       -0.249766-0.0947811im      0.010408+0.0282893im     0.224775-0.0788269im     -0.203199-0.252292im      -0.0223913-0.109573im      0.191158-0.108096im     0.024735+0.0810937im     0.190804-0.0288941im     -0.0463916+0.0297991im   -0.0402752-0.0760155im     0.137001+0.163787im      -0.149474-0.140396im      -0.137437+0.0376925im    0.0313366+0.0922761im  0.00767733-0.131233im     0.0120748-0.181529im     0.0551931+0.113688im      0.0426028+0.0681698im     0.0987933-0.140712im     -0.0613713-0.0697428im   0.0955569-0.108774im     0.122611+0.10608im        0.0123826+0.022057im       0.163606+0.0111128im
    -0.112023-0.250409im      -0.182717-0.0719776im    0.0306535-0.0572251im     0.0848423+0.138818im     -0.0321951-0.0853502im     -0.150026+0.0464706im     -0.015557+0.0583689im   -0.00395366+0.284871im        0.141106+0.0813615im    -0.0404456+0.0412851im     0.108954-0.0783327im     0.0640979-0.0648247im      -0.248301-0.0437532im    0.0958557-0.090368im    -0.165642-0.132425im     -0.162939-0.0282452im      -0.063281+0.231764im    -0.0616212+0.0839208im     0.239357+0.0233224im     0.0609139-0.220849im     0.00478163+0.0488494im    -0.133195-0.250342im     0.164339-0.0394408im     -0.13908-0.0278335im    0.0348716+0.0762451im     0.0916655+0.0101343im     -0.037325+0.0976695im     0.0193319-0.0375535im   -0.130816-0.0674819im    0.159086+0.0750852im        0.24652-0.267102im     -0.0304116-0.0630537im
    0.0232409-0.19437im        0.042803+0.0453138im    -0.164203-0.0265224im     -0.231969+0.218313im      -0.185405+0.106183im      -0.255023-0.00731233im   -0.0786878+0.0396306im       0.10911-0.0237044im      -0.169578-0.189491im      -0.061966-0.0370865im    -0.070614+0.296932im       0.125053-0.0313637im       0.162236-0.0567878im    -0.163737-0.284052im    -0.138867+0.149818im    -0.0173228+0.0622198im        0.05352+0.0738033im    -0.107625+0.0976861im     0.104831+0.122613im     -0.0432785-0.0113457im    -0.0187995-0.0765722im   -0.0641044+0.0519825im    0.078472+0.0210342im   -0.0128818-0.115649im    -0.0675729-0.107682im      -0.160397+0.0820222im   -0.00119425-0.00957089im   0.00966017+0.208721im     0.108974+0.0948645im    0.211292+0.0378208im     -0.0381318+0.157851im      -0.219139-0.103688im
    0.0448354+0.0906391im      0.072323-0.189652im    -0.0593251-0.0691699im      0.248547-0.168378im      0.0284592-0.0179027im   -0.00567579-0.107248im     -0.0279476-0.0535im        0.0179695-0.0724318im      -0.103293+0.0843924im     0.0453526+0.0546394im    0.0369128+0.0266583im     0.0787075-0.0732197im       0.179889+0.0733357im    0.0297467-0.0882431im   -0.350043-0.220768im     0.0843193-0.021378im        0.121271-0.0187352im    -0.142943+0.145312im     -0.142624-0.129435im       0.142362-0.275601im      -0.194255-0.0566373im    0.0269632+0.19831im     0.0080175-0.121842im    0.00977851+0.124083im     -0.185218-0.169619im      0.0667747-0.102153im      0.0393548-0.0287966im      0.122251+0.0642029im    0.237014-0.279924im    0.0108761+0.0797485im       0.103938-0.0664116im    -0.0307047-0.0930211im
   -0.0124242-0.0873168im      0.165493-0.138006im     -0.137327+0.322206im     -0.0269196-0.084549im      -0.108486+0.0554119im      0.020545-0.0376017im      0.116413-0.0575148im    -0.0184674+0.0712859im      0.0106713-0.234516im       0.115191+0.0250145im  0.000156614-0.0311343im    -0.0134539+0.0237729im      0.0413905-0.145316im    -0.0530975-0.0585556im    0.183505-0.209612im     -0.390205-0.136872im       0.0466287+0.0887387im     0.172763-0.061407im      0.150043-0.11557im      -0.0192991-0.0565723im      -0.11691+0.20677im     -0.0531693+0.278812im    -0.126983-0.125916im    -0.0336804-0.00334916im   -0.157648+0.0396542im    -0.0747522-0.0433803im      0.221844+0.103115im      0.0029279-0.0471895im    -0.11197+0.0639741im  -0.0108707+0.182708im       0.0580394+0.0958286im      0.124308-0.0233381im
     0.117064+0.143824im      0.0626177+0.0955923im     0.025395-0.102858im      0.0225838-0.133491im      0.0440563+0.00974021im     0.250785-0.0382767im      0.139067-0.036027im      0.0037736-0.324961im       0.0396039+0.015109im      -0.186024-0.0712314im    -0.130097+0.00069399im    0.0857002-0.0663331im      0.0122777+0.0281098im    0.0093651-0.0468264im  -0.0477552+0.0504808im   -0.0855436+0.307696im       -0.120301+0.175625im       0.12491+0.112523im      0.110127+0.0759806im    -0.0600933-0.0776491im      0.094275+0.0410963im   -0.0271569-0.214668im     0.115166+0.0531308im    -0.165249-0.0311071im    -0.208832+0.0311578im     0.0289049-0.0794342im       0.28664+0.0239252im      0.206303+0.222262im    -0.162289+0.0202846im   0.0253236-0.0539196im       0.223768+0.166088im       0.108509+0.0336005im
   -0.0396666-0.0553948im      0.120839+0.0305273im    0.0621751+0.15869im      -0.0777413-0.0988777im     -0.187572+0.0941768im      -0.14444+0.00914912im    0.0975702-0.0591705im     -0.177915-0.0213484im      0.0603864+0.00452995im   -0.0774758+0.164002im     0.0483647-0.224849im       0.129506-0.0602499im      0.0050718+0.0960301im    0.0518539-0.0437311im     0.16577+0.183476im      0.114698+0.152918im       0.0437024-0.0242521im     -0.22305+0.044392im       0.01409-0.271364im      0.0756794+0.00036322im    -0.247965+0.0183358im     0.185329-0.0724183im    0.237973+0.0782971im   -0.0529154-0.04726im      0.0721516+0.204454im        -0.1638-0.131267im        0.10799+0.0057385im     -0.289385+0.236487im    0.0429709-0.163787im    0.0101453+0.0707749im     -0.0489015-0.0663711im     0.0647365+0.115027im
    -0.031987-0.0160066im     -0.127453+0.152437im     -0.146507-0.278694im      -0.169274-0.00614121im     0.088522+0.173699im     -0.0867039+0.124707im      0.0271927-0.290431im        0.12109-0.068899im       0.0033019-0.0522735im     0.0315166-0.0569498im     0.153382-0.146201im      0.0588518-0.0282327im     -0.0130111-0.23574im     -0.0577824+0.0307261im   -0.116798-0.0241115im  0.000733303-0.121541im       0.0713936+0.0448708im    -0.224076-0.341758im    -0.0721952-0.0537802im     0.0348279-0.043698im     -0.0347061+0.052322im    -0.0156165+0.0505381im   0.0264629-0.0637496im    -0.055031-0.0645107im    -0.252445-0.0464276im    -0.0158714-0.00907254im    -0.136286-0.0756019im   -0.00419498+0.194186im    -0.123969+0.149578im    -0.269822-0.0571944im      0.0812614-0.110793im       0.190496+0.139342im
    -0.105428+0.0835214im     0.0235719+0.0539317im    -0.120632+0.0195391im      0.134295-0.126268im       0.122051+0.22813im      -0.0139182-0.0258981im      0.239368-0.091541im      0.0105216+0.124044im    -0.000570444-0.0778721im     -0.165232+0.0609897im  -0.00273733-0.0889641im    0.00998774+0.217424im      0.00553596+0.047845im     -0.176723-0.0977569im   0.0836176-0.0150383im    0.0172858-0.0569679im      -0.217687+0.0772264im   -0.0835298+0.0462066im    -0.165743-0.00664352im    -0.368406-0.191583im      -0.188469-0.0922245im     0.047165-0.110665im     0.102076+0.183063im       0.23228+0.0413372im    0.0284211-0.0162215im      0.130597+0.184654im     -0.0645352-0.116407im      0.0176313-0.148403im    0.0798034+0.206997im      0.06825+0.192082im        0.155098+0.0466577im    -0.0648057-0.0182221im
 -0.000678033+0.30035im        -0.20746-0.0559145im    -0.116156-0.0133084im     0.0178751+0.171287im     0.00162672-0.0611154im    -0.0312508-0.227144im     -0.0181346+0.109727im     -0.0315018+0.0677621im     -0.0713301+0.0922164im      0.177329-0.198067im    -0.0394793+0.025176im      0.0447868-0.0345496im      0.0386055+0.126316im    -0.0975487-0.113742im     0.179917-0.102986im     -0.137493+0.0917621im       0.151333-0.0268462im     0.126104+0.0632404im   -0.0125037-0.109468im      0.0285153-0.0297404im     -0.188728-0.214157im    0.00265798-0.0755595im  -0.0976461-0.00707568im    0.166045-0.301873im     0.0169003+0.220905im     0.00496883-0.204818im      -0.212125-0.0449074im      0.136312+0.210049im   -0.0953895+0.108607im   -0.0377562+0.0711831im      0.0802409-0.0953055im    -0.0208622+0.170916im
      0.19974-0.0296056im     0.0646663+0.0309833im   0.00829894+0.0243513im    -0.0288291-0.0746195im      0.143578+0.100371im      0.0766866+0.0610096im     -0.109205+0.0421618im      0.075404+0.0650801im      -0.107838-0.0947791im     -0.282066+0.269772im    -0.0297178+0.0368309im     -0.119135-0.0153056im     -0.0294778-0.0204711im     0.082889-0.183761im    0.0968035+0.055478im     -0.191955+0.179685im      -0.0738751-0.289954im      0.109421-0.173158im    -0.0392681-0.118225im       0.154585+0.0551231im     -0.144207+0.0155656im   -0.0983284-0.276923im    -0.221052-0.115368im     0.0322912-0.0735582im    -0.156358-0.117717im      0.0865958+0.113345im     -0.0370679+0.0208784im    -0.0274584+0.0711151im  0.00381777-0.0836352im  -0.0887853+0.0636222im    -0.00843506-0.265299im      -0.247822-0.0541949im
   -0.0935657-0.151219im      -0.138439-0.048483im     -0.159876+0.0913057im      0.106118-0.142001im     -0.0222636+0.2032im        0.0410452+0.000272479im  -0.0817599+0.192775im      -0.188478+0.0478667im       0.185743-0.118283im      0.0126126+0.0268944im   -0.0779571-0.0829224im   -0.00558407-0.047281im      -0.0665375+0.0862021im     0.113082-0.0342674im   -0.123628-0.0762352im    0.0254946+0.0997463im      0.0388891+0.112114im     -0.193085-0.190807im    -0.0625182+0.0500017im     -0.220891+0.24988im       0.0095486-0.178993im    -0.0892148+0.0280988im   -0.211854-0.0917621im   -0.0468116-0.326235im     0.0446742+0.00190351im    0.0623593+0.180442im      0.0554986-0.086086im       0.144482+0.0571078im   0.0359199-0.303457im    0.0126003-0.0699273im     0.00333324+0.189819im        0.11345+0.0753131im
    0.0347452-0.00844061im    0.0235209+0.0927904im    0.0666364-0.0873628im     0.0750394-0.0149407im     0.0963781+0.263768im     0.00684768+0.013085im     -0.0403662-0.171707im      -0.257869+0.0240942im    -0.00727619-0.0052612im     0.0957107-0.0653101im    0.0165658+0.114115im     -0.0730413-0.195227im        -0.07727+0.00654915im   -0.174419-0.0543777im  -0.0587763+0.0987533im   -0.0370288-0.15908im         -0.28287+0.0669484im     0.111637-0.0984705im   -0.0724808-0.000391402im     0.10989-0.00508218im     0.027032-0.156217im      0.141734+0.192063im    0.0717615-0.0143535im   -0.0604894-0.23356im       0.174993+0.0534045im      0.293952-0.211027im       0.261967+0.140029im     0.00814522+0.0711793im  -0.0168973+0.0503936im   0.0254443+0.00606965im     -0.156269-0.154474im       -0.12021-0.226095im
    -0.173012-0.0221668im     0.0575043+0.146759im      0.118271+0.0631907im    -0.0149627+0.0322413im     -0.136774+0.0420385im      0.252194-0.0107716im    -0.0753029+0.0185269im     -0.167414+0.0816159im       0.110844+0.175882im       0.187145-0.0265157im    -0.370912-0.0414194im     -0.190263+0.0409493im      0.0100221-0.0207301im    -0.134162+0.163991im    -0.116285+0.136337im     0.0217065-0.0353404im      -0.045295+0.0700825im     0.184617-0.119156im     0.0495181+0.02121im       0.0367389-0.126483im      -0.197381+0.00224662im  -0.0924407+0.0254102im  -0.0716531+0.149265im     -0.139988-0.0587463im    -0.226951-0.119828im      -0.162619+0.101883im      -0.184047-0.0620018im     -0.168079+0.135154im     0.227441+0.0316496im    0.080384+0.0058277im       0.163485-0.110039im      0.0192953-0.0758455im
    -0.171328-0.0160213im      0.100958-0.0257227im      0.13907+0.142241im       0.101966+0.133918im       -0.10442+0.0986552im     -0.103953-0.236017im      0.0170187-0.00332926im     0.032846+0.0667483im     -0.0325749-0.145623im      -0.195185-0.0189733im    -0.057431-0.0536086im   -0.00247867-0.03109im        -0.137625-0.182972im    -0.0357546+0.0630624im   0.0587991-0.183479im     0.0729182-0.0358766im     -0.0545613-0.0458418im   -0.0433576+0.222984im    -0.0725756+0.148057im     -0.0551088-0.0274605im     0.0679153-0.114627im    -0.0611446-0.121354im     0.002367+0.124883im     0.0842659-0.170603im     -0.334102-0.109374im      -0.123103-0.231072im       0.104713-0.0994115im     0.0267776-0.0927246im   0.0106723-0.038583im    -0.175997-0.298799im       -0.240901-0.191306im       0.104311-0.0634769im
     0.191818-0.419283im      0.0699628-0.0538361im        0.113-0.053421im     -0.0576737+0.0840288im     0.0704629-0.0362852im      0.179123+0.182404im       0.212354+0.0343363im      0.124532+0.0462084im     -0.0419183+0.027204im     0.00912207-0.100024im   0.000125536+0.149825im       0.134199-0.124819im        0.209625+0.278838im     0.0721134+0.0748189im   0.0363459-0.0464999im   -0.0513249-0.084406im      -0.0965768+0.137289im   -0.00435139+0.118161im    -0.0616805-0.184268im      -0.187543-0.0101607im    -0.0812843-0.18194im       0.193578-0.0554441im   -0.172647-0.0775148im   -0.0712692-0.0239587im    -0.174092+0.176369im     0.00312627+0.0247727im     -0.146669-0.00502576im   -0.0603948-0.0322218im   0.0201886+0.067467im   -0.0652855-0.13776im       -0.0811376-0.0900341im      0.157794-0.10359im
    0.0464322+0.0389045im      0.121053-0.182722im     0.0887816-0.0526354im   -1.85234e-5+0.0795487im      0.108599-0.0250624im    -0.0774852+0.129866im      -0.268283+0.220868im      -0.131331-0.098021im       0.0133504-0.0597437im     -0.177659-0.21072im     -0.0902835-0.0917278im     0.0768257+0.00917601im      0.108925-0.195908im       0.11778+0.047291im   -0.0528535-0.13044im       0.193928-0.0426241im      0.0404629-0.0337758im   0.00756686+0.0680061im    0.0663037+0.0252487im     -0.226849-0.0802065im     -0.257292-0.00589033im   -0.132295+0.108934im    -0.154896+0.0521102im     -0.11261+0.0634661im    0.0737634+0.0428738im      0.255097+0.0264083im      0.170444-0.0528708im     -0.295538+0.133348im    -0.158498+0.215113im   -0.0240733-0.00927275im     0.0238396-0.0737232im    -0.0880904+0.123696im
   -0.0308548+0.161643im      -0.123031+0.0480273im     0.073858+0.325098im      -0.233646+0.023246im      -0.080461+0.0446061im      0.117629+0.0982203im    -0.0262237+0.0168518im    -0.0547608-0.145605im        0.115233+0.237561im      -0.209743+0.0401918im     0.163058+0.348975im      -0.250272+0.0150301im   -0.000581257+0.0549789im    -0.107687-0.0971787im  0.00010894-0.229745im    -0.0654896+0.0267831im     -0.0881381+0.120641im     -0.173745+0.0211062im   -0.0122876+0.0506268im     -0.201813-0.0625562im     0.0489134-0.0423517im   -0.0639483+0.0932597im   0.0643605-0.132818im    -0.0136051+0.101033im      0.110471-0.0966614im    -0.0299343-0.105043im      -0.146844-0.0152897im     -0.150294+0.123727im   -0.0962478-0.116712im     -0.21661+0.0491151im      0.0206202-0.0692422im     0.0183284-0.0572097im
   -0.0789758+0.0547222im      0.237007-0.0954984im    0.0419122-0.0403886im    -0.0892882-0.0331719im    -0.0675574-0.172612im      0.0459538-0.0538814im     0.0264779+0.139497im     -0.0234943+0.0874525im       0.107685+0.0854919im     0.0422549+0.207348im   -0.00383741-0.111755im        0.05409-0.0741137im      0.0235673+0.157703im     -0.113151-0.22611im    -0.0551697-0.0642587im   -0.0172956-0.0182397im       0.157045-0.105349im    -0.0559836-0.0816175im   -0.0544735+0.171972im      -0.123775-0.115596im       0.090138+0.155125im      0.273514+0.0610245im   0.0842131-0.031086im     -0.133731-0.255103im     0.0453044+0.00492578im  0.000384185+0.153577im      0.0467292+0.16921im       0.0511759-0.0484742im   0.0576993+0.227314im    -0.330813-0.248716im         0.15491-0.0252986im     -0.206384+0.00388455im
    0.0570585+0.0125973im     0.0585398-0.119125im      0.078231-0.114765im     -0.0275842-0.249575im      -0.181113-0.117717im      0.0472412+0.318466im      -0.190532-0.156262im     -0.0778912+0.231707im       -0.138074-0.0645127im     -0.018598-0.0755788im   -0.0384947-0.0738382im     -0.285819+0.220815im        0.101221-0.152487im      -0.15612-0.159295im   0.00218555-0.105689im     0.0769753+0.140575im       0.0238556+0.0359061im   -0.0467561+0.0427184im     0.280118-0.103668im     -0.0348769+0.0487264im   -0.00134423-0.140527im     0.0578071-0.0460495im   0.0719474+0.12313im       0.113999+0.00547067im   -0.040147+0.104055im       0.103593-0.0491097im     -0.120237+0.231329im       0.185466+0.022525im    0.0490207-0.0434191im  -0.0317045-0.142473im      -0.0908595+0.0678115im      0.120833-0.0176425im
    -0.023889+0.0696481im     -0.167945+0.246164im     -0.218822-0.135889im     0.00320723+0.19785im      -0.0284694+0.0191348im      -0.11543+0.00781472im   -0.0524568+0.0987409im    -0.0811734+0.0419239im      -0.106432-0.222153im      -0.162847+0.0948644im    -0.176899-0.0908368im     -0.169984-0.0567194im       0.174128+0.12554im     -0.0195207+0.131163im    0.0281532-0.229514im      0.186799+0.0526681im      -0.150045+0.2567im       0.0869653+0.0500037im   -0.0242445-0.107057im      0.0528252+0.0180606im      0.160588+0.257616im      0.232153+0.0822257im   -0.105674-0.0224629im     0.067084+0.038807im      -0.11184+0.118053im     -0.0130607-0.0558981im     -0.014528+0.14073im       -0.133919-0.0717684im  0.00407325-0.163052im   -0.0761215+0.000164376im     0.148316+0.00315936im    -0.169506+0.0458429im</code></pre><p>and then generate the state <span>$ψ$</span></p><pre><code class="language-julia hljs">psi = P[:, 3]</code></pre><pre><code class="nohighlight hljs">32-element Vector{ComplexF64}:
    -0.1321143361308827 + 0.04104494426313696im
     0.1136715540900873 - 0.016483305071718742im
   -0.02654810037013777 - 0.06054370103100764im
    0.03370005376300926 - 0.022191572472919086im
   -0.01398236534350046 - 0.054066287046034285im
   0.011544858270242389 + 0.1497422044689377im
  -0.042668941248642164 - 0.20620987005190014im
  -0.015480829124750854 + 0.11247383469693154im
    0.09674747536607714 - 0.029512154796546362im
  -0.021120440427474622 - 0.2253419184382064im
    0.23887734305918046 + 0.14217832887263054im
  -0.018844525104504233 + 0.18419866034428695im
    -0.1625647911433907 + 0.18152913608015359im
   -0.14828975732573862 + 0.05387292942808047im
    -0.2014538337258747 - 0.029454796624053398im
    0.19773936544494256 + 0.035309776218975526im
  -0.044734395763757824 - 0.04722505370952008im
   0.027023313913554888 + 0.02640907350591525im
 -0.0028641339415134397 - 0.06419473563096614im
   -0.11487977484748005 + 0.021406016917290736im
  -0.008287729984013238 - 0.07854701441414527im
   -0.27747253636883457 - 0.14242186062027234im
    0.17564594139892803 + 0.11428434468846016im
    0.27865254470084894 + 0.10148010103451498im
    0.05111697002669584 - 0.10944598060861595im
   0.029945664958361547 + 0.04985112217775676im
   -0.05829147356307466 - 0.29489853864087323im
   0.005154300891386844 + 0.04133500860427651im
   -0.22389843415197705 + 0.03687111879476578im
     0.3246123729086182 + 0.0im
   -0.09084832099407439 - 0.06166161367256712im
   0.010579137992910643 - 0.041906665878315284im</code></pre><p>In the phase estimation process, we will feed the state to circuit and measure the first <code>n</code> qubits processed by iQFT.</p><pre><code class="language-julia hljs">r = join(ArrayReg(psi), zero_state(N))
r |&gt; PE(N, M, U)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 8/8
    nlevel: 2</code></pre><p>Since our phase can be represented by 3 qubits precisely, we only need to measure once</p><pre><code class="language-julia hljs">results = measure(r, 1:N; nshots=1)</code></pre><pre><code class="nohighlight hljs">1-element Vector{DitStr{2, 3, Int64}}:
 011 ₍₂₎</code></pre><p>Recall that our QFT&#39;s bit numbering is reversed, let&#39;s reverse it back</p><pre><code class="language-julia hljs">using BitBasis
estimated_phase = bfloat(results[]; nbits=N)</code></pre><pre><code class="nohighlight hljs">0.75</code></pre><p>the phase is exactly <code>0.75</code>!</p><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../1.prepare-ghz-state/index.html">« Prepare Greenberger–Horne–Zeilinger state with Quantum Circuit</a><a class="docs-footer-nextpage" href="../3.grover-search/index.html">Grover Search »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.3.0 on <span class="colophon-date" title="Tuesday 12 March 2024 01:30">Tuesday 12 March 2024</span>. Using Julia version 1.10.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
