<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Quantum Fourier Transformation and Phase Estimation · Documentation | Yao</title><meta name="title" content="Quantum Fourier Transformation and Phase Estimation · Documentation | Yao"/><meta property="og:title" content="Quantum Fourier Transformation and Phase Estimation · Documentation | Yao"/><meta property="twitter:title" content="Quantum Fourier Transformation and Phase Estimation · Documentation | Yao"/><meta name="description" content="Documentation for Documentation | Yao."/><meta property="og:description" content="Documentation for Documentation | Yao."/><meta property="twitter:description" content="Documentation for Documentation | Yao."/><script data-outdated-warner src="../../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../search_index.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script><link href="../../../assets/indigo.css" rel="stylesheet" type="text/css"/><link href="https://yaoquantum.org/assets/favicon-light.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../index.html"><img src="../../../assets/logo.png" alt="Documentation | Yao logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../../index.html">Documentation | Yao</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../../index.html">Home</a></li><li><a class="tocitem" href="../../../quick-start.html">Quick Start</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../../../man/registers.html">Quantum Registers</a></li><li><a class="tocitem" href="../../../man/blocks.html">Blocks</a></li><li><a class="tocitem" href="../../../man/symbolic.html">Symbolic Computation</a></li><li><a class="tocitem" href="../../../man/cuda.html">CUDA extension - CuYao</a></li><li><a class="tocitem" href="../../../man/plot.html">Quantum Circuit Visualization</a></li><li><a class="tocitem" href="../../../man/automatic_differentiation.html">Automatic Differentiation</a></li><li><a class="tocitem" href="../../../man/yao2einsum.html">Tensor network backend</a></li><li><a class="tocitem" href="../../../man/simplification.html">Simplification</a></li><li><a class="tocitem" href="../../../man/bitbasis.html">BitBasis</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../1.prepare-ghz-state/index.html">Prepare Greenberger–Horne–Zeilinger state with Quantum Circuit</a></li><li class="is-active"><a class="tocitem" href="index.html">Quantum Fourier Transformation and Phase Estimation</a><ul class="internal"><li><a class="tocitem" href="#Quantum-Fourier-Transformation"><span>Quantum Fourier Transformation</span></a></li><li><a class="tocitem" href="#Wrap-QFT-to-an-external-block"><span>Wrap QFT to an external block</span></a></li><li><a class="tocitem" href="#Phase-Estimation"><span>Phase Estimation</span></a></li></ul></li><li><a class="tocitem" href="../3.grover-search/index.html">Grover Search</a></li><li><a class="tocitem" href="../4.shor-algorithm/index.html">Shor&#39;s Algorithm</a></li><li><a class="tocitem" href="../5.shor-9-code/index.html">Shor&#39;s 9 qubit code</a></li><li><a class="tocitem" href="../6.quantum-circuit-born-machine/index.html">Quantum Circuit Born Machine</a></li><li><a class="tocitem" href="../7.variation-quantum-eigen-solver/index.html">Variational Quantum Eigen Solver</a></li><li><a class="tocitem" href="../8.riemannian-gradient-flow/index.html">Riemannian gradient flow optimizer</a></li></ul></li><li><a class="tocitem" href="../../../performancetips.html">Performance Tips</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href="index.html">Quantum Fourier Transformation and Phase Estimation</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="index.html">Quantum Fourier Transformation and Phase Estimation</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/QuantumBFS/Yao.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/QuantumBFS/Yao.jl/blob/master/docs/src/examples/2.qft-phase-estimation/main.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><p><a href="/generated/examples/2.qft-phase-estimation/main.ipynb"><img src="https://mybinder.org/badge_logo.svg" alt/></a></p><h1 id="example-qft"><a class="docs-heading-anchor" href="#example-qft">Quantum Fourier Transformation and Phase Estimation</a><a id="example-qft-1"></a><a class="docs-heading-anchor-permalink" href="#example-qft" title="Permalink"></a></h1><p>Let&#39;s use Yao first</p><pre><code class="language-julia hljs">using Yao</code></pre><h2 id="Quantum-Fourier-Transformation"><a class="docs-heading-anchor" href="#Quantum-Fourier-Transformation">Quantum Fourier Transformation</a><a id="Quantum-Fourier-Transformation-1"></a><a class="docs-heading-anchor-permalink" href="#Quantum-Fourier-Transformation" title="Permalink"></a></h2><p>The Quantum Fourier Transformation (QFT) circuit is to repeat two kinds of blocks repeatly:</p><p><img src="assets/qft.png" alt="qft-circuit"/></p><p>The basic building block control phase shift gate is defined as</p><p class="math-container">\[R(k)=\begin{bmatrix}
1 &amp; 0\\
0 &amp; \exp\left(\frac{2\pi i}{2^k}\right)
\end{bmatrix}\]</p><p>Let&#39;s define block <code>A</code> and block <code>B</code>, block <code>A</code> is actually a control block.</p><pre><code class="language-julia hljs">A(i, j) = control(i, j=&gt;shift(2π/(1&lt;&lt;(i-j+1))))</code></pre><pre><code class="nohighlight hljs">A (generic function with 1 method)</code></pre><p>Once you construct the blockl you can inspect its matrix using <code>mat</code> function. Let&#39;s construct the circuit in dash box A, and see the matrix of <span>$R_4$</span> gate.</p><pre><code class="language-julia hljs">R4 = A(4, 1)</code></pre><pre><code class="nohighlight hljs">(n -&gt; control(n, 4, 1 =&gt; shift(0.39269908169872414)))</code></pre><p>If you have read about <a href="@ref tutorial-ghz">preparing GHZ state</a>, you probably know that in Yao, we could just leave the number of qubits, and it will be evaluated when possible.</p><pre><code class="language-julia hljs">R4(5)</code></pre><pre><code class="nohighlight hljs">nqubits: 5
control(4)
└─ (1,) shift(0.39269908169872414)</code></pre><p>its matrix will be</p><pre><code class="language-julia hljs">mat(R4(5))</code></pre><pre><code class="nohighlight hljs">32×32 Diagonal{ComplexF64, Vector{ComplexF64}}:
 1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im</code></pre><p>Then we repeat this control block over and over on different qubits, and put a Hadamard gate to <code>i</code>th qubit to construct <code>i</code>-th <code>B</code> block.</p><pre><code class="language-julia hljs">B(n, k) = chain(n, j==k ? put(k=&gt;H) : A(j, k) for j in k:n)</code></pre><pre><code class="nohighlight hljs">B (generic function with 1 method)</code></pre><p>We need to input the total number of qubits <code>n</code> here because we have to iterate through from <code>k</code>-th location to the last.</p><p>Now, let&#39;s construct the circuit by chaining all the <code>B</code> blocks together</p><pre><code class="language-julia hljs">qft(n) = chain(B(n, k) for k in 1:n)
qft(4)</code></pre><pre><code class="nohighlight hljs">nqubits: 4
chain
├─ chain
│  ├─ put on (1)
│  │  └─ H
│  ├─ control(2)
│  │  └─ (1,) shift(1.5707963267948966)
│  ├─ control(3)
│  │  └─ (1,) shift(0.7853981633974483)
│  └─ control(4)
│     └─ (1,) shift(0.39269908169872414)
├─ chain
│  ├─ put on (2)
│  │  └─ H
│  ├─ control(3)
│  │  └─ (2,) shift(1.5707963267948966)
│  └─ control(4)
│     └─ (2,) shift(0.7853981633974483)
├─ chain
│  ├─ put on (3)
│  │  └─ H
│  └─ control(4)
│     └─ (3,) shift(1.5707963267948966)
└─ chain
   └─ put on (4)
      └─ H
</code></pre><h2 id="Wrap-QFT-to-an-external-block"><a class="docs-heading-anchor" href="#Wrap-QFT-to-an-external-block">Wrap QFT to an external block</a><a id="Wrap-QFT-to-an-external-block-1"></a><a class="docs-heading-anchor-permalink" href="#Wrap-QFT-to-an-external-block" title="Permalink"></a></h2><p>In most cases, <code>function</code>s are enough to wrap quantum circuits, like <code>A</code> and <code>B</code> we defined above, but sometimes, we need to dispatch specialized methods on certain kinds of quantum circuit, or we want to define an external block to export, thus, it&#39;s useful to be able to wrap circuit to custom blocks.</p><p>First, we define a new type as subtype of <code>PrimitiveBlock</code> since we are not going to use the subblocks of <code>QFT</code>, if you need to use its subblocks, it&#39;d be better to define it under <code>CompositeBlock</code>.</p><pre><code class="language-julia hljs">struct QFT &lt;: PrimitiveBlock{2}
    n::Int
end

YaoBlocks.nqudits(q::QFT) = q.n</code></pre><p>Now, let&#39;s define its circuit</p><pre><code class="language-julia hljs">circuit(q::QFT) = qft(q.n)</code></pre><pre><code class="nohighlight hljs">circuit (generic function with 1 method)</code></pre><p>And forward <code>mat</code> to its circuit&#39;s matrix</p><pre><code class="language-julia hljs">YaoBlocks.mat(::Type{T}, x::QFT) where T = mat(T, circuit(x))</code></pre><p>You may notice, it is a little ugly to print <code>QFT</code> at the moment, this is because we print the type summary by default, you can define your own printing by overloading <code>print_block</code></p><pre><code class="language-julia hljs">YaoBlocks.print_block(io::IO, x::QFT) = print(io, &quot;QFT($(x.n))&quot;)</code></pre><p>Since it is possible to use FFT to simulate the results of QFT (like cheating), we could define our custom <code>apply!</code> method:</p><pre><code class="language-julia hljs">using FFTW, LinearAlgebra

function YaoBlocks.apply!(r::ArrayReg, x::QFT)
    α = sqrt(length(statevec(r)))
    invorder!(r)
    lmul!(α, ifft!(statevec(r)))
    return r
end</code></pre><p>Now let&#39;s check if our <code>apply!</code> method is correct:</p><pre><code class="language-julia hljs">r = rand_state(5)
r1 = r |&gt; copy |&gt; QFT(5)
r2 = r |&gt; copy |&gt; circuit(QFT(5))
r1 ≈ r2</code></pre><pre><code class="nohighlight hljs">true</code></pre><p>We can get iQFT (inverse QFT) directly by calling <code>adjoint</code></p><pre><code class="language-julia hljs">QFT(5)&#39;</code></pre><pre><code class="nohighlight hljs"> [†]QFT(5)</code></pre><p>QFT and iQFT are different from FFT and IFFT in three ways,</p><ol><li>they are different by a factor of <span>$\sqrt{2^n}$</span> with <span>$n$</span> the number of qubits.</li><li>the <a href="https://quantumbfs.github.io/BitBasis.jl/stable/tutorial/#Conventions-1">bit numbering</a> will exchange after applying QFT or iQFT.</li><li>due to the convention, QFT is more related to IFFT rather than FFT.</li></ol><h2 id="Phase-Estimation"><a class="docs-heading-anchor" href="#Phase-Estimation">Phase Estimation</a><a id="Phase-Estimation-1"></a><a class="docs-heading-anchor-permalink" href="#Phase-Estimation" title="Permalink"></a></h2><p>Since we have QFT and iQFT blocks we can then use them to realize phase estimation circuit, what we want to realize is the following circuit:</p><p><img src="assets/phaseest.png" alt="phase estimation"/></p><p>First we call Hadamard gates repeatly on first <code>n</code> qubits.</p><pre><code class="language-julia hljs">Hadamards(n) = repeat(H, 1:n)</code></pre><pre><code class="nohighlight hljs">Hadamards (generic function with 1 method)</code></pre><p>Then in dashed box <code>B</code>, we have controlled unitaries:</p><pre><code class="language-julia hljs">ControlU(n, m, U) = chain(n+m, control(k, n+1:n+m=&gt;matblock(U^(2^(k-1)))) for k in 1:n)</code></pre><pre><code class="nohighlight hljs">ControlU (generic function with 1 method)</code></pre><p>each of them is a <code>U</code> of power <span>$2^{(k-1)}$</span>.</p><p>Since we will only apply the qft and Hadamard on first <code>n</code> qubits, we could use <code>Subroutine</code>, which creates a context of a sub-scope of the qubits.</p><pre><code class="language-julia hljs">PE(n, m, U) =
    chain(n+m, # total number of the qubits
        subroutine(Hadamards(n), 1:n), # apply H in local scope
        ControlU(n, m, U),
        subroutine(QFT(n)&#39;, 1:n))</code></pre><pre><code class="nohighlight hljs">PE (generic function with 1 method)</code></pre><p>we use the first <code>n</code> qubits as the output space to store phase <span>$ϕ$</span>, and the other <code>m</code> qubits as the input state which corresponds to an eigenvector of oracle matrix <code>U</code>.</p><p>The subroutine here uses <code>focus!</code> and <code>relax!</code> to manage a local scope of quantum circuit, and only activate the first <code>n</code> qubits while applying the block inside the subroutine context, and the scope will be <code>relax!</code>ed back, after the context. This is equivalent to manually <code>focus!</code> then <code>relax!</code></p><p>fullly activated</p><pre><code class="language-julia hljs">r = rand_state(5)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 5/5
    nlevel: 2</code></pre><p>first 3 qubits activated</p><pre><code class="language-julia hljs">focus!(r, 1:3)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 3/5
    nlevel: 2</code></pre><p>relax back to the original</p><pre><code class="language-julia hljs">relax!(r, 1:3)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 5/5
    nlevel: 2</code></pre><p>In this way, we will be able to apply small operator directly on the subset of the qubits.</p><p>Details about the algorithm can be found here: <a href="https://en.wikipedia.org/wiki/Quantum_phase_estimation_algorithm">Quantum Phase Estimation Algorithm</a></p><p>Now let&#39;s check the results of our phase estimation.</p><p>First we need to set up a unitary with known phase, we set the phase to be 0.75, which is <code>0.75 * 2^3 == 6 == 0b110</code> .</p><pre><code class="language-julia hljs">N, M = 3, 5
P = eigen(rand_unitary(1&lt;&lt;M)).vectors
θ = Int(0b110) / 1&lt;&lt;N
phases = rand(1&lt;&lt;M)
phases[0b010+1] = θ
U = P * Diagonal(exp.(2π * im * phases)) * P&#39;</code></pre><pre><code class="nohighlight hljs">32×32 Matrix{ComplexF64}:
   0.119056+0.175049im    -0.0920705-0.0179535im     0.0590916+0.0319227im    0.0464729-0.135001im       0.156781+0.365414im     -0.113669+0.0813558im    0.0260007+0.129712im     0.0437875-0.102201im     0.0502727-0.113798im    -0.0966889-0.168747im       0.118245+0.0433314im   -0.0454587+0.155028im      -0.100446-0.0408396im     0.0920955-0.331696im      0.154154-0.115586im      0.0156899+0.153103im    0.00692864-0.0687376im    -0.187964+0.18058im       -0.122208+0.0803934im       0.174489-0.080114im       0.0448706+0.141166im      -0.139705-0.163865im      0.0908712-0.251542im        0.113801-0.0834706im    -0.061814-0.0259396im      -0.13947-0.238782im    -0.123395+0.0151062im     -0.106121+0.126048im    0.0252199-0.0204122im    0.0642253-0.0460657im    0.0585322+0.0455866im     -0.017164+0.0156679im
 -0.0439107+0.245836im      0.091076+0.0140951im      0.122075+0.067746im     -0.074362+0.104224im       0.134816-0.09264im       0.341531-0.129582im      0.249191+0.15263im     -0.0271759+0.0282115im   -0.0869325-0.242722im    -0.0701261-0.0677996im    -0.0677736+0.0174554im   -0.0860957+0.0356343im     0.0645235+0.0632205im      0.124267-0.0677716im   -0.0575966-0.0138337im     0.0276728-0.0955674im     0.026546+0.00319537im   0.0488017-0.162562im      -0.227282-0.0922471im      0.0764586+0.136309im      0.00362019-0.00968813im     0.136823+0.0031282im      -0.11948-0.172072im     0.000214554+0.00341275im   -0.109518+0.200996im       0.024704+0.116191im    -0.170892+0.00107432im   -0.0594091-0.163002im    0.0587297+0.0376963im    0.0978227-0.107214im     -0.204161-0.131235im      -0.351422-0.0630696im
  -0.108876-0.203699im      0.235646-0.17398im      -0.0125602-0.140517im     0.0931642+0.00886158im      0.10535-0.0678642im    -0.233368-0.0717187im     0.122146+0.107446im      0.243414+0.0792896im    0.0718417+0.185361im     -0.173342+0.0131571im     0.0434957+0.117408im     0.0830244-0.025498im     -0.0600381+0.187423im     -0.0300949+0.0409976im    -0.175395-0.0801224im      0.142518+0.0804588im    0.0861423-0.0702984im    0.0355388+0.0426933im     -0.207625-0.126405im       0.0116399+0.114203im       -0.130086-0.264706im       0.108847-0.14335im        0.169099-0.0805443im     -0.0693115-0.104011im     -0.114849+0.0858709im    -0.0150165+0.0136958im   -0.164507+0.115094im       -0.12587-0.0900078im   -0.160995-0.14248im     -0.0384737-0.106511im      0.246811+0.0152086im     0.0440584-0.0383273im
   0.187363+0.128503im    -0.0226879+0.107116im     -0.0388075+0.00480008im  -0.0604783+0.220776im       0.147379-0.0885611im   -0.0755442-0.0263092im   -0.0685945-0.246248im     -0.192705-0.171334im     0.0566843+0.0436754im     0.133286-0.0172955im       -0.2243-0.0351918im    -0.127044+0.0222187im      0.100945+0.0119209im      0.105837-0.0305158im    -0.145307+0.123068im       0.140069+0.00978723im    0.170854-0.107482im     -0.085614+0.0271772im    -0.0500198-0.144911im       -0.188631+0.228406im    -0.000852884+0.049169im      0.0998036-0.0510279im     0.0783333-0.078463im       0.0645536-0.177563im      0.065191-0.0155696im    -0.0360365-0.0152379im    0.204665+0.0745125im    0.00511205+0.244238im    -0.105745-0.0511658im     0.303598-0.279261im      0.141834-0.000473827im   0.0625001-0.0264931im
   0.168767+0.0123332im    -0.014935-0.173882im       0.122796+0.0935264im    0.0419798-0.163669im      0.0420273+0.137725im     0.0112509-0.158859im     -0.048175-0.0258534im     0.158053-0.0842171im    0.0507606-0.113318im     -0.135964-0.0591667im     -0.307106-0.0112389im     0.121716+0.010732im      -0.186957-0.0723597im     -0.156207+0.126331im    -0.0546448+0.137191im      0.0150937+0.0715312im     0.046783+0.272271im     -0.154362-0.0919243im    -0.0994688-0.22631im        -0.144915-0.0529631im      0.0676323+0.0624721im       0.14248-0.127593im    -0.00926868-0.0253395im      -0.213363+0.0657959im   -0.0599785+0.100011im      -0.116321-0.0672264im    0.239885+0.0379609im      0.112732+0.156071im       -0.147+0.143751im     -0.225949+0.158504im    -0.0571607-0.0364887im     -0.100973-0.0529046im
   0.114013-0.00934579im  -0.0460847+0.0148567im     -0.252826-0.0843392im    0.0365127-0.0950852im      0.162418+0.00079623im    0.164444+0.214311im     0.0192778+0.118985im     0.0530861+0.0845814im    -0.258683+0.224586im     0.0478995+0.0688388im    -0.0992456-0.0476143im    -0.198854+0.00952194im    -0.158669-0.0430367im     0.0277908-0.0904842im    0.0401621+0.101032im      -0.133155-0.13563im      -0.226026-0.0148163im    -0.174931+0.173918im      -0.157931+0.135939im      -0.0531763-0.0773005im     0.00542836-0.0615869im      0.188521-0.113137im      -0.018558+0.0385666im    -0.00430867-0.116374im     -0.016027+0.0248811im        0.2002+0.0659278im    0.234208+0.0993402im    -0.0453119-0.193927im   -0.0878873+0.0847533im     0.100575+0.134981im      0.128141+0.117787im     -0.0950839-0.234598im
 0.00833514-0.148443im     0.0692717+0.062652im       0.165285+0.120053im    -0.0095952-0.0524764im    -0.0134245-0.210104im    -0.0702228+0.192772im     -0.129164-0.109759im    -0.0263834+0.00549392im  -0.0870501-0.0207135im    0.0650886+0.0129712im      0.136376-0.0284678im    -0.259204+0.0448798im     0.0144256+0.0524836im      0.101247-0.138074im     0.0465842-0.264257im     -0.0505098+0.0826917im    -0.139895+0.213913im     0.0579692-0.234718im      -0.231034-0.104285im       -0.119404-0.0886153im     -0.0160891+0.0603321im    0.00805129-0.206783im      0.0670116+0.0445533im     -0.0539796+0.27251im       0.191648+0.00679859im    -0.229803-0.11972im     0.0962888+0.236832im       0.119231-0.151108im    0.0693826-0.174044im      0.021224-0.0888972im    0.0233194-0.0408714im    -0.0244737-0.030207im
  0.0269339-0.164725im    -0.0566753+0.0315553im      0.070905+0.030468im      0.168434+0.07012im       0.0323454+0.105005im      0.252634+0.108602im    0.00805675-0.0384006im    -0.015457-0.0318856im    0.0528936-0.0234107im    0.0586867+0.120537im      0.0866636-0.098218im      0.339137-0.0244652im     0.0318848+0.109473im       0.208132-0.126126im    -0.0526553+0.00734061im    -0.156068-0.0532793im     0.212222+0.0642472im     0.120874+0.112188im     -0.0353603+0.0687022im     -0.0252303+0.190639im        -0.08464-0.00959402im    -0.102842-0.0142535im     0.0258947+0.0493033im     -0.0673906-0.0272909im   -0.0913713+0.129272im       0.112039-0.286946im    0.0529471+0.146531im       0.219996-0.0456753im   -0.239045-0.151169im     0.0107579+0.00874718im   -0.268684+0.290783im      0.0147561-0.065339im
  0.0150436-0.0673195im    -0.287758-0.204635im     -0.0544927+0.0731899im   -0.0373834+0.314399im      -0.136384-0.147888im     0.0819982+0.0910155im     0.112742-0.112211im      0.031962-0.157991im     -0.225783-0.124238im     -0.114088-0.0740436im     -0.173879-0.232856im      0.108076-0.0525266im    -0.0950618-0.107799im       0.220688-0.0984278im   -0.0199847-0.137142im      0.0521182+0.108775im    -0.0519297+0.0747486im     0.134677+0.0781016im    -0.0300007-0.0567126im       0.124089+0.0161677im       0.222043-0.0723574im    -0.0162661-0.0650183im      0.174485-0.051294im      -0.0284179-0.0147965im     0.130517+0.0832613im     0.0764344+0.0338754im  -0.0503541-0.239161im      -0.100694-0.0534068im   0.0290105-0.0208562im    -0.201433+0.0259851im     0.208603+0.0168164im      0.144423-0.0481736im
  0.0100214-0.225195im      0.117153+0.0112237im      0.221778+0.117273im      0.162331+0.0542124im     0.0528173+0.120206im    -0.0392489-0.0473044im    0.0165111+0.0167476im    0.0201726-0.138361im     0.0869651-0.00772263im    0.211174-0.0910014im      0.223347-0.149914im     0.0103371+0.00471067im    0.0919889+0.145559im       0.239755+0.0514664im  -0.00123853-0.106799im     -0.0815114-0.299011im      0.168996-0.0451999im    -0.170457-0.075235im      0.0426035-0.0261263im    0.000995619-0.257495im        0.255408-0.208112im      0.0182428+0.0362706im    -0.0820382+0.0313004im      0.0044405-0.230109im      0.130357+0.0397625im     0.0284754+0.0679682im    0.111948-0.0046115im    -0.0747761+0.0750547im   0.0290161+0.18054im     -0.0822291+0.0429497im     0.179131-0.108795im      -0.179823-0.0260881im
  0.0130836-0.0130114im    0.0959972+0.116593im      0.0198343+0.0423001im   -0.0529341+0.0534787im    -0.0478703+0.00700735im  -0.0605455-0.0194524im     0.162799-0.0061485im      0.21601+0.055869im      0.165767-0.235369im     -0.185832+0.00572504im   -0.0937849-0.0813619im    -0.161257+0.0250342im     -0.184332+0.153109im     -0.0332517-0.217625im      0.158872+0.193751im       -0.11693-0.177429im       0.13345+0.110176im    0.00332932-0.18183im      -0.0174844+0.142016im        -0.01463+0.134761im      -0.0401934-0.0819555im    -0.0184654+0.0734036im     -0.211537-0.000601882im    -0.036811-0.161634im      0.062707-0.0217877im    -0.0401938-0.0706213im    0.147158-0.0339994im    -0.0293388-0.160951im     0.112835-0.0517047im    0.0729956+0.0593375im    0.0566321-0.0743754im      0.480558-0.0176615im
  0.0934716+0.137348im     0.0360002+0.0769988im     0.0705885-0.00861941im   -0.268185+0.133716im     -0.0572509+0.0233653im   -0.0619215-0.0990388im    -0.175116+0.00700778im   0.0117594+0.260131im      0.161163-0.0265114im   0.00441924+0.290479im       0.108118-0.0485934im     0.145151-0.0553729im     -0.154719-0.0139379im      0.179806-0.202739im     0.0158563-0.0938266im     -0.226102+0.160573im     0.0254456+0.0683026im   -0.0649814+0.132771im     -0.0248211+0.120428im       0.0473909-0.0533358im       -0.18341-0.0320361im      0.255116+0.117777im     -0.0262578-0.0478496im     0.00511231+0.0950484im     0.169619+0.120052im     -0.0325944+0.219034im   -0.0404847-0.0781039im     0.0959276+0.153803im    -0.231488+0.00722316im  -0.0233141+0.0350025im     0.149995-0.171702im     -0.0831633-0.0372278im
  -0.113421+0.0529774im   -0.0973579+0.0549748im      0.149888-0.0538619im   -0.0232809+0.20091im      -0.0200177+0.00626677im   -0.081035-0.0734163im     0.124631+0.0332132im     0.152815-0.17312im      -0.217718-0.0426183im     0.213245-0.0441916im      0.164865+0.111697im    -0.0756301+0.195642im      -0.164574+0.0311281im    -0.0353509-0.0181224im    -0.203627+0.0850973im    -0.0858436-0.163588im     -0.167944+0.148003im     0.0299559+0.0742279im     -0.210003-0.0532874im      -0.021237+0.0386629im       -0.16623+0.152256im     -0.0494411+0.312321im      0.0392953+0.116822im       -0.213307-0.0288301im   -0.0846454-0.237238im     -0.0984564-0.0679674im    -0.10193-0.104028im       0.126868+0.0593705im   -0.124393+0.140959im     0.0258132-0.00601792im    0.178892+0.130092im     -0.0324354+0.0899399im
   0.062254-0.14337im      0.0801239+0.0172916im     -0.246764-0.160674im     0.0145713+0.150002im       0.106614+0.132764im     0.0844119-0.202898im       -0.1847+0.00457976im   -0.154384-0.135176im    -0.0778241-0.161353im     -0.158967+0.060919im      0.0555003+0.00216557im   0.0823733-0.190724im      0.0889298+0.203472im      0.0847321+0.0799676im     0.163952-0.118946im      -0.120706+0.0710999im    -0.306591+0.161409im     -0.123828-0.248723im     -0.0236834+0.0401393im      -0.214026+0.0978846im      -0.148349+0.117209im      -0.167574-0.0163294im     0.0158543-0.179426im       0.0311298-0.184609im    -0.0938696-0.146178im      0.0905799+0.0265799im  0.00512787-0.00548751im   -0.0569626-0.0340491im  -0.0417434+0.0118211im    -0.116774-0.00875053im    0.102131-0.0394865im    -0.0458554+0.124143im
   0.112479+0.13319im        0.11025+0.174982im      -0.103292-0.0157666im     0.192154-0.0583191im    -0.0460395-0.0872392im    -0.108594+0.157067im      0.227347-0.215634im      0.120755+0.110478im      0.102985+0.00804121im   -0.291338-0.0687427im      0.114447-0.0438844im    0.0792041-0.136192im        0.23034+0.106227im      0.0196345-0.0779541im    -0.140181+0.00485225im    0.0806444-0.0338331im    -0.122089+0.27557im      -0.175301+0.0654421im     0.0568512-0.162933im       0.0596635+0.0238525im     -0.0672058-0.0491568im    -0.0478501+0.00416987im   -0.0101931+0.00707921im      0.164124+0.0506704im     0.139714-0.112123im     -0.0258368+0.0302977im   0.0145295-0.291375im       0.157363+0.0253821im   0.0394821+0.142558im     0.0691077+0.00482955im   -0.015377+0.208127im      -0.165114-0.160711im
   0.122934+0.150645im     0.0497451+0.0703628im    -0.0158963-0.240626im      0.253205-0.0648714im     0.0196307-0.278051im       0.09209-0.154553im     -0.174011+0.155572im      0.023342+0.0675854im    0.0133894-0.123039im     0.0529445+0.117341im        0.17653-0.0829531im    0.0370485+0.107195im     -0.0605398-0.0577949im     0.0864775+0.122946im     0.0275942+0.139441im       0.075402+0.16193im      0.0876975+0.0666978im    0.0833664+0.120879im      -0.191728-0.0620556im      -0.193812-0.130058im      -0.0231541+0.0204613im     -0.206177+0.104777im        0.12905+0.0290693im     -0.0435527-0.0976141im     0.203757+0.109964im     -0.0083622-0.0945338im  -0.0583553-0.0022295im     -0.237204+0.05038im      0.174084+0.159339im    -0.0149379-0.00920546im  -0.0900643-0.0206625im      0.142581-0.26883im
  -0.134215-0.0506437im     0.139538+0.0447883im     -0.283982+0.130308im     -0.177844+0.121824im     -0.0997019+0.0487255im    -0.161774+0.0874824im   -0.0254839+0.0378662im   -0.0128336+0.0198372im   -0.0239592+0.00901454im   -0.276705+0.000359939im    -0.12036+0.0861653im     0.120961+0.0677452im   -0.00542679+0.0279449im     0.0368457-0.149584im    -0.0139824+0.12167im      -0.0776526+0.0134104im    0.0552621-0.0839181im   -0.0452284-0.0460333im    -0.0564548-0.067977im      -0.0650743-0.188522im        0.279625+0.0679213im     -0.194157+0.16448im        0.234318+0.160812im        -0.15166-0.0549577im     0.174659+0.0156826im    -0.0223561-0.0265934im  -0.0638117+0.186508im     -0.0262695-0.138317im    -0.192156+0.223607im      0.180763-0.0789458im    -0.191343-0.0874204im     -0.133284+0.0793157im
  -0.176149+0.0641151im     0.071972+0.286928im      -0.141547+0.0715569im    0.0366573-0.0987208im     -0.274249+0.00844654im   0.0477466-0.138349im    -0.0338653-0.0524109im     0.126952-0.190301im    -0.0296028-0.219124im     0.0519751+0.00457067im    0.0827256+0.0303633im    0.0461276-0.164437im      -0.110123-0.124064im       -0.14228+0.0382909im    -0.185754-0.206921im     -0.0996181-0.090832im     -0.147925-0.0757937im    -0.159917+0.208871im     -0.0443489+0.1552im         -0.176879+0.218748im        0.208858-0.111515im      0.0384246-0.224703im     0.00349453+0.092553im       0.0792836+0.00963045im   -0.072643+0.212038im     -0.0781342-0.0126759im    -0.10576+0.103214im      0.0866543+0.0668296im   0.0449134+0.0922505im    0.0128465-0.117802im     0.0271909-0.0618317im     0.0912082-0.046271im
  0.0154939-0.0982025im    -0.115796-0.244841im       0.087576-0.0869662im    0.0313135-0.288616im      0.0403425+0.186173im     0.0128182-0.226601im     -0.150026-0.179712im      0.170271-0.00651263im   0.0257647+0.0273164im    0.0434146-0.0682931im    0.00889316+0.16444im      -0.053309-0.00909337im     0.154417+0.100544im       0.136149-0.185804im    -0.0559633-0.0206863im     0.0246646-0.115006im     -0.208268+0.165153im      0.198661+0.131361im      0.0304452-0.000726657im   -0.0800716+0.0239695im       0.232511+0.0695269im     0.0508967+0.127717im     -0.0116338-0.104135im      -0.0398101+0.0804212im    0.0752521+0.0208119im      0.116292+0.277112im   -0.0282362-0.042367im     -0.0606288-0.066513im    -0.108537+0.00473831im     0.19895-0.187242im     -0.157813-0.0289029im      0.206365-0.0959655im
  -0.124519-0.137066im     0.0683108+0.132167im       0.127266-0.126173im    -0.0809555-0.0380056im    -0.0263618-0.0073109im    0.0664275+0.214613im     -0.120077-0.055093im      0.127458+0.112325im      -0.21906+0.00842643im   -0.130806-0.114411im     -0.0457442-0.118279im     -0.237442-0.147454im      -0.190336+0.243445im      0.0615431+0.138565im    0.00657647+0.10685im       0.0264185-0.0638752im    0.0837408-0.033471im      -0.14073+0.115034im       0.183451+0.0131526im     -0.0920739-0.0250644im     -0.0223407+0.149051im      0.0466842+0.121369im     -0.0564513-0.187244im      -0.0240051+0.184929im     0.0588311+0.177887im        0.11563-0.20834im    -0.0987745-0.0988476im     -0.166879+0.181216im   -0.0895929+0.0164995im    -0.152497-0.282926im    -0.0606642+0.040675im     -0.0477859+0.103329im
 -0.0417401-0.0627797im     0.134155-0.214517im     -0.0707904-0.120297im     0.0201044+0.128637im    -0.00536914+0.122375im     0.0533705-0.10364im       0.154183+0.109577im    -0.0735568-0.134443im      0.145301+0.228159im    -0.0867327+0.100149im     -0.0401314-0.0302686im   -0.0553646-0.112555im      -0.148436-0.191507im     -0.0299011+0.144178im     -0.205462-0.134544im      -0.188683+0.0142265im    0.0546043-0.0546556im   -0.0450455-0.117443im      -0.137714+0.0802862im      0.0339125-0.236389im         0.04549+0.155071im     -0.0653603+0.0375555im     -0.160871-0.167301im      -0.0117253+0.117679im      0.124195-0.0070406im     0.0845932-0.134475im    0.0226644-0.167331im       0.283172+0.0102217im    0.166786-0.0414567im     0.146766-0.264959im    -0.0127803+0.019356im      0.0926755-0.191589im
  -0.136837-0.0967802im      0.22511+0.0990505im     0.0778483-0.0650238im    -0.110404+0.117852im     -0.0518468+0.00776151im   -0.161797-0.0294228im    0.0686327-0.0376116im    -0.196181+0.0687831im     0.158859-0.245111im      0.200631+0.0192439im     -0.266112-0.0134349im    -0.031031+0.149273im       0.260276+0.0511114im     -0.156189+0.0757617im    0.0400243+0.0989405im     0.0279239-0.0419862im    -0.179072+0.145184im     0.0171267+0.178936im      -0.162026+0.160383im      0.00727283-0.207715im        0.134235-0.0244385im      0.041932-0.0026498im       0.10761-0.266622im       0.0152169+0.0693092im   0.00674894+0.120267im       0.156204-0.119834im   -0.0733782-0.0149762im   -0.00388987+0.017046im   -0.0486555-0.12274im     -0.0086053+0.206524im     0.0509574+0.21082im      0.00874243-0.0783664im
  -0.185675+0.0203203im   -0.0572816+0.111535im    -0.00706147+0.023513im    -0.0986928+0.144519im      0.0573745+0.271443im    -0.0858947-0.0353665im    0.0939863-0.124862im     0.0345655+0.161397im    -0.0655033+0.194849im      0.121304-0.0346963im     0.0823504+0.00594903im    0.206989-0.0608258im     0.0674668-0.104771im      -0.155743-0.125758im      0.113608+0.06333im        0.034356-0.154301im     0.0728156-0.0266074im    -0.022651+0.130729im     -0.0777003-0.238928im       -0.249112+0.0852594im     -0.0842391+0.303346im     -0.0915157-0.0935567im    -0.0719109-0.0576293im     -0.0863446-0.0718325im      0.18416+0.166453im      -0.025956+0.0982043im   0.0444948-0.0302775im    -0.0845139-0.174647im     0.243461-0.173711im     -0.224316-0.00247909im    0.039637-0.0604691im    -0.0613128-0.131135im
  -0.224112-0.00752438im    0.146234-0.0706498im    -0.0195173-0.221797im      0.104119-0.0210537im     0.0737604-0.148186im    -0.0582636+0.0775129im    0.0312796+0.044039im     -0.155396-0.137522im     0.0845698-0.0775607im     0.099957+0.100557im      -0.207463+0.194363im      0.155767-0.175788im      -0.308532-0.00949339im    0.0595825-0.196111im     0.0687926-0.0754619im   -0.00625387-0.230617im    -0.0114804+0.273075im     0.0512127+0.119972im      0.0773372-0.115412im        0.197002-0.0678553im     -0.0287278+0.116691im      0.0934029+0.0458246im     0.0792331+0.148337im        0.248765-0.0617982im   -0.0381906-0.0364503im    -0.0768636+0.0153035im    0.164093+0.079591im      -0.159902+0.101716im     0.135682-0.0602474im   -0.0473157-0.109077im    -0.0969485-0.0416148im    -0.0824418+0.0601149im
  0.0107026-0.181483im      -0.20725+0.0913586im    -0.0648373+0.00522602im    0.153773+0.120806im      0.0556602+0.147395im     0.0724313-0.132006im      0.061519+0.285126im     -0.013924+0.104408im    -0.0484667-0.206503im     -0.252403+0.1247im          0.14525-0.0427193im   -0.0797186-0.0218137im      0.183229-0.0656046im    -0.0465955+0.135299im     -0.142527+0.220164im     -0.0780498-0.182659im    0.00593847+0.0426287im    0.0972097+0.124669im      0.0919198+0.0283748im      0.0685745-0.0591565im      0.0372736+0.0831467im      0.207876-0.166872im       0.199316+0.0734032im     -0.0169422+0.135416im      0.133383-0.117905im      -0.212146-0.0128325im    0.128446-0.0190327im     -0.108233+0.0900481im  -0.0139769-0.262228im      0.122626-0.0559616im    0.0462542-0.108831im     -0.0474092+0.0678292im
 -0.0499154+0.118963im     -0.166153+0.00564875im     0.185075+0.037368im     0.0616397+0.0206022im    -0.0562619-0.0742188im    -0.228913+0.153146im     -0.243571+0.171039im     0.0943995+0.0623921im    0.0537654+0.118513im    -0.0310255+0.140436im       -0.25414-0.11767im       0.096018+0.0106344im     0.0338687+0.116634im        0.05804+0.109798im     -0.133437-0.0382087im     -0.207118-0.0807908im     -0.11371+0.0246625im    0.0805199-0.132762im       0.084952+0.135628im      -0.0279874+0.0202099im      0.0307251+0.139393im      0.0223649-0.209071im     -0.0694011-0.0849233im       -0.12684-0.315366im    -0.0356196+0.0652264im     -0.245635+0.125779im    -0.157238-0.075279im     -0.0778704-0.021967im     0.160201+0.0578494im     0.112293-0.0542286im   -0.0784306+0.272014im     -0.0747012+0.0129463im
  0.0566679-0.21932im     -0.0712731-0.1295im         0.227995-0.0519022im    -0.104734+0.102im        -0.0959443-0.0537095im   -0.0317536+0.00391186im    0.103782-0.100271im     0.0751434+0.267349im    -0.0402799+0.00242918im   -0.064147+0.0136962im     0.0158654+0.0778729im   -0.0575922-0.133806im      0.0562902+0.0227041im    -0.0097811-0.0571734im   -0.0957303+0.161011im      -0.297569+0.154693im    -0.0831658-0.0897722im    0.0730038-0.0071745im    -0.0541449-0.0412331im    0.000648757+0.140957im        0.169771+0.0989825im     -0.196163+0.0580487im      0.020216+0.0305648im        0.27885-0.0230189im    -0.281827-0.0241687im     0.0128723-0.0660441im   0.0754092+0.215011im     -0.0394342+0.243219im     0.194541+0.116685im     0.0323015+0.102327im     0.0853114-0.11146im       -0.110146-0.233909im
    0.12433-0.0374947im    0.0669406-0.115946im      -0.126004-0.205122im     -0.057143+0.0476165im      0.210248+0.261994im     0.0809732+0.11338im      0.0782894-0.121528im    -0.0414051+0.221734im     0.0572189+0.0361117im       0.1762+0.131777im     -0.0503757-0.0713421im    -0.135871+0.0313031im    -0.0106548-0.0725743im    -0.0413473-0.0837753im   -0.0391111-0.0519813im      0.101607-0.209551im    -0.0201055+0.0884732im    0.0208777-0.275633im   -0.000731747+0.169365im      -0.0326216+0.151674im       0.0319334-0.125942im     -0.0956766-0.0878878im      0.279136+0.240412im      -0.0750477+0.0888887im    -0.011301+0.183621im      -0.166389-0.0565103im   -0.219225-0.177342im     -0.0224835+0.192319im    0.0498005+0.177686im    -0.0671151-0.00706219im  -0.0452585-0.0325945im     0.0239848+0.0252321im
 -0.0223573-0.307667im      0.128011+0.00505974im   -0.0229833-0.00440708im   -0.120658+0.143285im      -0.056853-0.0392383im     0.132817+0.0583537im    0.0873169-0.0880964im    -0.121689-0.154902im      0.104557+0.094506im     0.0163152-0.198089im       0.208056+0.0951758im    -0.125395-0.145776im      -0.073551-0.223473im      0.0651731-0.0390039im    0.0144057+0.182995im     0.00640828+0.180596im    -0.0190793+0.0811119im   -0.0453568+0.0423318im      0.012539+0.0388695im     -0.0140743-0.00435737im    -0.0530268-0.00279663im     0.183225-0.116167im      -0.131776-0.0838783im      -0.119579-0.160095im     0.0413545-0.074924im      -0.302602+0.158559im    -0.175405-0.00087998im    -0.196866+0.0939642im  -0.0881824+0.0623429im   0.00996598+0.159684im     -0.295571+0.163163im      0.0704776-0.105528im
  -0.117797-0.0245738im    0.0715646+0.230936im     -0.0930208+0.192672im    -0.0410962+0.0113121im      0.214076+0.121239im     0.0502069-0.0148361im   -0.0643606-0.0920098im     0.197346+0.0686987im   -0.0554507-0.0580805im   -0.0608867-0.175868im      -0.186995+0.148872im     0.0302276-0.034303im       0.134127-0.00277533im     0.264435+0.0722275im    -0.168281-0.0794656im     0.0938935+0.147213im     0.0955948-0.032642im      0.143509-0.012073im      -0.232388+0.299244im       0.0370759-0.240413im        -0.17213+0.0813637im     0.0393048+0.020166im    0.000638913+0.22969im        0.0223765-0.0096169im    -0.108774-0.0763852im     0.0325412+0.138119im     0.142499-0.0011855im    -0.0174803+0.149357im     0.174903+0.0129442im    -0.198839-0.0762475im   -0.0230073+0.0812415im      0.096868-0.0529353im
    0.12412-0.164868im      0.107357+0.0363846im     -0.257918+0.0801704im     0.216367+0.036834im     -0.0250904+0.0974161im     -0.13494+0.11838im      -0.102174+0.0057944im   -0.0105759-0.132271im     0.0233472-0.120812im    0.00860472+0.0407817im     0.0268752+0.044777im    -0.0434172+0.264854im      -0.101256-0.0420842im   -0.00916382-0.137652im      -0.23086-0.00903656im    -0.157589+0.042312im    -0.0186548-0.173498im      0.196016-0.0856212im     0.0107908-0.204303im      -0.0974414+0.0281195im     -0.0941965+0.00956599im  -0.00848016+0.127301im      -0.191325-0.0879111im       0.131065+0.235188im    -0.0986179+0.314095im    -8.81096e-5+0.133342im     0.111036-0.177815im      -0.213099+0.0318686im   0.0550577-0.0131271im    0.0341632+0.151975im     0.0157461+0.126098im     -0.0655558+0.124358im
   0.117873+0.0390811im    -0.077194-0.133207im      0.0122656+0.174229im     0.0942268+0.177876im     -0.0531702-0.0467162im   -0.0772452-0.0509359im   -0.0389028+0.260987im     0.0466759-0.132843im     0.0217522+0.12415im      0.0205452-0.202153im      -0.124183-0.0992219im    -0.116075-0.244887im       0.149133+0.0177417im     -0.120726-0.0796951im     0.283122+0.0988822im    -0.0500261-0.0920228im   -0.0163943+0.0958963im   -0.0262978+0.107066im      -0.117681+0.0429972im      -0.171008-0.156488im       -0.180634-0.144773im      -0.193437+0.108711im     -0.0307902+0.206761im        0.210376+0.119165im     -0.132867+0.231538im      -0.138326+0.124796im    -0.117251-0.0328474im     0.0476583+0.0676981im   -0.160575-0.110976im    0.00433855-0.147679im    -0.0262458+0.0174809im     0.0041278-0.0439646im</code></pre><p>and then generate the state <span>$ψ$</span></p><pre><code class="language-julia hljs">psi = P[:, 3]</code></pre><pre><code class="nohighlight hljs">32-element Vector{ComplexF64}:
   0.01613790004705954 + 0.2625926867175315im
   0.06771615927392903 - 0.09820490460597493im
   0.20066701095084438 + 0.08803457801489536im
   -0.0640850151688489 + 0.026851577946008644im
  -0.06511255703967217 - 0.21224323226055414im
   -0.0175516523579251 - 0.22876158248987957im
  0.022051240109205707 + 0.08961270289016683im
 -0.005153859921397174 + 0.007824620754812281im
  0.035065059053089355 + 0.06044738316124364im
  -0.18552981848475011 + 0.2034402003389764im
  -0.07813952795116115 - 0.20708823381838987im
  0.061001487664235306 - 0.011782472285642026im
   0.09574485168190004 - 0.07495409019222005im
     0.334156159169215 + 0.0im
  -0.06437566509725977 + 0.15380950244505445im
 -0.004620067469225388 - 0.14244675656740594im
   0.02040620688152594 + 0.21035262884735906im
 -0.038264408028937776 - 0.09563383040437341im
   0.17122580231565526 + 0.0076886340091597075im
  0.035027864771319715 + 0.24070419876276558im
  -0.06690750720285844 + 0.038766129555377546im
  -0.04981914973541803 - 0.05165319112370743im
    0.2429555155165617 - 0.06576527272915499im
   0.09197269570746272 + 0.08698295013919272im
   0.11918964219025448 + 0.0746713997763412im
   -0.1440975350112839 + 0.05434827260100877im
  -0.07645551539061711 + 0.07454608916912085im
   0.01722026453492373 - 0.014070739483002626im
   0.14773456302335122 + 0.03997902462032351im
  0.015121025723806174 + 0.2915181251282496im
   0.04751249555612101 - 0.03583270227056678im
  -0.18720660838774603 - 0.09017004910852809im</code></pre><p>In the phase estimation process, we will feed the state to circuit and measure the first <code>n</code> qubits processed by iQFT.</p><pre><code class="language-julia hljs">r = join(ArrayReg(psi), zero_state(N))
r |&gt; PE(N, M, U)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 8/8
    nlevel: 2</code></pre><p>Since our phase can be represented by 3 qubits precisely, we only need to measure once</p><pre><code class="language-julia hljs">results = measure(r, 1:N; nshots=1)</code></pre><pre><code class="nohighlight hljs">1-element Vector{DitStr{2, 3, Int64}}:
 011 ₍₂₎</code></pre><p>Recall that our QFT&#39;s bit numbering is reversed, let&#39;s reverse it back</p><pre><code class="language-julia hljs">using BitBasis
estimated_phase = bfloat(results[]; nbits=N)</code></pre><pre><code class="nohighlight hljs">0.75</code></pre><p>the phase is exactly <code>0.75</code>!</p><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../1.prepare-ghz-state/index.html">« Prepare Greenberger–Horne–Zeilinger state with Quantum Circuit</a><a class="docs-footer-nextpage" href="../3.grover-search/index.html">Grover Search »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.4.1 on <span class="colophon-date" title="Monday 13 May 2024 16:32">Monday 13 May 2024</span>. Using Julia version 1.10.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
