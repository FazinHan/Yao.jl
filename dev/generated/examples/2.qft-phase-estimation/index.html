<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Quantum Fourier Transformation and Phase Estimation · Documentation | Yao</title><meta name="title" content="Quantum Fourier Transformation and Phase Estimation · Documentation | Yao"/><meta property="og:title" content="Quantum Fourier Transformation and Phase Estimation · Documentation | Yao"/><meta property="twitter:title" content="Quantum Fourier Transformation and Phase Estimation · Documentation | Yao"/><meta name="description" content="Documentation for Documentation | Yao."/><meta property="og:description" content="Documentation for Documentation | Yao."/><meta property="twitter:description" content="Documentation for Documentation | Yao."/><script data-outdated-warner src="../../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../search_index.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script><link href="../../../assets/indigo.css" rel="stylesheet" type="text/css"/><link href="https://yaoquantum.org/assets/favicon-light.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../index.html"><img src="../../../assets/logo.png" alt="Documentation | Yao logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../../index.html">Documentation | Yao</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../../index.html">Home</a></li><li><a class="tocitem" href="../../../quick-start.html">Quick Start</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../../../man/registers.html">Quantum Registers</a></li><li><a class="tocitem" href="../../../man/blocks.html">Blocks</a></li><li><a class="tocitem" href="../../../man/symbolic.html">Symbolic Computation</a></li><li><a class="tocitem" href="../../../man/cuda.html">CUDA extension - CuYao</a></li><li><a class="tocitem" href="../../../man/plot.html">Quantum Circuit Visualization</a></li><li><a class="tocitem" href="../../../man/automatic_differentiation.html">Automatic Differentiation</a></li><li><a class="tocitem" href="../../../man/yao2einsum.html">Tensor network backend</a></li><li><a class="tocitem" href="../../../man/simplification.html">Simplification</a></li><li><a class="tocitem" href="../../../man/bitbasis.html">BitBasis</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../1.prepare-ghz-state/index.html">Prepare Greenberger–Horne–Zeilinger state with Quantum Circuit</a></li><li class="is-active"><a class="tocitem" href="index.html">Quantum Fourier Transformation and Phase Estimation</a><ul class="internal"><li><a class="tocitem" href="#Quantum-Fourier-Transformation"><span>Quantum Fourier Transformation</span></a></li><li><a class="tocitem" href="#Wrap-QFT-to-an-external-block"><span>Wrap QFT to an external block</span></a></li><li><a class="tocitem" href="#Phase-Estimation"><span>Phase Estimation</span></a></li></ul></li><li><a class="tocitem" href="../3.grover-search/index.html">Grover Search</a></li><li><a class="tocitem" href="../4.shor-algorithm/index.html">Shor&#39;s Algorithm</a></li><li><a class="tocitem" href="../5.shor-9-code/index.html">Shor&#39;s 9 qubit code</a></li><li><a class="tocitem" href="../6.quantum-circuit-born-machine/index.html">Quantum Circuit Born Machine</a></li><li><a class="tocitem" href="../7.variation-quantum-eigen-solver/index.html">Variational Quantum Eigen Solver</a></li><li><a class="tocitem" href="../8.riemannian-gradient-flow/index.html">Riemannian gradient flow optimizer</a></li></ul></li><li><a class="tocitem" href="../../../performancetips.html">Performance Tips</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href="index.html">Quantum Fourier Transformation and Phase Estimation</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="index.html">Quantum Fourier Transformation and Phase Estimation</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/QuantumBFS/Yao.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/QuantumBFS/Yao.jl/blob/master/docs/src/examples/2.qft-phase-estimation/main.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><p><a href="/generated/examples/2.qft-phase-estimation/main.ipynb"><img src="https://mybinder.org/badge_logo.svg" alt/></a></p><h1 id="example-qft"><a class="docs-heading-anchor" href="#example-qft">Quantum Fourier Transformation and Phase Estimation</a><a id="example-qft-1"></a><a class="docs-heading-anchor-permalink" href="#example-qft" title="Permalink"></a></h1><p>Let&#39;s use Yao first</p><pre><code class="language-julia hljs">using Yao</code></pre><h2 id="Quantum-Fourier-Transformation"><a class="docs-heading-anchor" href="#Quantum-Fourier-Transformation">Quantum Fourier Transformation</a><a id="Quantum-Fourier-Transformation-1"></a><a class="docs-heading-anchor-permalink" href="#Quantum-Fourier-Transformation" title="Permalink"></a></h2><p>The Quantum Fourier Transformation (QFT) circuit is to repeat two kinds of blocks repeatly:</p><p><img src="assets/qft.png" alt="qft-circuit"/></p><p>The basic building block control phase shift gate is defined as</p><p class="math-container">\[R(k)=\begin{bmatrix}
1 &amp; 0\\
0 &amp; \exp\left(\frac{2\pi i}{2^k}\right)
\end{bmatrix}\]</p><p>Let&#39;s define block <code>A</code> and block <code>B</code>, block <code>A</code> is actually a control block.</p><pre><code class="language-julia hljs">A(i, j) = control(i, j=&gt;shift(2π/(1&lt;&lt;(i-j+1))))</code></pre><pre><code class="nohighlight hljs">A (generic function with 1 method)</code></pre><p>Once you construct the blockl you can inspect its matrix using <code>mat</code> function. Let&#39;s construct the circuit in dash box A, and see the matrix of <span>$R_4$</span> gate.</p><pre><code class="language-julia hljs">R4 = A(4, 1)</code></pre><pre><code class="nohighlight hljs">(n -&gt; control(n, 4, 1 =&gt; shift(0.39269908169872414)))</code></pre><p>If you have read about <a href="@ref tutorial-ghz">preparing GHZ state</a>, you probably know that in Yao, we could just leave the number of qubits, and it will be evaluated when possible.</p><pre><code class="language-julia hljs">R4(5)</code></pre><pre><code class="nohighlight hljs">nqubits: 5
control(4)
└─ (1,) shift(0.39269908169872414)</code></pre><p>its matrix will be</p><pre><code class="language-julia hljs">mat(R4(5))</code></pre><pre><code class="nohighlight hljs">32×32 Diagonal{ComplexF64, Vector{ComplexF64}}:
 1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im</code></pre><p>Then we repeat this control block over and over on different qubits, and put a Hadamard gate to <code>i</code>th qubit to construct <code>i</code>-th <code>B</code> block.</p><pre><code class="language-julia hljs">B(n, k) = chain(n, j==k ? put(k=&gt;H) : A(j, k) for j in k:n)</code></pre><pre><code class="nohighlight hljs">B (generic function with 1 method)</code></pre><p>We need to input the total number of qubits <code>n</code> here because we have to iterate through from <code>k</code>-th location to the last.</p><p>Now, let&#39;s construct the circuit by chaining all the <code>B</code> blocks together</p><pre><code class="language-julia hljs">qft(n) = chain(B(n, k) for k in 1:n)
qft(4)</code></pre><pre><code class="nohighlight hljs">nqubits: 4
chain
├─ chain
│  ├─ put on (1)
│  │  └─ H
│  ├─ control(2)
│  │  └─ (1,) shift(1.5707963267948966)
│  ├─ control(3)
│  │  └─ (1,) shift(0.7853981633974483)
│  └─ control(4)
│     └─ (1,) shift(0.39269908169872414)
├─ chain
│  ├─ put on (2)
│  │  └─ H
│  ├─ control(3)
│  │  └─ (2,) shift(1.5707963267948966)
│  └─ control(4)
│     └─ (2,) shift(0.7853981633974483)
├─ chain
│  ├─ put on (3)
│  │  └─ H
│  └─ control(4)
│     └─ (3,) shift(1.5707963267948966)
└─ chain
   └─ put on (4)
      └─ H
</code></pre><h2 id="Wrap-QFT-to-an-external-block"><a class="docs-heading-anchor" href="#Wrap-QFT-to-an-external-block">Wrap QFT to an external block</a><a id="Wrap-QFT-to-an-external-block-1"></a><a class="docs-heading-anchor-permalink" href="#Wrap-QFT-to-an-external-block" title="Permalink"></a></h2><p>In most cases, <code>function</code>s are enough to wrap quantum circuits, like <code>A</code> and <code>B</code> we defined above, but sometimes, we need to dispatch specialized methods on certain kinds of quantum circuit, or we want to define an external block to export, thus, it&#39;s useful to be able to wrap circuit to custom blocks.</p><p>First, we define a new type as subtype of <code>PrimitiveBlock</code> since we are not going to use the subblocks of <code>QFT</code>, if you need to use its subblocks, it&#39;d be better to define it under <code>CompositeBlock</code>.</p><pre><code class="language-julia hljs">struct QFT &lt;: PrimitiveBlock{2}
    n::Int
end

YaoBlocks.nqudits(q::QFT) = q.n</code></pre><p>Now, let&#39;s define its circuit</p><pre><code class="language-julia hljs">circuit(q::QFT) = qft(q.n)</code></pre><pre><code class="nohighlight hljs">circuit (generic function with 1 method)</code></pre><p>And forward <code>mat</code> to its circuit&#39;s matrix</p><pre><code class="language-julia hljs">YaoBlocks.mat(::Type{T}, x::QFT) where T = mat(T, circuit(x))</code></pre><p>You may notice, it is a little ugly to print <code>QFT</code> at the moment, this is because we print the type summary by default, you can define your own printing by overloading <code>print_block</code></p><pre><code class="language-julia hljs">YaoBlocks.print_block(io::IO, x::QFT) = print(io, &quot;QFT($(x.n))&quot;)</code></pre><p>Since it is possible to use FFT to simulate the results of QFT (like cheating), we could define our custom <code>apply!</code> method:</p><pre><code class="language-julia hljs">using FFTW, LinearAlgebra

function YaoBlocks.apply!(r::ArrayReg, x::QFT)
    α = sqrt(length(statevec(r)))
    invorder!(r)
    lmul!(α, ifft!(statevec(r)))
    return r
end</code></pre><p>Now let&#39;s check if our <code>apply!</code> method is correct:</p><pre><code class="language-julia hljs">r = rand_state(5)
r1 = r |&gt; copy |&gt; QFT(5)
r2 = r |&gt; copy |&gt; circuit(QFT(5))
r1 ≈ r2</code></pre><pre><code class="nohighlight hljs">true</code></pre><p>We can get iQFT (inverse QFT) directly by calling <code>adjoint</code></p><pre><code class="language-julia hljs">QFT(5)&#39;</code></pre><pre><code class="nohighlight hljs"> [†]QFT(5)</code></pre><p>QFT and iQFT are different from FFT and IFFT in three ways,</p><ol><li>they are different by a factor of <span>$\sqrt{2^n}$</span> with <span>$n$</span> the number of qubits.</li><li>the <a href="https://quantumbfs.github.io/BitBasis.jl/stable/tutorial/#Conventions-1">bit numbering</a> will exchange after applying QFT or iQFT.</li><li>due to the convention, QFT is more related to IFFT rather than FFT.</li></ol><h2 id="Phase-Estimation"><a class="docs-heading-anchor" href="#Phase-Estimation">Phase Estimation</a><a id="Phase-Estimation-1"></a><a class="docs-heading-anchor-permalink" href="#Phase-Estimation" title="Permalink"></a></h2><p>Since we have QFT and iQFT blocks we can then use them to realize phase estimation circuit, what we want to realize is the following circuit:</p><p><img src="assets/phaseest.png" alt="phase estimation"/></p><p>First we call Hadamard gates repeatly on first <code>n</code> qubits.</p><pre><code class="language-julia hljs">Hadamards(n) = repeat(H, 1:n)</code></pre><pre><code class="nohighlight hljs">Hadamards (generic function with 1 method)</code></pre><p>Then in dashed box <code>B</code>, we have controlled unitaries:</p><pre><code class="language-julia hljs">ControlU(n, m, U) = chain(n+m, control(k, n+1:n+m=&gt;matblock(U^(2^(k-1)))) for k in 1:n)</code></pre><pre><code class="nohighlight hljs">ControlU (generic function with 1 method)</code></pre><p>each of them is a <code>U</code> of power <span>$2^{(k-1)}$</span>.</p><p>Since we will only apply the qft and Hadamard on first <code>n</code> qubits, we could use <code>Subroutine</code>, which creates a context of a sub-scope of the qubits.</p><pre><code class="language-julia hljs">PE(n, m, U) =
    chain(n+m, # total number of the qubits
        subroutine(Hadamards(n), 1:n), # apply H in local scope
        ControlU(n, m, U),
        subroutine(QFT(n)&#39;, 1:n))</code></pre><pre><code class="nohighlight hljs">PE (generic function with 1 method)</code></pre><p>we use the first <code>n</code> qubits as the output space to store phase <span>$ϕ$</span>, and the other <code>m</code> qubits as the input state which corresponds to an eigenvector of oracle matrix <code>U</code>.</p><p>The subroutine here uses <code>focus!</code> and <code>relax!</code> to manage a local scope of quantum circuit, and only activate the first <code>n</code> qubits while applying the block inside the subroutine context, and the scope will be <code>relax!</code>ed back, after the context. This is equivalent to manually <code>focus!</code> then <code>relax!</code></p><p>fullly activated</p><pre><code class="language-julia hljs">r = rand_state(5)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 5/5
    nlevel: 2</code></pre><p>first 3 qubits activated</p><pre><code class="language-julia hljs">focus!(r, 1:3)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 3/5
    nlevel: 2</code></pre><p>relax back to the original</p><pre><code class="language-julia hljs">relax!(r, 1:3)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 5/5
    nlevel: 2</code></pre><p>In this way, we will be able to apply small operator directly on the subset of the qubits.</p><p>Details about the algorithm can be found here: <a href="https://en.wikipedia.org/wiki/Quantum_phase_estimation_algorithm">Quantum Phase Estimation Algorithm</a></p><p>Now let&#39;s check the results of our phase estimation.</p><p>First we need to set up a unitary with known phase, we set the phase to be 0.75, which is <code>0.75 * 2^3 == 6 == 0b110</code> .</p><pre><code class="language-julia hljs">N, M = 3, 5
P = eigen(rand_unitary(1&lt;&lt;M)).vectors
θ = Int(0b110) / 1&lt;&lt;N
phases = rand(1&lt;&lt;M)
phases[0b010+1] = θ
U = P * Diagonal(exp.(2π * im * phases)) * P&#39;</code></pre><pre><code class="nohighlight hljs">32×32 Matrix{ComplexF64}:
   0.433134-0.0886266im     0.161878+0.0476275im      0.157041+0.162293im      0.0646263+0.219419im   -0.00141374+0.033509im    -0.0763373+0.00674567im  -0.0100873+0.0226979im    -0.136357+0.0293263im   -0.0278816-0.167239im      -0.149413-0.0137596im     0.169081-0.106325im     -0.0173198-0.294843im      0.0257913+0.204036im       -0.142102-0.0639576im   0.00429347+0.137087im        -0.15342+0.0375793im     -0.0151425-0.0752925im      0.16724+0.0268595im    0.0111855+0.053316im       0.0455205+0.174645im     -0.0264601-0.0442526im    -0.149499-0.0647306im     -0.138948-0.0649288im     -0.22405+0.183768im     -0.0444708+0.149054im     -0.0645046-0.0973702im     0.113256-0.0607679im  -0.0717169-0.120565im      0.101552-0.0999881im     0.104937-0.0118238im    -0.0675397-0.122029im     0.138571+0.0773331im
  0.0438684-0.0491214im     0.358681-0.024621im       0.070726+0.0731058im   -0.00624667-0.185389im     -0.124921+0.00786996im   0.0676281-0.109406im     -0.220205+0.0887743im    0.0471808-0.227471im     0.0815998+0.0566884im    -0.0536031+0.0887564im    -0.166724+0.138889im     -0.0811369+0.0936594im     -0.127772+0.016169im       0.0472449+0.0171846im   -0.0295474-0.0973107im     -0.0546171-0.0149355im      -0.145055-0.143551im      0.162987-0.140106im     -0.181521-0.0357802im      0.0658396+0.124607im     -0.0871519-0.00221411im   -0.108306-0.125241im      -0.125422+0.124765im    -0.0787902+0.0351006im      0.191648-0.157479im      0.0327861+0.312543im     0.0923224+0.0347091im  -0.0481148-0.105223im    -0.0817212+0.173071im     0.0718625+0.0404203im      0.325081+0.0685818im    0.026017+0.0989687im
  -0.158716-0.149173im     -0.232858+0.216863im      0.0843294-0.148041im     -0.0376095-0.210818im    -0.0948253-0.0383634im     0.154182+0.163264im     -0.145283+0.0849291im    0.0192879+0.0408666im   -0.0881548-0.208413im     -0.0490243+0.00525484im  -0.0164155+0.0138662im     0.0524629-0.0496398im   -0.00387592+0.217146im      -0.0349644+0.0195847im   0.00787966-0.0324271im      -0.102347-0.0248736im    -0.00744468-0.17354im     -0.0553943+0.0961822im     0.126291+0.01392im         0.129094+0.02563im      -0.0948262-0.0192378im    -0.245753-0.189567im     -0.0394522-0.209814im    -0.0085811-0.137846im      -0.215089-0.00541128im    0.0584993+0.198453im     -0.138336+0.200103im     -0.28509+0.156455im      0.133374-0.0639039im     0.121742-0.026476im      0.0351204-0.0474756im   -0.151517-0.0263477im
 -0.0236892+0.125152im      0.130376-0.0606224im    -0.0189728+0.132664im       0.116566+0.0472316im  0.000560327-0.141109im     0.0153776-0.124155im     -0.226877-0.112989im      0.106509+0.139584im     0.0688834+0.176699im      0.0573163-0.164616im      0.133266-0.124498im      -0.116953+0.0894665im     0.0206829+0.157935im      -0.0648322+0.276804im    -0.0999138+0.0424492im      0.0101599+0.29634im     -0.000481579+0.136136im     0.0770041-0.0116147im   0.00441924+0.149272im         0.19866-0.050291im    0.000437589-0.00509204im  -0.0365898-0.237944im       0.016412-0.0979494im   -0.0613447-0.0153432im     -0.310306-0.235688im      0.0701417-0.0106989im   -0.0321176-0.0126131im   0.0848744+0.023083im     -0.263618-0.150684im     -0.166593-0.0577787im     0.0133044-0.0737868im      -0.126-0.0131638im
  0.0466289-0.0841012im   -0.0650613-0.0631298im     -0.018059-0.0360559im     0.0378729+0.0111844im    0.0851063-0.141854im     -0.132795-0.143036im      0.114538-0.13164im       0.162864-0.226318im     -0.144774-0.0152067im    -0.0304906+0.108537im     -0.104932+0.0789716im      0.024313-0.157849im      -0.118166+0.000381514im    0.0967199+0.0991014im    -0.291386+0.0121378im     -0.0782423+0.185652im       -0.242535-0.213605im     -0.340963-0.153695im      0.146777-0.281683im        0.148621-0.0583654im      0.053271-0.161047im     0.0454481-0.0238489im      0.134317-0.115451im     -0.129997-0.0311007im     -0.124798+0.051561im     -0.0468465+0.116914im       0.10408-0.0355139im     0.19807-0.0798824im   0.00148641+0.0084414im    0.0751174+0.0182959im     -0.119486-0.0236605im   0.0656149-0.0436811im
 -0.0510828-0.0927054im    -0.177753+0.0584056im   -0.00232337+0.156269im      -0.253579-0.091913im      0.350926+0.0388598im     0.183604+0.15173im     -0.0644125-0.0723207im    -0.176658+0.125123im      0.121768+0.103996im       0.103261+0.19564im      0.0717448+0.039186im     -0.0632067+0.0313801im    -0.0644208+0.144013im      -0.0864525+0.0562064im    -0.202106-0.103442im        0.091114+0.00329777im    0.00604191-0.190741im      0.298109+0.0333834im    0.0825584-0.0741429im    -0.00213969-0.0520929im    -0.0551332-0.185892im     0.0528469+0.0902767im     0.0308672+0.158804im    -0.0306797+0.021104im      -0.104215+0.211965im      0.0217539+0.00681362im    0.116843-0.0963826im  -0.0177584-0.145471im     -0.212795+0.210464im    -0.0361917+0.00933636im  -0.00320958-0.111924im   -0.0502049-0.114294im
   0.151341+0.0716064im    -0.102102-0.0114233im    -0.0629484+0.0123722im      0.162581+0.113388im      0.013459+0.0391324im   0.00219601+0.187251im      0.178946+0.0814083im   -0.0958914+0.0817459im   0.00135617-0.155971im       0.260995-0.106796im    -0.0734809+0.027203im       0.156566+0.0832294im      0.198972+0.0893732im      -0.066029+0.155808im    -0.0598013-0.119993im       -0.131152+0.00199799im     -0.244176-0.0114554im   -0.0902081+0.0902019im   -0.0958415-0.14251im      -0.00696319-0.0274585im      -0.15731-0.135702im     -0.287615-0.00382288im   -0.0156832+0.00219342im   0.0592253-0.00507213im      0.11786-0.196421im     -0.0836199-0.188345im     0.0545996+0.171647im   0.00420242+0.0160897im    -0.262849+0.0962203im   -0.0880146+0.261614im       0.125422+0.135379im     0.126646-0.074687im
   0.289536-0.0569451im    -0.126281-0.136738im      0.0146785-0.0666295im    -0.0998188-0.0630751im     0.104999+0.098606im      0.152766-0.124385im     0.0892638-0.01457im        0.15729+0.0272699im    -0.114471-0.124701im      -0.139823-0.0495287im     0.105831+0.200836im     -0.0638763+0.0495261im    -0.0696459-0.179167im      -0.0745545-0.101589im     0.0155033-0.000978199im     0.049213-0.0227601im     -0.0348514+0.0502952im    0.0462074+0.0920812im   -0.0145147-0.0470719im      -0.045849+0.119922im      -0.454558+0.07769im      -0.106421-0.105345im       0.123728+0.0260382im    -0.114116+0.0361759im   -0.00111433+0.000900221im    0.149005+0.137647im     -0.278708-0.0501725im    0.150289+0.0411348im    -0.112866+0.0191531im    -0.303549-0.114255im      -0.167428+0.0965786im  -0.0132255+0.0399576im
  0.0274583-0.0569667im   -0.0537763-0.0331531im    0.00571223-0.0618904im    -0.0332928+0.0561243im  -9.65184e-5-0.172125im      0.129221+0.0372775im   -0.0414564+0.0924728im   0.00559567-0.0839033im     0.252061+0.161932im     -0.0153445-0.047992im      0.326188+0.0528096im     0.0785467-0.103472im       0.156266-0.103226im       0.0968031-0.0620246im     0.186783-0.0547205im     -0.0567837+0.204226im        0.244966-0.0831051im    -0.054254-0.0567159im    -0.161942-0.308084im        0.293089+0.0796913im    -0.0267273-0.160889im     0.0102303+0.115491im      -0.270292+0.1438im      -0.0137575-0.234746im     0.00373081-0.0907878im     0.0194711+0.00890211im  -0.0828953+0.0490301im   0.0107189-0.0444072im     0.168421+0.0063537im    -0.141545+0.0599972im    -0.0678892-0.0145696im   0.0953963-0.0882381im
  0.0854562-0.238322im    -0.0136756+0.0666695im      -0.22451+0.00764433im    -0.108112+0.0545984im    -0.299996+0.291863im    -0.0841268+0.0622908im   -0.0428773-0.0623525im    0.0470215+0.0946364im   -0.0936637+0.188597im       0.167134-0.118015im     0.0696658-0.114264im        0.18929-0.00893695im    0.0383657+0.113102im       0.0302941-0.172795im     0.0362401-0.0109146im     -0.0746048+0.0823028im      0.0130769-0.0443389im   -0.0830029-0.241065im     0.0556916-0.0543184im      -0.051075+0.121391im     -0.0664523-0.148914im      0.219371+0.00309278im   -0.0241696+0.0557716im   -0.0764065+0.228215im      -0.138209+0.0426953im     0.0967087+0.0713238im    -0.109527-0.169364im   0.00716552+0.20224im     -0.0732699+0.0850853im     0.015525+0.190806im       0.120596+0.123327im    -0.197517+0.0487432im
 -0.0171737+0.0356688im   -0.0868646+0.00509224im   -0.0297386-0.265529im      0.0223967-0.120064im     -0.111598-0.0712013im     0.012485+0.0246326im    0.0945036-0.127725im     -0.105767-0.107124im      0.116911+0.000847853im    -0.21717-0.112128im      0.223122-0.0393605im     0.0846021+0.0495812im    -0.0509076+0.0183514im    -0.00896623+0.0530984im   -0.0443096-0.0772156im      0.0175611-0.203304im       -0.132924-0.0129383im   -0.0668492-0.0775303im     0.046817+0.0309311im       0.180171+0.0726135im     -0.221393-0.00831837im    0.184242-0.087481im      -0.177446-0.0845233im     0.225674+0.233596im       0.114266+0.0486333im     -0.197435-0.0923575im     0.319397+0.0491102im    0.036969+0.0173204im     -0.10188+0.00264182im   -0.173755-0.12175im       0.0451935-0.248561im    -0.187847+0.14515im
 -0.0501994-0.100825im     -0.125469+0.235957im       0.107547+0.0141991im      0.111626-0.0376683im    -0.100312+0.134659im      0.285869-0.151719im    -0.0116653+0.147781im    -0.0315713-0.0510284im   -0.0826039-0.0961527im      0.139536-0.0951923im    -0.147581+0.0950282im      0.144321+0.352398im     -0.0625504+0.00687427im   -0.00134865+0.0295095im    0.0899677+0.0306217im     -0.0642951+0.140559im       0.0992837-0.0148247im    0.0300514+0.0830597im    -0.194147+0.0691538im       0.147935+0.0590115im     0.0674606-0.0702849im     0.208601-0.065234im      0.0623579-0.126807im     0.0612581+0.152483im       -0.10231+0.123562im      0.0402448+0.0235264im      0.17832-0.11203im      0.109675-0.117822im     0.0256598-0.0739212im   -0.0735514+0.0372157im     -0.147515-0.0514327im    0.380247+0.0593835im
  0.0189575+0.0738723im    0.0781963-0.179942im       0.233183-0.121354im      0.0697573+0.0515733im   -0.0319588+0.0379832im    0.0523348+0.059712im    -0.0420093-0.0646548im     0.029928-0.0530218im   -0.0230673-0.0557332im      0.106208+0.156909im      0.244444+0.142792im      0.0298928-0.118011im       0.213817+0.176433im        -0.02629+0.0516415im    -0.190925-0.148738im        0.157111-0.172828im       0.0629023-0.152466im    -0.0151863+0.11366im      -0.285665+0.040683im       0.0617506+0.00809243im     0.137469+0.191588im      0.127974+0.0644868im      0.032826-0.184547im     0.0555708-0.0837476im    -0.0998792+0.135082im      -0.146323+0.128142im     -0.116762-0.218344im     0.112737+0.262391im     -0.120344+0.0104037im     0.029403+0.0759434im     0.0907477+0.139659im    0.0801374+0.140127im
   0.164564-0.0970135im   -0.0569397+0.172786im      -0.161029+0.18667im      -0.0544488+0.105785im      -0.13967+0.00788979im   0.0498547+0.00751179im    0.244417+0.0589696im    -0.128772+0.0347271im   -0.0183017+0.0771748im    -0.0422062+0.118034im     0.0621709+0.11073im      -0.0350241-0.0088219im    -0.0676215+0.0406541im       0.399364+0.331246im    -0.0470991+0.14517im         0.278125+0.0136343im       0.107024-0.113484im     0.0729916+0.0784433im    0.0773953+0.020035im        0.136718-0.0307605im     0.0341006-0.0342168im   -0.0383904-0.119821im       0.158757+0.0913314im    0.0695616+0.102851im       0.162741-0.0894802im     -0.125058+0.0196003im    -0.205295+0.0641048im   0.0431985+0.177155im      0.097701-0.0814115im    0.0128569-0.104561im       0.181899-0.0861875im   0.0775172+0.0621861im
  0.0857955-0.00408804im  -0.0530232+0.015894im      0.0185863-0.158478im      0.0830128+0.0810354im     0.102203+0.012531im    -0.0142566+0.127592im    -0.0930203-0.212482im     -0.112298-0.00704706im  -0.0602503+0.208036im     -0.0419049+0.0813318im    -0.135518+0.058524im        0.10271-0.0113783im      0.182504-0.0336943im      0.0365138+0.00767322im    0.194759+0.104532im       -0.086363-0.0305086im       0.154525-0.0867501im   -0.0586741-0.104724im     -0.157486+0.223666im         0.15928-0.0765537im     -0.029033-0.0304087im    -0.220615-0.197919im       0.334154+0.088679im     -0.156779-0.106347im      0.0576195+0.140365im      0.0898233-0.0423144im     0.343525-0.0315869im    0.100052+0.0897311im     0.133254+0.120701im     -0.117722-0.115347im      0.0679865+0.158689im     -0.14155-0.00920925im
   0.138988+0.0880121im     0.153445+0.0963185im     0.0578277-0.0370524im      0.185206+0.0507171im   -0.0529933+0.141888im    0.00232902-0.0521593im     0.077608-0.139226im      -0.10919+0.00553078im  -0.0329687+0.0496688im     -0.025399+0.198517im     -0.183951-0.0649622im      0.012694+0.23678im      -0.0700907-0.138113im       -0.182949+0.130282im     -0.019554+0.0293039im      0.0784982-0.191191im      -0.0330499-0.121141im     0.0400658+0.0977611im   -0.0456663-0.0916828im       0.253544+0.0150868im    -0.0118067-0.135613im    -0.0451582+0.15837im       -0.177769-0.125418im     0.0360836-0.0571987im     -0.106824-0.133306im       0.184265-0.170078im     -0.229935-0.168525im    0.0727891-0.00682803im    0.202123+0.16777im      0.0837028+0.0538687im     -0.124086-0.118763im      -0.3031-0.0277382im
 -0.0806223+0.147963im    -0.0591185-0.064502im       0.159554-0.141462im     -0.0281718+0.0257466im    -0.110677+0.254366im    -0.0231678-0.254359im    -0.0806705-0.0916042im   -0.0331019-0.0856845im    0.0483205-0.024662im       0.193295-0.151951im     0.0204117+0.0817473im     -0.194138-0.25682im       0.0367839-0.0263828im     -0.0841143+0.104282im    -0.0649835-0.0174031im     -0.0493991-0.079046im        0.216883+0.102244im      0.198731+0.143017im      0.229148-0.194352im        0.121778-0.1786im       -0.0148642-0.143556im     -0.048801+0.00662137im     0.164776+0.0484648im    0.0767931+0.272348im      0.0115998-0.109684im     -0.0532715+0.125533im      0.110303+0.0968682im  -0.0429683-0.0367607im     0.214396+0.0547209im   -0.0489338+0.159539im     -0.0314987+0.142083im   -0.0430333+0.0390757im
 -0.0807544-0.107739im    0.00650593+0.0681757im     0.0806719+0.117287im       0.252864+0.212697im     -0.141608-0.127497im      -0.13287-0.0107448im    -0.111847+0.287854im     -0.398028-0.111408im    -0.0648081+0.160747im      0.0414671+0.07986im      0.0498249+0.141852im      0.0501791-0.0805787im    0.00316971-0.349653im      -0.0793731-0.0364011im   -0.0493004-0.0451689im     -0.0807226-0.00890499im    -0.0756815+0.00403986im    0.153836-0.0221777im     0.233081-0.000845763im   -0.0554459-0.00259062im    -0.208558+0.0807352im     0.140066-0.0926512im     0.0657218-0.00643033im   0.0876135-0.179993im      -0.186744+0.0334097im    -0.0361138+0.0469492im    0.0208301+0.060416im    0.0117439+0.145938im     -0.135547+0.0947897im    0.0315316-0.0434831im    -0.0912151+0.0363364im   0.0143724+0.0408631im
   0.112007+0.149266im     0.0756447+0.151452im      0.0740348-0.0882327im    -0.0526088-0.115112im    -0.0279563-0.203453im    -0.0219473+0.166501im     -0.142141-0.0597776im    0.0924498-0.12327im     -0.0270347-0.0263691im      0.105167-0.00248727im    0.103488-0.14841im      -0.0131856-0.0756808im     -0.193564+0.150917im      -0.0714226+0.135936im      0.354042-0.0795178im        0.12733-0.10379im        -0.144793+0.0392083im   -0.0104558+0.0150068im     0.172247+0.0345953im      -0.041812+0.00674043im    -0.178003-0.0443481im    0.0311438+0.0560298im     0.0677462+0.204845im      0.131328+0.0335953im     -0.153849-0.0461156im      0.120604-0.0344962im    0.0200711-0.0754556im    0.311455+0.163252im      0.110804+0.0891039im     0.159213-0.00754998im     0.028726+0.0547768im    0.312878-0.137537im
   0.137107+0.109371im      0.122324+0.0784436im     0.0312863+0.0211167im     -0.143725-0.0529784im     0.146205-0.0467795im    -0.238957+0.278783im     0.0512662+0.290419im      0.190852+0.154913im    -0.0506383+0.0084402im     0.0796943+0.0158752im   -0.0532914+0.0391003im     -0.154073+0.0916353im     0.0487726-0.0513614im       0.144942-0.261598im     -0.120124+0.01846im      0.000906178+0.0231054im     -0.0949381+0.0309597im    0.0400937+0.172995im      0.124288+0.156397im        0.468253+0.0399585im    -0.0582989+0.0755436im     0.216562-0.00821352im    0.0117431-0.0418084im    0.0408246+0.0258218im     -0.011296-0.00658602im   -0.0393013+0.0474174im     0.116732+0.0403895im   0.0195698-0.0393496im     0.121111-0.0155761im   -0.0671537+0.169566im    -0.00323392+0.151273im   -0.0798378-0.0281491im
  0.0156206-0.0633137im    0.0452368+0.116849im       0.122324-0.229847im       0.265607+0.251448im       0.10776+0.0444344im     0.104255-0.12154im      -0.106135-0.0797582im   -0.0301031+0.13559im      -0.038158-0.0732754im     -0.166981-0.086325im       0.11433+0.00899878im  -0.00697612+0.1472im       -0.0970221+0.120463im        0.176505-0.0895216im    -0.106647-0.0656706im      0.0568296-0.0230754im     -0.0543929+0.100079im     -0.189106+0.195756im      0.286006-0.0403571im      0.0462176+0.0321714im     0.0728156-0.0824071im    0.0715035+0.12285im     0.000229566+0.2858im      -0.0519976-0.166211im     0.00943419+0.0500222im      0.186299-0.0282767im   0.00737673-0.0623726im    -0.15885-0.113409im    -0.0843941+0.00796944im  -0.0163432-0.0586814im      0.275179+0.148566im    0.0469866+0.183755im
   0.020923+0.072923im     0.0118852+0.057763im       0.110587+0.117919im      0.0144224-0.118312im     -0.263933-0.0444083im   -0.0550461+0.097261im    -0.0524702-0.138939im     -0.027894+0.0669721im    -0.120556-0.2639im        -0.188831+0.108992im      0.120244+0.131504im     -0.0463589-0.00695337im    0.0423018+0.0938646im     -0.0520407-0.120027im    -0.0640657-0.105507im       -0.137253+0.375562im       0.0671205+0.0429314im     0.108054-0.131645im    -0.0246918+0.0969632im      0.0117284-0.211728im      0.0176163-0.186834im      0.103611+0.109598im       0.129254-0.0665388im     0.221823-0.0737777im      0.233471+0.0625611im      0.151354-0.143583im     -0.145064+0.173006im     0.195306-0.0675092im   -0.0144721+0.172274im    0.00816429-0.0498061im     0.0250653+0.0201564im  -0.0684827+0.11235im
 -0.0981635-0.0448115im    -0.122306+0.0756759im    0.00704336-0.126924im     -0.0696734+0.0143303im    -0.209651+0.0807962im   -0.0587352+0.0613263im     0.207535-0.00223872im    0.200166-0.0359208im     0.281878+0.311924im      -0.166467-0.0019947im    -0.035573-0.0360315im    -0.0839431-0.0573936im     0.0605584+0.106439im       0.0231969+0.0671123im    -0.117956-0.0166373im        -0.1161-0.11202im       -0.0382994+0.02367im       0.155554-0.00284553im  -0.0137791+0.165026im       0.0639333+0.0653837im     -0.184202-0.098127im    -0.0121251+0.14212im        0.157428-0.128878im     -0.100759-0.156636im      0.0319735-0.147878im       0.102228-0.112325im    -0.0119344-0.0818499im   -0.113821-0.112332im     -0.149227+0.0101009im     0.246006-0.0824797im     -0.205919+0.146797im     0.246053+0.179266im
  0.0901724+0.011657im       0.11491-0.15635im       -0.122391-0.28464im       -0.167237+0.292496im     -0.114699-0.0630206im    0.0381189-0.0195398im    -0.183018-0.0373344im   -0.0341739+0.347271im      0.195445+0.0315134im    -0.0945988+0.123708im     -0.166794+0.0169087im      0.230687+0.0115941im     -0.167406-0.0659754im      -0.138067-0.0232585im   -0.0567898+0.144557im       0.0994995+0.103271im       0.0564501+0.027936im    -0.0264845+0.097439im    -0.0382515-0.00146366im     0.0498012+0.0254224im    -0.0678647-0.0406813im   -0.0362628+0.155198im      0.0447416-0.145385im      0.134672+0.0852779im     0.0103106+0.100523im     -0.0540545+0.253582im     0.0277104+0.267386im    0.0833561+0.0117392im   -0.0913228-0.0190125im     0.152649-0.0111565im     0.0177093-0.0223094im    0.116843-0.158225im
    0.16025+0.221017im    -0.0555389-0.0343768im    -0.0990785+0.197352im       0.177127-0.244527im     0.0151636-0.0144183im     0.236545+0.0513562im   -0.0792705-0.120284im     -0.219479+0.00422255im  6.79121e-5+0.074372im       -0.09946-0.0367394im    -0.083394+0.0615773im     0.0513321-0.113344im       0.170842+0.0356894im     -0.0654456+0.0129081im   -0.0486453+0.0972026im       0.191892-0.156489im      -0.0455725+0.0826065im   -0.0782099-0.29093im       0.127723-0.027404im        0.152079+0.0506318im    -0.0212354+0.101754im      0.156889+0.140572im       0.076448-0.0379188im   -0.0370734-0.0039499im     0.0975241+0.0516189im      0.276238+0.126523im     -0.010454+0.133916im    -0.146509-0.0229519im   -0.0368938-0.266446im     0.0234932+0.243661im     -0.0714607+0.0479223im    0.106295-0.02226im
  -0.100529+0.217451im      0.125726-0.0688593im     0.0107254-0.097913im       0.101345+0.134468im    -0.0505066-0.0736195im    0.0913331+0.158784im      0.103151-0.136987im      0.118883+0.0582219im    -0.142805+0.0764561im     0.0785162+0.224434im     0.0451904+0.111676im      -0.118062-0.019482im     0.00281656-0.107787im        0.258346+0.0992762im   0.00703322-0.136883im       -0.230087+0.0220025im       0.242118-0.0953777im    -0.117447+0.0493638im   0.00670646+0.0810782im      -0.134976+0.0251963im     -0.226621+0.0984139im    0.0463029-0.177357im     -0.0917033+0.0741554im   -0.0162077+0.231908im      -0.063909+0.118479im       0.208456-0.0281483im   -0.0396164+0.0548845im   -0.144639-0.148753im    -0.0619368+0.0121252im     0.120894+0.23558im       -0.049923-0.244158im    0.0571148-0.045117im
 -0.0496333-0.286072im     0.0674987+0.133624im      0.0206769-0.0937074im    -0.0410417-0.057262im    -0.0627651-0.0988563im    -0.261617+0.163121im     -0.117412-0.228495im     0.0188359+0.0163963im     0.163163-0.239602im       0.140125-0.115848im    -0.0930293+0.129823im       0.102725+0.0356053im      0.137462-0.171647im      0.00590274+0.0515906im    -0.332871-0.0998015im       0.204788-0.0148987im       0.154203+0.0409006im     0.121284+0.0124414im    0.0554775-0.0563774im     -0.0586273+0.160132im      0.0371404+0.0749803im   -0.0694128-0.133279im      -0.114132+0.111621im    -0.0899263+0.00135922im     0.117353-0.0648476im       0.26375-0.0811833im     0.104698-0.0511351im    0.155007+0.076184im     0.0384599-0.183629im     0.0215907+0.00603124im    -0.118265-0.0712618im   0.0649987-0.000532996im
  0.0506525-0.0137564im    -0.127448+0.156199im       0.190926-0.223635im       0.132581+0.0698486im    0.0351708+0.0834373im     0.110539+0.0387014im   -0.0850186+0.168309im     0.0111264-0.0728599im     0.150983+0.164621im       -0.20976+0.0377115im    -0.174952+0.212155im      -0.101851-0.0728529im    -0.0625496+0.284961im       0.0106208-0.10327im      -0.136031+0.178694im      -0.0619747+0.0727771im     -0.0505872-0.00683972im   0.0166189-0.0433284im   -0.0203706+0.0745994im      -0.217778-0.0968065im     0.0422944+0.103377im       0.09576-0.0287982im     -0.105733+0.164756im    -0.0489921+0.0473779im      0.068749-0.168994im     -0.0801142-0.100711im    -0.0666939+0.0151088im    0.243062+0.160767im     0.0196656-0.0721724im   -0.0995288+0.261307im     -0.0978427-0.113827im    -0.122527-0.221225im
   0.025799+0.0407504im   -0.0631667-0.0618868im      0.121224-0.216288im      -0.136827+0.0118578im   -0.0342092+0.0149225im    0.0546502+0.0499056im    0.0564751-0.0956257im   -0.0405328+0.0510625im    0.0320414-0.0559884im    -0.0385335+0.0333295im    -0.215758-0.0359888im     0.0763731-0.308123im      0.0633026-0.153937im         0.15091+0.0342502im     0.255369+0.0481247im      0.0867147+0.212014im       -0.343856-0.11797im       0.277583+0.0768823im   -0.0405171-0.139739im      -0.0281762+0.141774im       0.211232+0.115646im      0.184193-0.128859im      0.0832315-0.0502738im     0.101992-0.0189809im     -0.147612-0.0932043im      0.177104-0.147876im    -0.0277595-0.0351366im   -0.119722-0.103862im    -0.0726637+0.00437877im   -0.153631+0.0522876im      0.117181-0.0383393im  -0.0261556+0.121483im
  -0.179992+0.105151im     -0.248112-0.183765im       0.166586+0.115401im     -0.0276175+0.0584587im  -0.00961553+0.163718im    -0.0218649-0.0683085im    -0.111414-0.0345908im    0.0626319-0.049875im     0.0167204-0.0919085im    -0.0635076+0.249035im      0.128448-0.100356im        0.16261+0.173339im     -0.0141974-0.0762984im       0.157648+0.0657395im    0.0978442+0.034859im      -0.0641282+0.085468im        -0.13528+0.214925im      0.187817+0.0133081im    0.0834979-0.0689721im      0.0918746+0.167859im      -0.152978-0.0451136im   -0.0556724-0.049777im     0.00148809-0.0143204im    -0.120494-0.105359im       0.175563+0.114357im     -0.0945114-0.0399139im    0.0567401-0.137589im     0.157225+0.0605031im    0.0228849-0.297138im      0.249461+0.202087im       0.128453+0.0138851im   -0.136145-0.107073im
  0.0194492+0.0785915im    -0.167173+0.0996951im     0.0577843+0.061346im       0.002131-0.0922521im    -0.201532-0.115805im    -0.0442983-0.207058im      0.109273-0.054159im      0.127641+0.0877948im    0.0291313+0.0646644im      0.163132+0.164348im     -0.150754+0.0644455im    -0.0663342-0.110155im      0.0598455-0.037941im       -0.164397-0.171362im     -0.169743+0.196409im      -0.0407688-0.0638777im      0.0752502-0.0477251im    -0.040949-0.100436im    -0.0204593+0.052263im       0.0167445+0.108612im      -0.145026+0.00766824im   -0.157753+0.0391862im     -0.100271+0.194808im      0.286752-0.0857459im     -0.225287+0.141634im      -0.061614-0.13346im     -0.0229774-0.10047im     0.0398487-0.148819im     0.0321352-0.219223im     -0.120195-0.0716511im      0.381741+0.0194406im   0.0594071-0.0219718im
  -0.140601+0.0936494im    -0.218756-0.142957im     -0.0807249+0.0499005im    -0.0575642+0.0763328im    -0.133694-0.0995296im    -0.132592-0.114201im    -0.0322504-0.14134im      -0.118574+0.255976im     -0.148183+0.0244581im     -0.104062-0.193982im     -0.115815+0.22104im       -0.114509+0.170589im       0.186254+0.164298im      -0.0857439-0.115533im      0.196763-0.0632416im      0.0929554-0.0208509im     -0.0337782-0.268851im     0.0502045+0.0128789im     0.115226-0.0921556im       0.120567-0.0644877im    -0.0520315+0.242648im     0.0573769-0.0629928im     -0.162374+0.0756084im    -0.237438+0.0164451im    0.00473751-0.0968587im     -0.149013-0.0279432im   -0.0371127-0.0330374im    0.146854-0.103399im     0.0423434+0.128633im      0.186486-0.0298008im     0.0160474-0.0375026im    0.132479+0.0431625im</code></pre><p>and then generate the state <span>$ψ$</span></p><pre><code class="language-julia hljs">psi = P[:, 3]</code></pre><pre><code class="nohighlight hljs">32-element Vector{ComplexF64}:
  -0.09834199962731499 + 0.061639425636755486im
  -0.18638674320212048 - 0.06864692756417577im
   0.05725665470412761 - 0.0818547705965531im
  -0.07077238932411138 - 0.11363132927781856im
  0.006697857462136265 - 0.03019580152837227im
  0.022275275936123988 + 0.23817352683491266im
   0.13239419810402064 - 0.08568592601680315im
   -0.1829986586754388 + 0.10065620779376318im
  -0.05283102190020753 + 0.044694060430233926im
   0.14091677589262647 - 0.15610559918230055im
   0.02053361816991751 - 0.15746525285907734im
  -0.17247229304549827 + 0.08749753686680271im
  -0.00851421552934401 - 0.016366446119255876im
  -0.11208576527590186 + 0.18783834077360623im
  -0.05306095052747122 - 0.1388772250530108im
    0.4129060761390007 + 0.0im
   0.22069668461912273 + 0.1368639151378312im
   0.07895942779940808 + 0.0841449370716279im
    0.1789363447415288 - 0.13732275318040532im
   0.06820155627779909 - 0.06564067858271441im
   0.06135542245648608 - 0.07563065826674692im
   -0.1699693213926924 - 0.09462614576497196im
  -0.03345868239977445 - 0.039357528666556715im
  -0.06793739155197187 - 0.036550299386676185im
   0.10954807568630971 + 0.10735767237846221im
 -0.020481621227707254 - 0.037670142348027846im
  -0.07653222866137217 + 0.0682845186666599im
 -0.059195132851422194 + 0.13808828282020952im
  -0.13132251852752103 - 0.07983406173269222im
  -0.17186878201572842 - 0.11595740338768298im
  -0.13088152876860246 + 0.17772996417283946im
    0.1886667108875171 + 0.18487920029303495im</code></pre><p>In the phase estimation process, we will feed the state to circuit and measure the first <code>n</code> qubits processed by iQFT.</p><pre><code class="language-julia hljs">r = join(ArrayReg(psi), zero_state(N))
r |&gt; PE(N, M, U)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 8/8
    nlevel: 2</code></pre><p>Since our phase can be represented by 3 qubits precisely, we only need to measure once</p><pre><code class="language-julia hljs">results = measure(r, 1:N; nshots=1)</code></pre><pre><code class="nohighlight hljs">1-element Vector{DitStr{2, 3, Int64}}:
 011 ₍₂₎</code></pre><p>Recall that our QFT&#39;s bit numbering is reversed, let&#39;s reverse it back</p><pre><code class="language-julia hljs">using BitBasis
estimated_phase = bfloat(results[]; nbits=N)</code></pre><pre><code class="nohighlight hljs">0.75</code></pre><p>the phase is exactly <code>0.75</code>!</p><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../1.prepare-ghz-state/index.html">« Prepare Greenberger–Horne–Zeilinger state with Quantum Circuit</a><a class="docs-footer-nextpage" href="../3.grover-search/index.html">Grover Search »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.4.1 on <span class="colophon-date" title="Wednesday 22 May 2024 17:58">Wednesday 22 May 2024</span>. Using Julia version 1.10.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
