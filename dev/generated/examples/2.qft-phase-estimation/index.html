<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Quantum Fourier Transformation and Phase Estimation · Documentation | Yao</title><script data-outdated-warner src="../../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.044/juliamono.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script><link href="../../../assets/indigo.css" rel="stylesheet" type="text/css"/><link href="https://yaoquantum.org/assets/favicon-light.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../index.html"><img src="../../../assets/logo.png" alt="Documentation | Yao logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../../index.html">Documentation | Yao</a></span></div><form class="docs-search" action="../../../search.html"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../../index.html">Home</a></li><li><a class="tocitem" href="../../../quick-start.html">Quick Start</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../../../man/registers.html">Quantum Registers</a></li><li><a class="tocitem" href="../../../man/blocks.html">Blocks</a></li><li><a class="tocitem" href="../../../man/symbolic.html">Symbolic Computation</a></li><li><a class="tocitem" href="../../../man/automatic_differentiation.html">Automatic Differentiation</a></li><li><a class="tocitem" href="../../../man/simplification.html">Simplification</a></li><li><a class="tocitem" href="../../../man/bitbasis.html">BitBasis</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../1.prepare-ghz-state/index.html">Prepare Greenberger–Horne–Zeilinger state with Quantum Circuit</a></li><li class="is-active"><a class="tocitem" href="index.html">Quantum Fourier Transformation and Phase Estimation</a><ul class="internal"><li><a class="tocitem" href="#Quantum-Fourier-Transformation"><span>Quantum Fourier Transformation</span></a></li><li><a class="tocitem" href="#Wrap-QFT-to-an-external-block"><span>Wrap QFT to an external block</span></a></li><li><a class="tocitem" href="#Phase-Estimation"><span>Phase Estimation</span></a></li></ul></li><li><a class="tocitem" href="../3.grover-search/index.html">Grover Search</a></li><li><a class="tocitem" href="../4.shor-algorithm/index.html">Shor&#39;s Algorithm</a></li><li><a class="tocitem" href="../5.shor-9-code/index.html">Shor&#39;s 9 qubit code</a></li><li><a class="tocitem" href="../6.quantum-circuit-born-machine/index.html">Quantum Circuit Born Machine</a></li><li><a class="tocitem" href="../7.variation-quantum-eigen-solver/index.html">Variational Quantum Eigen Solver</a></li></ul></li><li><a class="tocitem" href="../../../performancetips.html">Performance Tips</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href="index.html">Quantum Fourier Transformation and Phase Estimation</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="index.html">Quantum Fourier Transformation and Phase Estimation</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/QuantumBFS/Yao.jl/blob/master/docs/src/examples/2.qft-phase-estimation/main.jl" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><p><a href="https://mybinder.org/v2/gh/QuantumBFS/Yao.jl/gh-pages?filepath=dev/generated/examples/2.qft-phase-estimation/main.ipynb"><img src="https://mybinder.org/badge_logo.svg" alt/></a> <a href="https://nbviewer.jupyter.org/github/QuantumBFS/Yao.jl/blob/gh-pages/dev/generated/examples/2.qft-phase-estimation/main.ipynb"><img src="https://img.shields.io/badge/show-nbviewer-579ACA.svg" alt/></a> <a href="https://minhaskamal.github.io/DownGit/#/home?url=https://github.com/QuantumBFS/tutorials/tree/gh-pages/dev/generated/examples/2.qft-phase-estimation"><img src="https://img.shields.io/badge/download-project-orange" alt/></a></p><h1 id="example-qft"><a class="docs-heading-anchor" href="#example-qft">Quantum Fourier Transformation and Phase Estimation</a><a id="example-qft-1"></a><a class="docs-heading-anchor-permalink" href="#example-qft" title="Permalink"></a></h1><p>Let&#39;s use Yao first</p><pre><code class="language-julia hljs">using Yao</code></pre><h2 id="Quantum-Fourier-Transformation"><a class="docs-heading-anchor" href="#Quantum-Fourier-Transformation">Quantum Fourier Transformation</a><a id="Quantum-Fourier-Transformation-1"></a><a class="docs-heading-anchor-permalink" href="#Quantum-Fourier-Transformation" title="Permalink"></a></h2><p>The Quantum Fourier Transformation (QFT) circuit is to repeat two kinds of blocks repeatly:</p><p><img src="assets/qft.png" alt="qft-circuit"/></p><p>The basic building block control phase shift gate is defined as</p><p class="math-container">\[R(k)=\begin{bmatrix}
1 &amp; 0\\
0 &amp; \exp\left(\frac{2\pi i}{2^k}\right)
\end{bmatrix}\]</p><p>Let&#39;s define block <code>A</code> and block <code>B</code>, block <code>A</code> is actually a control block.</p><pre><code class="language-julia hljs">A(i, j) = control(i, j=&gt;shift(2π/(1&lt;&lt;(i-j+1))))</code></pre><pre><code class="nohighlight hljs">A (generic function with 1 method)</code></pre><p>Once you construct the blockl you can inspect its matrix using <code>mat</code> function. Let&#39;s construct the circuit in dash box A, and see the matrix of <span>$R_4$</span> gate.</p><pre><code class="language-julia hljs">R4 = A(4, 1)</code></pre><pre><code class="nohighlight hljs">(n -&gt; control(n, 4, 1 =&gt; shift(0.39269908169872414)))</code></pre><p>If you have read about <a href="generated/examples/2.qft-phase-estimation/@ref example-ghz">preparing GHZ state</a>, you probably know that in Yao, we could just leave the number of qubits, and it will be evaluated when possible.</p><pre><code class="language-julia hljs">R4(5)</code></pre><pre><code class="nohighlight hljs">nqubits: 5
control(4)
└─ (1,) shift(0.39269908169872414)</code></pre><p>its matrix will be</p><pre><code class="language-julia hljs">mat(R4(5))</code></pre><pre><code class="nohighlight hljs">32×32 Diagonal{ComplexF64, Vector{ComplexF64}}:
 1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im</code></pre><p>Then we repeat this control block over and over on different qubits, and put a Hadamard gate to <code>i</code>th qubit to construct <code>i</code>-th <code>B</code> block.</p><pre><code class="language-julia hljs">B(n, k) = chain(n, j==k ? put(k=&gt;H) : A(j, k) for j in k:n)</code></pre><pre><code class="nohighlight hljs">B (generic function with 1 method)</code></pre><p>We need to input the total number of qubits <code>n</code> here because we have to iterate through from <code>k</code>-th location to the last.</p><p>Now, let&#39;s construct the circuit by chaining all the <code>B</code> blocks together</p><pre><code class="language-julia hljs">qft(n) = chain(B(n, k) for k in 1:n)
qft(4)</code></pre><pre><code class="nohighlight hljs">nqubits: 4
chain
├─ chain
│  ├─ put on (1)
│  │  └─ H
│  ├─ control(2)
│  │  └─ (1,) shift(1.5707963267948966)
│  ├─ control(3)
│  │  └─ (1,) shift(0.7853981633974483)
│  └─ control(4)
│     └─ (1,) shift(0.39269908169872414)
├─ chain
│  ├─ put on (2)
│  │  └─ H
│  ├─ control(3)
│  │  └─ (2,) shift(1.5707963267948966)
│  └─ control(4)
│     └─ (2,) shift(0.7853981633974483)
├─ chain
│  ├─ put on (3)
│  │  └─ H
│  └─ control(4)
│     └─ (3,) shift(1.5707963267948966)
└─ chain
   └─ put on (4)
      └─ H
</code></pre><h2 id="Wrap-QFT-to-an-external-block"><a class="docs-heading-anchor" href="#Wrap-QFT-to-an-external-block">Wrap QFT to an external block</a><a id="Wrap-QFT-to-an-external-block-1"></a><a class="docs-heading-anchor-permalink" href="#Wrap-QFT-to-an-external-block" title="Permalink"></a></h2><p>In most cases, <code>function</code>s are enough to wrap quantum circuits, like <code>A</code> and <code>B</code> we defined above, but sometimes, we need to dispatch specialized methods on certain kinds of quantum circuit, or we want to define an external block to export, thus, it&#39;s useful to be able to wrap circuit to custom blocks.</p><p>First, we define a new type as subtype of <code>PrimitiveBlock</code> since we are not going to use the subblocks of <code>QFT</code>, if you need to use its subblocks, it&#39;d be better to define it under <code>CompositeBlock</code>.</p><pre><code class="language-julia hljs">struct QFT &lt;: PrimitiveBlock{2}
    n::Int
end

YaoBlocks.nqudits(q::QFT) = q.n</code></pre><p>Now, let&#39;s define its circuit</p><pre><code class="language-julia hljs">circuit(q::QFT) = qft(q.n)</code></pre><pre><code class="nohighlight hljs">circuit (generic function with 1 method)</code></pre><p>And forward <code>mat</code> to its circuit&#39;s matrix</p><pre><code class="language-julia hljs">YaoBlocks.mat(::Type{T}, x::QFT) where T = mat(T, circuit(x))</code></pre><p>You may notice, it is a little ugly to print <code>QFT</code> at the moment, this is because we print the type summary by default, you can define your own printing by overloading <code>print_block</code></p><pre><code class="language-julia hljs">YaoBlocks.print_block(io::IO, x::QFT) = print(io, &quot;QFT($(x.n))&quot;)</code></pre><p>Since it is possible to use FFT to simulate the results of QFT (like cheating), we could define our custom <code>apply!</code> method:</p><pre><code class="language-julia hljs">using FFTW, LinearAlgebra

function YaoBlocks.apply!(r::ArrayReg, x::QFT)
    α = sqrt(length(statevec(r)))
    invorder!(r)
    lmul!(α, ifft!(statevec(r)))
    return r
end</code></pre><p>Now let&#39;s check if our <code>apply!</code> method is correct:</p><pre><code class="language-julia hljs">r = rand_state(5)
r1 = r |&gt; copy |&gt; QFT(5)
r2 = r |&gt; copy |&gt; circuit(QFT(5))
r1 ≈ r2</code></pre><pre><code class="nohighlight hljs">true</code></pre><p>We can get iQFT (inverse QFT) directly by calling <code>adjoint</code></p><pre><code class="language-julia hljs">QFT(5)&#39;</code></pre><pre><code class="nohighlight hljs"> [†]QFT(5)</code></pre><p>QFT and iQFT are different from FFT and IFFT in three ways,</p><ol><li>they are different by a factor of <span>$\sqrt{2^n}$</span> with <span>$n$</span> the number of qubits.</li><li>the <a href="https://quantumbfs.github.io/BitBasis.jl/stable/tutorial/#Conventions-1">bit numbering</a> will exchange after applying QFT or iQFT.</li><li>due to the convention, QFT is more related to IFFT rather than FFT.</li></ol><h2 id="Phase-Estimation"><a class="docs-heading-anchor" href="#Phase-Estimation">Phase Estimation</a><a id="Phase-Estimation-1"></a><a class="docs-heading-anchor-permalink" href="#Phase-Estimation" title="Permalink"></a></h2><p>Since we have QFT and iQFT blocks we can then use them to realize phase estimation circuit, what we want to realize is the following circuit:</p><p><img src="assets/phaseest.png" alt="phase estimation"/></p><p>First we call Hadamard gates repeatly on first <code>n</code> qubits.</p><pre><code class="language-julia hljs">Hadamards(n) = repeat(H, 1:n)</code></pre><pre><code class="nohighlight hljs">Hadamards (generic function with 1 method)</code></pre><p>Then in dashed box <code>B</code>, we have controlled unitaries:</p><pre><code class="language-julia hljs">ControlU(n, m, U) = chain(n+m, control(k, n+1:n+m=&gt;matblock(U^(2^(k-1)))) for k in 1:n)</code></pre><pre><code class="nohighlight hljs">ControlU (generic function with 1 method)</code></pre><p>each of them is a <code>U</code> of power <span>$2^{(k-1)}$</span>.</p><p>Since we will only apply the qft and Hadamard on first <code>n</code> qubits, we could use <code>Subroutine</code>, which creates a context of a sub-scope of the qubits.</p><pre><code class="language-julia hljs">PE(n, m, U) =
    chain(n+m, # total number of the qubits
        subroutine(Hadamards(n), 1:n), # apply H in local scope
        ControlU(n, m, U),
        subroutine(QFT(n)&#39;, 1:n))</code></pre><pre><code class="nohighlight hljs">PE (generic function with 1 method)</code></pre><p>we use the first <code>n</code> qubits as the output space to store phase <span>$ϕ$</span>, and the other <code>m</code> qubits as the input state which corresponds to an eigenvector of oracle matrix <code>U</code>.</p><p>The subroutine here uses <code>focus!</code> and <code>relax!</code> to manage a local scope of quantum circuit, and only activate the first <code>n</code> qubits while applying the block inside the subroutine context, and the scope will be <code>relax!</code>ed back, after the context. This is equivalent to manually <code>focus!</code> then <code>relax!</code></p><p>fullly activated</p><pre><code class="language-julia hljs">r = rand_state(5)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 5/5
    nlevel: 2</code></pre><p>first 3 qubits activated</p><pre><code class="language-julia hljs">focus!(r, 1:3)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 3/5
    nlevel: 2</code></pre><p>relax back to the original</p><pre><code class="language-julia hljs">relax!(r, 1:3)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 5/5
    nlevel: 2</code></pre><p>In this way, we will be able to apply small operator directly on the subset of the qubits.</p><p>Details about the algorithm can be found here: <a href="https://en.wikipedia.org/wiki/Quantum_phase_estimation_algorithm">Quantum Phase Estimation Algorithm</a></p><p>Now let&#39;s check the results of our phase estimation.</p><p>First we need to set up a unitary with known phase, we set the phase to be 0.75, which is <code>0.75 * 2^3 == 6 == 0b110</code> .</p><pre><code class="language-julia hljs">N, M = 3, 5
P = eigen(rand_unitary(1&lt;&lt;M)).vectors
θ = Int(0b110) / 1&lt;&lt;N
phases = rand(1&lt;&lt;M)
phases[0b010+1] = θ
U = P * Diagonal(exp.(2π * im * phases)) * P&#39;</code></pre><pre><code class="nohighlight hljs">32×32 Matrix{ComplexF64}:
  0.0236728-0.301466im     0.0240106-0.00889584im   -0.239794-0.160205im     -0.013746+0.00783152im  -0.00525156+0.0708749im      0.177976+0.186646im      0.191309+0.0641474im       0.109451-0.0384088im    0.0822687-0.0595595im     -0.209922-0.00615639im      0.168476+0.0644869im   0.00916112+0.205261im     -0.0324195+0.0911142im      -0.041238+0.200088im      0.0556679+0.0610468im     0.0116327-0.0234264im     -0.176608-0.105266im       0.262787-0.0635038im      0.292541-0.0418915im    -0.206679+0.0878335im       0.122086+0.0565536im     -0.103144+0.137642im      0.0528743-0.0486771im      0.127202+0.0909031im    0.0442854+0.134285im      0.215643-0.0153623im   0.00583588+0.0250773im     -0.166544+0.101957im       0.0987612+0.173861im     -0.0877453+0.00619926im  -0.0309019+0.028977im      -0.153702-0.04346im
  0.0955159+0.0598604im    -0.202947-0.158216im     -0.208426-0.0559093im    -0.131124+0.272171im      -0.114546+0.00641399im   -0.0671987-0.0930875im    -0.117249+0.0813706im     0.00685506+0.0561696im    -0.129251-0.0962798im     0.0218661+0.0635016im      0.0590199+0.0207202im   -0.0721781-0.0372574im      0.299238+0.0173579im     -0.0566063-0.190663im       -0.18443+0.0374331im      0.108444-0.0541852im     0.0571471-0.0442912im    -0.0669817-0.214673im       0.042808-0.0429855im   -0.0586875+0.0671508im       0.213676+0.0799369im       0.15986-0.361014im      0.0745218+0.0208639im      0.117691-0.00424071im   -0.105738-0.108237im    -0.0184008+0.0656804im     0.058714+0.150883im      -0.117019+0.144782im      -0.0602066+0.108645im      -0.158396-0.0425211im    -0.194477-0.182141im      -0.105316+0.068985im
   0.197522-0.28422im      0.0575167-0.00506002im    0.103886-0.0465078im    0.0646092-0.123714im       -0.10918-0.145953im      -0.122313-0.0446941im   -0.0427974-0.26268im         0.354445+0.0807763im   -0.0713014+0.0136979im     0.0920849+0.0185349im      -0.183886+0.0277546im    -0.121363-0.0600896im    -0.0442835-0.00793918im    -0.0430354-0.142163im    -0.00166265-0.163554im      -0.190205+0.20209im      -0.0419129+0.0313724im     0.0813634-0.265178im      0.0991131+0.0778728im     0.232319-0.0179452im       0.159066-0.0719648im     0.0269821+0.0556546im     -0.257986-0.0604179im    -0.0306254-0.0148181im    0.0706325+0.0181442im     0.216246+0.105563im    0.00103854+0.0589397im      0.143982+0.167534im      0.00985333-0.0236454im    -0.0109619-0.045007im     -0.144262-0.0363189im    0.00770598-0.0191537im
 0.00120795-0.082738im      0.225485-0.198404im     -0.088271+0.177632im    -0.0168852-0.08125im      -0.0918521+0.0405853im    -0.0357855-0.0686765im    -0.160094+0.0596104im      -0.144914+0.1931im        0.142954-0.107079im      -0.043197+0.10094im     -0.000992136+0.042375im    -0.0845974+0.00303599im    -0.108223-0.0304242im      -0.273943+0.0235732im    -0.0070256-0.056492im     -0.0356251+0.038801im      0.0478215+0.0662592im     -0.227467-0.150547im      -0.113702-0.204518im     0.0645722-0.00148485im    -0.0425168+0.0917256im    -0.0851464+0.158201im       0.289601+0.152356im     -0.0122811-0.122216im      -0.10784+0.323764im      0.164432+0.236109im     0.0301304+0.0901058im     -0.111685+0.0564686im      0.0681918-0.0783709im      0.094433+0.070644im      0.110081-0.186279im     -0.0118498-0.0756659im
  0.0862391+0.179963im     0.0770395-0.106994im    -0.0362489-0.117771im      0.148511+0.0931122im   -0.00782801-0.203613im        0.14325-0.138802im     -0.127285+0.0837046im       0.103164+0.0108033im   -0.0449877-0.200475im      -0.122454+0.144573im      -0.0423245+0.0295303im    0.0640444+0.262017im      0.0207698-0.035596im        0.096699+0.0611243im     0.0635764-0.0902732im     0.0526577-0.0395634im    0.00155547-0.0446639im   -0.00233228-0.146218im      0.0668546+0.0647834im     0.121033-0.0441717im    -0.00924509-0.131944im      -0.179911-0.0507419im      0.100094-0.104064im      0.0917538-0.321702im    -0.0547076-0.193634im      0.227706-0.0330086im    0.0591967-0.231391im     -0.0770218-0.283908im       -0.238595-0.121262im      0.0570415+0.00584617im  -0.0253639+0.121014im    -0.00434742-0.188909im
 -0.0857433+0.0141465im    0.0158362+0.0442216im    0.0344006-0.0106067im     0.163992+0.121744im      0.0940668+0.115971im     -0.0114873+0.0254749im    0.0239736-0.0114311im     -0.0656727-0.00139453im  -0.0926937-0.115566im      0.0286134+0.251326im       -0.308809+0.106184im    -0.0703538+0.0277701im     -0.155278-0.288813im        0.184135-0.0446561im     -0.270354+0.198569im     -0.0151623-0.0596258im      0.222941+0.0893372im      0.171364-0.00778532im     0.120047-0.0357384im     -0.16054+0.123442im       0.0277481+0.129082im      0.0128787+0.0166666im    0.00449521+0.229436im      -0.247265-0.0552303im     0.180939-0.0824717im     0.224687-0.0313805im   -0.0323134+0.159899im      0.0885134-0.0940477im      0.0559448+0.153758im      0.0661788+0.0734262im    0.0340843-0.070589im    -0.00582085-0.0745164im
    0.07838-0.0577898im     0.104549+0.0415007im    -0.130219+0.0474699im    -0.254358-0.115467im      0.0161114-0.0814522im      0.059217+0.155855im     0.0752794-0.0977535im      -0.235206+0.244626im     -0.196922-0.100188im      -0.026974-0.17371im         0.174322+0.0124722im    0.0195057+0.284786im      -0.122962-0.0427341im        0.23185-0.0531627im    -0.0832529-0.0456535im    -0.0587259+0.00373089im  0.000279404-0.131567im      -0.185034-0.0659721im     -0.105721+0.0917341im    -0.279517-0.106179im        0.139795-0.147457im     -0.0153089-0.0211191im      -0.17487-0.0346807im    -0.0785565-0.108133im      -0.13823-0.0609261im  -0.00153577-0.0284631im   -0.0496153+0.0850435im      0.241254+0.0488177im     -0.0300131+0.00597342im    0.0709691+0.171394im    0.00837446-0.163764im       0.124218-0.0985227im
    0.10445+0.107338im      0.172449+0.0826228im    0.0908372-0.0194777im    -0.111349+0.128832im        0.15282-0.134806im     -0.0181217-0.0141446im     0.131771-0.144275im       -0.077004-0.224442im     0.0361927-0.00257166im     0.200222+0.0632787im     -0.0299975+0.0921469im   -0.0229399-0.178506im       0.112951+0.302212im       -0.145096-0.103764im       0.112873+0.125983im      0.0178146+0.0667915im     -0.179193+0.0349278im     0.0209373-0.0199476im      0.146906+0.0606936im     -0.25806-0.121268im       -0.174058-0.0402934im      -0.16118-0.091084im       0.137832-0.0446938im     -0.157333-0.280282im      0.128268+0.109678im      0.102728-0.118117im      0.109434+0.103285im      0.0594045+0.109353im       -0.102422-0.0588532im   -0.00744189+0.217185im    -0.0800965-0.132862im     -0.0400884+0.033791im
   0.140287+0.0421913im    -0.124927-0.0199235im   -0.0587591+0.12462im       0.111306-0.100581im      -0.210116-0.157103im      -0.158236-0.101648im    -0.0432959-0.140876im    -0.000386891-0.164083im     -0.126006-0.373082im      -0.262091+0.0425948im      0.0677675+0.0591729im    0.0291554-0.0181079im     -0.195185+0.0029759im     -0.0786876-0.0752139im     -0.124624+0.0779701im     0.0742012+0.125351im      -0.105415+0.206158im       0.132275+0.165063im      -0.177998+0.101748im     -0.122109-0.0383752im      -0.172114-0.0836236im     -0.126288+0.0366426im     0.0779648-0.0302065im      0.211058+0.172126im     0.0264981-0.150108im    -0.0436069-0.0387926im     0.254584+0.0831146im     0.0202206+0.127701im        0.115077+0.0833751im     0.0430098-0.0239277im    0.0535369-0.0368733im     0.0817535-0.0110356im
 -0.0682311+0.0924223im     0.062514-0.0990274im    -0.273894-0.108058im      0.135179+0.109397im       0.185486+0.0514147im    -0.0859159+0.129027im    -0.0248834+0.0256364im       0.109431+0.0468295im   -0.0398577+0.141884im      -0.115422-0.223389im      -0.0106268-0.053949im     0.0201611-0.238455im      -0.112538+0.0977962im     -0.0878039-0.118348im     -0.0837986+0.0360356im     -0.209188-0.00241321im     0.199166+0.191973im      -0.216198-0.152461im     -0.0790744+0.233327im     -0.246737+0.0759264im      0.0341643+0.0495747im     0.0488729+0.143306im     0.00299268-0.0786116im       0.07863-0.0632742im     0.100687-0.142462im     0.0910578+0.00352972im   0.0313252-0.062166im      -0.114775+0.182891im      -0.0639773-0.0964649im   -0.00611559+0.0450778im     0.154472+0.291721im    -0.00404048-0.083315im
  0.0232363-0.0617579im   -0.0928694+0.096313im      0.235758+0.0315388im    -0.127728+0.0719563im      0.210924-0.192056im     -0.0298369-0.174972im    -0.0361013+0.164688im       0.0152509+0.0947811im    0.0894009+0.0469242im   -0.00820811-0.124669im      -0.0523725-0.160198im      0.164919+0.200567im    -0.00226197+0.149539im      -0.0782505-0.00753758im   -0.0499728-0.0759736im     -0.059654-0.0763198im     0.0764228+0.180517im     -0.0736447-0.0586482im       0.16798-0.0382519im    0.0782473-0.11383im        0.0193179+0.25381im       0.0261682+0.0216347im   -0.00894334-0.0346085im    -0.0285855+0.0296298im    -0.156273-0.071771im      0.151978-0.147845im      0.317003+0.0252409im     0.0394484-0.00232363im      0.187634+0.304664im      -0.142963+0.0601826im     0.213496-0.00158069im     0.203589-0.00389631im
 -0.0248027+0.121386im     -0.147358-0.0713076im   -0.0459178+0.0611831im   -0.0416738+0.0757263im    -0.0380863+0.423783im       0.025934-0.23267im      0.0739801+0.0846627im      0.0718699-0.0121974im    0.0815772-0.308508im      0.0121072-0.0910243im       0.143765+0.0861183im   -0.0685349-0.18884im       0.0266942-0.00763104im     -0.149737-0.00393856im     0.129552+0.0649941im    -0.0837412-0.0362213im     -0.152386-0.00741498im    0.0525278-0.16851im        0.127766+0.214466im      0.027797+0.028568im       0.0973514+0.0118124im    -0.0434584+0.0677919im     -0.204516+0.0287667im     -0.161485+0.108892im      -0.14126+0.0110729im    0.0798373-0.161468im     -0.063753-0.0265046im     0.0721836-0.16402im         0.046606-0.159822im      0.0489745+0.0528852im     0.091966-0.110222im       0.304842-0.0927203im
  0.0782557-0.163439im     -0.279726-0.0232668im    -0.043304-0.0485656im    -0.174152-0.0705286im    -0.0241936-0.0902057im    -0.0534526-0.0205115im    -0.173439+0.199395im      -0.0676951+0.0207189im   -0.0240015+0.0209325im     0.0276476-0.130922im        0.130938-0.140263im    -0.0220195-0.246333im      -0.152097-0.13599im         0.107048-0.111101im      0.0492283-0.104072im      0.0306668-0.0186942im     0.0426004-0.169141im       0.212667+0.0739808im      0.157749-0.123809im      0.101283+0.0784618im     -0.0936783-0.150387im       0.119314-0.0411429im     0.0791494+0.0782615im    -0.0401277-0.0359901im     0.205617-0.0179415im     0.090321+0.0083127im     0.148663-0.105635im      -0.105933+0.0632334im     -0.0508247-0.117701im       0.133001+0.469525im     0.0786444+0.0222535im     0.0096323-0.0639159im
   0.348186-0.129302im      0.109219+0.0296503im   -0.0394176+0.00923616im  -0.0534536+0.0634119im     0.0411452+0.0729725im      0.196522-0.0164883im   -0.0888839+0.0985366im     -0.0872598-0.147707im     -0.118533-0.0344837im    -0.0708188-0.103388im      -0.0870184-0.105318im     -0.039228-0.0529363im     0.0298632-0.0944625im      0.0714302-0.253617im      0.0544161+0.152983im      0.0461666+0.163431im     -0.0103411-0.031419im     -0.0124016-0.0216411im     -0.256543-0.0374946im    0.0877398-0.00451197im      0.158325+0.240936im      -0.029113-0.0379161im    -0.0197212-0.0680254im      0.190864+0.0191262im     0.176641+0.336379im     0.0401928-0.302619im    -0.0162969-0.0173329im      0.133457-0.191107im      -0.0984784+0.0319751im     -0.014512-0.0555959im     0.187821+0.0796509im    -0.0779302+0.036694im
  0.0598543-0.132991im    -0.0404783+0.0571518im     0.129842+0.161763im    -0.0847723+0.128653im     -0.0262166-0.0265912im      0.138796-0.0155957im    0.0194125-0.103465im        0.130677-0.0189667im     0.310916+0.105971im       0.167815+0.1234im          0.186818+0.231935im    -0.0178373-0.127937im      -0.163416-0.24409im         0.159006+0.105187im      -0.216513-0.171524im     -0.0397556+0.0192391im       0.15829+0.0314913im     -0.079849-0.215696im        0.09624+0.194036im     -0.128127+0.0630463im     -0.0818918+0.0197084im    -0.0740157-0.0560384im      0.165071-0.118876im       0.235017+0.0400196im    -0.031291+0.106266im     -0.221622-0.172624im     0.0629284-0.0841344im     -0.018426-0.00976607im      -0.12465+0.0753743im     0.0851611-0.0212623im   0.00210367-0.0669062im     0.0520572-0.0337384im
  0.0463782-0.198359im     -0.130931+0.201862im     -0.192332-0.219527im    -0.0291747-0.0679422im      0.140177+0.0265538im      0.118102-0.192868im      0.114857+0.00583005im      0.114082+0.198439im     0.0173065-0.0748028im      0.332565+0.00800045im     0.0480659+0.0921066im    0.0711218-0.0351024im     0.0582465+0.0191735im      -0.051963+0.171034im     -0.0423772+0.0131647im     0.0980909+0.20152im      -0.0391979+0.064077im       -0.03971+0.164594im      -0.234054-0.080966im    -0.0408673+0.186293im       -0.101267+0.129357im      -0.133459-0.0643816im     -0.163204+0.264723im      0.0430167-0.136676im    -0.0212136-0.145583im     0.0124992+0.078111im      0.164988-0.0486914im     0.0205785+0.0520308im      -0.106112-0.117458im     -0.0254006-0.12734im       0.172698-0.0522037im    -0.0903509-0.0990897im
  -0.022399+0.127192im      0.113527-0.0947313im   -0.0696004+0.0717895im    0.0840587+0.249826im       0.130297-0.0107075im     -0.139935+0.123549im     -0.140845+0.0517541im     -0.0263768-0.0922609im     -0.12413+0.148889im      0.0477803+0.22059im         0.200685-0.0127669im     0.103024+0.0650953im     0.0741782-0.00405403im     0.0804541+0.113736im      -0.187215-0.0504219im   -0.00736004+0.278537im      -0.230886-0.301436im      0.0460707-0.140502im     -0.0475648+0.138824im      0.149914-0.108123im       0.0127459+0.170992im       -0.15653+0.0584228im     -0.131442+0.0301333im     -0.131793+0.172171im      0.143994-0.0295024im   -0.0889474+0.18493im       0.155868-0.0881025im   -0.00641108+0.0521626im      0.0977035+0.0021563im     0.0449823+0.0874261im     0.220442-0.0611862im    0.00243362+0.0035516im
 -0.0813552+0.215028im   -0.00430305-0.0207808im   -0.0226193-0.207959im     0.0290603-0.139497im       -0.10915+0.0991352im    0.00417645+0.105178im    0.00596086-0.115339im       -0.171284+0.0110435im   -0.0215785+0.156107im     -0.0258316-0.149187im       0.0378555-0.0886079im     0.193757-0.192463im     -0.0867151-0.0307875im     -0.0446189+0.232007im     0.00506997-0.0696091im      0.113762+0.178309im     -0.0294649+0.114955im     -0.0138445-0.036326im      0.0134217+0.116619im      0.279417+0.128191im       0.0779967+0.00357644im    -0.118548-0.270964im     0.00700403-0.0860859im     0.0616647-0.174234im     0.0533537+0.0252763im     0.118392-0.135288im    -0.0599861+0.217553im     -0.0458454+0.000297158im     0.114151+0.310719im       0.184625-0.0063469im   -0.0351035-0.136636im     0.00228921-0.223549im
 -0.0111264-0.106958im    -0.0574997-0.0907594im    0.0866843+0.210987im      0.215793+0.23782im      0.00292745-0.012331im      -0.186608+0.263031im     0.0692396+0.0812398im      0.0837964+0.198348im     0.0857768-0.0876963im    -0.0892799-0.0583635im       0.102066+0.0949774im     0.123045-0.161446im      -0.165273+0.139252im        0.141935+0.0251035im      0.226313-0.0303662im      0.287119+0.220926im        0.10236+0.0698324im      0.155391-0.116376im     -0.0570922-0.272986im    -0.0472067-0.0713275im     -0.0177545+0.0399777im    -0.0109174-0.0989219im     -0.100213-0.0626159im    -0.0730335-0.118471im      -0.11468-0.0219489im   -0.0511301+0.0112491im   -0.0620758+0.189999im      0.0724655-0.10469im        -0.140598-0.0269843im     -0.185976+0.00895534im   0.0509837+0.0780759im     0.0461648-0.00750704im
  0.0535978-0.0224478im    -0.223234+0.101723im     -0.024504+0.130642im     0.0787128+0.169223im      -0.112794+0.175035im       0.147096-0.0915504im   0.00601159-0.44282im       -0.0514396-0.00515424im    0.122727+0.0408719im     0.0695273+0.00669913im      0.132351-0.129489im      0.052437+0.140813im      0.0523895+0.0319167im      -0.106519-0.0466514im      0.167315+0.0500095im    -0.0790767+0.163885im        0.27256-0.0317089im     0.0419718+0.0793536im    -0.0829764+0.0231661im   -0.0269108-0.376588im        0.093267+0.11016im       0.0857737+0.0444568im      0.054183+0.0357982im   -0.00553825+0.0127122im   0.00139808-0.142253im       0.10839+0.0892313im    -0.063071-0.0567354im     -0.116266-0.0789904im      0.0471654+0.0777603im      0.131392+0.192354im    -0.0228815+0.0530891im     -0.207548-0.0930019im
 0.00482222+0.0482211im   -0.0307779+0.226743im    -0.0120055+0.108132im     -0.146563+0.0812399im     0.0124699+0.0390389im     0.0105219+0.264295im    0.00391626-0.0130496im      0.0414654-0.0213391im   -0.0285546-0.127547im       0.162469-0.0612518im     0.00352944+0.0978392im   -0.0092224+0.0584716im      0.113311-0.160133im       -0.124801-0.258068im     -0.0341958-0.242295im       0.118325+0.0609843im    -0.0948275+0.145429im     -0.0319785+0.0627169im     0.0586885-0.00122978im    0.019252+0.141092im       0.0168699-0.18204im       0.0574067+0.0227265im      0.182392-0.298592im       -0.13784-0.00199903im   0.0837118-0.0767931im    0.0696436+0.115721im    -0.0684711-0.0404877im    -0.0385641-0.152131im        0.284768-0.0626922im     -0.157886-0.132995im      0.281732-0.0229363im     -0.164493-0.196505im
 -0.0286332-0.117984im     -0.354377+0.00852147im   -0.116367-0.119568im    -0.0989041+0.0482198im     0.0739649-0.14142im     -0.00292396+0.0124898im     -0.13444+0.0285781im      -0.123424-0.21417im      0.0379583-0.0233353im     0.0207685+0.0966185im      -0.171325-0.111303im     0.0998236+0.00446057im    -0.180058+0.230539im       0.0277999+0.0900755im    0.00975358-0.11989im       -0.136509+0.0175082im      0.105682+0.117365im     -0.0660246-0.0490173im    -0.0565422+0.0682747im   -0.0239512+0.139065im        0.138621+0.0117499im     -0.379018-0.00266266im     0.080887-0.111568im     -0.0844225+0.224436im     -0.060291+0.0235993im   4.02076e-5+0.151166im     -0.243024+0.0981443im      0.122505-0.194236im      -0.0491222-0.148858im     -0.0446797+0.0764273im   -0.0402767-0.115811im     -0.0666859+0.152793im
 -0.0891664+0.0853436im     0.168117-0.0769871im    -0.239273-0.233734im     0.0732872+0.121815im       0.037816+0.032489im       0.062255-0.175971im     0.0435737+0.12773im        0.0518242+0.0504622im   -0.0624119+0.0635911im      0.195552+0.200142im       0.0249165-0.153662im     -0.225682+0.0637466im     -0.127978+0.00737998im     0.0669475-0.101013im       0.208925-0.10479im        0.190054+0.198371im       0.224503+0.132511im      0.0552047+0.0790147im   -0.00365612+0.0366952im   -0.0763454-0.0755069im       -0.15926-0.247792im      0.0615499-0.0619621im    -0.0451613-0.151005im      0.0208882+0.218779im     -0.110008+0.200013im     0.0694767+0.0230722im   -0.0139435-0.137455im      0.0925094+0.0769069im       0.096878+0.20638im      -0.0197926+0.0437764im    0.0185339-0.0868075im      0.130652+0.0555465im
   0.240597+0.143188im    -0.0284074+0.134945im    -0.0273484+0.0151408im     0.226511+0.140648im      -0.144136+0.0436042im      0.091298-0.141688im    -0.0478758+0.0644565im     -0.0762945-0.0748925im   -0.0431952+0.230003im     -0.0181874-0.0643221im       0.188288+0.137747im     -0.125659+0.0256724im     -0.203889+0.281485im    -0.000933247+0.104078im      -0.223146-0.307135im      -0.111166-0.0389796im     -0.108992+0.109417im       0.143659+0.109938im     -0.0803241-0.102261im    -0.0787478+0.0606013im        0.25605-0.0980256im      0.205817+0.00824246im    0.0779886+0.165032im       -0.11162-0.184447im     0.0416213+0.0907441im    0.0380851+0.00192304im    0.013267-0.0677554im      0.101575-0.0737259im      0.0762205-0.0165839im    -0.0488525-0.0759295im   -0.0210998+0.0130482im     0.0826703+0.0861866im
 0.00497477-0.0157337im    0.0794939+0.0527587im    0.0218804+0.111846im     0.0817553-0.047374im      -0.138808+0.148443im        0.16644+0.0670146im    -0.144668+0.0402087im       0.135195+0.115149im     -0.183243+0.00988309im   -0.0405753-0.0932507im     -0.0777492-0.0346034im   -0.0788136-0.0827377im     0.0641544+0.0635871im       0.175165+0.0213987im      0.129337-0.121304im      -0.255387+0.164421im     -0.0229985-0.0651806im     -0.160076+0.0789386im      0.073595-0.109367im    -0.0968063-0.0229181im       -0.20662+0.128162im       -0.21279-0.092032im       0.163731+0.105935im      0.0773912+0.0288505im      0.19109-0.245065im     0.0339128-0.105567im     -0.162384-0.125373im      -0.134606-0.00467863im      0.105706+0.066618im      -0.292489+0.0413911im   -0.0737237-0.259831im       0.206052+0.0693794im
 -0.0800788+0.159787im    -0.0982464+0.187266im     0.0134187-0.0541269im   -0.0268907+0.0385207im     -0.150976-0.246176im     -0.0455081+0.105663im    -0.0743048+0.0334255im      -0.114144+0.111399im       0.22051-0.0189801im    0.00343633+0.177614im        0.122599-0.273558im     -0.121283+0.134903im       -0.12376-0.136838im       -0.161867-0.0768356im     0.0450567-0.00453024im      0.01535+0.12538im      -0.0358058-0.0564254im     0.0467618-0.0908502im     -0.133893+0.157243im    -0.0221096+0.115542im      -0.0262153+0.08978im     0.000190841+0.114359im     -0.0857647+0.180291im       -0.13803-0.0367778im    0.0514936+0.0634056im    0.0144271-0.351826im    -0.0988184+0.0208679im     -0.130426+0.134391im     -0.00308189-0.127064im      -0.320963-0.0645167im    -0.184245+0.062845im      0.0150221-0.104703im
 -0.0344123-0.0816382im  -0.00511605+0.14109im      -0.117448+0.110585im     0.0615026-0.0630813im      0.230645+0.024763im       0.119278-0.00881583im   -0.168313-0.0789865im      -0.219963+0.0534846im    0.0845714-0.106413im      -0.153657+0.0950905im     -0.0931749+0.306217im      0.188899-0.102994im     -0.0860261+0.104891im       -0.044553-0.105931im     -0.0117158-0.0574889im      0.124332-0.0670627im    -0.0996272+0.0258897im    -0.0862108+0.0593183im    -0.0141949+0.0307726im     0.108425-0.0131959im     -0.0101113+0.114138im        0.11223-0.175719im     -0.0985824-0.0595765im     -0.119896+0.170094im     0.0583412+0.0964555im    0.0628634+0.0780007im     -0.06233-0.377906im      0.0315477+0.173133im       -0.102417+0.136764im      -0.122671+0.0562768im    -0.273168+0.0644798im     0.0761257-0.222334im
 -0.0111537+0.120906im      0.139951-0.0485919im    -0.123627+0.23457im      -0.113603-0.18423im       0.0771675+0.0367951im   -0.00401934+0.106971im    -0.0776642+0.187846im       0.0727855-0.116375im      0.145083-0.0777238im      0.177145+0.0173774im     -0.0947003-0.181303im   -0.00782378-0.11737im      -0.0647639-0.0279507im      -0.156569+0.0939899im    -0.0316749-0.00333961im    -0.253876+0.0645549im    -0.0281664+0.0216879im      0.184238-0.0414295im      -0.16387-0.144275im     -0.166394-0.000889758im     0.110363-0.0891843im     0.0539428+0.0348846im     -0.205443-0.087804im      0.0323167-0.0419509im   -0.0247942-0.114525im    -0.0973897+0.0596078im     0.214637-0.0933867im    -0.0274866-0.276522im       -0.101273+0.289103im     -0.0718997+0.0547129im    -0.226671-0.0954986im     -0.155056-0.101201im
  -0.183927-0.173549im     0.0486805-0.0838926im   -0.0900009+0.128676im      0.170568-0.0735856im    0.00347019-0.126431im       0.283543+0.113128im      0.088453+0.219506im        -0.10942-0.147109im     -0.133577-0.172982im       0.129709-0.0762451im      0.0705251-0.0876162im     0.100094-0.00835409im      0.06559-0.0449431im     -0.0117408-0.118153im      0.0023219-0.160828im      -0.199995+0.124776im       0.153111+0.083985im       0.158578+0.0857794im      0.158383+0.172375im     0.0462987-0.178407im       0.0389084+0.13391im     -0.00335377-0.212848im      0.0789084+0.0872305im     -0.138833-0.0644028im   -0.0745607+0.0931481im    -0.115068+0.024311im      0.138152+0.114046im     -0.0295623+0.0965876im      0.0498777-0.198326im       0.138478-0.235502im     -0.130785+0.0920241im     0.0714946-0.0486553im
   0.161638-0.0786442im      0.13835-0.0846651im     0.168989+0.0141153im   -0.0820924+0.242447im     -0.0215089+0.0891549im     0.0534472-0.00703591im   0.0190017+0.111058im       -0.117242-0.246703im     0.0659736-0.012424im       0.047142-0.0202789im      0.0171623-0.0585055im     0.184603-0.0659617im     0.0436446+0.031536im      -0.0168012-0.00100259im     0.134214-0.0841647im    -0.0139234-0.17107im        0.224145-0.172331im      0.0396247-0.00680331im    -0.149603-0.0579116im    0.0608235+0.0685627im      0.0247105-0.274331im      -0.128494+0.170956im      0.0311638+0.182608im      0.0315054+0.102549im      0.048267-0.204443im     0.0950446+0.0175624im   -0.0461717+0.0535671im      0.148711+0.327506im      -0.0704895+0.102396im     -0.0557314-0.230511im     0.0124093-0.0600357im     0.0493355-0.304309im
 -0.0686058-0.111298im      0.241872-0.0856911im     0.048961+0.105181im    -0.0340323+0.0323888im     -0.180881+0.134768im      -0.253965-0.0453114im     0.167426-0.0867548im      -0.195274-0.0718341im      0.11201+0.0348886im     0.0526269+0.127935im       -0.033387-0.0794689im    -0.142709-0.010335im      -0.125137+0.0664677im       0.215262-0.063404im      0.0832307-0.201042im     -0.0273277-0.0852625im     -0.101456+0.00484932im    -0.161037+0.241905im      0.0606833+0.0501419im    -0.021891+0.134267im         0.16246+0.126831im     -0.0688734-0.252999im      -0.128845-0.00867385im    0.0675035+0.147283im     -0.100038-0.116797im      0.242467-0.0839575im       0.2362-0.00923042im    -0.155547-0.0516886im     -0.0597186-0.155069im     -0.0491832+0.0205511im    0.0575235+0.109187im      -0.160535-0.0346085im
  -0.195798-0.0177124im    -0.137317-0.0241937im    0.0507413+0.11658im       0.126707+0.0793008im     -0.145326-0.0597129im     0.0864656-0.123557im     -0.291441+0.0662438im    -0.00457735-0.0150025im   -0.0089644+0.151891im       0.094791-0.194328im       -0.192564+0.140159im     -0.196575+0.163536im      0.0645758+0.0782992im       0.221718+0.100735im       0.119169+0.199163im      -0.111753-0.0916352im     -0.154663+0.127047im        0.11986-0.0491598im    -0.0991243+0.0567737im   -0.0725184-0.0249344im     -0.0341725-0.068743im     -0.0207311-0.0679955im     -0.109913-0.106188im    0.000124086+0.0240063im   -0.0428538+0.167817im    -0.0962234-0.0083858im    0.0403216+0.101631im     -0.0730639+0.178103im       -0.010908-0.0415401im    -0.0571103+0.0584648im     0.176168-0.0879654im     -0.167404-0.394603im</code></pre><p>and then generate the state <span>$ψ$</span></p><pre><code class="language-julia hljs">psi = P[:, 3]</code></pre><pre><code class="nohighlight hljs">32-element Vector{ComplexF64}:
   -0.03382585447922666 - 0.036473733867545155im
   -0.12283267930222892 + 0.044192653948645765im
   0.005260305690836756 - 0.021883558970443487im
   0.026081190417535365 + 0.059368020543011026im
    0.22752495793634225 + 0.008727138700169002im
   -0.02221042025194001 - 0.011901813338149329im
  -0.045355531415372234 - 0.051643396903301705im
    0.13416310591820657 + 0.02092136746275009im
    0.20670450356768852 - 0.14320942571691295im
    -0.2083106085708389 + 0.010630330807447005im
   -0.07257052995516602 + 0.21198112355004173im
    -0.1087567513131665 + 0.03071882042420239im
    0.13009876088432848 + 0.09905879931262829im
    0.10969717828655468 + 0.10229688664480012im
    0.16154256920582027 - 0.13733709294201765im
   -0.13580530997430704 - 0.17874261629055338im
   -0.13759772486379784 - 0.09600326809578669im
 -0.0064643314148867086 - 0.06300476734232083im
   0.023230864326723527 + 0.11019527020827874im
    0.02316191071708926 + 0.07923034540811838im
     0.3282205337030659 + 0.04703971662587447im
    0.19735863461398753 + 0.04078155643059536im
    0.37237008977323227 + 0.0im
   -0.14925115600794905 + 0.04004948155841952im
    -0.2569092068589066 - 0.05859181788224534im
   0.021918804942202844 - 0.007715161166088589im
    0.15983139806570046 - 0.08126508595537656im
    0.18022191238757887 + 0.1363303662963344im
  -0.025126653763456193 + 0.012492616198932768im
   -0.15876433847650723 - 0.17584859666238054im
    0.03721230426610012 - 0.018475221192572763im
    0.03873543876571973 + 0.08800365449922992im</code></pre><p>In the phase estimation process, we will feed the state to circuit and measure the first <code>n</code> qubits processed by iQFT.</p><pre><code class="language-julia hljs">r = join(ArrayReg(psi), zero_state(N))
r |&gt; PE(N, M, U)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 8/8
    nlevel: 2</code></pre><p>Since our phase can be represented by 3 qubits precisely, we only need to measure once</p><pre><code class="language-julia hljs">results = measure(r, 1:N; nshots=1)</code></pre><pre><code class="nohighlight hljs">1-element Vector{DitStr{2, 3, Int64}}:
 011 ₍₂₎</code></pre><p>Recall that our QFT&#39;s bit numbering is reversed, let&#39;s reverse it back</p><pre><code class="language-julia hljs">using BitBasis
estimated_phase = bfloat(results[]; nbits=N)</code></pre><pre><code class="nohighlight hljs">0.75</code></pre><p>the phase is exactly <code>0.75</code>!</p><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../1.prepare-ghz-state/index.html">« Prepare Greenberger–Horne–Zeilinger state with Quantum Circuit</a><a class="docs-footer-nextpage" href="../3.grover-search/index.html">Grover Search »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.19 on <span class="colophon-date" title="Wednesday 29 June 2022 21:17">Wednesday 29 June 2022</span>. Using Julia version 1.7.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
