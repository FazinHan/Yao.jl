<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Quantum Fourier Transformation and Phase Estimation · Documentation | Yao</title><meta name="title" content="Quantum Fourier Transformation and Phase Estimation · Documentation | Yao"/><meta property="og:title" content="Quantum Fourier Transformation and Phase Estimation · Documentation | Yao"/><meta property="twitter:title" content="Quantum Fourier Transformation and Phase Estimation · Documentation | Yao"/><meta name="description" content="Documentation for Documentation | Yao."/><meta property="og:description" content="Documentation for Documentation | Yao."/><meta property="twitter:description" content="Documentation for Documentation | Yao."/><script data-outdated-warner src="../../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../search_index.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script><link href="../../../assets/indigo.css" rel="stylesheet" type="text/css"/><link href="https://yaoquantum.org/assets/favicon-light.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../index.html"><img src="../../../assets/logo.png" alt="Documentation | Yao logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../../index.html">Documentation | Yao</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../../index.html">Home</a></li><li><a class="tocitem" href="../../../quick-start.html">Quick Start</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../../../man/registers.html">Quantum Registers</a></li><li><a class="tocitem" href="../../../man/blocks.html">Blocks</a></li><li><a class="tocitem" href="../../../man/symbolic.html">Symbolic Computation</a></li><li><a class="tocitem" href="../../../man/cuda.html">CUDA extension - CuYao</a></li><li><a class="tocitem" href="../../../man/plot.html">Quantum Circuit Visualization</a></li><li><a class="tocitem" href="../../../man/automatic_differentiation.html">Automatic Differentiation</a></li><li><a class="tocitem" href="../../../man/simplification.html">Simplification</a></li><li><a class="tocitem" href="../../../man/bitbasis.html">BitBasis</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../1.prepare-ghz-state/index.html">Prepare Greenberger–Horne–Zeilinger state with Quantum Circuit</a></li><li class="is-active"><a class="tocitem" href="index.html">Quantum Fourier Transformation and Phase Estimation</a><ul class="internal"><li><a class="tocitem" href="#Quantum-Fourier-Transformation"><span>Quantum Fourier Transformation</span></a></li><li><a class="tocitem" href="#Wrap-QFT-to-an-external-block"><span>Wrap QFT to an external block</span></a></li><li><a class="tocitem" href="#Phase-Estimation"><span>Phase Estimation</span></a></li></ul></li><li><a class="tocitem" href="../3.grover-search/index.html">Grover Search</a></li><li><a class="tocitem" href="../4.shor-algorithm/index.html">Shor&#39;s Algorithm</a></li><li><a class="tocitem" href="../5.shor-9-code/index.html">Shor&#39;s 9 qubit code</a></li><li><a class="tocitem" href="../6.quantum-circuit-born-machine/index.html">Quantum Circuit Born Machine</a></li><li><a class="tocitem" href="../7.variation-quantum-eigen-solver/index.html">Variational Quantum Eigen Solver</a></li><li><a class="tocitem" href="../8.riemannian-gradient-flow/index.html">Riemannian gradient flow optimizer</a></li></ul></li><li><a class="tocitem" href="../../../performancetips.html">Performance Tips</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href="index.html">Quantum Fourier Transformation and Phase Estimation</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="index.html">Quantum Fourier Transformation and Phase Estimation</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/QuantumBFS/Yao.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/QuantumBFS/Yao.jl/blob/master/docs/src/examples/2.qft-phase-estimation/main.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><p><a href="/generated/examples/2.qft-phase-estimation/main.ipynb"><img src="https://mybinder.org/badge_logo.svg" alt/></a></p><h1 id="example-qft"><a class="docs-heading-anchor" href="#example-qft">Quantum Fourier Transformation and Phase Estimation</a><a id="example-qft-1"></a><a class="docs-heading-anchor-permalink" href="#example-qft" title="Permalink"></a></h1><p>Let&#39;s use Yao first</p><pre><code class="language-julia hljs">using Yao</code></pre><h2 id="Quantum-Fourier-Transformation"><a class="docs-heading-anchor" href="#Quantum-Fourier-Transformation">Quantum Fourier Transformation</a><a id="Quantum-Fourier-Transformation-1"></a><a class="docs-heading-anchor-permalink" href="#Quantum-Fourier-Transformation" title="Permalink"></a></h2><p>The Quantum Fourier Transformation (QFT) circuit is to repeat two kinds of blocks repeatly:</p><p><img src="assets/qft.png" alt="qft-circuit"/></p><p>The basic building block control phase shift gate is defined as</p><p class="math-container">\[R(k)=\begin{bmatrix}
1 &amp; 0\\
0 &amp; \exp\left(\frac{2\pi i}{2^k}\right)
\end{bmatrix}\]</p><p>Let&#39;s define block <code>A</code> and block <code>B</code>, block <code>A</code> is actually a control block.</p><pre><code class="language-julia hljs">A(i, j) = control(i, j=&gt;shift(2π/(1&lt;&lt;(i-j+1))))</code></pre><pre><code class="nohighlight hljs">A (generic function with 1 method)</code></pre><p>Once you construct the blockl you can inspect its matrix using <code>mat</code> function. Let&#39;s construct the circuit in dash box A, and see the matrix of <span>$R_4$</span> gate.</p><pre><code class="language-julia hljs">R4 = A(4, 1)</code></pre><pre><code class="nohighlight hljs">(n -&gt; control(n, 4, 1 =&gt; shift(0.39269908169872414)))</code></pre><p>If you have read about <a href="@ref tutorial-ghz">preparing GHZ state</a>, you probably know that in Yao, we could just leave the number of qubits, and it will be evaluated when possible.</p><pre><code class="language-julia hljs">R4(5)</code></pre><pre><code class="nohighlight hljs">nqubits: 5
control(4)
└─ (1,) shift(0.39269908169872414)</code></pre><p>its matrix will be</p><pre><code class="language-julia hljs">mat(R4(5))</code></pre><pre><code class="nohighlight hljs">32×32 Diagonal{ComplexF64, Vector{ComplexF64}}:
 1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im</code></pre><p>Then we repeat this control block over and over on different qubits, and put a Hadamard gate to <code>i</code>th qubit to construct <code>i</code>-th <code>B</code> block.</p><pre><code class="language-julia hljs">B(n, k) = chain(n, j==k ? put(k=&gt;H) : A(j, k) for j in k:n)</code></pre><pre><code class="nohighlight hljs">B (generic function with 1 method)</code></pre><p>We need to input the total number of qubits <code>n</code> here because we have to iterate through from <code>k</code>-th location to the last.</p><p>Now, let&#39;s construct the circuit by chaining all the <code>B</code> blocks together</p><pre><code class="language-julia hljs">qft(n) = chain(B(n, k) for k in 1:n)
qft(4)</code></pre><pre><code class="nohighlight hljs">nqubits: 4
chain
├─ chain
│  ├─ put on (1)
│  │  └─ H
│  ├─ control(2)
│  │  └─ (1,) shift(1.5707963267948966)
│  ├─ control(3)
│  │  └─ (1,) shift(0.7853981633974483)
│  └─ control(4)
│     └─ (1,) shift(0.39269908169872414)
├─ chain
│  ├─ put on (2)
│  │  └─ H
│  ├─ control(3)
│  │  └─ (2,) shift(1.5707963267948966)
│  └─ control(4)
│     └─ (2,) shift(0.7853981633974483)
├─ chain
│  ├─ put on (3)
│  │  └─ H
│  └─ control(4)
│     └─ (3,) shift(1.5707963267948966)
└─ chain
   └─ put on (4)
      └─ H
</code></pre><h2 id="Wrap-QFT-to-an-external-block"><a class="docs-heading-anchor" href="#Wrap-QFT-to-an-external-block">Wrap QFT to an external block</a><a id="Wrap-QFT-to-an-external-block-1"></a><a class="docs-heading-anchor-permalink" href="#Wrap-QFT-to-an-external-block" title="Permalink"></a></h2><p>In most cases, <code>function</code>s are enough to wrap quantum circuits, like <code>A</code> and <code>B</code> we defined above, but sometimes, we need to dispatch specialized methods on certain kinds of quantum circuit, or we want to define an external block to export, thus, it&#39;s useful to be able to wrap circuit to custom blocks.</p><p>First, we define a new type as subtype of <code>PrimitiveBlock</code> since we are not going to use the subblocks of <code>QFT</code>, if you need to use its subblocks, it&#39;d be better to define it under <code>CompositeBlock</code>.</p><pre><code class="language-julia hljs">struct QFT &lt;: PrimitiveBlock{2}
    n::Int
end

YaoBlocks.nqudits(q::QFT) = q.n</code></pre><p>Now, let&#39;s define its circuit</p><pre><code class="language-julia hljs">circuit(q::QFT) = qft(q.n)</code></pre><pre><code class="nohighlight hljs">circuit (generic function with 1 method)</code></pre><p>And forward <code>mat</code> to its circuit&#39;s matrix</p><pre><code class="language-julia hljs">YaoBlocks.mat(::Type{T}, x::QFT) where T = mat(T, circuit(x))</code></pre><p>You may notice, it is a little ugly to print <code>QFT</code> at the moment, this is because we print the type summary by default, you can define your own printing by overloading <code>print_block</code></p><pre><code class="language-julia hljs">YaoBlocks.print_block(io::IO, x::QFT) = print(io, &quot;QFT($(x.n))&quot;)</code></pre><p>Since it is possible to use FFT to simulate the results of QFT (like cheating), we could define our custom <code>apply!</code> method:</p><pre><code class="language-julia hljs">using FFTW, LinearAlgebra

function YaoBlocks.apply!(r::ArrayReg, x::QFT)
    α = sqrt(length(statevec(r)))
    invorder!(r)
    lmul!(α, ifft!(statevec(r)))
    return r
end</code></pre><p>Now let&#39;s check if our <code>apply!</code> method is correct:</p><pre><code class="language-julia hljs">r = rand_state(5)
r1 = r |&gt; copy |&gt; QFT(5)
r2 = r |&gt; copy |&gt; circuit(QFT(5))
r1 ≈ r2</code></pre><pre><code class="nohighlight hljs">true</code></pre><p>We can get iQFT (inverse QFT) directly by calling <code>adjoint</code></p><pre><code class="language-julia hljs">QFT(5)&#39;</code></pre><pre><code class="nohighlight hljs"> [†]QFT(5)</code></pre><p>QFT and iQFT are different from FFT and IFFT in three ways,</p><ol><li>they are different by a factor of <span>$\sqrt{2^n}$</span> with <span>$n$</span> the number of qubits.</li><li>the <a href="https://quantumbfs.github.io/BitBasis.jl/stable/tutorial/#Conventions-1">bit numbering</a> will exchange after applying QFT or iQFT.</li><li>due to the convention, QFT is more related to IFFT rather than FFT.</li></ol><h2 id="Phase-Estimation"><a class="docs-heading-anchor" href="#Phase-Estimation">Phase Estimation</a><a id="Phase-Estimation-1"></a><a class="docs-heading-anchor-permalink" href="#Phase-Estimation" title="Permalink"></a></h2><p>Since we have QFT and iQFT blocks we can then use them to realize phase estimation circuit, what we want to realize is the following circuit:</p><p><img src="assets/phaseest.png" alt="phase estimation"/></p><p>First we call Hadamard gates repeatly on first <code>n</code> qubits.</p><pre><code class="language-julia hljs">Hadamards(n) = repeat(H, 1:n)</code></pre><pre><code class="nohighlight hljs">Hadamards (generic function with 1 method)</code></pre><p>Then in dashed box <code>B</code>, we have controlled unitaries:</p><pre><code class="language-julia hljs">ControlU(n, m, U) = chain(n+m, control(k, n+1:n+m=&gt;matblock(U^(2^(k-1)))) for k in 1:n)</code></pre><pre><code class="nohighlight hljs">ControlU (generic function with 1 method)</code></pre><p>each of them is a <code>U</code> of power <span>$2^{(k-1)}$</span>.</p><p>Since we will only apply the qft and Hadamard on first <code>n</code> qubits, we could use <code>Subroutine</code>, which creates a context of a sub-scope of the qubits.</p><pre><code class="language-julia hljs">PE(n, m, U) =
    chain(n+m, # total number of the qubits
        subroutine(Hadamards(n), 1:n), # apply H in local scope
        ControlU(n, m, U),
        subroutine(QFT(n)&#39;, 1:n))</code></pre><pre><code class="nohighlight hljs">PE (generic function with 1 method)</code></pre><p>we use the first <code>n</code> qubits as the output space to store phase <span>$ϕ$</span>, and the other <code>m</code> qubits as the input state which corresponds to an eigenvector of oracle matrix <code>U</code>.</p><p>The subroutine here uses <code>focus!</code> and <code>relax!</code> to manage a local scope of quantum circuit, and only activate the first <code>n</code> qubits while applying the block inside the subroutine context, and the scope will be <code>relax!</code>ed back, after the context. This is equivalent to manually <code>focus!</code> then <code>relax!</code></p><p>fullly activated</p><pre><code class="language-julia hljs">r = rand_state(5)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 5/5
    nlevel: 2</code></pre><p>first 3 qubits activated</p><pre><code class="language-julia hljs">focus!(r, 1:3)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 3/5
    nlevel: 2</code></pre><p>relax back to the original</p><pre><code class="language-julia hljs">relax!(r, 1:3)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 5/5
    nlevel: 2</code></pre><p>In this way, we will be able to apply small operator directly on the subset of the qubits.</p><p>Details about the algorithm can be found here: <a href="https://en.wikipedia.org/wiki/Quantum_phase_estimation_algorithm">Quantum Phase Estimation Algorithm</a></p><p>Now let&#39;s check the results of our phase estimation.</p><p>First we need to set up a unitary with known phase, we set the phase to be 0.75, which is <code>0.75 * 2^3 == 6 == 0b110</code> .</p><pre><code class="language-julia hljs">N, M = 3, 5
P = eigen(rand_unitary(1&lt;&lt;M)).vectors
θ = Int(0b110) / 1&lt;&lt;N
phases = rand(1&lt;&lt;M)
phases[0b010+1] = θ
U = P * Diagonal(exp.(2π * im * phases)) * P&#39;</code></pre><pre><code class="nohighlight hljs">32×32 Matrix{ComplexF64}:
   -0.161814+0.0284104im       0.168491+0.200541im       0.193164+0.0729249im    0.0153206+0.0880332im    -0.0689071-0.0447949im    -0.0803843+0.0443759im   -0.141328+0.148863im      0.0945833-0.109232im      0.0537033-0.00175272im      0.208262+0.07848im     -0.000100552+0.0281105im     -0.152069+0.0671602im     -0.312369+0.0603865im      0.0887091+0.0618161im   0.0785455+0.0904647im    -0.119044+0.192761im      -0.122082+0.0103271im    -0.0637382-0.0820543im   0.0392832-0.0372062im   0.00259729-0.265766im       0.138146-0.0244356im      0.213454+0.0519455im    0.103953-0.224975im     -0.0371463+0.342986im       0.109909-0.0398982im       0.0279528-0.082025im     0.0238555+0.0813779im       0.166533-0.243591im      -0.127848+0.0741144im    -0.0950801+0.0254016im      0.144408+0.000233344im    -0.023797-0.00388057im
  -0.0233148+0.0897418im      -0.138538-0.0710529im    0.00774701+0.0700184im   -0.0229554+0.064654im       0.050467+0.0341223im    0.00435939+0.083234im    0.0683085-0.209824im      0.0884253+0.0194142im     -0.218336+0.197044im       -0.125041-0.157274im         0.11923-0.000688782im  -0.0275017+0.166904im       0.184681+0.0943889im      -0.142954+0.0276067im    0.152015+0.158252im     -0.209814+0.12358im       -0.285913-0.0593004im     0.0370336+0.0134996im  -0.0979562+0.116423im    5.24913e-5+0.0770353im      -0.03545-0.00574386im   -0.0569246-0.0655618im   0.0868863-0.120627im      -0.117153+0.0104048im     -0.196625-0.195624im        -0.219833+0.0485612im    0.0677985-0.198139im       0.0950158-0.00433653im    -0.121731+0.167892im      -0.186808-0.103971im        0.24492-0.0662681im       0.148378+0.179727im
  -0.0243528+0.101749im       -0.117028+0.10979im       0.0361617-0.0757045im    0.0772695-0.0871146im     -0.201634-0.216189im     -0.0769472-0.0318241im    0.037768-0.143227im       0.214371+0.19039im       0.0406782+0.00373904im     -0.146464-0.133964im       0.0202347-0.00128392im    0.0620305+0.0294732im     0.0848062-0.10679im         0.233335-0.194216im    -0.143288-0.0791172im     0.018798+0.0380698im     0.0540582-0.0134669im     -0.269807+0.132706im    -0.130069+0.0351502im   -0.0183696-0.174966im     -0.0707934+0.000665418im   0.0671195-0.0543016im    0.115006+0.0397361im     -0.269176+0.0535847im     0.0795329-0.0926148im      -0.0271019+0.159841im      0.203711+0.168428im      -0.0734012-0.0972155im     0.0902651+0.243967im      0.0505826+0.192863im      -0.200039+0.0662131im     -0.0117783+0.188734im
   0.0771125+0.144488im        0.048408-0.121336im      0.0258675-0.013079im     -0.203531-0.0175452im      -0.14709-0.0738232im     0.0562764+0.144429im    0.0675399+0.113002im       0.144617-0.213308im      -0.185355+0.290458im       -0.082747-0.157353im       -0.104613-0.224301im      0.0797616-0.0314733im     -0.123036-0.126122im        0.191354+0.0266955im  -0.0788085+0.0585078im     0.175548-0.0599846im    -0.0224736+0.216663im      -0.157726-0.123882im    0.0426752-0.119412im     0.0235411+0.142649im       -0.03838+0.0788751im    -0.0235294-0.143909im    0.0704479-0.0474692im    -0.0434276-0.0358417im      0.210302+0.190595im       -0.0844019+0.042654im      0.102528-0.180242im       0.0970305-0.0624918im    -0.0611012-0.211232im      -0.171239-0.176897im     -0.0434891+0.125319im       -0.104053-0.0106845im
     0.19972-0.103987im       -0.207422+0.124973im       0.141002+0.138301im      0.123155+0.182027im       -0.17841+0.0345296im    0.00425978-0.0118425im  -0.0941093-0.0228144im     0.0760781-0.0670202im     0.0907768-0.187555im      -0.0304041-0.197126im         0.17227-0.0275858im      0.223016+0.160337im     -0.0367373+0.0925182im      -0.178847-0.0940977im    0.271357+0.152845im   -0.00501199+0.0504651im    0.00756221+0.00265674im   -0.0526725+0.166786im     0.179897-0.0857134im   -0.0294644+0.0485538im     0.0569696+0.107352im      0.0270339-0.167952im     0.203283+0.196404im      0.0239893-0.0791315im    -0.0806319+0.179974im       -0.0966868-0.1454im      -0.0559211+0.0940266im     -0.0152807-0.131121im      -0.182186-0.182656im      0.0256008+0.0616934im     -0.154586+0.0423306im      -0.104916-0.0241727im
   0.0576369-0.0679891im      0.0904344-0.0496129im      0.134887+0.0124284im   -0.0575401+0.215535im       0.163301+0.158612im    -0.00296389-0.35996im     0.0669494+0.0272462im      0.163097-0.111226im      -0.139462+0.0438007im      0.0651581+0.114542im       0.0439762+0.0572407im      -0.28334+0.106101im     -0.0513937+0.155102im      -0.0561531+0.0858391im   0.0186212-0.14405im       0.204089-0.0547908im    0.00566317+0.140762im      -0.219277+0.017971im      0.15926+0.106051im     0.0854235-0.0141127im      0.023706-0.0112004im     -0.116316-0.0504872im    0.253581+0.0886231im       0.03905-0.0088918im     -0.145489-0.121876im     -0.000656305+0.197217im    -0.0654313+0.111906im       0.0225173+0.0275941im      0.227815+0.0433805im    -0.0359471-0.134461im      -0.153521+0.138505im      -0.0285636+0.191444im
   0.0962785-0.0321951im      -0.108048+0.112591im       -0.15526-0.041726im      0.119702-0.0556062im    -0.0922646+0.167271im     -0.0728313+0.0256667im   -0.162758-0.0223328im     0.0799342-0.149838im      -0.180289-0.00656549im    -0.0872004-0.0979426im      0.0562036-0.0362549im     -0.271192+0.0121608im    -0.0963264+0.149957im        0.128984+0.156902im    0.0822153+0.0498054im     0.261932-0.00404103im   -0.0796775+0.0904003im     0.0893131-0.0931857im   -0.137415-0.0201996im   -0.0827689-0.0602979im     -0.115352+0.0390896im      0.125753+0.0150193im   -0.201566-0.00635513im    -0.243908-0.245416im     -0.0694347-0.0712638im        0.190862-0.241689im     -0.129897+0.0259421im    -0.00746085+0.119286im      0.0058231+0.0239202im     -0.118048+0.318928im      0.0323377+0.196275im     0.000124374+0.0193599im
   0.0861305+0.0517639im        0.14097-0.115039im     -0.0792271+0.0586297im    0.0518413-0.239738im       0.118544-0.244213im       0.147778-0.0123372im  -0.0495475-0.0437049im    -0.0245823-0.23026im       0.0775527-0.130846im      -0.0787483+0.0525834im       0.142796+0.277266im     -0.0978921-0.108612im       0.198822+0.0676788im      -0.120944-0.134177im    0.0934741+0.0539514im      0.10401+0.0667132im     0.0647681+0.185im        -0.0883618-0.0274133im   -0.203779-0.0892652im   -0.0318105+0.232992im      0.0147358+0.0528459im      0.280357+0.34978im      0.265818-0.0978925im    -0.0529198-0.000533315im  -0.0149482+0.0176134im      -0.0733174+0.0165249im   -0.0117347-0.0362479im     0.00391003-0.13254im      0.00867349-0.0412348im    -0.0324901-0.0113671im    -0.0157236+0.100682im      -0.0182305-0.0343297im
  -0.0227043+0.10172im       -0.0714027-0.00848658im     0.179736-0.0483394im     0.123187-0.0968793im     0.0872223+0.148642im      -0.177008-0.0192144im   0.0824485-0.0820319im     -0.253109-0.0910706im    -0.0978813-0.104698im       0.0501195+0.180243im        0.129826-0.118765im     -0.0455457-0.121875im       0.085128-0.026068im        0.198285+0.0237628im    0.156799+0.230181im     0.0130529-0.0449124im    -0.0658448-0.0518406im    -0.0465664-0.032658im    -0.201138+0.0508656im    0.0715411-0.122606im      -0.110013+0.0258757im    -0.0851317-0.0483777im    0.191184+0.297237im      -0.084188+0.171733im      0.0216942+0.0593004im        0.189275-0.0104195im    0.0962099-0.244302im       -0.213119-0.133846im       0.137646-0.0731552im     -0.135791-0.0452439im    -0.0168955-0.185166im       -0.172517-0.0887444im
   0.0159554-0.114838im      -0.0652613+0.155453im     0.00728469-0.0210981im    -0.190364+0.192013im      0.0908558+0.109124im       0.011089+0.0231996im   -0.174848-0.151541im       -0.11664+0.114654im      -0.168393-0.193833im      -0.0428782+0.0202472im       0.163956+0.145899im      0.0709401+0.00459328im   -0.0444708+0.206534im        0.307274-0.221705im    0.0374588+0.108194im    -0.0481722-0.134984im       0.093148+0.133986im       0.090441-0.116191im    0.0728199-0.0999313im   -0.0218223+0.0646304im    -0.0571177-0.127443im       0.140199+0.0239297im   -0.117377-0.163605im     0.00117979+0.00389269im    0.0990752+0.259726im        0.0454105+0.140391im     0.0221827-0.176818im        0.124088+0.0205586im     0.0440662+0.111235im      0.0510109-0.143065im       -0.16009-0.0834297im       0.136951+0.237208im
  0.00367153-0.0573938im      -0.121408+0.161168im     -0.0679733-0.0196942im     0.244633-0.0865536im    -0.0164173-0.383786im      -0.101023-0.118511im     0.216958-0.176302im      0.0727543-0.0626613im    -0.0750825-0.0952302im      0.0455754+0.13931im        -0.142613-0.0646839im    -0.0747882-0.081515im      -0.249781+0.105141im       -0.142389+0.0793317im    0.078437-0.0297516im    -0.118628-0.0854675im      0.114257+0.16954im        -0.11242-0.198186im   -0.0653966+0.0622943im      -0.2147-0.0578432im       0.14421-0.0392318im     0.0101251-0.151893im    -0.182188+0.0893415im    -0.0187461+0.0147379im    -0.0903798+0.0845318im       -0.139547+0.114503im    -0.0499655-0.231076im      -0.0998029-0.00864368im   -0.0688509-0.122648im       0.115597-0.0771341im     0.0512326+0.0398276im       0.141687+0.0854031im
    0.202764-0.0692169im        -0.1886-0.0842946im    -0.0973212+0.0659206im   -0.0262113-0.180649im      0.0661333+0.238115im      0.0304089+0.0366523im   0.0248832-0.0408852im      0.307638-0.133576im       0.104013+0.0175623im      0.0872258+0.0349478im     -0.0344613-0.119801im      -0.172996-0.171222im        0.17461+0.105129im      0.00242282-0.0929507im   -0.136325-0.114183im     -0.224899+0.0735738im    -0.0533539+0.112572im     0.00680855+0.0113424im  -0.0692924-0.153267im      0.153986-0.191691im     -0.0989405-0.265776im       0.135541-0.163838im     0.079129-0.0249571im     0.0718396+0.0317801im     0.0914453+0.165914im       -0.0674071-0.0498375im   -0.0617721+0.178817im       -0.084032-0.00105058im    0.0199709-0.198491im      0.0235391-0.00186488im    0.0942124-0.219351im        0.121319+0.112477im
    0.041563-0.255095im     -0.00915075-0.0326264im    -0.0885512+0.0364125im   -0.0221038-0.189146im     -0.0437612+0.0773224im      0.146895-0.0368345im   0.0644718+0.205632im      0.0634401-0.162698im     -0.0978481+0.0658416im      0.0666749+0.0814858im      0.0477362+0.040096im       0.107433+0.0808389im     0.0962966-0.0696932im       0.141363-0.114276im    -0.024043-0.0564519im    -0.201626+0.145942im    -0.00265918-0.277929im      -0.172628-0.150096im   -0.0443271+0.0428571im   -0.0428731-0.136123im      0.0426899-0.0270895im      -0.14978+0.0553488im  -0.0883135-0.147883im      0.0236427-0.151827im      -0.330212+0.0936149im        0.180489+0.0402276im   -0.0874158-0.205232im       0.0452048-0.242454im       -0.10132+0.0238534im     0.0979694+0.0183105im      -0.15027+0.130832im       -0.221263+0.109145im
   -0.079718-0.217142im       0.0343888-0.250516im       0.193099-0.136564im      0.139431+0.0575797im     -0.268488-0.131495im      0.0261704+0.110789im    0.0446009+0.109524im     -0.0431003-0.130198im     0.00145423+0.0141706im      -0.177956-0.014101im        0.140026+0.0484025im     -0.163365-0.0493146im     -0.175005-0.0765854im    -0.00600219-0.119978im     0.198417-0.0248682im   -0.0926059-0.0874557im     -0.140297+0.0229656im      -0.11126-0.168845im     0.103277+0.147529im     0.0914056+0.102226im      -0.221515-0.170069im      -0.188139+0.170959im   0.00902133-0.0613784im     -0.067354-0.0304695im     0.0197185-0.0196248im       0.0882186-0.108017im      0.132167+0.159628im      -0.0377067+0.120818im     -0.0376892-0.0988013im      0.159502+0.00934678im   -0.0670519-0.221033im        0.206879+0.0462452im
  0.00973264-0.0192585im       0.123948+0.0501758im      0.172392-0.110557im    -0.0886151+0.138069im      -0.107647+0.00676132im   -0.0564178-0.115334im     0.154661+0.0826974im      0.185223+0.00209788im    -0.007831-0.283426im       0.0266822-0.0869217im      0.0269373-0.149994im      -0.100096-0.174045im       0.196093+0.0375105im       -0.12663-0.0225209im   -0.232834-0.0503496im   -0.0867529-0.111465im       0.168683+0.0418204im     -0.067802+0.0232804im    0.131097+0.0424445im    -0.187291+0.0653364im     -0.180788+0.222532im     -0.0866112+0.111146im   0.00544745-0.127485im      -0.153234+0.0372654im     -0.052317+0.122028im       -0.0402468-0.126122im     -0.140742-0.199413im        0.149154+0.00385337im  -0.00563694+0.101515im      -0.120608+0.187036im       0.173994-0.266392im       -0.138031-0.016756im
   0.0885776+0.0957961im      0.0314687-0.224449im      -0.109675-0.156644im    -0.0726859-0.0247556im     0.0201428-0.024354im     -0.0315105-0.191227im    -0.351947-0.0298279im     0.0102416-0.14714im       0.0383107-0.0170388im       0.116703-0.0531329im      0.0473329+0.0609057im    -0.0394111+0.135072im      0.0225776-0.0926764im     -0.0810796-0.0410969im    -0.09064-0.0996193im     -0.22195-0.182782im      -0.192312+0.135748im      0.0864072-0.183939im     0.220103-0.0699259im   -0.0636771-0.0743328im      0.133562+0.143019im     -0.0484775-0.0676186im   0.0594128+0.158486im      -0.107403-0.109136im       0.180705+0.000346478im     0.0909076+0.00990385im   0.0724995-0.119046im       -0.290777-0.119401im      -0.169179+0.28975im       0.0862256+0.0211483im     0.0476711-0.0049248im      0.0331944-0.0437037im
  0.00277456-0.150734im        0.089764-0.0929697im     -0.155948-0.13838im      0.0468172+0.236744im      -0.261613+0.0444371im      0.088152-0.026626im    -0.108773-0.0693825im     -0.209407+0.080607im      0.0649683-0.0441386im   -0.000471914-0.120921im       -0.051927+0.273626im      0.0502914+0.0690692im     0.0889766-0.0592327im      -0.113784+0.189734im   -0.0827924-0.250587im     0.0248564+0.0497499im     -0.163571+0.00777083im    0.0293103-0.109194im    -0.279214-0.0112133im   -0.0905872-0.214058im      -0.110374+0.0290371im    -0.0479746-0.0827064im    0.088704+0.0794513im    -0.0515534+0.171522im       0.086804+0.127286im        -0.116244-0.0387014im   -0.0518164-0.134387im        0.162487-0.096928im       0.209343-0.257269im     -0.0274683-0.0109857im     0.0179752+0.0669987im    -0.00281417+0.151881im
    0.140564-0.201792im      -0.0546205+0.0171145im    -0.0162893-0.0745059im   0.00222198-0.114242im     -0.0234937+0.153481im      -0.152242-0.197782im     0.176876+0.105812im      0.0671689+0.198374im       0.201558-0.00726015im      0.189914-0.191183im       -0.185707-0.135748im     -0.0653741+0.204557im     -0.0705977+0.000117727im    0.0103884-0.0414997im    0.191975+0.0380534im    -0.056104+0.119144im     -0.0360347-0.0145858im      0.161276-0.185368im   -0.0972988+0.0466216im   0.00492732+0.375212im      -0.197254+0.0658752im     0.0940572+0.0885449im    0.059391+0.00820988im  -0.00200714+0.0603272im      0.133035+0.0564122im        0.116852+0.279938im      0.112663-0.0255804im       0.033657-0.111382im      0.0731128+0.0160946im     0.0498095+0.0820137im      0.112585+0.130331im       0.0475383-0.0425578im
  -0.0578003-0.000233588im   -0.0657144-0.182214im      0.0951726+0.139094im     -0.140974-0.132001im      0.0221151-0.0545474im    -0.0428452-0.169413im     -0.01005+0.110746im       0.109623+0.0304333im     -0.155964+0.186462im       0.0456644-0.0390588im      0.0494293+0.108123im       0.187695-0.0406705im     -0.111254+0.267972im       -0.158469-0.0125368im   0.0745104-0.0328895im     0.118261-0.123971im      -0.155946-0.124831im      0.0398026+0.0693118im   -0.183625-0.239626im     -0.124991-0.130981im      0.0110816+0.218062im     0.00244167+0.0583353im  -0.0520072-0.0351474im     -0.104086+0.192209im      0.0307952+0.027621im         0.140118+0.271466im    -0.0565487+0.0143806im      0.0184445+0.217642im      -0.106346-0.132487im      0.0899053+0.174706im      -0.137665-0.260818im      0.00902483-0.0357011im
  -0.0139082-0.138879im        0.135724-0.0692507im   0.000840835-0.0851712im    -0.200586-0.0872456im     -0.033962+0.060024im       0.114385+0.170495im    0.0733096+0.0272861im    -0.0861276+0.055899im     0.00969878-0.178631im       0.0679328-0.192205im      -0.0529844-0.134327im     0.00163833-0.163562im     -0.0606222-0.0790863im        0.12914+0.0709384im    0.169034+0.0760838im    -0.142002-0.166667im     -0.0163671+0.138514im     -0.0555886+0.116685im    -0.112958-0.0949086im   -0.0839235-0.183759im      0.0925044+0.280197im      0.0478519-0.0494892im   0.0695762+0.0517922im    -0.0808221-0.156002im      -0.257224-0.116222im        0.0564709+0.136611im     -0.156644+0.214198im       0.0463663-0.154685im        0.09589+0.0338208im    -0.0371659-0.188853im      0.0106953+0.00570893im      0.347412-0.0913216im
  -0.0947644-0.0261989im      0.0510105-0.0236154im   -0.00605256-0.0365422im     0.040593-0.213573im     -0.0876671+0.154934im      -0.215251-0.105075im    0.0301475+0.189494im     -0.0121855-0.0186792im      0.131608+0.1287im         -0.119762-0.109452im       -0.161501+0.192289im      0.0698421-0.0899237im     0.0601137+0.0171726im      -0.144488-0.0596118im    0.010722+0.168998im     0.0551321-0.118827im       0.165626-0.119343im       0.114225-0.2566im       0.127794+0.215535im   -0.00159817-0.148598im      0.0924526+0.000882781im     0.18786-0.0759133im   0.0594405-0.00131621im  -0.00762827+0.0182993im    -0.0949008+0.141599im        -0.151953-0.0963033im    0.0298825+0.0168203im     -0.0459244+0.0778317im     0.0119343+0.102327im      -0.388851-0.0658426im     -0.266425-0.0403024im       0.161745+0.0843184im
  -0.0184874+0.165725im        0.205377-0.0741696im     0.0942939+0.258307im     0.0343659-0.0651772im   -0.00682173-0.0250221im    -0.0115443-0.10611im     0.0415463+0.0251458im     0.0655284+0.236033im        0.10815+0.0234637im      -0.303221+0.0158241im      -0.180768+0.057114im      -0.126565+0.183235im      0.0609425+0.0454714im     -0.0257649+0.227599im     0.114813+0.17695im       -0.17422-0.0995645im    0.00541378+0.1437im         0.049084+0.12103im     -0.017631-0.0800511im   0.00759876-0.121303im      -0.269397-0.0429469im    -0.0501556-0.0815229im  -0.0141411-0.235044im     -0.0601882-0.0408081im     0.0464888+0.126284im         0.122566-0.138111im     -0.179858-0.0878783im      -0.155746-0.0850867im     0.0191968+0.0297312im      0.214554-0.15603im       -0.145495+0.0905876im     -0.0852257-0.0218037im
   -0.227513+0.165563im     -0.00592005+0.0395663im     0.0404469+0.275045im     0.0856904-0.0471911im     -0.222255+0.136315im       0.241671-0.0803477im    0.200853-0.307107im     -0.0719847-0.110162im     -0.0976208+0.0267765im       0.228738+0.00219371im     0.0230261-0.0307742im      0.183304+0.0343361im     0.0703457-0.122923im       -0.077354-0.0836256im   0.0382462+0.0366851im   -0.0791697-0.0869308im      0.123381+0.199033im       0.133942-0.34113im     0.0461823-0.119837im    -0.0477106+0.00226885im  -0.00830978+0.0425134im    -0.0832626-0.0392646im    0.110791-0.131423im      0.0809166+0.00464743im    0.0186326-0.100655im          0.15823-0.0591621im   -0.0018109+0.185471im       0.0346196+0.0758882im      0.153715+0.0307939im   -0.00273283+0.16648im       0.0038248+0.0492205im     -0.0363521+0.0907498im
 -0.00837568+0.0100126im       0.143768-0.278567im       0.186475+0.155464im   -0.00947802+0.222607im    -0.00968197+0.150696im      -0.185686+0.24299im     0.0983889-0.0625298im   -0.00277084+0.0465534im   -0.00155439+0.0953922im      0.0849597+0.104778im      -0.0382801-0.0409068im      0.023429-0.0348362im   -0.00854659-0.0616831im    -0.00197547-0.0359715im  -0.0484777-0.141372im     0.0931322+0.246667im       0.252812+0.0546267im      0.174076-0.0392948im   0.0218149+0.0204026im   -0.0775068-0.0969776im     0.0198219-0.11371im        0.223375+0.0330226im    0.175984+0.137497im      -0.223284-0.162592im      -0.075369-0.07483im       -0.00359783+0.0768905im    -0.043712-0.255109im      -0.0169036-0.00911773im    -0.194746-0.0233274im      0.227314+0.133295im     -0.0853336+0.0364437im       0.157997-0.00891222im
   -0.266653-0.126214im      -0.0142236+0.0404063im      0.208336-0.29698im      -0.148873+0.00505475im   -0.0834088-0.0132346im     0.0397755-0.0497469im   -0.163394+0.00328746im     0.011184+0.109357im      0.0682408+0.0170859im       0.110003+0.188896im       -0.143143+0.0165339im     0.0930192-0.0261277im      0.199888+0.187241im       0.0192307-0.0098153im   -0.153471+0.303974im     -0.050557+0.0804702im     -0.168476+0.167024im     -0.0290026-0.0787961im   0.0273912-0.0164342im    0.0881047+0.153943im      0.0848447-0.0634723im     0.0159435-0.113384im   -0.0291151-0.106826im      -0.187095-0.100727im      -0.117295-0.170057im        -0.149069+0.0472173im   -0.0570114+0.0156756im      -0.195104+0.0128024im     0.0366661-0.301043im      0.0483363+0.141532im     -0.0601484+0.0947636im     -0.0802075-0.0654275im
    0.219114+0.172237im       0.0755186+0.215421im      0.0669936-0.146377im     -0.125191-0.00505362im   -0.0372311+0.00583639im   -0.0714709-0.150803im     0.272601+0.016973im     0.00186227-0.00504177im    -0.181905-0.0408489im      0.0221681-0.0290007im       0.133516+0.162755im       0.079552+0.151038im      -0.145085-0.0716304im      0.0399833-0.121396im    -0.206424-0.0431309im    0.0153688-0.0530876im    -0.0896172+0.0130835im       0.13073-0.0687273im   -0.210822-0.056084im      0.269997+0.00131789im   -0.0192366-0.132346im      -0.144157+0.0457133im   0.0826321-0.0287847im     0.0102048+0.0763525im     -0.105533+0.0262319im       -0.149639-0.151754im     -0.212445+0.000737206im   -0.0708365-0.069326im      -0.127696+0.0192127im     0.0330237+0.0815125im    -0.0982863+0.0664333im       0.271476-0.309633im
   -0.199295-0.010879im        0.139262-0.101651im        -0.2144+0.0296351im   -0.0174631+0.0663334im      0.127974-0.0375082im      0.127527-0.109633im   -0.0513772-0.0813788im      0.199005-0.231006im       0.217073-0.0356164im       0.240553-0.0945788im       0.139087-0.145847im        0.21084-0.0523687im     -0.192717+0.100487im        0.175812+0.218289im     0.108805-0.0245304im    -0.133081-0.0807773im     0.0847981-0.13727im       0.0560956+0.159756im     -0.15011+0.198561im       0.10239+0.149542im     -0.0962332-0.0687903im    -0.0230325-0.0547409im   0.0529353-0.0619865im     -0.132558+0.0123663im      0.066908-0.0316736im       -0.169473-0.147664im    -0.0103641-0.15507im       -0.0470277+0.0621999im       0.09393+0.0447808im    -0.0108788+0.0930307im     -0.250545-0.0221027im      0.0675198+0.00670816im
  -0.0608172+0.070383im       -0.225863+0.160099im      -0.174238+0.0727113im    -0.197329+0.118973im     -0.0496487-0.0258357im     -0.244273+0.118246im   -0.0572361+0.0512991im    -0.0105879-0.0343595im    -0.0636299+0.174922im       0.0839819+0.0616172im     -0.0157589+0.13921im      -0.0180883-0.202418im     -0.0569396+0.0113026im     -0.0639466+0.0436847im    0.102129-0.184179im     0.0185869-0.13712im       0.0974073-0.0631359im      0.128555-0.0519712im   0.0891277-0.087023im     -0.112895+0.121606im      -0.321254+0.0259944im    -0.0428985+0.0684316im   0.0183542-0.0892316im    -0.0481206-0.000181746im   -0.135539-0.169062im        -0.147728-0.00999674im   0.0120746+0.140323im       -0.226773-0.433157im      0.0659007-0.0491981im     0.0344906-0.0853028im     -0.046562-0.0850418im      -0.115743+0.0113108im
    0.151492+0.0962763im       0.160734+0.166876im     -0.0441381-0.0721727im   -0.0298903-9.33308e-5im    0.0703117+0.0952939im     0.0815761-0.064896im     0.102359-0.0722507im    -0.0422632-0.0947832im        0.0824-0.103437im       -0.152627-0.0829821im        0.05343-0.172955im       0.136164+0.162661im        0.06579-0.0868822im     -0.0430041+0.0287674im   0.0234604-0.120867im    -0.0455632-0.0993283im    -0.0843321-0.103824im    -0.00467208-0.0908969im    0.157186+0.023648im     -0.218896-0.0140848im     0.0194567-0.302841im       0.200035+0.131229im    -0.110506+0.00739663im     -0.30655+0.115789im      0.0600673-0.293816im         0.126698+0.139022im     -0.117609+0.0754024im     -0.0422801+0.026288im      -0.109415-0.272419im      -0.130348-0.19347im       -0.105461-0.0902286im      -0.108045+0.0146589im
 -0.00569925+0.0219553im     -0.0707286-0.167464im      0.0470848+0.081851im     -0.188647-0.107282im      0.0500272-0.0324273im     0.0619604+0.277509im    -0.121635+8.48381e-5im    0.0682283+0.102759im     -0.0125547-0.2305im         0.0179566-0.0488869im    -0.00914436-0.233822im     -0.0108901+0.159996im     -0.0232582+0.164067im       -0.266596+0.0922142im   -0.096152+0.0673389im     0.109319-0.0600575im      0.154128+0.0676562im     0.0470429-0.118918im   -0.0792908+0.0633131im     0.145656-0.0612002im       0.07299-0.139473im      -0.305824+0.264502im      -0.1477+0.130105im     -0.0476545+0.232912im     -0.0193775+0.0567508im       0.0234015+0.00531273im   0.0524672+0.0556429im     -0.0628159-0.220915im     -0.0253874+0.00944786im    -0.125746+0.0852533im     -0.104422+0.148418im       0.0506261+0.193933im
    0.118067-0.0322138im     -0.0683934-0.0216609im      0.156245+0.207258im      0.230577+0.0103097im     0.0387936+0.170072im     -0.0512754+0.178314im   -0.0379055+0.0793331im     0.0179098-0.0364579im     -0.203882-0.106124im        0.311261-0.0375585im      -0.262763+0.231998im       0.112157-0.0268519im      0.031851-0.149367im       -0.109926-0.0412881im  0.00201815-0.088986im    -0.0968681-0.244609im      -0.199667+0.200595im      -0.161672+0.223739im   -0.0594502+0.207283im     0.0401325+0.075203im     0.00734344-0.118952im      0.0660865+0.0626154im    -0.20704-0.089923im      -0.138878-0.0317043im      0.066336+0.0159403im      -0.0552732+0.0635342im    0.0693977-0.0377818im      0.0333521+0.00400795im    0.0660691+0.0696707im    -0.0924964+0.00848457im       -0.113+0.0431873im     -0.0736088-0.150446im
   -0.234397-0.312383im      -0.0122593-0.0500662im      0.124533+0.130065im    -0.0143466-0.0266188im    -0.0757208+0.0501954im    -0.0904611-0.0914887im  -0.0960169-0.177609im       0.178944+0.0262343im     0.0972065+0.0443756im     -0.0333269-0.20009im        0.0659188-0.050972im      -0.201529+0.0331599im      0.093339-0.243278im        0.146884-0.116288im     0.095031-0.0611677im     0.112481-0.194439im    -0.00637749+0.0120286im    0.00753871+0.0116573im  -0.0339142-0.304008im    -0.0542009-0.0356684im     0.0746862-0.155294im     0.00701137+0.140114im    -0.130763+0.0893225im      0.204639+0.191986im      -0.111347-0.121766im        -0.223383-0.038128im    -0.0668584-0.212055im      -0.0856535+0.0632952im    -0.0180599+0.0293671im    -0.0531955-0.0464184im   -0.00473632+0.0928409im     -0.0890248-0.179735im</code></pre><p>and then generate the state <span>$ψ$</span></p><pre><code class="language-julia hljs">psi = P[:, 3]</code></pre><pre><code class="nohighlight hljs">32-element Vector{ComplexF64}:
   -0.10168016201973173 + 0.07612575051268791im
    0.10562850247192648 - 0.09461406294423592im
   -0.06903005242068505 - 0.15409749503189926im
   -0.12134974813468048 + 0.170863445032945im
  -0.012836344259515797 - 0.13880706538093007im
     0.2441509286541655 + 0.004361278879735822im
    0.18752946893194347 + 0.1013231758103937im
   -0.18953390583613097 + 0.21827460198761625im
  -0.060575771323023525 - 0.10567518340511253im
   0.020039856166265392 + 0.08400548412661332im
  -0.013525123964900795 + 0.050427433298089866im
   -0.21437154684930582 + 0.2004240575753403im
   -0.21772886016849272 - 0.06275888132645001im
   -0.19431165601975747 + 0.016215356328603936im
   -0.15444261675755513 - 0.0838041986254083im
    0.03444509486390863 - 0.13385106314140957im
 -0.0001483784816498565 - 0.09702462410115895im
  -0.019627572223593095 + 0.008417435402885193im
    0.07741341832262899 - 0.007432857290356927im
    0.06608186506572448 - 0.07544208220477465im
   -0.06793065630700952 + 0.11983813330533608im
    0.39520159135112615 + 0.0im
  -0.010936107881346468 + 0.19030365392754672im
     0.1076479540504649 + 0.10169419680858212im
     0.2550056391946121 + 0.05464733874825223im
  -0.047192137045826026 - 0.024878244789994633im
    -0.0100391289942008 + 0.12321370582023089im
   -0.11155534536548531 - 0.02118844806002898im
   0.012238991021614805 + 0.09898076191861493im
  -0.021279955217099314 - 0.10621538518637522im
   -0.21979030360230273 + 0.022169824027660934im
    0.04115026740855806 - 0.04651670818632922im</code></pre><p>In the phase estimation process, we will feed the state to circuit and measure the first <code>n</code> qubits processed by iQFT.</p><pre><code class="language-julia hljs">r = join(ArrayReg(psi), zero_state(N))
r |&gt; PE(N, M, U)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 8/8
    nlevel: 2</code></pre><p>Since our phase can be represented by 3 qubits precisely, we only need to measure once</p><pre><code class="language-julia hljs">results = measure(r, 1:N; nshots=1)</code></pre><pre><code class="nohighlight hljs">1-element Vector{DitStr{2, 3, Int64}}:
 011 ₍₂₎</code></pre><p>Recall that our QFT&#39;s bit numbering is reversed, let&#39;s reverse it back</p><pre><code class="language-julia hljs">using BitBasis
estimated_phase = bfloat(results[]; nbits=N)</code></pre><pre><code class="nohighlight hljs">0.75</code></pre><p>the phase is exactly <code>0.75</code>!</p><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../1.prepare-ghz-state/index.html">« Prepare Greenberger–Horne–Zeilinger state with Quantum Circuit</a><a class="docs-footer-nextpage" href="../3.grover-search/index.html">Grover Search »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.3.0 on <span class="colophon-date" title="Friday 12 April 2024 03:27">Friday 12 April 2024</span>. Using Julia version 1.10.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
