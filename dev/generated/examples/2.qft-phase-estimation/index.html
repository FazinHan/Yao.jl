<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Quantum Fourier Transformation and Phase Estimation · Documentation | Yao</title><meta name="title" content="Quantum Fourier Transformation and Phase Estimation · Documentation | Yao"/><meta property="og:title" content="Quantum Fourier Transformation and Phase Estimation · Documentation | Yao"/><meta property="twitter:title" content="Quantum Fourier Transformation and Phase Estimation · Documentation | Yao"/><meta name="description" content="Documentation for Documentation | Yao."/><meta property="og:description" content="Documentation for Documentation | Yao."/><meta property="twitter:description" content="Documentation for Documentation | Yao."/><script data-outdated-warner src="../../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../search_index.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script><link href="../../../assets/indigo.css" rel="stylesheet" type="text/css"/><link href="https://yaoquantum.org/assets/favicon-light.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../index.html"><img src="../../../assets/logo.png" alt="Documentation | Yao logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../../index.html">Documentation | Yao</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../../index.html">Home</a></li><li><a class="tocitem" href="../../../quick-start.html">Quick Start</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../../../man/registers.html">Quantum Registers</a></li><li><a class="tocitem" href="../../../man/blocks.html">Blocks</a></li><li><a class="tocitem" href="../../../man/symbolic.html">Symbolic Computation</a></li><li><a class="tocitem" href="../../../man/cuda.html">CUDA extension - CuYao</a></li><li><a class="tocitem" href="../../../man/plot.html">Quantum Circuit Visualization</a></li><li><a class="tocitem" href="../../../man/automatic_differentiation.html">Automatic Differentiation</a></li><li><a class="tocitem" href="../../../man/yao2einsum.html">Tensor network backend</a></li><li><a class="tocitem" href="../../../man/simplification.html">Simplification</a></li><li><a class="tocitem" href="../../../man/bitbasis.html">BitBasis</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../1.prepare-ghz-state/index.html">Prepare Greenberger–Horne–Zeilinger state with Quantum Circuit</a></li><li class="is-active"><a class="tocitem" href="index.html">Quantum Fourier Transformation and Phase Estimation</a><ul class="internal"><li><a class="tocitem" href="#Quantum-Fourier-Transformation"><span>Quantum Fourier Transformation</span></a></li><li><a class="tocitem" href="#Wrap-QFT-to-an-external-block"><span>Wrap QFT to an external block</span></a></li><li><a class="tocitem" href="#Phase-Estimation"><span>Phase Estimation</span></a></li></ul></li><li><a class="tocitem" href="../3.grover-search/index.html">Grover Search</a></li><li><a class="tocitem" href="../4.shor-algorithm/index.html">Shor&#39;s Algorithm</a></li><li><a class="tocitem" href="../5.shor-9-code/index.html">Shor&#39;s 9 qubit code</a></li><li><a class="tocitem" href="../6.quantum-circuit-born-machine/index.html">Quantum Circuit Born Machine</a></li><li><a class="tocitem" href="../7.variation-quantum-eigen-solver/index.html">Variational Quantum Eigen Solver</a></li><li><a class="tocitem" href="../8.riemannian-gradient-flow/index.html">Riemannian gradient flow optimizer</a></li></ul></li><li><a class="tocitem" href="../../../performancetips.html">Performance Tips</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href="index.html">Quantum Fourier Transformation and Phase Estimation</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="index.html">Quantum Fourier Transformation and Phase Estimation</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/QuantumBFS/Yao.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/QuantumBFS/Yao.jl/blob/master/docs/src/examples/2.qft-phase-estimation/main.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><p><a href="/generated/examples/2.qft-phase-estimation/main.ipynb"><img src="https://mybinder.org/badge_logo.svg" alt/></a></p><h1 id="example-qft"><a class="docs-heading-anchor" href="#example-qft">Quantum Fourier Transformation and Phase Estimation</a><a id="example-qft-1"></a><a class="docs-heading-anchor-permalink" href="#example-qft" title="Permalink"></a></h1><p>Let&#39;s use Yao first</p><pre><code class="language-julia hljs">using Yao</code></pre><h2 id="Quantum-Fourier-Transformation"><a class="docs-heading-anchor" href="#Quantum-Fourier-Transformation">Quantum Fourier Transformation</a><a id="Quantum-Fourier-Transformation-1"></a><a class="docs-heading-anchor-permalink" href="#Quantum-Fourier-Transformation" title="Permalink"></a></h2><p>The Quantum Fourier Transformation (QFT) circuit is to repeat two kinds of blocks repeatly:</p><p><img src="assets/qft.png" alt="qft-circuit"/></p><p>The basic building block control phase shift gate is defined as</p><p class="math-container">\[R(k)=\begin{bmatrix}
1 &amp; 0\\
0 &amp; \exp\left(\frac{2\pi i}{2^k}\right)
\end{bmatrix}\]</p><p>Let&#39;s define block <code>A</code> and block <code>B</code>, block <code>A</code> is actually a control block.</p><pre><code class="language-julia hljs">A(i, j) = control(i, j=&gt;shift(2π/(1&lt;&lt;(i-j+1))))</code></pre><pre><code class="nohighlight hljs">A (generic function with 1 method)</code></pre><p>Once you construct the blockl you can inspect its matrix using <code>mat</code> function. Let&#39;s construct the circuit in dash box A, and see the matrix of <span>$R_4$</span> gate.</p><pre><code class="language-julia hljs">R4 = A(4, 1)</code></pre><pre><code class="nohighlight hljs">(n -&gt; control(n, 4, 1 =&gt; shift(0.39269908169872414)))</code></pre><p>If you have read about <a href="@ref tutorial-ghz">preparing GHZ state</a>, you probably know that in Yao, we could just leave the number of qubits, and it will be evaluated when possible.</p><pre><code class="language-julia hljs">R4(5)</code></pre><pre><code class="nohighlight hljs">nqubits: 5
control(4)
└─ (1,) shift(0.39269908169872414)</code></pre><p>its matrix will be</p><pre><code class="language-julia hljs">mat(R4(5))</code></pre><pre><code class="nohighlight hljs">32×32 Diagonal{ComplexF64, Vector{ComplexF64}}:
 1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im</code></pre><p>Then we repeat this control block over and over on different qubits, and put a Hadamard gate to <code>i</code>th qubit to construct <code>i</code>-th <code>B</code> block.</p><pre><code class="language-julia hljs">B(n, k) = chain(n, j==k ? put(k=&gt;H) : A(j, k) for j in k:n)</code></pre><pre><code class="nohighlight hljs">B (generic function with 1 method)</code></pre><p>We need to input the total number of qubits <code>n</code> here because we have to iterate through from <code>k</code>-th location to the last.</p><p>Now, let&#39;s construct the circuit by chaining all the <code>B</code> blocks together</p><pre><code class="language-julia hljs">qft(n) = chain(B(n, k) for k in 1:n)
qft(4)</code></pre><pre><code class="nohighlight hljs">nqubits: 4
chain
├─ chain
│  ├─ put on (1)
│  │  └─ H
│  ├─ control(2)
│  │  └─ (1,) shift(1.5707963267948966)
│  ├─ control(3)
│  │  └─ (1,) shift(0.7853981633974483)
│  └─ control(4)
│     └─ (1,) shift(0.39269908169872414)
├─ chain
│  ├─ put on (2)
│  │  └─ H
│  ├─ control(3)
│  │  └─ (2,) shift(1.5707963267948966)
│  └─ control(4)
│     └─ (2,) shift(0.7853981633974483)
├─ chain
│  ├─ put on (3)
│  │  └─ H
│  └─ control(4)
│     └─ (3,) shift(1.5707963267948966)
└─ chain
   └─ put on (4)
      └─ H
</code></pre><h2 id="Wrap-QFT-to-an-external-block"><a class="docs-heading-anchor" href="#Wrap-QFT-to-an-external-block">Wrap QFT to an external block</a><a id="Wrap-QFT-to-an-external-block-1"></a><a class="docs-heading-anchor-permalink" href="#Wrap-QFT-to-an-external-block" title="Permalink"></a></h2><p>In most cases, <code>function</code>s are enough to wrap quantum circuits, like <code>A</code> and <code>B</code> we defined above, but sometimes, we need to dispatch specialized methods on certain kinds of quantum circuit, or we want to define an external block to export, thus, it&#39;s useful to be able to wrap circuit to custom blocks.</p><p>First, we define a new type as subtype of <code>PrimitiveBlock</code> since we are not going to use the subblocks of <code>QFT</code>, if you need to use its subblocks, it&#39;d be better to define it under <code>CompositeBlock</code>.</p><pre><code class="language-julia hljs">struct QFT &lt;: PrimitiveBlock{2}
    n::Int
end

YaoBlocks.nqudits(q::QFT) = q.n</code></pre><p>Now, let&#39;s define its circuit</p><pre><code class="language-julia hljs">circuit(q::QFT) = qft(q.n)</code></pre><pre><code class="nohighlight hljs">circuit (generic function with 1 method)</code></pre><p>And forward <code>mat</code> to its circuit&#39;s matrix</p><pre><code class="language-julia hljs">YaoBlocks.mat(::Type{T}, x::QFT) where T = mat(T, circuit(x))</code></pre><p>You may notice, it is a little ugly to print <code>QFT</code> at the moment, this is because we print the type summary by default, you can define your own printing by overloading <code>print_block</code></p><pre><code class="language-julia hljs">YaoBlocks.print_block(io::IO, x::QFT) = print(io, &quot;QFT($(x.n))&quot;)</code></pre><p>Since it is possible to use FFT to simulate the results of QFT (like cheating), we could define our custom <code>apply!</code> method:</p><pre><code class="language-julia hljs">using FFTW, LinearAlgebra

function YaoBlocks.apply!(r::ArrayReg, x::QFT)
    α = sqrt(length(statevec(r)))
    invorder!(r)
    lmul!(α, ifft!(statevec(r)))
    return r
end</code></pre><p>Now let&#39;s check if our <code>apply!</code> method is correct:</p><pre><code class="language-julia hljs">r = rand_state(5)
r1 = r |&gt; copy |&gt; QFT(5)
r2 = r |&gt; copy |&gt; circuit(QFT(5))
r1 ≈ r2</code></pre><pre><code class="nohighlight hljs">true</code></pre><p>We can get iQFT (inverse QFT) directly by calling <code>adjoint</code></p><pre><code class="language-julia hljs">QFT(5)&#39;</code></pre><pre><code class="nohighlight hljs"> [†]QFT(5)</code></pre><p>QFT and iQFT are different from FFT and IFFT in three ways,</p><ol><li>they are different by a factor of <span>$\sqrt{2^n}$</span> with <span>$n$</span> the number of qubits.</li><li>the <a href="https://quantumbfs.github.io/BitBasis.jl/stable/tutorial/#Conventions-1">bit numbering</a> will exchange after applying QFT or iQFT.</li><li>due to the convention, QFT is more related to IFFT rather than FFT.</li></ol><h2 id="Phase-Estimation"><a class="docs-heading-anchor" href="#Phase-Estimation">Phase Estimation</a><a id="Phase-Estimation-1"></a><a class="docs-heading-anchor-permalink" href="#Phase-Estimation" title="Permalink"></a></h2><p>Since we have QFT and iQFT blocks we can then use them to realize phase estimation circuit, what we want to realize is the following circuit:</p><p><img src="assets/phaseest.png" alt="phase estimation"/></p><p>First we call Hadamard gates repeatly on first <code>n</code> qubits.</p><pre><code class="language-julia hljs">Hadamards(n) = repeat(H, 1:n)</code></pre><pre><code class="nohighlight hljs">Hadamards (generic function with 1 method)</code></pre><p>Then in dashed box <code>B</code>, we have controlled unitaries:</p><pre><code class="language-julia hljs">ControlU(n, m, U) = chain(n+m, control(k, n+1:n+m=&gt;matblock(U^(2^(k-1)))) for k in 1:n)</code></pre><pre><code class="nohighlight hljs">ControlU (generic function with 1 method)</code></pre><p>each of them is a <code>U</code> of power <span>$2^{(k-1)}$</span>.</p><p>Since we will only apply the qft and Hadamard on first <code>n</code> qubits, we could use <code>Subroutine</code>, which creates a context of a sub-scope of the qubits.</p><pre><code class="language-julia hljs">PE(n, m, U) =
    chain(n+m, # total number of the qubits
        subroutine(Hadamards(n), 1:n), # apply H in local scope
        ControlU(n, m, U),
        subroutine(QFT(n)&#39;, 1:n))</code></pre><pre><code class="nohighlight hljs">PE (generic function with 1 method)</code></pre><p>we use the first <code>n</code> qubits as the output space to store phase <span>$ϕ$</span>, and the other <code>m</code> qubits as the input state which corresponds to an eigenvector of oracle matrix <code>U</code>.</p><p>The subroutine here uses <code>focus!</code> and <code>relax!</code> to manage a local scope of quantum circuit, and only activate the first <code>n</code> qubits while applying the block inside the subroutine context, and the scope will be <code>relax!</code>ed back, after the context. This is equivalent to manually <code>focus!</code> then <code>relax!</code></p><p>fullly activated</p><pre><code class="language-julia hljs">r = rand_state(5)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 5/5
    nlevel: 2</code></pre><p>first 3 qubits activated</p><pre><code class="language-julia hljs">focus!(r, 1:3)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 3/5
    nlevel: 2</code></pre><p>relax back to the original</p><pre><code class="language-julia hljs">relax!(r, 1:3)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 5/5
    nlevel: 2</code></pre><p>In this way, we will be able to apply small operator directly on the subset of the qubits.</p><p>Details about the algorithm can be found here: <a href="https://en.wikipedia.org/wiki/Quantum_phase_estimation_algorithm">Quantum Phase Estimation Algorithm</a></p><p>Now let&#39;s check the results of our phase estimation.</p><p>First we need to set up a unitary with known phase, we set the phase to be 0.75, which is <code>0.75 * 2^3 == 6 == 0b110</code> .</p><pre><code class="language-julia hljs">N, M = 3, 5
P = eigen(rand_unitary(1&lt;&lt;M)).vectors
θ = Int(0b110) / 1&lt;&lt;N
phases = rand(1&lt;&lt;M)
phases[0b010+1] = θ
U = P * Diagonal(exp.(2π * im * phases)) * P&#39;</code></pre><pre><code class="nohighlight hljs">32×32 Matrix{ComplexF64}:
    0.128531-0.244144im       0.148785-0.00221709im      0.103835+0.0775349im      0.103267-0.0247186im     0.104714+0.0805214im     0.217949-0.0248608im   -0.0843999-0.181705im      0.00947607-0.120857im      -0.164003-0.106777im    -0.00100725-0.0633241im  -0.00308514-0.0192681im     -0.165159+0.130353im    -0.0579719-0.0757416im    -0.0484269+0.268802im      0.102415+0.0408989im    -0.126924-0.0633807im       0.192042-0.0197789im      0.0495234+0.0554444im    0.0505547+0.219898im      -0.13809+0.133921im     -0.0162058+0.000744835im    0.249961-0.00507595im    0.0434185-0.046821im      -0.235529+0.156202im      0.0230385-0.0454533im    -0.0592899+0.286506im     0.0577032+0.0907729im      0.0094491-0.0862071im     0.0525272+0.231225im       0.121568-0.179937im      -0.161112+0.016825im      0.00610205-0.189567im
   -0.109382-0.156562im       0.255887-0.262709im        0.123611-0.0713309im    -0.0313342+0.251379im      0.102823+0.0140043im    0.0608146-0.0265146im    0.0853597+0.00803722im     -0.188653+0.192302im    -0.00383454+0.10042im        0.105953-0.104883im      0.106669+0.225429im      0.0708811-0.089855im     0.0031276+0.29707im        -0.08707+0.0795403im    0.0774181+0.313061im      0.109264+0.0600824im      0.0350283+0.189468im       -0.189762+0.13961im      0.0544951-0.0530363im    -0.143586-0.0737131im      0.015241-0.00705521im    -0.149463-0.0427179im      0.106215-0.0168774im     0.0711856-0.119842im       0.045192+0.0845821im    -0.0328075+0.127078im     -0.061038+0.0264823im     -0.0192429-0.127744im      0.0360481+0.0899193im     -0.121587-0.00684901im    -0.144293-0.0631987im     -0.0534934+0.201819im
   0.0270157-0.239474im     -0.0570825+0.0356865im       0.329482-0.234807im     -0.0425816-0.0509166im    -0.089913-0.113457im     -0.131937+0.0433017im    0.0925318+0.0189956im    -0.00225038+0.076732im     -0.0697842-0.107028im     -0.0401517+0.260739im     0.0353278-0.0599693im       0.14098+0.0891756im     0.122776+0.0234359im    -0.0760307+0.00659857im  -0.0558682+0.196068im     0.0234779+0.0156012im      0.0412025+0.00644248im      0.170353-0.145023im     0.0301255-0.0178331im     0.173434+0.0885067im      0.244607+0.0909497im    -0.0632143+0.0837331im      0.132529+0.054779im      -0.256775+0.0154584im     -0.153124+0.0595209im    -0.0469836+0.10231im      -0.170042+0.0362616im      -0.104447+0.237762im       -0.23012+0.00541029im   -0.0405622-0.128385im      0.0765742+0.194601im       0.0807638+0.127895im
  -0.0295948-0.0520986im    -0.0892303-0.155562im      -0.0984377-0.0988694im    -0.0144778-0.304927im      0.196253+0.156013im     0.0433403+0.198197im     0.0444162+0.176039im       -0.210264-0.0182699im      0.100333+0.254317im      0.0163309+0.175501im     0.0473975+0.0866425im     -0.152511+0.234327im     0.0819197-0.0241608im     -0.190313-0.0591363im    -0.107157-0.0144185im      0.10102-0.111884im        0.170346+0.125876im      -0.0621886+0.0293483im   0.00107037+0.00654466im  0.00846792+0.176444im      0.0809634+0.20116im       0.0428115+0.235583im     -0.0708071-0.11208im      -0.0151729+0.0504267im     -0.188198+0.00430837im     0.119871+0.053508im      0.154423-0.0635203im       0.119131-0.110334im     -0.0344275-0.0585279im    -0.0828154+0.0722931im     0.0994093-0.232463im      -0.0133292-0.040752im
   0.0654824-0.186462im     -0.0550625-0.00867237im    0.00580492-0.0453822im     0.0493358+0.0727873im     0.187663+0.00461375im   0.0463794-0.0805503im    -0.190999-0.00271781im      0.125358-0.021525im       0.229847+0.113009im       0.228063+0.108436im     -0.129466+0.087331im     -0.0935088-0.035898im     0.0142089-0.0576425im    -0.0780762-0.234037im     -0.207184-0.0168345im     0.311809-0.0416241im     -0.0810281-0.193687im       -0.112722+0.00143569im   -0.156103+0.00171299im   0.0927563+0.141768im      0.0325332-0.0716251im     0.0175824-0.0964525im   -0.00470449+0.11641im       -0.228193-0.0826326im      0.235705-0.0111572im    -0.0771964-0.0696281im     -0.03209-0.0177559im     -0.0838482+0.100535im       0.276074+0.104228im      -0.237629-0.0917998im     -0.140474+0.0221871im       0.141366-0.0763113im
    0.152636-0.0897686im     -0.328254+0.0978512im      0.0944663+0.0957772im    -0.0577952-0.139851im     -0.108034+0.0298218im    0.0764714-0.489251im     0.0995646+0.000251925im    -0.193988+0.0435452im     0.0440608+0.0198469im      0.146945-0.0226205im    -0.112706+0.0280131im     -0.117965-0.0188964im   -0.0129731-0.220321im     -0.0404509+0.0899865im     0.150786-0.120447im     0.0627779+0.0741366im     -0.0777112+0.118605im       -0.102224+0.11522im     -0.0300227-0.103361im    -0.0873312-0.184813im      0.0901276+0.0989687im    -0.0690353+0.0876659im      0.241333+0.0832914im    -0.0112232+0.0148499im     0.0273504+0.204937im      0.0525938+0.0866196im    0.0947417+0.0743913im       0.132685-0.0839086im     0.0815196-0.104469im    -0.00487183-0.111199im      0.0939783+0.0875532im      0.0397807+0.111755im
   0.0119171-0.024252im      0.0273574-0.103054im     -0.00245463-0.111793im      -0.141182-0.0269829im    0.0645435+0.020762im    -0.0398809-0.0661888im     0.142524-0.430741im       0.0142642-0.248197im     -0.0898238+0.0839329im      0.109836+0.0164273im    0.0394423+0.114356im     -0.0760838+0.010003im    -0.0075884+0.0340061im    -0.0706096+0.179502im    0.00271259+0.0123171im     0.115819-0.158141im    -0.000620407-0.225196im       0.0106419+0.0703136im    0.0517753-0.153529im    -0.0684976+0.105174im      -0.248317+0.0557641im     -0.190197-0.0999825im      0.166446+0.210435im     -0.0144207+0.0639239im    0.00148488-0.0443313im       0.15561-0.150797im     0.0391323-0.25586im     -0.000260506+0.233314im      -0.148045-0.0432147im      0.203136+0.0622703im     0.0810427-0.137793im       0.0234607+0.0340008im
    0.141311-0.161327im     -0.0597172-0.0179241im      -0.111192-0.104223im      -0.160681+0.00274522im   0.0412138-0.0625007im   -0.0871484-0.0725773im    0.0581936+0.116263im         0.24606-0.135513im       0.199708+0.154051im     -0.0414108+0.0822363im   -0.0947719+0.00823026im    -0.158087+0.0604124im   -0.0922698+0.140573im      0.0940977+0.193336im    -0.0498226+0.0230844im   -0.0320876-0.207626im       0.0419939+0.0738306im       0.114431-0.00953909im    0.159886-0.230248im      0.096204-0.230855im       -0.05237-0.132497im     -0.0858768+0.0558351im     -0.230057-0.181954im      0.0435005-0.195518im      0.0811239-0.101466im      0.0344958+0.152757im    -0.0288734+0.242471im        0.102166+0.127766im    0.000697219-0.0388536im      0.147161-0.228693im      -0.127018-0.0497618im      -0.106642+0.0602705im
   -0.170926+0.0148994im     -0.074125-0.195921im       0.0111506+0.133717im      -0.185267-0.132396im      0.078056+0.0278038im     0.148311-0.143621im     -0.216489-0.121537im       0.0663707+0.0366901im     0.0514281-0.488187im       0.101656+0.0653957im    -0.105008+0.0976096im    -0.0496345+0.0466095im   -0.0762218+0.0620471im      0.131703-0.168122im    -0.0792027+0.137239im     0.0542306+0.0633321im      0.0597624+0.0862152im      0.0697629-0.118556im     0.0493265+0.00469188im  -0.0139138+0.144098im      0.0234041-0.0990121im     -0.241333-0.0415036im    -0.0231744-0.153303im     -0.0226111-0.188433im     -0.0482212+0.0223188im      0.132587+0.0605641im   -0.0623045+0.110021im       0.0892312-0.0996396im    -0.0194936+0.0733622im      0.165545+0.111111im       0.245767-0.0786675im      0.0898021-0.100088im
  -0.0811412-0.166359im       0.241931-0.0736363im      -0.161986+0.0971239im     0.0866489-0.13089im      -0.098523-0.0804221im   -0.0281712-0.211505im      0.181161+0.0870343im      0.0538668+0.173286im       0.028653-0.0375501im     0.0578181-0.198547im    -0.0407395-0.038215im      0.0111977-0.0650689im   0.00555216+0.171785im       0.126937-0.0199692im    0.0079689-0.184295im      0.263924+0.00214306im    -0.0378268+0.0449856im     0.00943909-0.0676981im   -0.0100866+0.00361263im    0.364907-0.0279373im     -0.155599+0.24136im         0.21295+0.0674709im     0.0472919+0.180112im     -0.0639931+0.0331888im     -0.113169-0.184446im      0.0603455-0.00992816im    -0.06196+0.0911924im     -0.0196801-0.103536im      -0.166839+0.157738im      0.0811393-0.0686183im     0.0363223-0.165236im        0.151614-0.0191598im
   0.0888487-0.253846im     -0.0908663+0.00836489im     0.0121379+0.0282321im    -0.0646689-0.0519108im     0.043453+0.340776im      0.108511+0.0859524im     0.107126-0.0363546im     -0.0292566-0.01504im      0.00293213+0.0974451im      0.110686-0.244137im      0.263294-0.335505im       0.133244+0.108968im     0.0734916+0.0719476im    -0.0279767-0.159287im    -0.0761415-0.0219934im    -0.147068+0.0371133im      -0.241514+0.122258im       0.0417439+0.0931644im     0.117152+0.00621114im   0.0105703-0.00491171im    0.0940099-0.0611805im     -0.234991-0.051914im     -0.0492452+0.0541355im     -0.100396+0.0553847im      0.172998-0.101289im       0.146443-0.199734im     0.0858016+0.240369im       -0.154352-0.0322685im    -0.0421646+0.0932283im     0.0712711+0.0244597im     0.0484926+0.0198795im    -0.00818783-0.0669232im
   -0.132601-0.102047im      -0.185456-0.248944im       0.0842224+0.272048im      -0.162476+0.126219im    -0.0684045-0.02591im      0.0753807+0.164252im     0.0333944-0.0237307im     -0.0952596+0.0691744im    -0.0990164+0.153084im      -0.046091+0.046258im    -0.0435405+0.101279im       0.295741-0.289294im     -0.216235-0.248826im     0.00765121-0.0948634im    -0.115452-0.150723im     0.0210259-0.192444im       0.0349954-0.0934725im       0.153879+0.0436565im    0.0208687-0.0578509im   0.00658145+0.0650806im     -0.154309+0.0170671im    -0.0121697+0.109137im      0.0187791+0.000881466im  -0.0696844+0.0554457im      0.180111-0.0853169im    -0.0723733+0.246707im     0.0503153+0.157868im       0.0386192-0.0394353im     -0.210228-0.0899897im    -0.0809772+0.021943im     -0.0188344+0.00846209im    -0.0308734-0.0387805im
 -0.00688901-0.103469im       0.139851+0.000600343im   -0.0319314-0.117035im      0.0888148+0.211171im    -0.0556927-0.107685im     -0.036183-0.214215im     0.0643624-0.14776im        0.0112368-0.0383287im     -0.101006-0.0955281im      0.105631+0.277444im      0.188052-0.154084im     -0.0143379+0.0342564im     0.205974-0.260702im     -0.0591306-0.0296287im    -0.225588-0.0485424im   -0.0173779-0.0322463im      -0.141695+0.0117856im       0.143589-0.0649644im     0.201625-0.0212438im   -0.0797322-0.00798146im     -0.06225+0.0344395im      0.127528+0.218425im      0.0913425+0.0273038im      0.198078-0.229645im     -0.0189169-0.0815989im     0.0723352+0.0492051im   -0.0611092+0.0809212im      -0.020726-0.150843im       0.159153+0.0281138im     -0.128681+0.191486im     -0.0211006-0.148688im       -0.235341-0.087356im
   -0.219721+0.0202525im     0.0885902+0.154614im      -0.0226028-0.0541938im      0.165839-0.0151051im    -0.190131+0.00272262im    0.172816-0.121176im     0.0449984-0.109661im      -0.0821812+0.125888im       0.119795+0.158932im      0.0712074+0.205003im     -0.021493+0.178968im      0.0865316+0.130528im    -0.0256624+0.0948262im    -0.0218965-0.239952im     0.0508885-0.0226986im    0.0326844-0.0205342im      -0.105178-0.0603664im       0.204636-0.0444113im     0.247625+0.0575963im    -0.183848-0.144178im      -0.104117-0.00233442im   -0.0875907+0.0303901im    -0.0706964-0.198771im       -0.15954+0.161961im     -0.0993631+0.100397im      -0.193403-0.103028im     0.0652505+0.0198655im      -0.110028-0.030956im      0.0346919-0.162804im       0.249645-0.0650995im     -0.196878-0.067526im        0.172722-0.0920557im
  -0.0351988-0.136489im     -0.0543233-0.0170304im       0.120069+0.199725im      0.0944091-0.0305872im   -0.0425626-0.0366668im       -0.189-0.0240353im   0.00300841+0.0335394im      -0.162218-0.101142im    -0.00257679+0.0648226im      0.123501+0.165271im      0.133477+0.103211im     -0.0117341-0.124946im    -0.0981839+0.190089im      0.0931362+0.170616im    0.00426832-0.172362im    -0.0909661-0.0110232im       0.182673+0.114166im       -0.151396-0.0536748im     0.175942-0.0144243im     0.090571+0.159683im       0.130957-0.222488im     0.00539957+0.125426im    -0.00118244+0.176991im       0.159437-0.0983951im     -0.096958+0.0430591im      -0.17999-0.225452im       0.11149+0.115943im       0.0580475+0.148566im      0.0851334+0.0812538im     0.0837549+0.220875im      -0.100488+0.130958im        0.187744-0.243055im
   -0.087822+0.218484im      0.0911336+0.134388im        0.110337+0.192408im      0.0507042+0.199595im    -0.0441437-0.0349814im    0.0893625-0.0937502im   -0.0870157+0.121006im      0.00515677-0.20751im        0.228427+0.128571im     -0.0693985-0.0210805im      0.15279-0.192761im       0.257815+0.182052im    -0.0539763+0.0827362im     -0.016763+0.0181731im   -0.0179213-0.03141im       0.371965-0.185544im       0.0896137-0.0575884im      -0.106112+0.0313033im    0.0479356+0.0390536im    -0.200216+0.0744104im      0.084077-0.034068im       0.122857-0.0189004im      0.148147-0.0468642im    -0.0740285-0.0532507im    -0.0868441+0.0357299im      0.123839+0.0220705im   0.00175546+0.16724im         0.114888+0.141867im     -0.0365794+0.115335im         0.1067-0.0348765im      0.238379+0.0428488im      -0.126491+0.0759825im
   0.0526737+0.00179924im     0.198966-0.0713441im      0.0249242+0.019832im    -0.00170332-0.0789266im    -0.125417-0.0996548im   -0.0192029+0.0268938im    -0.029646+0.112092im      -0.0776024-0.0591447im     0.0395517-0.0684538im      0.173768-0.0941078im     0.190506-0.199312im      -0.155154-0.087653im     -0.216337-0.139988im     -0.0596107-0.238722im    -0.0516104+0.0215807im    0.0101212+0.0836922im       0.396384-0.243825im         0.14627+0.04978im     -0.0603054-0.0856019im   -0.0854614-0.136586im       0.197716-0.0610629im     -0.218083+0.121373im      0.0401236+0.081877im       0.180248+0.211897im     -0.0613928-0.175935im      0.0410733+0.0360828im   -0.0912419-0.00852703im      0.012153+0.0317292im      0.135384-0.00519145im    0.0631443-0.11008im       -0.110497-0.10304im           0.1028+0.148422im
   0.0734456-0.0495752im     0.0567361-0.0127391im      -0.321196+0.239619im       0.155257+0.0607371im     0.149726-0.219316im    -0.0611715-0.0360948im     0.126752+0.11841im        0.0856029+0.0580881im    -0.0618818+0.00455963im     0.139202+0.0397019im    -0.101541-0.0894143im     -0.132178-0.119733im    -0.0311017+0.192669im      0.0694113-0.0253952im   -0.0342907+0.0423318im    -0.112624+0.0839765im     0.00248907-0.188894im       0.0754563+0.0521228im    0.0390577+0.0654934im   -0.0941631+0.0347334im      0.149516+0.116465im      -0.194401+0.0932243im      0.199578-0.17141im       -0.143529+0.0306554im     0.0379806+0.262278im      0.0142127-0.0204544im       0.2007-0.0239418im     -0.0775432+0.16493im       -0.200518+0.0311891im     -0.128557+0.00211157im    0.0648732-0.0266894im      -0.277573-0.158511im
    0.192851-0.0366874im     0.0149603+0.0829909im     -0.0805333-0.150874im      0.0361685+0.0501852im    0.0739747-0.0109257im     0.105609+0.0623844im   -0.0587738+0.069653im       -0.163385+0.109114im     0.00751793-0.187996im      -0.285773-0.172211im    -0.0165283+0.113347im      -0.150645+0.0105862im    0.0188117-0.0819558im      0.170505-0.142912im     -0.123606-0.0910812im     0.155409-0.116319im      -0.0190332+0.0155613im      -0.136671-0.171367im      0.179683-0.327224im    -0.0770427+0.035461im    -0.00054071-0.164821im      0.0132226+0.0575226im      0.124294+0.0623323im     -0.109642+0.21954im      -0.0394018+0.138642im       0.149594+0.00216534im  -0.0284182+0.064365im      0.00762309+0.0349769im     -0.149412+0.050147im      0.0490818+0.249949im      -0.300009+0.0900689im     -0.0988242+0.0293034im
   -0.152267+0.0448965im      0.298275-0.0425425im       0.307546-0.113588im      0.0593781-0.253936im       0.15553-0.0856956im     0.132263-0.135671im     0.0149019+0.143822im       0.0045577-0.0747912im    -0.0147736+0.145981im     -0.0991936-0.0762093im    0.0457808+0.00678497im    0.0418217+0.050544im    -0.0708945-0.131834im      0.0697473+0.0498405im    0.0941118-0.049758im     -0.120699-0.0763579im     -0.0534415-0.0424297im       0.127615-0.212608im     -0.355685-0.0421389im   -0.0507471-0.16868im       0.0430508+0.0676884im     -0.120464+0.0436011im    -0.0446849+0.0819258im    -0.0710618-0.233097im       0.218152+0.179083im      0.0455669-0.0572216im    0.0309612+0.0428814im      0.0603649+0.0528009im    -0.0921692+0.043748im     0.00982222+0.201394im     -0.0944856-0.0719391im     -0.0124891-0.183024im
  -0.0094708-0.00550466im    0.0755409-0.0272521im      -0.130895+0.144546im      0.0341689+0.111464im       0.31158+0.0500856im   -0.0944611-0.1623im        0.164147-0.0797794im      -0.159613-0.00505133im   -0.0257115+0.123752im       -0.13743-0.0506578im      0.26979+0.177964im      -0.122525-0.157961im      0.132002-0.120329im      -0.133457-0.0885148im    0.0625401-0.0220441im   -0.0501744+0.0718248im     -0.0826527-0.126208im       0.0982913-0.263935im    -0.0668941-0.0268678im     0.115994+0.0377803im      0.237348-0.268446im       0.100876-0.227516im     0.00191441-0.110578im      -0.125954-0.0677704im     -0.120744-0.121555im     -0.0483584+0.0248983im   -0.0293615+0.052514im        0.149537-0.0618657im     -0.035708-0.175035im       0.126252-0.133714im       0.140304+0.00719649im     0.0173519+0.0599583im
     -0.1121-0.101304im       0.093567-0.0344275im       0.100177-0.0629413im    -0.0509805+0.0620485im   -0.0895725-0.266077im     0.0880412+0.132776im     -0.210044+0.159422im      -0.0289544+0.0979912im    -0.0128331+0.0112535im      0.156868-0.0578538im    -0.179274+0.102108im      -0.141624-0.115758im      0.345528-0.128574im      -0.115244+0.0560272im    -0.121242-0.124079im    -0.0393537-0.00842921im    -0.0540631+0.0509736im     -0.0622047+0.111195im     0.0212884+0.153219im     -0.179378+0.0361662im       0.12517-0.0365301im     0.0854779-0.125837im      -0.022154+0.0485383im       0.15704-0.0569431im     0.0398052-0.0780041im      0.261423-0.177733im      0.114118+0.116445im     -0.00291187+0.071548im      -0.257063-0.139755im       0.227763-0.208552im      -0.018596+0.0189454im      0.0446415-0.0350928im
    0.143839-0.022417im    -0.00727281-0.115935im      -0.0178294+0.0132958im   -0.00419675-0.0614495im   0.00509206+0.0402742im     0.215947-0.0879999im    -0.104977+0.0749797im      0.0594835-0.212646im     -0.0343666-0.0354616im     0.0935364-0.0739168im      0.21126+0.0820294im      0.174985-0.0546459im     0.112019+0.0713289im     0.0883655+0.0961944im    -0.302521-0.111909im    -0.0441318+0.0525465im      0.0661062+0.113633im    -0.000220708-0.157344im     -0.115874+0.162202im      0.107352-0.166087im      -0.185389-0.200171im      0.0814048+0.146337im       0.224192-0.300172im      0.0222925+0.00149361im   -0.0414676+0.0726698im     0.0485693+0.0215894im       0.1571-0.194059im       -0.210683+0.11398im      -0.0353567-0.123621im     -0.0733899-0.031289im     -0.0518222+0.000735202im     0.174229+0.21172im
   0.0800577+0.0811812im     0.0626263+0.164802im       -0.021643+0.0352689im     0.0637908-0.220127im      0.156396+0.0524595im   -0.0661333+0.0783065im   -0.0625538-0.150449im        -0.18097+0.159398im      0.0149154-0.0592281im     0.0457196-0.0122868im   -0.0187929+0.140578im      0.0697653+0.0291969im    0.0146649-0.16351im       0.0529159-0.0691583im     0.180066+0.097751im     0.0531578-0.199731im       0.0313559-0.24008im        -0.163683-0.0898512im      0.20871+0.220433im       0.10842-0.175173im     -0.0360694+0.0609208im     -0.108144+0.156246im      0.0182984-0.0615045im       0.14376-0.276528im      0.0600923-0.237339im      0.0210936-0.00158544im    0.224698+0.0605063im      -0.148579+0.0704959im    -0.0699764+0.181653im     -0.0389209-0.077194im     0.00200876+0.205644im      -0.0557828+0.159411im
    0.152908+0.110128im     -0.0164196-0.129703im        0.107215+0.0744719im    -0.0343797+0.198019im     0.0860663+0.0129053im   0.00141012+0.111762im     0.0397686+0.166536im       0.0364514+0.151225im     0.00432603-0.121727im       0.062424+0.129481im     0.0148775-0.0402014im     0.0193368+0.239857im     0.0552418-0.0183854im   -0.00222295+0.227567im     0.0199336+0.011851im     0.0852598+0.192248im       0.0124628-0.0968958im      0.0109778-0.250017im      0.106389-0.201077im    -0.0237574-0.120639im      0.0145103+0.268301im      0.0144061-0.164462im        0.17233-0.134353im      0.0208685+0.122114im       0.266998-0.262342im      -0.113598-0.0901622im     0.239681+0.0551328im       0.134386+0.0116543im     0.0474329-0.0677321im     0.0232687+0.108517im    -0.00275138-0.0572544im       0.230391-0.0652633im
    0.023314+0.0105406im     -0.148353-0.0734579im      0.0938203+0.0236118im      0.228854-0.28086im       0.265355+0.069378im    -0.0540679-9.99444e-5im  -0.0979815+0.0585011im       0.206735+0.0225401im    -0.0536332+0.0175021im     0.0817558+0.119081im   -0.00128765+0.091143im       0.141108-0.0924739im   -0.0134226+0.0820321im     0.0439612+0.0598777im   -0.0433626+0.119758im     0.0234441+0.052326im       0.0388954-0.0788892im      0.0882695+0.0804071im     0.108558-0.0396928im       -0.223-0.220286im     -0.0725893-0.150937im       0.172555+0.078338im       0.135425+0.101262im     -0.0478164+0.126857im    -0.00231883-0.123307im      0.0245959-0.333865im     -0.290105+0.0578576im       0.172282-0.243im         -0.158011-0.0108879im     -0.082189-0.0743256im     0.0172097+0.0399538im      -0.126832+0.0272212im
   0.0102528+0.0108287im     0.0896958+0.00376289im     0.0119223+0.145847im      -0.240631+0.0690021im   0.00889792+0.179028im    -0.0456013-0.100867im     -0.113863+0.190552im        0.125971+0.100506im     -0.0825048+0.160479im       0.142017+0.196328im    -0.0362942-0.250588im      -0.150215+0.0119009im     0.126391+0.00236354im     0.212701-0.146001im      0.245496+0.138556im      0.041776-0.276392im       -0.052474+0.1498im          0.147326-0.0861354im   0.00924476+0.142638im    -0.0159754+0.0441608im    -0.0339546-0.17971im      -0.0185474-0.0699769im      0.133958+0.154947im      0.0130751+0.0412466im    -0.0677294-0.0669284im   -0.00756539+0.0820509im     0.120491-0.29121im         0.127036-0.0867306im     -0.135858-0.0273574im    -0.0189474+0.0876669im     -0.179195+0.080949im       0.0384828+0.0638335im
    0.173632-0.0804757im    -0.0516458+0.0853671im     -0.0830587-0.124538im      0.0380731-0.0478031im   -0.0338127-0.22362im      -0.072131-0.0203198im    -0.137132-0.156313im        0.188865-0.00896376im   -0.0528778+0.135528im     -0.0511171-0.214256im     0.0249606-0.0127735im      0.212267-0.00320275im   0.0121355+0.0931613im     -0.246463-0.123482im     -0.131721+0.00856558im   0.0317296+0.0727239im       0.155358-0.00470037im      0.152055-0.0617387im     0.128342+0.119949im     0.0588006+0.0215693im    -0.0167371+0.104497im      -0.110564-0.145468im     -0.0124614+0.0567374im      0.033477-0.114157im      -0.037475+0.154681im       0.019192+0.0573739im     0.250866-0.0160623im       0.455259-0.223635im     -0.0260914+0.0570286im    0.00177124+0.125439im      -0.118301+0.147467im        0.107107+0.055901im
    0.128203+0.0153099im      0.172403+0.121812im        0.122444+0.143413im      -0.167546-0.0331129im   -0.0458933-0.0164249im    0.0741884+0.158365im      0.189892-0.11242im         0.180153+0.161043im      0.0775036+0.0993068im       0.01584-0.0457082im    0.0660225+0.0601044im   -0.00243877-0.181916im    0.00697102-0.125143im       0.160676+0.0806842im   0.00781802+0.174524im     0.0553355+0.0196647im      0.0544246+0.0955593im     -0.0511443-0.173698im     -0.037912+0.0969291im    0.0332653+0.207417im      -0.143072+0.134668im     -0.0980951+0.151695im      0.0518356-0.108431im     -0.0686429+0.0607706im     -0.123284+0.0563789im      0.256422-0.226765im    -0.0791239+0.130775im        0.134745+0.00792881im     0.331643-0.24147im      -0.0314836-0.121445im     -0.0655652+0.115215im       -0.086526-0.112031im
   -0.263593-0.104634im      -0.141049+0.154633im      -0.0581039-0.0175585im     0.0654482-0.131448im     0.0178143-0.0526753im     0.176617+0.17066im       0.137022+0.0207023im     -0.0333549-0.0689269im     -0.136799-0.230194im     -0.0262151+0.076392im       0.13959-0.167874im     -0.0543204-0.0970031im    -0.144538+0.143068im      -0.129318-0.0670734im     0.151399-0.249423im     0.0805316-0.122147im       0.0570712+0.161519im      -0.0700413-0.188656im      0.130685+0.00075771im  -0.0418496+0.0568169im     0.0198137+0.0781378im    0.00561614-0.167267im       0.154959-0.0609023im     0.0125883-0.208247im       0.234874-0.0059068im     0.0343527-0.0665011im    -0.107658-0.181909im         0.12711+0.0436986im     0.0504836-0.104623im      -0.104225-0.244725im      -0.181494-0.0744298im     -0.0715718+0.0749001im
     0.15559-0.0668802im     -0.120303-0.0137583im     -0.0623062+0.0209825im      0.112478-0.0230237im    -0.152042-0.16576im       0.129548-0.0576147im   -0.0648452-0.101058im     -0.00562664+0.223165im      -0.018751+0.192729im     -0.0563842-0.174677im    -0.0499099+0.0254527im    0.00224899+0.143906im     0.0511354+0.12177im       0.0902891-0.083707im    -0.0531387+0.156831im     -0.215333-0.266909im        0.206107+0.0644489im     -0.0713721-0.335022im     0.0339921-0.00118227im   -0.157402+0.020505im       0.029466-0.0715397im     0.0553789-0.0366827im     0.0572748+0.235638im      0.0700327-0.003287im       0.147131-0.06054im        -0.11538+0.027546im    -0.0892059-0.0127032im      -0.112362+0.0598966im     0.0809316-0.136806im     -0.0940413-0.0446601im      0.337235-0.225524im        0.011775-0.0504827im
    0.168268+0.226264im      0.0697726-0.0146596im     0.00268944+0.00279334im   -0.0154194-0.085144im    -0.0436387-0.248515im     0.0402046+0.0322311im    0.0409216-0.154802im       -0.134041-0.199778im      0.0338309+0.0929979im    -0.0526713+0.0541993im   -0.0327574-0.00231989im    0.0447495+0.0319675im   -0.0779652+0.0436668im    -0.0152391-0.235348im      0.152758+0.237762im     0.0066629+0.112427im      -0.0467847+0.218904im       0.0629507+0.196645im     0.0531001-0.216054im      0.146137+0.00822141im     0.058833-0.135023im       0.194003+0.0160045im      0.206206-0.0752213im     0.0319522-0.0811208im      0.130944-0.129604im       0.219488+0.0384562im    0.0518177-0.0292396im     -0.0849344-0.0410415im     -0.116347-0.0301766im     -0.133557-0.121321im     -0.0590698+0.0336387im       0.174835-0.353623im</code></pre><p>and then generate the state <span>$ψ$</span></p><pre><code class="language-julia hljs">psi = P[:, 3]</code></pre><pre><code class="nohighlight hljs">32-element Vector{ComplexF64}:
   -0.04815112741771709 + 0.03095862402740324im
    0.04906507964511133 + 0.1523661233212752im
   -0.09132659257338549 + 0.03704302039030877im
   -0.10153825911689139 - 0.14969305399813543im
    -0.0714516687131534 + 0.19296189426516203im
    0.41272440341838273 + 0.0im
    0.11099338009632059 + 0.03932704543084613im
   -0.06021370871163578 - 0.10950611535232206im
    0.10236078624723431 + 0.16153923581858093im
    0.08065393235512182 + 0.07256965853975067im
    -0.2171374267075911 - 0.02339268704142375im
   -0.04765042438712543 + 0.1926970214993705im
    0.08624400039350928 + 0.08096694423157856im
   -0.08630335694817436 + 0.13792682478759852im
   -0.01987409179005311 - 0.1089939599273324im
  -0.011493117827125796 - 0.2139010818846413im
   -0.10493413385902024 + 0.168569235920454im
 -0.0002742461570160934 + 0.10258773191018619im
    0.21254689614764266 + 0.27398560774172165im
  -0.015165547353146389 - 0.15302054675291454im
    0.04728911381091262 + 0.05758415848189982im
   -0.13472976030277534 + 0.08997076606019533im
    0.06888738227889912 - 0.18088381346725932im
   -0.09387256484894396 - 0.16270113881015724im
    -0.0940138571533109 + 0.16132572769228343im
   -0.12791456922536582 - 0.17105729358561889im
   0.012530347542491434 - 0.06289831251025732im
   -0.01967560690141991 - 0.03572365538071191im
      0.027769321030428 + 0.016252771784561488im
   -0.12750719172975664 - 0.022268200118358096im
    -0.1545261608599797 + 0.08185639518501436im
   0.033104321102800906 + 0.13535322387790277im</code></pre><p>In the phase estimation process, we will feed the state to circuit and measure the first <code>n</code> qubits processed by iQFT.</p><pre><code class="language-julia hljs">r = join(ArrayReg(psi), zero_state(N))
r |&gt; PE(N, M, U)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 8/8
    nlevel: 2</code></pre><p>Since our phase can be represented by 3 qubits precisely, we only need to measure once</p><pre><code class="language-julia hljs">results = measure(r, 1:N; nshots=1)</code></pre><pre><code class="nohighlight hljs">1-element Vector{DitStr{2, 3, Int64}}:
 011 ₍₂₎</code></pre><p>Recall that our QFT&#39;s bit numbering is reversed, let&#39;s reverse it back</p><pre><code class="language-julia hljs">using BitBasis
estimated_phase = bfloat(results[]; nbits=N)</code></pre><pre><code class="nohighlight hljs">0.75</code></pre><p>the phase is exactly <code>0.75</code>!</p><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../1.prepare-ghz-state/index.html">« Prepare Greenberger–Horne–Zeilinger state with Quantum Circuit</a><a class="docs-footer-nextpage" href="../3.grover-search/index.html">Grover Search »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.4.1 on <span class="colophon-date" title="Tuesday 21 May 2024 20:54">Tuesday 21 May 2024</span>. Using Julia version 1.10.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
