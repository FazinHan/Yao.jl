<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Quantum Fourier Transformation and Phase Estimation · Documentation | Yao</title><meta name="title" content="Quantum Fourier Transformation and Phase Estimation · Documentation | Yao"/><meta property="og:title" content="Quantum Fourier Transformation and Phase Estimation · Documentation | Yao"/><meta property="twitter:title" content="Quantum Fourier Transformation and Phase Estimation · Documentation | Yao"/><meta name="description" content="Documentation for Documentation | Yao."/><meta property="og:description" content="Documentation for Documentation | Yao."/><meta property="twitter:description" content="Documentation for Documentation | Yao."/><script data-outdated-warner src="../../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../search_index.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script><link href="../../../assets/indigo.css" rel="stylesheet" type="text/css"/><link href="https://yaoquantum.org/assets/favicon-light.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../index.html"><img src="../../../assets/logo.png" alt="Documentation | Yao logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../../index.html">Documentation | Yao</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../../index.html">Home</a></li><li><a class="tocitem" href="../../../quick-start.html">Quick Start</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../../../man/registers.html">Quantum Registers</a></li><li><a class="tocitem" href="../../../man/blocks.html">Blocks</a></li><li><a class="tocitem" href="../../../man/symbolic.html">Symbolic Computation</a></li><li><a class="tocitem" href="../../../man/cuda.html">CUDA extension - CuYao</a></li><li><a class="tocitem" href="../../../man/plot.html">Quantum Circuit Visualization</a></li><li><a class="tocitem" href="../../../man/automatic_differentiation.html">Automatic Differentiation</a></li><li><a class="tocitem" href="../../../man/yao2einsum.html">Tensor network backend</a></li><li><a class="tocitem" href="../../../man/simplification.html">Simplification</a></li><li><a class="tocitem" href="../../../man/bitbasis.html">BitBasis</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../1.prepare-ghz-state/index.html">Prepare Greenberger–Horne–Zeilinger state with Quantum Circuit</a></li><li class="is-active"><a class="tocitem" href="index.html">Quantum Fourier Transformation and Phase Estimation</a><ul class="internal"><li><a class="tocitem" href="#Quantum-Fourier-Transformation"><span>Quantum Fourier Transformation</span></a></li><li><a class="tocitem" href="#Wrap-QFT-to-an-external-block"><span>Wrap QFT to an external block</span></a></li><li><a class="tocitem" href="#Phase-Estimation"><span>Phase Estimation</span></a></li></ul></li><li><a class="tocitem" href="../3.grover-search/index.html">Grover Search</a></li><li><a class="tocitem" href="../4.shor-algorithm/index.html">Shor&#39;s Algorithm</a></li><li><a class="tocitem" href="../5.shor-9-code/index.html">Shor&#39;s 9 qubit code</a></li><li><a class="tocitem" href="../6.quantum-circuit-born-machine/index.html">Quantum Circuit Born Machine</a></li><li><a class="tocitem" href="../7.variation-quantum-eigen-solver/index.html">Variational Quantum Eigen Solver</a></li><li><a class="tocitem" href="../8.riemannian-gradient-flow/index.html">Riemannian gradient flow optimizer</a></li></ul></li><li><a class="tocitem" href="../../../performancetips.html">Performance Tips</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href="index.html">Quantum Fourier Transformation and Phase Estimation</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="index.html">Quantum Fourier Transformation and Phase Estimation</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/QuantumBFS/Yao.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/QuantumBFS/Yao.jl/blob/master/docs/src/examples/2.qft-phase-estimation/main.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><p><a href="/generated/examples/2.qft-phase-estimation/main.ipynb"><img src="https://mybinder.org/badge_logo.svg" alt/></a></p><h1 id="example-qft"><a class="docs-heading-anchor" href="#example-qft">Quantum Fourier Transformation and Phase Estimation</a><a id="example-qft-1"></a><a class="docs-heading-anchor-permalink" href="#example-qft" title="Permalink"></a></h1><p>Let&#39;s use Yao first</p><pre><code class="language-julia hljs">using Yao</code></pre><h2 id="Quantum-Fourier-Transformation"><a class="docs-heading-anchor" href="#Quantum-Fourier-Transformation">Quantum Fourier Transformation</a><a id="Quantum-Fourier-Transformation-1"></a><a class="docs-heading-anchor-permalink" href="#Quantum-Fourier-Transformation" title="Permalink"></a></h2><p>The Quantum Fourier Transformation (QFT) circuit is to repeat two kinds of blocks repeatly:</p><p><img src="assets/qft.png" alt="qft-circuit"/></p><p>The basic building block control phase shift gate is defined as</p><p class="math-container">\[R(k)=\begin{bmatrix}
1 &amp; 0\\
0 &amp; \exp\left(\frac{2\pi i}{2^k}\right)
\end{bmatrix}\]</p><p>Let&#39;s define block <code>A</code> and block <code>B</code>, block <code>A</code> is actually a control block.</p><pre><code class="language-julia hljs">A(i, j) = control(i, j=&gt;shift(2π/(1&lt;&lt;(i-j+1))))</code></pre><pre><code class="nohighlight hljs">A (generic function with 1 method)</code></pre><p>Once you construct the blockl you can inspect its matrix using <code>mat</code> function. Let&#39;s construct the circuit in dash box A, and see the matrix of <span>$R_4$</span> gate.</p><pre><code class="language-julia hljs">R4 = A(4, 1)</code></pre><pre><code class="nohighlight hljs">(n -&gt; control(n, 4, 1 =&gt; shift(0.39269908169872414)))</code></pre><p>If you have read about <a href="@ref tutorial-ghz">preparing GHZ state</a>, you probably know that in Yao, we could just leave the number of qubits, and it will be evaluated when possible.</p><pre><code class="language-julia hljs">R4(5)</code></pre><pre><code class="nohighlight hljs">nqubits: 5
control(4)
└─ (1,) shift(0.39269908169872414)</code></pre><p>its matrix will be</p><pre><code class="language-julia hljs">mat(R4(5))</code></pre><pre><code class="nohighlight hljs">32×32 Diagonal{ComplexF64, Vector{ComplexF64}}:
 1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im</code></pre><p>Then we repeat this control block over and over on different qubits, and put a Hadamard gate to <code>i</code>th qubit to construct <code>i</code>-th <code>B</code> block.</p><pre><code class="language-julia hljs">B(n, k) = chain(n, j==k ? put(k=&gt;H) : A(j, k) for j in k:n)</code></pre><pre><code class="nohighlight hljs">B (generic function with 1 method)</code></pre><p>We need to input the total number of qubits <code>n</code> here because we have to iterate through from <code>k</code>-th location to the last.</p><p>Now, let&#39;s construct the circuit by chaining all the <code>B</code> blocks together</p><pre><code class="language-julia hljs">qft(n) = chain(B(n, k) for k in 1:n)
qft(4)</code></pre><pre><code class="nohighlight hljs">nqubits: 4
chain
├─ chain
│  ├─ put on (1)
│  │  └─ H
│  ├─ control(2)
│  │  └─ (1,) shift(1.5707963267948966)
│  ├─ control(3)
│  │  └─ (1,) shift(0.7853981633974483)
│  └─ control(4)
│     └─ (1,) shift(0.39269908169872414)
├─ chain
│  ├─ put on (2)
│  │  └─ H
│  ├─ control(3)
│  │  └─ (2,) shift(1.5707963267948966)
│  └─ control(4)
│     └─ (2,) shift(0.7853981633974483)
├─ chain
│  ├─ put on (3)
│  │  └─ H
│  └─ control(4)
│     └─ (3,) shift(1.5707963267948966)
└─ chain
   └─ put on (4)
      └─ H
</code></pre><h2 id="Wrap-QFT-to-an-external-block"><a class="docs-heading-anchor" href="#Wrap-QFT-to-an-external-block">Wrap QFT to an external block</a><a id="Wrap-QFT-to-an-external-block-1"></a><a class="docs-heading-anchor-permalink" href="#Wrap-QFT-to-an-external-block" title="Permalink"></a></h2><p>In most cases, <code>function</code>s are enough to wrap quantum circuits, like <code>A</code> and <code>B</code> we defined above, but sometimes, we need to dispatch specialized methods on certain kinds of quantum circuit, or we want to define an external block to export, thus, it&#39;s useful to be able to wrap circuit to custom blocks.</p><p>First, we define a new type as subtype of <code>PrimitiveBlock</code> since we are not going to use the subblocks of <code>QFT</code>, if you need to use its subblocks, it&#39;d be better to define it under <code>CompositeBlock</code>.</p><pre><code class="language-julia hljs">struct QFT &lt;: PrimitiveBlock{2}
    n::Int
end

YaoBlocks.nqudits(q::QFT) = q.n</code></pre><p>Now, let&#39;s define its circuit</p><pre><code class="language-julia hljs">circuit(q::QFT) = qft(q.n)</code></pre><pre><code class="nohighlight hljs">circuit (generic function with 1 method)</code></pre><p>And forward <code>mat</code> to its circuit&#39;s matrix</p><pre><code class="language-julia hljs">YaoBlocks.mat(::Type{T}, x::QFT) where T = mat(T, circuit(x))</code></pre><p>You may notice, it is a little ugly to print <code>QFT</code> at the moment, this is because we print the type summary by default, you can define your own printing by overloading <code>print_block</code></p><pre><code class="language-julia hljs">YaoBlocks.print_block(io::IO, x::QFT) = print(io, &quot;QFT($(x.n))&quot;)</code></pre><p>Since it is possible to use FFT to simulate the results of QFT (like cheating), we could define our custom <code>apply!</code> method:</p><pre><code class="language-julia hljs">using FFTW, LinearAlgebra

function YaoBlocks.apply!(r::ArrayReg, x::QFT)
    α = sqrt(length(statevec(r)))
    invorder!(r)
    lmul!(α, ifft!(statevec(r)))
    return r
end</code></pre><p>Now let&#39;s check if our <code>apply!</code> method is correct:</p><pre><code class="language-julia hljs">r = rand_state(5)
r1 = r |&gt; copy |&gt; QFT(5)
r2 = r |&gt; copy |&gt; circuit(QFT(5))
r1 ≈ r2</code></pre><pre><code class="nohighlight hljs">true</code></pre><p>We can get iQFT (inverse QFT) directly by calling <code>adjoint</code></p><pre><code class="language-julia hljs">QFT(5)&#39;</code></pre><pre><code class="nohighlight hljs"> [†]QFT(5)</code></pre><p>QFT and iQFT are different from FFT and IFFT in three ways,</p><ol><li>they are different by a factor of <span>$\sqrt{2^n}$</span> with <span>$n$</span> the number of qubits.</li><li>the <a href="https://quantumbfs.github.io/BitBasis.jl/stable/tutorial/#Conventions-1">bit numbering</a> will exchange after applying QFT or iQFT.</li><li>due to the convention, QFT is more related to IFFT rather than FFT.</li></ol><h2 id="Phase-Estimation"><a class="docs-heading-anchor" href="#Phase-Estimation">Phase Estimation</a><a id="Phase-Estimation-1"></a><a class="docs-heading-anchor-permalink" href="#Phase-Estimation" title="Permalink"></a></h2><p>Since we have QFT and iQFT blocks we can then use them to realize phase estimation circuit, what we want to realize is the following circuit:</p><p><img src="assets/phaseest.png" alt="phase estimation"/></p><p>First we call Hadamard gates repeatly on first <code>n</code> qubits.</p><pre><code class="language-julia hljs">Hadamards(n) = repeat(H, 1:n)</code></pre><pre><code class="nohighlight hljs">Hadamards (generic function with 1 method)</code></pre><p>Then in dashed box <code>B</code>, we have controlled unitaries:</p><pre><code class="language-julia hljs">ControlU(n, m, U) = chain(n+m, control(k, n+1:n+m=&gt;matblock(U^(2^(k-1)))) for k in 1:n)</code></pre><pre><code class="nohighlight hljs">ControlU (generic function with 1 method)</code></pre><p>each of them is a <code>U</code> of power <span>$2^{(k-1)}$</span>.</p><p>Since we will only apply the qft and Hadamard on first <code>n</code> qubits, we could use <code>Subroutine</code>, which creates a context of a sub-scope of the qubits.</p><pre><code class="language-julia hljs">PE(n, m, U) =
    chain(n+m, # total number of the qubits
        subroutine(Hadamards(n), 1:n), # apply H in local scope
        ControlU(n, m, U),
        subroutine(QFT(n)&#39;, 1:n))</code></pre><pre><code class="nohighlight hljs">PE (generic function with 1 method)</code></pre><p>we use the first <code>n</code> qubits as the output space to store phase <span>$ϕ$</span>, and the other <code>m</code> qubits as the input state which corresponds to an eigenvector of oracle matrix <code>U</code>.</p><p>The subroutine here uses <code>focus!</code> and <code>relax!</code> to manage a local scope of quantum circuit, and only activate the first <code>n</code> qubits while applying the block inside the subroutine context, and the scope will be <code>relax!</code>ed back, after the context. This is equivalent to manually <code>focus!</code> then <code>relax!</code></p><p>fullly activated</p><pre><code class="language-julia hljs">r = rand_state(5)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 5/5
    nlevel: 2</code></pre><p>first 3 qubits activated</p><pre><code class="language-julia hljs">focus!(r, 1:3)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 3/5
    nlevel: 2</code></pre><p>relax back to the original</p><pre><code class="language-julia hljs">relax!(r, 1:3)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 5/5
    nlevel: 2</code></pre><p>In this way, we will be able to apply small operator directly on the subset of the qubits.</p><p>Details about the algorithm can be found here: <a href="https://en.wikipedia.org/wiki/Quantum_phase_estimation_algorithm">Quantum Phase Estimation Algorithm</a></p><p>Now let&#39;s check the results of our phase estimation.</p><p>First we need to set up a unitary with known phase, we set the phase to be 0.75, which is <code>0.75 * 2^3 == 6 == 0b110</code> .</p><pre><code class="language-julia hljs">N, M = 3, 5
P = eigen(rand_unitary(1&lt;&lt;M)).vectors
θ = Int(0b110) / 1&lt;&lt;N
phases = rand(1&lt;&lt;M)
phases[0b010+1] = θ
U = P * Diagonal(exp.(2π * im * phases)) * P&#39;</code></pre><pre><code class="nohighlight hljs">32×32 Matrix{ComplexF64}:
   0.0870984-0.266441im      0.0616938-0.0556091im     0.037793+0.0842484im      0.0964436-0.0981655im       0.13975+0.191359im      -0.192295-0.177334im     -0.111286-0.0602025im    0.0133182+0.0683707im    -0.0185347+0.0197355im      -0.333572+0.108067im      -0.161302+0.175026im        0.115417-0.102143im        0.216937+0.116519im      -0.122662+0.233951im    -0.0721234-0.0943811im    0.0858455+0.0599363im    -0.0271545-0.0699104im     -0.0693129+0.11739im       -0.0644752+0.0805346im     0.0534688-0.10696im     -0.000475664+0.0762641im    0.0253548-0.0176149im    -0.0505104-0.205186im    -0.0728537-0.00999279im     0.128558-0.158839im      0.187602+0.0238661im    0.0534836-0.0697693im     -0.177695+0.135524im      0.191643-0.00370725im  -0.0578705-0.126911im     0.0664872+0.172718im      0.0835355+0.208448im
   -0.187614+0.189856im       0.120333+0.0595373im     -0.29994-0.0872938im       0.182805+0.0055111im      0.177014-0.0666982im      0.131997+0.328469im     0.0499765+0.0625618im   -0.0752704+0.0608678im     0.0200913+0.0552229im     -0.0558134-0.0820087im     0.0382072+0.0958705im     -0.0791505-0.0836575im      0.0623758-0.0474833im     -0.140955+0.107772im      0.201005-0.0722763im     0.071058+0.124272im      0.0734764-0.0605153im       0.189368+0.106557im       -0.166716+0.00704083im   0.00748771+0.0857138im      0.0899374+0.0639095im   -0.0513677-0.133526im      -0.184869-0.376658im    -0.0677107-0.0904571im    -0.0897168+0.028308im      0.038422-0.0653866im    0.0719385-0.0459909im     0.0608727-0.0158211im   -0.0757134+0.138552im      0.148397+0.0498779im   -0.0972138+0.215276im      -0.121538-0.0550694im
  -0.0855234-0.0578632im      0.195502-0.00481888im  -0.0595932-0.0694304im      0.0520157-0.0918109im    -0.0618939-0.00710687im    0.0630273+0.0932817im    0.0633052-0.137307im     0.0196137-0.0521144im      0.106812+0.063768im        0.102886+0.0243559im      -0.29389-0.143714im        0.192984+0.081994im      -0.0340632-0.00928395im     0.180513+0.292245im     -0.187863-0.00973946im    0.111128-0.00976931im     0.241298-0.0185598im      -0.126673-0.000850992im     0.212468-0.231475im    -0.00191162+0.187581im       0.0309018-0.204485im    -0.0193237-0.133278im    -0.00144993-0.172099im    -0.0812583+0.0898458im      0.145706-0.266127im    -0.0912529-0.0541832im    0.0139945-0.0963359im    0.00091219-0.128711im     0.0120305-0.0380562im   -0.0353739+0.0449393im     0.125983-0.195638im      -0.185937-0.0876407im
  -0.0545867+0.151943im       -0.19615+0.133288im     -0.177411-0.0707922im      0.0782556-0.189426im     -0.0135844+0.083341im      0.0539749-0.137271im    -0.0557778+0.0986524im   -0.0283617-0.235118im      0.0802412-0.0880573im     -0.0592593-0.017142im     -0.0296364-0.0406968im      -0.124158+0.0700031im     -0.0370717+0.166714im       0.105871+0.101896im     -0.014306+0.0561488im    -0.155884+0.00804244im     0.297624-0.00392687im     -0.132584-0.0197082im     -0.0698728+0.152592im      -0.141271-0.241381im      -0.0582735+0.144593im      0.156048-0.0333273im     -0.162697+0.0707809im     0.241154+0.0701667im      0.039329-0.094234im     0.0227569-0.18415im       0.145478-0.156053im     0.00438647-0.253684im     0.0372565-0.00969179im   -0.200811+0.20354im     -0.0843726+0.100773im      0.0970856+0.0100096im
  -0.0897247-0.27959im        0.219128+0.0775595im   -0.0577772-0.274154im      -0.0437377-0.235442im     -0.0990304-0.342754im      0.0697672-0.0461726im     0.011472+0.0760508im    -0.109432+0.115858im      0.0963839-0.0997722im      0.0202453+0.0895273im     -0.115996-0.0529127im      -0.118407-0.00193563im      0.121487+0.00261859im    -0.152102-0.0692566im    -0.031052+0.144328im    -0.0587191-0.0339344im     -0.243279-0.0987717im   -0.000114483-0.0499222im       -0.01442-0.144038im      0.0485523-0.22647im       -0.0642371-0.00352333im    0.124074-0.0508724im     -0.166783+0.0923137im    0.0868591+0.062727im       0.181169+0.137167im     0.0454884-0.0403337im     0.102343+0.0409465im     -0.275478+0.0522307im    -0.147139+0.131173im     0.0125512-0.00202928im  0.00994355-0.0290987im     -0.118377-0.12334im
     0.11651+0.0125842im      0.078099+0.180095im     -0.130605-0.00987151im      0.118804-0.0149871im     -0.050578+0.108977im      -0.159787-0.0293824im     0.224414-0.0703219im    0.0796591-0.0175702im    -0.0782485+0.171798im        0.206398+0.0323056im    0.00710094-0.108879im       0.0293628-0.277005im     -0.00201643-0.19662im       0.0712197+0.197783im    -0.0026431+0.010785im    0.00973384+0.0842366im     -0.176689-0.0108064im       0.014399-0.0207216im       0.047765+0.177525im       0.172336-0.136387im      -0.0812671+0.0261824im     -0.24482+0.0210134im      0.121729+0.11363im        0.15577+0.0458343im     -0.282743-0.0919985im     0.120848+0.0980041im    0.0183064-0.0149155im     -0.162894-0.110606im    -0.0122796+0.141634im     -0.260105-0.0380898im   -0.0476603+0.111738im      -0.178174-0.175801im
  -0.0409995-0.104355im    -0.00832734-0.033075im     -0.248347+0.0266855im      -0.195904+0.0320395im    -0.0648174-0.12153im      -0.0699962-0.152244im     -0.192955-0.215842im     -0.322791+0.00206132im    0.0141818+0.0877925im      -0.164135+0.123736im      0.0214543-0.109552im        0.156317-0.0484377im       0.114253+0.0278222im     -0.174527-0.123353im     -0.164704+0.0454827im   -0.0870828-0.0273807im      0.142708+0.142159im       0.0107926-0.0101359im      0.0202719+0.296429im      0.0106395+0.191721im       0.0187408-0.152268im     -0.117126+0.0924716im    -0.0656067-0.0330967im     0.071623+0.0969307im     -0.120068+0.0421033im     0.129313-0.1261im        -0.11487+0.119696im       0.209579+0.0530435im    -0.147929+0.0140707im    -0.085058+0.149769im     -0.034284+0.0311107im     -0.231458+0.0275604im
    0.235211+0.104457im      -0.076027-0.217077im     0.0530791-0.0282968im       0.161081+0.124031im      -0.313455-0.10777im       -0.191892+0.0978346im     0.130735-0.176959im     0.0802552-0.236668im      0.0376528+0.0101384im   -0.000176578+0.121994im     -0.0624015+0.119155im       -0.239147-0.133105im        0.158447+0.171223im    -0.00607776+0.0302071im    0.0472108-0.038935im     0.0840056-0.0562113im     0.0369946-0.109163im      -0.0596946-0.0448473im      -0.121915-0.0101779im     -0.109051+0.155584im       0.0672631-0.0653849im    0.0476931+0.0776048im    -0.0133604-0.0414429im     0.190095+0.0225615im    0.00770544-0.0883249im    0.0978057-0.228308im    -0.0271984+0.248647im      -0.096554+0.0440606im   -0.0177034+0.198955im      0.186191+0.0361472im    0.0959205-0.0536134im     0.0928206-0.156685im
   0.0448615+0.021179im       0.078375-0.319439im    -0.0621165+0.124819im       -0.184706-0.0371344im     0.0655398+0.0156716im     0.0062266+0.151711im     0.0964224+0.0012785im    -0.162589-0.266897im      0.0410171-0.112368im      -0.0627602+0.105471im      0.0703663+0.127218im      -0.0139218-0.143336im      -0.0570686+0.0419094im      -0.11659-0.122337im     0.0909134+0.0252872im    0.0119565+0.0995179im     0.0223045-0.0233085im      0.0570743-0.213644im        0.222957-0.0146766im      0.151876-0.0506541im       0.170495-0.186688im     0.0415731+0.015456im      0.0560069-0.0325314im    0.0418583-0.151414im       0.107286-0.142229im     -0.144835+0.211279im      0.326342-0.0754107im    -0.0241401-0.0144715im    -0.187005+0.0319811im    -0.299614-0.0384797im   -0.0363282+0.0714385im      0.108714-0.00262454im
     0.23353+0.203447im     -0.0743899+0.215153im     -0.212183-0.114234im      0.00399007-0.0332008im    -0.0864765+0.0647846im     -0.284818+0.143302im     0.0702636+0.0936205im   -0.0990378+0.119095im       0.208022-0.0101361im      -0.220658-0.117664im      0.0550201+0.162903im       0.0275363+0.00937853im     0.0461843+0.0493645im     -0.102962+0.173341im    -0.0525915+0.116113im      0.146681-0.247019im     -0.0931396+0.156236im      0.00340945-0.219412im       0.0346611-0.12683im       -0.102992-0.147627im        -0.12855-0.123464im     0.0313312+0.0498232im    -0.0855421-0.0246615im   -0.0622663-0.167063im     -0.0182748+0.00634722im    -0.16332+0.0727789im    -0.250269+0.0119337im     0.0334659-0.00236364im   -0.107498-0.132792im     -0.097476-0.0623823im   0.00701959-0.111431im      -0.021028+0.0640518im
   0.0470445+0.0106055im     0.0147448-0.0789131im    0.0542606+0.157434im        0.281162+0.0381351im     -0.122225-0.11878im      -0.0989759+0.0506644im    -0.046737+0.153701im    -0.0727797+0.0335339im    -0.0148025-0.0356091im      -0.158593-0.0868763im    -0.0659991-0.153995im      -0.0449588-0.0815834im     -0.0532014-0.176951im      0.0114767-0.0717863im   0.00936914+0.194604im     -0.165606+0.047383im       0.177766-0.0176805im      -0.101822-0.155964im       -0.105195-0.0532168im     0.0681232-0.0090039im       0.119385-0.0525259im   -0.0127094-0.370365im     -0.0892167-0.0167812im     0.242412-0.0351104im    -0.0592697+0.0906233im    0.0911589+0.257663im    -0.0136561+0.0164702im     0.0632086+0.244293im      0.242425-0.263234im    -0.0389404+0.016565im      0.157495+0.0114967im    -0.0923667-0.0983764im
   0.0980868-0.00536953im    0.0297726-0.0757466im    -0.113364-0.214571im      -0.0536726+0.241166im        0.10023-0.0538502im     0.0557605+0.05349im      -0.172208-0.119394im     0.0144358+0.0499226im    -0.0152252+0.0773511im       0.134114+0.0067293im     -0.101183+0.000377992im   -0.0559317-0.0052824im     -0.0729259+0.231658im      -0.146638+0.169727im     -0.100177+0.200918im     0.0178763+0.0312347im   -0.00947204-0.134489im      -0.0341152-0.102698im       -0.123514-0.147407im      -0.113711+0.21993im        0.0375143+0.159131im     -0.224846+0.0354368im    -0.0751125+0.290934im     -0.170112-0.120328im     -0.0774467+0.0948168im   -0.0485596-0.0770812im     0.218245+0.0457828im    -0.0656635-0.00154516im    0.148735-0.266693im     -0.210279-0.0277561im    0.0217354+0.200094im      0.0476613-0.0295235im
    0.194614-0.148969im     -0.0722737+0.0436066im   -0.0534831+0.0342784im     -0.0593314-0.0504635im    -0.0594893+0.117im         -0.132433-0.178704im     -0.123851+0.0615314im     0.177083-0.222892im      -0.149868+0.0209498im      -0.019709+0.0925076im    0.00657295-0.141987im       -0.172578-0.000624909im   -0.0786777-0.290604im     -0.0866478-0.0973796im   -0.0197232+0.161695im      0.110557-0.0432036im     -0.171631-0.0429728im      0.0870451-0.0787339im     -0.0495713-0.209107im      -0.149083+0.0526525im      0.0466706+0.144678im    -0.0778496+0.100041im      -0.169251-0.200934im    -0.0682061+0.0974121im     0.0943156-0.183048im     -0.124876+0.129296im     0.0927029-0.0421687im       0.16985-0.12907im      -0.101324-0.0536055im     0.183328+0.202994im     0.0292638+0.182362im      -0.181902+0.0374417im
    0.117083-0.139411im      0.0122259+0.0344911im   -0.0284034-0.118524im       0.0546297+0.285965im       0.111079+0.11265im       0.0763946+0.0530862im     0.223756-0.0784956im      0.15835+0.0510853im    -0.0499183-0.0194806im      0.0142357-0.00104582im    0.0190543+0.180448im        0.162781-0.0708im         0.0252986-0.0583429im    -0.0498635-0.299293im     -0.154922-0.0129897im    0.0227859-0.0225414im      0.118844+0.180128im       -0.198996-0.14012im       -0.0236233+0.0545823im      0.156542-0.146875im      -0.0584985+0.0904941im    -0.121921-0.187268im      -0.117064+0.0119957im      0.10128+0.00960964im   0.00836712+0.0419479im    -0.177623-0.293685im     0.0990046-0.215012im     -0.0253396+0.0413596im    -0.170962+0.0128831im     0.138218+0.0716621im      0.27568+0.0267584im    -0.0167683+0.0984175im
  0.00994569+0.067521im       0.126725+0.0959462im   0.00573496-0.120973im        -0.10674+0.00349805im    0.0653634+0.0549615im     -0.100048-0.0579007im   -0.0504754+0.0461993im     0.117444+0.0756611im     0.0657229+0.00993486im   -0.00102938-0.10767im        0.219474-0.256508im      0.00989289-0.101457im       -0.126164+0.173159im      0.0639025+0.0352073im   -0.0777572-0.225im        0.0615507+0.0622056im    -0.0921733-0.117304im       -0.112499+0.288825im       -0.224062-0.0543351im     0.0989317+0.0681967im     -0.0397994-0.162627im      0.157568+0.033311im      -0.139236+0.0533387im     0.199542-0.181749im      0.0191484-0.0946156im    -0.153761+0.10014im        0.13352+0.153423im       0.170674+0.198374im    -0.0921072+0.121769im     -0.131164+0.152929im      0.286511+0.0158119im    -0.0202688+0.0935955im
    0.021655+0.0871055im     0.0393704+0.0996005im     0.117261+0.148237im      -0.0405796+0.016915im        -0.1584-0.123455im     -0.0265311+0.181071im    -0.0881029-0.0814055im      0.11974-0.00320449im    -0.314566-0.0421885im       0.227186-0.0222735im    -0.0543936+0.0125498im       0.132976-0.0839384im      -0.132625+0.0563913im    -0.0440975-0.0268045im   -0.0815527+0.161173im     0.0960495-0.382006im      0.0531967-0.00170959im    -0.0611513+0.196925im      -0.0754386+0.294529im      0.0712672-0.0791818im      0.0926687-0.102059im         0.179+0.0575295im     -0.144882-0.0925094im   -0.0751211-0.214398im       0.213687-0.00203958im   0.0412195+0.00737739im  -0.0323027-0.12637im       -0.138128+0.0270497im   -0.0341243-0.120028im     -0.037142+0.0231628im    -0.146744+0.164162im     -0.0811264-0.0831329im
   0.0670498+0.1666im        -0.147418-1.10124e-5im   -0.110986-0.0207191im      0.0716021-0.135641im      0.0616738+0.106594im       0.191925-0.0776067im    0.0849849+0.062586im     0.0803031+0.0794085im     -0.141236+0.0386301im       0.186688+0.160173im     -0.0442332-0.0886832im     -0.0261318+0.149434im        0.010905+0.0305422im     -0.111225+0.0329025im    -0.241922+0.22526im      -0.173898+0.0145927im    -0.0871176-0.0160956im      0.0270272-0.0892985im     -0.0259812-0.0172823im     0.0816578-0.0195865im       0.349996-0.00887509im   0.0750583-0.0596392im     0.0884734-0.228919im    -0.0616108-0.105115im      -0.176973-0.0434088im    0.0676148-0.038115im    -0.0652877+0.207133im      -0.174677+0.137101im     -0.102317+0.0897378im   -0.0834413+0.122574im     0.0694472-0.183346im      0.0995302+0.320685im
  -0.0315088+0.023591im      0.0566568+0.0505663im     0.306016-0.0787281im    -0.00720853-0.170815im      -0.060104-0.0584591im    -0.0433616-0.145633im     -0.072614-0.093128im     -0.133052-0.01332im       -0.137615-0.0138461im      -0.131025-0.0485027im     -0.149516-0.0406769im     -0.0318314-0.228322im      -0.0405115-0.222687im      0.0844851+0.108295im     0.0640828+0.0198597im    0.0786747+0.0948672im      0.188144+0.0404595im      0.0563745-0.271661im       -0.294979+0.0315273im     0.0638537+0.108544im     -0.00994572+0.153545im      0.198982-0.0445816im     0.0954665+0.0836495im     -0.27678-0.206549im      -0.122776+0.0295762im    -0.196266-0.174589im    -0.0418608-0.069482im      0.0335974+0.034767im     -0.180309+0.187669im     -0.115598-0.0055264im    0.0190303-0.0396633im     0.0221032+0.0119547im
    0.141857+0.00384881im    0.0190092+0.0943927im    -0.114808+0.0225041im       -0.02345-0.128255im     -0.0757352-0.13233im     -0.00335481+0.0382351im    0.0961775+0.040127im     -0.145507-0.27596im        -0.17026-0.0256444im       0.227495+0.0714987im    -0.0660614+0.288071im       0.0839074+0.0895009im      -0.130003-0.0852011im     -0.220081+0.120425im    -0.0598098-0.161337im     0.0376092+0.0334566im      0.173247-0.0465269im       0.195371+0.122934im       -0.020747-0.0691032im       0.15327+0.0464812im      -0.351155+0.165298im     0.0490882-0.0307888im     0.0894976+0.0145926im   0.00922296+0.146432im      0.0679782+0.171848im    0.00494124+0.127515im    -0.0528412+0.096091im      0.0665601+0.162126im     0.0663719-0.0680365im   -0.0689081+0.183913im      0.195893-0.0159539im     0.0900475+0.106133im
  -0.0303065+0.0140685im     0.0279315-0.293514im     0.0765745+0.0189788im     0.00706781-0.195008im        0.36158+0.0396551im        -0.186+0.058381im     0.0215843-0.0539423im    0.0267853+0.00876442im    -0.151868-0.188096im        0.127099-0.0728281im      0.128586-0.03774im        0.0558021+0.13475im          0.04771+0.173874im     -0.0482643+0.0761187im    0.0725369+0.225648im    -0.0969727+0.0515404im    -0.0560538-0.00854342im     0.0379469-0.160956im       -0.164604+0.0603797im      0.111631-0.106677im       -0.170047-0.115376im    -0.0362637-0.0482153im      0.120641-0.0299685im    0.0130434+0.0414228im      0.137878-0.0269619im    -0.123537-0.140313im      -0.23886+0.170619im      0.0804779-0.207237im      0.133291+0.0383624im    0.0386946+0.0428744im     0.162563+0.136407im       -0.21353-0.115481im
    0.037077-0.16992im      -0.0224126+0.0130205im    -0.270309-0.088776im       -0.152343+0.121232im       0.088949+0.121709im       0.215939-0.0292385im  -0.00633391-0.0220235im    0.0551178+0.0179267im     -0.132458+0.12856im       -0.0621667+0.0209287im     0.0631459-0.147175im       -0.299785-0.0375644im     -0.0573535-0.0908046im      0.102927+0.0127445im    0.0755252+0.175109im      0.308267+0.157314im       0.158542-0.0282303im       0.116257-0.0558379im     -0.0317124+0.0783369im      0.110555+0.0837665im      -0.200161-0.187661im      0.177622-0.0572993im     0.0779755+0.0175085im     0.183738-0.0590595im      0.176672-0.0609488im    0.0932941-0.039144im     -0.259402+0.00438321im    -0.160051+0.0519131im   -0.0387118-0.17005im       0.045682-0.142571im    -0.0448961-0.0069977im      0.153004+0.0246972im
   -0.187537+0.00242421im   -0.0874013-0.201524im     0.0403182-0.0202838im      0.0543312+0.0091854im    -0.0245175+0.136595im     -0.0519045+0.0224456im     0.307481-0.207007im     0.0263146-0.122141im      0.0957273+0.293778im       -0.032569+0.0390531im     0.0660287-0.132456im        0.175352+0.012188im        0.210344-0.11771im      -0.0444507-0.00660993im    0.103048+0.0287702im    0.0676045-0.102768im      -0.179786-0.198529im      -0.0576644+0.00997663im   -0.00790464-0.0370867im   -0.00577851+0.139544im     -0.00553439+0.0827166im     0.239752-0.149617im      -0.158349+0.0913438im    0.0211534-0.00222917im     0.113821+0.325063im    -0.0382844+0.0449196im    -0.115056-0.0684243im     0.0139129-0.116024im     0.0394581-0.0639057im    -0.163982+0.185518im     -0.130896+0.0245809im   -0.00618357+0.208234im
   -0.176167+0.0228111im       0.10003-0.089841im      0.083426-0.00415234im     0.0558009-0.224228im      -0.261207+0.0432453im     0.0550158-0.0449924im     0.116513+0.110525im     -0.108198+0.0852092im      0.119389+0.176772im       0.0147058+0.0227158im      0.127024-0.0813009im     -0.0302726-0.000882106im    0.0268644+0.0655516im     0.0138934-0.144012im     -0.110852+0.183388im     -0.017357-0.0284562im   -0.00462874+0.230898im      -0.0790304+0.0392513im     -0.0577582+0.100149im    -0.00821293+0.218216im       -0.303633+0.0391165im     -0.24351+0.0972059im     0.0096369-0.24814im     -0.0507538-0.113578im    -0.00100054-0.0325571im    -0.132022+0.105004im     0.0428829-0.0122521im     -0.181202-0.0852875im    0.0623015-0.0198274im    0.0259379+0.0560877im     0.156154+0.191604im        0.34558-0.0721017im
  -0.0892552-0.180962im      -0.121823-0.156446im     -0.119886+0.080128im       0.0510737-0.0808435im     0.0416712+0.132179im     -0.0830931-0.100246im      0.045229+0.17313im      0.0698621+0.1245im        0.0790931-0.00377397im     0.0628318-0.24898im       0.0859155+0.077455im       0.0404849-0.138621im      -0.0951433-0.187435im      -0.190513-0.0899144im   -0.0819613-0.21633im      0.0865986-0.13227im        0.196447-0.0817993im        0.14157-0.013897im       -0.121335+0.0791908im     -0.234851+0.00627271im     0.0354246-0.230709im     0.0289425-0.0586239im     0.0172947+0.123924im     -0.195452+0.0133604im    -0.0374015-0.00843794im   0.0567855-0.0502966im     0.169199+0.209358im      -0.311556-0.143915im    0.00385094-0.0918984im   -0.0082648+0.181903im     0.0426661-0.138869im     -0.0401191-0.10798im
   -0.129814-0.0982165im   -0.00331827+0.221729im     0.0259013-0.116453im       0.0386143+0.144622im      -0.189032+0.0819597im      0.117896+0.16347im      -0.142957-0.0331423im     0.126378-0.154464im       0.188517-0.15822im        -0.066467+0.155116im       0.069554-0.06699im         0.378549+0.0473426im      -0.104411+0.0193804im     0.0234743-0.0857298im     0.147753+0.0669798im    0.0260775+0.09951im      -0.0431057-0.263275im        0.230538-0.30112im        -0.100317+0.139715im     -0.0781918-0.0957772im     -0.0313256-0.0969634im    -0.066914+0.159932im      0.0249415-0.0696123im   -0.0416894-0.052387im     0.00129922-0.0509787im    0.0505617+0.0202836im   -0.0805335-0.0316119im      -0.07935+0.0949249im      0.22039+0.107575im     -0.026599+0.156598im      0.128886-0.0282688im     0.0386118+0.0191133im
  -0.0432544+0.147512im      0.0450074-0.0491901im    -0.080429+0.0312335im     -0.0324676-0.14314im      -0.0761348+0.126972im     -0.0446174+0.197916im     -0.229837+0.174354im    -0.0173839-0.207693im      -0.262715+0.0875993im      -0.270004-0.0714189im      0.177029-0.184181im        0.182253+0.0808754im      0.0249198-0.0248997im    -0.0288617-0.0392025im    -0.016411+0.0680475im     0.251407-0.0649681im     0.0235832+0.0468763im      -0.138936+0.0819452im      0.0943509-0.272582im        0.20165-0.0846046im      0.0592505+0.0419532im    -0.160613-0.0451969im     0.0259987+0.218284im    -0.0882308+0.0843882im    -0.0316457+0.0841537im     0.171843-0.225857im     0.0406033+0.0547237im     -0.125823+0.0519849im    0.0122953+0.175606im     0.0392303+0.0328465im   0.00525038-0.0164354im     0.0998298-0.0757284im
   0.0720234-0.0576859im     -0.141915+0.119222im     -0.276043+0.187986im      -0.0993768-0.238797im    -0.00887486-0.121932im      -0.156667+0.138801im    -0.0832731-0.00441349im    0.171134+0.114907im     0.00451938+0.216179im        0.125492-0.0300209im    -0.0123559-0.0308618im     -0.0136777-0.203967im      -0.0189951+0.128307im     -0.0441077-0.318007im       0.06927-0.1386im       -0.248966+0.0387296im    -0.0531307-0.0971255im     -0.0461053-0.143135im      -0.0398884-0.15644im       0.0765619+0.17679im       -0.0471606+0.0856325im    0.0709882-0.0251265im     0.0319585-0.0474177im   -0.0989964-0.054389im       0.124263-0.0894415im     0.114685-0.160173im    -0.0875926-0.238482im       0.093639-0.0500819im     0.159164+0.0689525im    -0.123399-0.137102im     0.0682897-0.12632im       0.0631083-0.026682im
 -0.00415356+0.119763im      0.0846317-0.0561432im   -0.0626248-0.000907429im    -0.236884+0.146887im      0.0177026+0.00685853im     0.125459-0.114053im     -0.140749-0.0237978im    0.0784867-0.153591im     0.00250877-0.0060394im      -0.174595-0.0495766im   -0.00518814+0.174461im       0.0334409+0.018738im      -0.0918771-0.292174im     -0.0422115+0.151569im    -0.0446416+0.07095im      -0.236281-0.0933147im     -0.194773-0.147718im        -0.18118+0.103754im      -0.0246824+0.0177267im    -0.0885679+0.0191774im     -0.0935272-0.0676577im    0.0922945-0.0482992im      0.111309-0.233397im     0.0564062-0.15672im      -0.0746707+0.224155im      0.158765-0.0717776im    0.0271824-0.0405762im    0.00142609-0.258091im    -0.0401631+0.0202028im   -0.0478927-0.155123im      0.314125-0.0822554im     0.0559075-0.189858im
   -0.171628+0.00142971im    -0.130152+0.162834im     -0.142387+0.029538im      -0.0406356+0.0652441im     -0.111619-0.104882im     -0.0530867-0.110206im      0.306075-0.051352im     -0.127996-0.174458im       0.132043-0.0585533im    -0.00624823+0.0607793im      0.170138+0.0392624im     -0.0301564-0.132337im       -0.033071+0.0238356im      0.158801-0.0822031im    -0.105066+0.180198im     0.0119316+0.12158im       0.0718864-0.0519276im      -0.136011+0.130732im      -0.0111906-0.099235im       0.111065-0.164695im       0.0648368-0.0362724im     0.151898+0.00985548im     0.100759+0.0630336im     -0.40238-0.0732776im   -0.00664907-0.0480178im      0.10683-0.0323837im    0.0687912+0.184721im      0.0775451-0.0344993im     0.136479-0.0940985im     0.169383-0.182783im      0.124987+0.215834im      -0.166702+0.0972982im
   0.0513319+0.0934654im      0.119454-0.0952736im   0.00538093-0.0592948im     -0.0769615+0.134579im      0.0421949+0.0488733im     -0.199309+0.0268529im    -0.087165+0.184652im     -0.110053-0.207987im       0.123155-0.031525im        0.314907-0.0787378im     0.0521494-0.229762im      -0.0728388+0.0706738im       0.260665-0.160143im       0.105269+0.0195337im    -0.138882-0.17349im      -0.142923+0.0238693im      0.175332-0.173815im       -0.111773-0.120129im       -0.140946+0.0573154im    -0.0555926-0.109879im      -0.0778103-0.0259909im    -0.226465+0.0653237im    -0.0471257-0.0998269im    -0.134413-0.0502472im      0.196962+0.113861im      0.118566+0.0165128im   -0.0687594-0.102259im     -0.0821012+0.137223im     -0.170403+0.00652335im    0.028992-0.182862im    -0.0899764+0.00211319im    0.0167905+0.182785im
   -0.227675-0.173458im      -0.288678+0.00780582im   -0.131899+0.135906im      -0.0612367+0.0261717im     -0.137425+0.206344im    -0.00593658+0.0905878im  -0.00633814-0.0280944im    0.0130422-0.0447407im     -0.215746-0.0999513im     -0.0196739-0.0178099im     -0.282845-0.0888061im    -0.00333379-0.128148im       0.0105605+0.232999im       0.166911+0.0673326im    -0.138889-0.150253im    -0.0595744+0.0937203im    -0.0528122+0.0245422im       0.123021-0.00779938im    0.00218423-0.0827468im    -0.0923209-0.123814im       0.0542088-0.0262469im   -0.0892465-0.0581318im     -0.132431-0.0742818im   -0.0157197+0.0334438im   -0.00835475+0.329824im     -0.206305+0.123017im     -0.133431+0.108589im    -0.00200165+0.0118877im    -0.201335+0.0487694im   -0.0311463-0.134498im      0.130515+0.126838im      0.0863394-0.177748im
     0.15201+0.0823999im    -0.0727714-0.178562im     0.0191757+0.112414im       0.0538803-0.150318im     0.00433808+0.0239409im     0.0665345+0.124122im      -0.23199+0.0384494im    0.0870131+0.000445736im    0.281324+0.196947im        0.145955+0.150838im      0.0323373+0.0360507im       0.212915+0.0092146im      -0.108089+0.0691572im    -0.0456173-0.0329489im    -0.189161+0.116368im      0.212059+0.281814im     -0.0335046+0.0316208im     -0.0888978+0.0124803im     -0.0649159+0.106692im      -0.249703-0.075888im       -0.130283+0.0955496im     0.255072-0.170744im      0.0819827+0.0661914im  -0.00417682+0.0894477im     -0.105615+0.0398509im    0.0296814+0.110537im     0.0136668-0.0526117im     0.0101865+0.0855663im    -0.239352+0.0545852im     0.123709-0.161754im    -0.0119469+0.0961679im        -0.135-0.095545im</code></pre><p>and then generate the state <span>$ψ$</span></p><pre><code class="language-julia hljs">psi = P[:, 3]</code></pre><pre><code class="nohighlight hljs">32-element Vector{ComplexF64}:
   0.40184807947944745 + 0.0im
  -0.12139790673310381 - 0.2316789061649407im
  -0.03460758096785242 - 0.23767263239065278im
  -0.18924545877701257 - 0.14472573018291762im
   0.03414220822132552 - 0.183294108075429im
  -0.13172538725310068 + 0.20999493085646578im
  0.023584640782380248 + 0.03879780841555413im
   -0.1339747167745439 - 0.1283471997263434im
 0.0036871177658119314 - 0.0851869085898117im
 -0.037228886587165555 + 0.32193145496394016im
 -0.004824899966409581 - 0.0408085211771168im
  -0.10529468910417078 + 0.03337520726578899im
  -0.07319150281263703 + 0.07916193018809989im
   0.12007726252833716 - 0.01490760412888563im
  0.012009144392163785 - 0.027585611282706084im
   0.07881503944237854 + 0.13564872449910687im
  -0.19005462211592544 - 0.07956299219574625im
  -0.10498272389011667 + 0.05539338545893039im
  -0.10228809743617005 - 0.1704146824885052im
   -0.0206598373750419 - 0.06485408795446176im
  0.023272658020222256 + 0.1161414389434468im
   -0.1116542862677731 - 0.004212074108221685im
   0.10917584572621071 - 0.09140042249234016im
  -0.06290738179281452 + 0.1423781700820347im
   0.07589886250510226 - 0.22353474548276608im
 -0.050394262269602405 - 0.11712519908139628im
  -0.02298531338215958 + 0.0017243022755866165im
  -0.13961881270536597 + 0.12771617034488014im
 -0.024462691265659062 + 0.015218096108442419im
  -0.00113497517352254 + 0.102562564283741im
  -0.15211333482109338 + 0.020988545961235935im
  -0.15840200226573337 - 0.07042018088101817im</code></pre><p>In the phase estimation process, we will feed the state to circuit and measure the first <code>n</code> qubits processed by iQFT.</p><pre><code class="language-julia hljs">r = join(ArrayReg(psi), zero_state(N))
r |&gt; PE(N, M, U)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 8/8
    nlevel: 2</code></pre><p>Since our phase can be represented by 3 qubits precisely, we only need to measure once</p><pre><code class="language-julia hljs">results = measure(r, 1:N; nshots=1)</code></pre><pre><code class="nohighlight hljs">1-element Vector{DitStr{2, 3, Int64}}:
 011 ₍₂₎</code></pre><p>Recall that our QFT&#39;s bit numbering is reversed, let&#39;s reverse it back</p><pre><code class="language-julia hljs">using BitBasis
estimated_phase = bfloat(results[]; nbits=N)</code></pre><pre><code class="nohighlight hljs">0.75</code></pre><p>the phase is exactly <code>0.75</code>!</p><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../1.prepare-ghz-state/index.html">« Prepare Greenberger–Horne–Zeilinger state with Quantum Circuit</a><a class="docs-footer-nextpage" href="../3.grover-search/index.html">Grover Search »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.4.1 on <span class="colophon-date" title="Wednesday 5 June 2024 11:18">Wednesday 5 June 2024</span>. Using Julia version 1.10.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
