<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Quantum Fourier Transformation and Phase Estimation · Documentation | Yao</title><meta name="title" content="Quantum Fourier Transformation and Phase Estimation · Documentation | Yao"/><meta property="og:title" content="Quantum Fourier Transformation and Phase Estimation · Documentation | Yao"/><meta property="twitter:title" content="Quantum Fourier Transformation and Phase Estimation · Documentation | Yao"/><meta name="description" content="Documentation for Documentation | Yao."/><meta property="og:description" content="Documentation for Documentation | Yao."/><meta property="twitter:description" content="Documentation for Documentation | Yao."/><script data-outdated-warner src="../../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../search_index.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script><link href="../../../assets/indigo.css" rel="stylesheet" type="text/css"/><link href="https://yaoquantum.org/assets/favicon-light.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../index.html"><img src="../../../assets/logo.png" alt="Documentation | Yao logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../../index.html">Documentation | Yao</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../../index.html">Home</a></li><li><a class="tocitem" href="../../../quick-start.html">Quick Start</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../../../man/registers.html">Quantum Registers</a></li><li><a class="tocitem" href="../../../man/blocks.html">Blocks</a></li><li><a class="tocitem" href="../../../man/symbolic.html">Symbolic Computation</a></li><li><a class="tocitem" href="../../../man/cuda.html">CUDA extension - CuYao</a></li><li><a class="tocitem" href="../../../man/plot.html">Quantum Circuit Visualization</a></li><li><a class="tocitem" href="../../../man/automatic_differentiation.html">Automatic Differentiation</a></li><li><a class="tocitem" href="../../../man/simplification.html">Simplification</a></li><li><a class="tocitem" href="../../../man/bitbasis.html">BitBasis</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../1.prepare-ghz-state/index.html">Prepare Greenberger–Horne–Zeilinger state with Quantum Circuit</a></li><li class="is-active"><a class="tocitem" href="index.html">Quantum Fourier Transformation and Phase Estimation</a><ul class="internal"><li><a class="tocitem" href="#Quantum-Fourier-Transformation"><span>Quantum Fourier Transformation</span></a></li><li><a class="tocitem" href="#Wrap-QFT-to-an-external-block"><span>Wrap QFT to an external block</span></a></li><li><a class="tocitem" href="#Phase-Estimation"><span>Phase Estimation</span></a></li></ul></li><li><a class="tocitem" href="../3.grover-search/index.html">Grover Search</a></li><li><a class="tocitem" href="../4.shor-algorithm/index.html">Shor&#39;s Algorithm</a></li><li><a class="tocitem" href="../5.shor-9-code/index.html">Shor&#39;s 9 qubit code</a></li><li><a class="tocitem" href="../6.quantum-circuit-born-machine/index.html">Quantum Circuit Born Machine</a></li><li><a class="tocitem" href="../7.variation-quantum-eigen-solver/index.html">Variational Quantum Eigen Solver</a></li><li><a class="tocitem" href="../8.riemannian-gradient-flow/index.html">Riemannian gradient flow optimizer</a></li></ul></li><li><a class="tocitem" href="../../../performancetips.html">Performance Tips</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href="index.html">Quantum Fourier Transformation and Phase Estimation</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="index.html">Quantum Fourier Transformation and Phase Estimation</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/QuantumBFS/Yao.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/QuantumBFS/Yao.jl/blob/master/docs/src/examples/2.qft-phase-estimation/main.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><p><a href="/generated/examples/2.qft-phase-estimation/main.ipynb"><img src="https://mybinder.org/badge_logo.svg" alt/></a></p><h1 id="example-qft"><a class="docs-heading-anchor" href="#example-qft">Quantum Fourier Transformation and Phase Estimation</a><a id="example-qft-1"></a><a class="docs-heading-anchor-permalink" href="#example-qft" title="Permalink"></a></h1><p>Let&#39;s use Yao first</p><pre><code class="language-julia hljs">using Yao</code></pre><h2 id="Quantum-Fourier-Transformation"><a class="docs-heading-anchor" href="#Quantum-Fourier-Transformation">Quantum Fourier Transformation</a><a id="Quantum-Fourier-Transformation-1"></a><a class="docs-heading-anchor-permalink" href="#Quantum-Fourier-Transformation" title="Permalink"></a></h2><p>The Quantum Fourier Transformation (QFT) circuit is to repeat two kinds of blocks repeatly:</p><p><img src="assets/qft.png" alt="qft-circuit"/></p><p>The basic building block control phase shift gate is defined as</p><p class="math-container">\[R(k)=\begin{bmatrix}
1 &amp; 0\\
0 &amp; \exp\left(\frac{2\pi i}{2^k}\right)
\end{bmatrix}\]</p><p>Let&#39;s define block <code>A</code> and block <code>B</code>, block <code>A</code> is actually a control block.</p><pre><code class="language-julia hljs">A(i, j) = control(i, j=&gt;shift(2π/(1&lt;&lt;(i-j+1))))</code></pre><pre><code class="nohighlight hljs">A (generic function with 1 method)</code></pre><p>Once you construct the blockl you can inspect its matrix using <code>mat</code> function. Let&#39;s construct the circuit in dash box A, and see the matrix of <span>$R_4$</span> gate.</p><pre><code class="language-julia hljs">R4 = A(4, 1)</code></pre><pre><code class="nohighlight hljs">(n -&gt; control(n, 4, 1 =&gt; shift(0.39269908169872414)))</code></pre><p>If you have read about <a href="@ref tutorial-ghz">preparing GHZ state</a>, you probably know that in Yao, we could just leave the number of qubits, and it will be evaluated when possible.</p><pre><code class="language-julia hljs">R4(5)</code></pre><pre><code class="nohighlight hljs">nqubits: 5
control(4)
└─ (1,) shift(0.39269908169872414)</code></pre><p>its matrix will be</p><pre><code class="language-julia hljs">mat(R4(5))</code></pre><pre><code class="nohighlight hljs">32×32 Diagonal{ComplexF64, Vector{ComplexF64}}:
 1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im</code></pre><p>Then we repeat this control block over and over on different qubits, and put a Hadamard gate to <code>i</code>th qubit to construct <code>i</code>-th <code>B</code> block.</p><pre><code class="language-julia hljs">B(n, k) = chain(n, j==k ? put(k=&gt;H) : A(j, k) for j in k:n)</code></pre><pre><code class="nohighlight hljs">B (generic function with 1 method)</code></pre><p>We need to input the total number of qubits <code>n</code> here because we have to iterate through from <code>k</code>-th location to the last.</p><p>Now, let&#39;s construct the circuit by chaining all the <code>B</code> blocks together</p><pre><code class="language-julia hljs">qft(n) = chain(B(n, k) for k in 1:n)
qft(4)</code></pre><pre><code class="nohighlight hljs">nqubits: 4
chain
├─ chain
│  ├─ put on (1)
│  │  └─ H
│  ├─ control(2)
│  │  └─ (1,) shift(1.5707963267948966)
│  ├─ control(3)
│  │  └─ (1,) shift(0.7853981633974483)
│  └─ control(4)
│     └─ (1,) shift(0.39269908169872414)
├─ chain
│  ├─ put on (2)
│  │  └─ H
│  ├─ control(3)
│  │  └─ (2,) shift(1.5707963267948966)
│  └─ control(4)
│     └─ (2,) shift(0.7853981633974483)
├─ chain
│  ├─ put on (3)
│  │  └─ H
│  └─ control(4)
│     └─ (3,) shift(1.5707963267948966)
└─ chain
   └─ put on (4)
      └─ H
</code></pre><h2 id="Wrap-QFT-to-an-external-block"><a class="docs-heading-anchor" href="#Wrap-QFT-to-an-external-block">Wrap QFT to an external block</a><a id="Wrap-QFT-to-an-external-block-1"></a><a class="docs-heading-anchor-permalink" href="#Wrap-QFT-to-an-external-block" title="Permalink"></a></h2><p>In most cases, <code>function</code>s are enough to wrap quantum circuits, like <code>A</code> and <code>B</code> we defined above, but sometimes, we need to dispatch specialized methods on certain kinds of quantum circuit, or we want to define an external block to export, thus, it&#39;s useful to be able to wrap circuit to custom blocks.</p><p>First, we define a new type as subtype of <code>PrimitiveBlock</code> since we are not going to use the subblocks of <code>QFT</code>, if you need to use its subblocks, it&#39;d be better to define it under <code>CompositeBlock</code>.</p><pre><code class="language-julia hljs">struct QFT &lt;: PrimitiveBlock{2}
    n::Int
end

YaoBlocks.nqudits(q::QFT) = q.n</code></pre><p>Now, let&#39;s define its circuit</p><pre><code class="language-julia hljs">circuit(q::QFT) = qft(q.n)</code></pre><pre><code class="nohighlight hljs">circuit (generic function with 1 method)</code></pre><p>And forward <code>mat</code> to its circuit&#39;s matrix</p><pre><code class="language-julia hljs">YaoBlocks.mat(::Type{T}, x::QFT) where T = mat(T, circuit(x))</code></pre><p>You may notice, it is a little ugly to print <code>QFT</code> at the moment, this is because we print the type summary by default, you can define your own printing by overloading <code>print_block</code></p><pre><code class="language-julia hljs">YaoBlocks.print_block(io::IO, x::QFT) = print(io, &quot;QFT($(x.n))&quot;)</code></pre><p>Since it is possible to use FFT to simulate the results of QFT (like cheating), we could define our custom <code>apply!</code> method:</p><pre><code class="language-julia hljs">using FFTW, LinearAlgebra

function YaoBlocks.apply!(r::ArrayReg, x::QFT)
    α = sqrt(length(statevec(r)))
    invorder!(r)
    lmul!(α, ifft!(statevec(r)))
    return r
end</code></pre><p>Now let&#39;s check if our <code>apply!</code> method is correct:</p><pre><code class="language-julia hljs">r = rand_state(5)
r1 = r |&gt; copy |&gt; QFT(5)
r2 = r |&gt; copy |&gt; circuit(QFT(5))
r1 ≈ r2</code></pre><pre><code class="nohighlight hljs">true</code></pre><p>We can get iQFT (inverse QFT) directly by calling <code>adjoint</code></p><pre><code class="language-julia hljs">QFT(5)&#39;</code></pre><pre><code class="nohighlight hljs"> [†]QFT(5)</code></pre><p>QFT and iQFT are different from FFT and IFFT in three ways,</p><ol><li>they are different by a factor of <span>$\sqrt{2^n}$</span> with <span>$n$</span> the number of qubits.</li><li>the <a href="https://quantumbfs.github.io/BitBasis.jl/stable/tutorial/#Conventions-1">bit numbering</a> will exchange after applying QFT or iQFT.</li><li>due to the convention, QFT is more related to IFFT rather than FFT.</li></ol><h2 id="Phase-Estimation"><a class="docs-heading-anchor" href="#Phase-Estimation">Phase Estimation</a><a id="Phase-Estimation-1"></a><a class="docs-heading-anchor-permalink" href="#Phase-Estimation" title="Permalink"></a></h2><p>Since we have QFT and iQFT blocks we can then use them to realize phase estimation circuit, what we want to realize is the following circuit:</p><p><img src="assets/phaseest.png" alt="phase estimation"/></p><p>First we call Hadamard gates repeatly on first <code>n</code> qubits.</p><pre><code class="language-julia hljs">Hadamards(n) = repeat(H, 1:n)</code></pre><pre><code class="nohighlight hljs">Hadamards (generic function with 1 method)</code></pre><p>Then in dashed box <code>B</code>, we have controlled unitaries:</p><pre><code class="language-julia hljs">ControlU(n, m, U) = chain(n+m, control(k, n+1:n+m=&gt;matblock(U^(2^(k-1)))) for k in 1:n)</code></pre><pre><code class="nohighlight hljs">ControlU (generic function with 1 method)</code></pre><p>each of them is a <code>U</code> of power <span>$2^{(k-1)}$</span>.</p><p>Since we will only apply the qft and Hadamard on first <code>n</code> qubits, we could use <code>Subroutine</code>, which creates a context of a sub-scope of the qubits.</p><pre><code class="language-julia hljs">PE(n, m, U) =
    chain(n+m, # total number of the qubits
        subroutine(Hadamards(n), 1:n), # apply H in local scope
        ControlU(n, m, U),
        subroutine(QFT(n)&#39;, 1:n))</code></pre><pre><code class="nohighlight hljs">PE (generic function with 1 method)</code></pre><p>we use the first <code>n</code> qubits as the output space to store phase <span>$ϕ$</span>, and the other <code>m</code> qubits as the input state which corresponds to an eigenvector of oracle matrix <code>U</code>.</p><p>The subroutine here uses <code>focus!</code> and <code>relax!</code> to manage a local scope of quantum circuit, and only activate the first <code>n</code> qubits while applying the block inside the subroutine context, and the scope will be <code>relax!</code>ed back, after the context. This is equivalent to manually <code>focus!</code> then <code>relax!</code></p><p>fullly activated</p><pre><code class="language-julia hljs">r = rand_state(5)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 5/5
    nlevel: 2</code></pre><p>first 3 qubits activated</p><pre><code class="language-julia hljs">focus!(r, 1:3)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 3/5
    nlevel: 2</code></pre><p>relax back to the original</p><pre><code class="language-julia hljs">relax!(r, 1:3)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 5/5
    nlevel: 2</code></pre><p>In this way, we will be able to apply small operator directly on the subset of the qubits.</p><p>Details about the algorithm can be found here: <a href="https://en.wikipedia.org/wiki/Quantum_phase_estimation_algorithm">Quantum Phase Estimation Algorithm</a></p><p>Now let&#39;s check the results of our phase estimation.</p><p>First we need to set up a unitary with known phase, we set the phase to be 0.75, which is <code>0.75 * 2^3 == 6 == 0b110</code> .</p><pre><code class="language-julia hljs">N, M = 3, 5
P = eigen(rand_unitary(1&lt;&lt;M)).vectors
θ = Int(0b110) / 1&lt;&lt;N
phases = rand(1&lt;&lt;M)
phases[0b010+1] = θ
U = P * Diagonal(exp.(2π * im * phases)) * P&#39;</code></pre><pre><code class="nohighlight hljs">32×32 Matrix{ComplexF64}:
   -0.148967-0.210756im      0.0382539-0.0320266im    -0.065201+0.11947im        0.052696-0.0590179im    -0.0388538-0.0275501im    -0.182149-0.0963632im    -0.082026+0.100315im      0.176413-0.0863034im   -0.00529873+0.167645im      0.168827+0.0466704im     0.117577+0.0178437im   -0.0861506-0.166078im     0.0874351-0.0375619im     -0.172633+0.172649im        0.126856+0.0581677im   -0.0669465-0.0376254im  -0.0467078+0.168793im        0.179111-0.068878im    -0.0916477+0.0384155im  -0.00114861-0.174945im     -0.203163+0.0024509im       0.11901-0.0615189im     0.0116577+0.0832278im     -0.188841-0.151066im     0.00631115+0.113604im     -0.171127+0.28976im       0.0996682+0.0885551im    -0.139108-0.079775im      0.166454+0.283885im       0.121805+0.0987967im     -0.195855+0.0276505im     0.157219-0.0696604im
   0.0589154+0.227185im      -0.204271-0.014544im     0.0857916+0.13842im        0.128101-0.0737181im    -0.0313658+0.00438474im  0.00296938-0.0825416im   -0.0673333-0.0863335im     0.111571+0.196331im      0.0119601+0.00479841im   -0.170805+0.0857247im     0.166247+0.0154908im    0.0278852+0.0611832im    -0.346073+0.0471198im       0.10026-0.0770647im       -0.15857-0.0178998im    0.0606874-0.105945im   -0.0823946-0.209279im        0.112931+0.0886726im     0.158713-0.0156714im   -0.0464827+0.037456im      0.177193+0.0960321im      0.146199-0.287784im     -0.0684736+0.0747618im     -0.244001+0.0518208im    -0.0301554-0.0629176im    -0.130106+0.136817im      0.0390457+0.0471197im    -0.268284+0.0111294im    -0.027622+0.207427im     -0.0844497-0.0129182im     0.0185996+0.211556im    -0.0770689+0.019127im
    0.112168+0.13584im       0.0141221+0.132155im     -0.340796-0.0739332im    -0.0383623-0.0316289im      0.127184+0.0925496im   -0.0807009-0.00665027im    0.144239+0.0211796im   -0.0492314+0.0027861im      0.163967+0.00747583im    0.075293+0.00687829im   -0.139268-0.0484315im    0.0121036+0.128208im    -0.0740759+0.0410963im      0.119359+0.0239607im     -0.0151268+0.0844689im      0.21852-0.105829im     0.204078-0.0305618im       0.166038-0.137149im     -0.109235+0.102159im     -0.134051-0.00750611im    0.198217-0.0858772im    -0.0345501+0.0503833im    0.00319882+0.130527im      0.0683195-0.313221im      -0.124375-0.120631im     -0.109959+0.189158im     -0.0724571+0.0127849im    -0.125721+0.198025im     0.0805843-0.045588im      -0.166934+0.0886698im    -0.0907741-0.26799im     -0.0146233-0.224656im
    0.111424+0.0533382im    0.00312344+0.232837im     -0.130851+0.315501im      0.0435858-0.066316im     -0.0301366+0.0813543im     0.111318-0.0173178im    0.0964942+0.0643274im    0.0707402+0.206098im      0.0344174+0.0255929im    0.0590627-0.158327im    -0.0761678+0.139626im    -0.0553426-0.0765263im    0.0632723+0.14924im        4.589e-5+0.0509865im       0.285609-0.224926im   -0.00041207+0.0889355im   0.0590408-0.156239im        0.085184+0.101013im      0.051462-0.189312im      0.251954+0.0539852im    0.0287886+0.0729653im   -0.00636359+0.130591im         0.1708+0.0219235im       0.14704+0.178623im       0.129262-0.0894484im    -0.018039+0.0264266im     0.0340955+0.0822037im    -0.163122-0.0212748im   -0.0455224-0.101395im      0.0737669+0.164601im      0.0712803+0.107161im       0.26936-0.203615im
   -0.213107-0.0540046im     0.0207201+0.0128126im    0.0415835+0.0428733im      0.010456-0.0472057im      0.054576-0.0329253im   -0.0180797-0.115156im     0.0782895-0.0998335im    0.0934505-0.0106889im      0.207267+0.0424118im    0.0274409-0.120354im    -0.0291777-0.0538017im    0.0547014+0.151857im       0.13936-0.00372074im    0.0912886+0.0375433im       0.037216-0.102573im    -0.0125498+0.0236382im    0.148368+0.0374595im       0.266079+0.0515112im     0.083519-0.15648im    -0.00951631+0.114976im    -0.0141702+0.0494903im     -0.115502-0.0372218im      0.218739+0.0854317im     -0.116577-0.0591381im     -0.567168+0.164098im     0.0671321-0.242143im    -0.00425299-0.0435178im    0.0375212-0.209867im    0.00480641+0.127422im        -0.1636+0.00884593im     0.167181+0.0469742im   0.00685215+0.0855352im
    0.070813+0.0529658im    -0.0101103-0.0377484im    0.0466103-0.0268153im     -0.172322-0.270992im   -0.000921006-0.147077im     0.0685309+0.142345im    -0.0290736-0.117066im     -0.217656+0.214672im     -0.0796349-0.129785im     0.0599872-0.0185961im     0.115397-0.227936im     -0.232686-0.0340581im   -0.0358398-0.0826979im      0.171026+0.18079im          0.14859-0.114724im    -0.0144909+0.150213im    -0.193314+0.0510235im       -0.12293+0.00757637im  -0.0557784-0.151525im     -0.013466+0.0276062im     0.174434+0.138897im     -0.0789069-0.105779im      0.0473715-0.00227644im    0.0316472-0.0585817im     -0.156755+0.108836im     -0.105357+0.151027im      -0.122342+0.0316882im     0.244143+0.115206im     -0.136356+0.206367im      0.0815346+0.0863775im     -0.162541-0.136074im      0.132857+0.0350213im
   -0.167102-0.191492im      -0.223399-0.022749im      0.170737+0.0874712im     0.0853811+0.150146im      -0.160968+0.162613im     -0.264385-0.106464im     -0.201483-0.157173im     -0.115042+0.0611317im     -0.050171+0.0347038im    0.0363319-0.0269306im     0.101189-0.0547686im     0.138975-0.0239164im    0.0530127-0.0973116im     -0.137318-0.0709359im     -0.0133211+0.0307185im  -0.00543501+0.0676885im    0.218288-0.156298im       -0.219775+0.0179417im    0.0511937+0.045949im     -0.155146-0.0189676im     0.312922-0.0559937im     -0.220797+0.156948im       0.102526+0.0415618im      0.126739-0.0419162im    -0.0360041-0.0303772im    0.0419304+0.126978im        0.22205-0.0734422im    0.0292177+0.0819118im    -0.159762+0.0926912im    -0.0210585+0.144657im     0.00378311+0.0119035im     0.125918-0.116079im
  -0.0955896-0.00158914im    0.0392517-0.0135595im   -0.0226146-0.270266im       0.022964+0.0525586im      0.160834+0.0989023im     0.137886-0.0956189im      0.28735+0.0618059im    -0.188304-0.00488934im     0.100502-0.164835im     -0.127503-0.0519509im     0.119531+0.0274207im    0.0868903-0.0964964im    0.0860021+0.212863im    -0.00165113-0.0110732im      -0.012445-0.0638765im     0.133062-0.104806im     0.110564-0.0663284im     -0.0597499-0.0174976im   -0.0786129-0.0373566im   -0.0457916-0.147288im      0.134201+0.00743374im     0.086859-0.00540978im      0.24691-0.00608091im   -0.0425634-0.0581327im      0.169939-0.113525im     0.0768401+0.11858im       0.0910563+0.145438im     0.0873356-0.114367im      0.111464+0.259036im       0.203521+0.182341im       0.108269+0.0836173im    0.0282574+0.351342im
   0.0748618-0.130785im      -0.115264-0.230062im      0.179625+0.14162im      -0.0404583-0.019118im       0.152341+0.172384im    -0.0853527+0.0398024im       0.2253+0.0434459im     -0.10816-0.0539082im     -0.233205+0.133841im      -0.05835-0.0390124im    0.0164308-0.0374701im   -0.0114882+0.272051im      0.206975+0.195439im       0.204538+0.0816619im        0.07181+0.25873im      0.0563729+0.0155416im   -0.134383-0.165332im        0.137104+0.089198im     0.0942922+0.0998173im     0.159414+0.238977im     0.0384953+0.152549im      0.0382715+0.150348im     -0.0572706-0.0560466im    0.00995176-0.119188im        0.12418+0.122023im    -0.0902929-0.0349931im      0.170473-0.0608839im  -0.00784175+0.0504543im     0.158143+0.082611im     -0.0186616-0.086634im     -0.0401842-0.0822556im    0.0417136+0.0408084im
   -0.160647+0.129618im        0.11869-0.119767im    -0.0117531+0.0104561im    -0.0984185+0.110592im     -0.0549281-0.0731562im     -0.11235+0.134126im    -0.0229551+0.0545919im     0.172655-0.241498im       0.275093+0.0334581im    -0.117588-0.0307709im      0.18156-0.0150957im   -0.0632195-0.106295im     0.0623865+0.12287im          0.3239-0.244265im      -0.0689524+0.0226125im    0.0176806-0.0572483im  -0.0190951-0.000951238im    -0.109554+0.07447im      -0.109843-0.0852363im     0.065757+0.246737im    -0.0196664-0.127874im     -0.0294918+0.0563747im     -0.152056+0.1897im         0.022503-0.0879362im    -0.0249911-0.112059im     -0.112777+0.00109836im   0.00971332-0.0596932im   -0.0128829+0.0653385im    -0.181142-0.0435173im      0.159566-0.00589274im    -0.110708+0.120083im      0.357188+0.0682847im
   0.0229412+0.0984242im   -0.00747246-0.152542im     0.0263218-0.115526im      -0.125927+0.185689im     -0.0513571+0.0131261im    -0.149387+0.124011im     0.0689575+0.0539852im      0.19153+0.225148im      -0.119117+0.0130984im    0.0547122+0.314416im     0.0694506+0.148452im     -0.252722-0.155929im      0.153518+0.118825im      0.0639118+0.100758im        0.134383+0.0588993im     0.207483-0.033444im     0.150195-0.0807773im    0.000399156-0.0199222im   -0.0877001-0.0843098im   -0.0470921-0.159196im     0.0506545-0.0260446im      0.184233+0.0929534im      0.109549+0.00674368im    -0.107384+0.111296im      -0.107462+0.17887im     -0.0363253+0.152678im       0.067053-0.0722389im     0.126068+0.00779445im   -0.153639-0.214539im      -0.224596-0.111799im       0.150725+0.0996013im   -0.0587113+0.0390865im
     0.12413-0.0974456im    -0.0113153-0.0305244im     0.074875+0.204974im         0.2876-0.0686715im      0.102568+0.168797im     -0.143624+0.00943987im    0.205692-0.0871383im    0.0294371-0.0387896im     0.0872555-0.0616563im   -0.0810031-0.0296524im    -0.107443-0.0644757im    -0.214328-0.171537im      -0.12584-0.16749im       0.0369182-0.111918im        0.184549+0.0785709im    0.0431973+0.148869im   -0.0107903+0.151729im        0.140583+0.0573605im    -0.302587+0.0486981im   -0.0765924-0.0769704im     0.287746-0.189786im     -0.0269522+0.0766326im     -0.113479+0.149344im      -0.144715+0.227302im      0.0510926+0.0182803im    0.0334079-0.221301im     0.00868596+0.0820026im     0.019952-0.0513138im   -0.0156851-0.00432844im    0.0441044-0.0425766im     -0.102274-0.0489567im      -0.0782+0.155076im
  0.00219164+0.0418827im     0.0910389-0.16778im      -0.062788+0.0787302im     -0.166577+0.117072im       0.250554+0.082697im     -0.144573-0.0315263im    -0.088941+0.0492712im    -0.106833+0.342802im        0.18277+0.188922im      0.217887+0.0863039im     0.118661+0.0254166im     0.105485+0.119117im    -0.0934562-0.09456im      -0.0461533+0.0151079im     -0.0382325-0.0435692im   0.00381356-0.0427504im  -0.0869069-0.0325507im      0.0211922+0.0323473im    -0.153212+0.299344im     0.0885184-0.110835im    -0.0732164+0.0619764im     -0.100069-0.00509186im   -0.0205432+0.147385im     -0.0161383+0.0516198im      0.035816+0.0901536im    0.0156816-0.234449im      -0.172531+0.0401228im    0.0437293+0.246886im     0.0122867+0.0407487im      0.199612+0.083051im       0.264898+0.124998im     0.0861964+0.043267im
  -0.0190946-0.229875im       0.116396-0.1263im       0.0271075-0.149037im    -0.00124841-0.0105781im     -0.031468+0.147584im    -0.0802827+0.0815708im   -0.0141448+0.0682218im   -0.0415623+0.111911im      0.0829903-0.0554869im    -0.104844+0.0282352im     0.204299+0.0827926im  -0.00937054-0.159749im      0.121055-0.0432748im    -0.0512224-0.104748im       -0.112462-0.234447im    -0.0352069-0.0992193im      0.1922-0.104045im        0.325139+0.224675im     0.0979921+0.0367039im   0.00525608+0.167321im    -0.0205372+0.0513807im     -0.132391-0.102317im     -0.0683908-0.145497im     -0.0241457+0.22974im       0.0773939-0.0560553im    0.0154066+0.0719886im     -0.252338+0.116197im      0.145063+0.114337im       0.15118+0.00417266im    -0.205234-0.0092188im     -0.252738-0.135667im     0.0321382-0.0839094im
 -0.00504602+0.214101im     -0.0765762-0.137798im      0.192807+0.0931338im     -0.117105+0.0128965im    -0.0462084+0.06149im     -0.0535844-0.207446im      0.157876-0.169068im     -0.154662+0.0802867im      0.235682-0.0689113im     0.172745-0.193817im     -0.144918+0.2068im        -0.11344-0.0252861im    -0.042087-0.0645439im     -0.148682-0.0266283im     -0.0777236+0.112763im      0.208833-0.0486619im   -0.204865+0.0731755im       0.122302+0.0455228im     0.113893-0.251834im     -0.171123+0.0221789im    -0.255425-0.178562im     -0.0735377-0.00530488im    -0.184878-0.065332im      0.0479993-0.0475592im      0.129206+0.0330832im    0.0938617+0.162416im      0.0669242+0.0238596im     0.151096+0.00343862im  0.00130067+0.0082379im     -0.128527+0.0478934im     0.0599891-0.00437256im    0.126198-0.00162615im
   -0.112424-0.0229661im    -0.0773972-0.0807382im     0.308157+0.0469428im     -0.057377+0.220595im       0.101182+0.120541im      0.372573+0.0254422im    0.0310208-0.00625438im   0.0289698-0.0198005im    -0.0885314+0.0355951im     0.103737+0.158248im     -0.226854+0.126627im   -0.00929623-0.0543423im    -0.133994+0.073203im     -0.0277192+0.0406262im      0.0181986+0.152903im     -0.186657-0.0913428im    0.190758-0.12077im         0.130695-0.0272528im    -0.125255-0.159958im     -0.190103+0.0107704im    0.0615544+0.0403818im    -0.0265979-0.212277im      0.0223901-0.000318037im  -0.0297825-0.0222928im    -0.0812842-0.0282475im    -0.121924-0.0589147im      -0.17551-0.134365im     0.0194397+0.00544051im  0.00677782-0.0889317im      0.334072+0.0640563im     -0.106652-0.111427im       0.12189-0.118134im
  0.00115048+0.050489im      0.0848479-0.0899544im   0.00634625+0.135139im        0.11407-0.115223im       0.181116-0.00688376im    -0.18226-0.15265im       -0.17668+0.181986im     0.0108647+0.0312469im      0.202945-0.100266im    -0.0947278+0.105551im     -0.124877+0.015985im     0.0626018+0.266614im    -0.0259792+0.176986im     -0.0307706-0.052558im       0.0218966-0.0052692im    -0.329929+0.219471im    0.0471728-0.048004im        -0.06453-0.00937202im   -0.170503-0.0294059im   -0.0638308-0.0602832im     0.097151+0.057596im       0.293259-0.0900804im    -0.0835999-0.126468im       0.104334-0.0395993im     0.0495663-0.0184116im    0.0484044+0.151649im     -0.0655598-0.101926im      0.288564-0.174112im      0.064329-0.0648948im     -0.204959+0.054663im    -0.00999621+0.0350244im     0.165522+0.0107088im
    0.076367+0.184324im       0.167147+0.121012im   -0.00281059-0.0404357im      0.112845+0.087302im      0.0328979+0.163552im     0.0208007+0.0825325im    0.0491472-0.17274im       0.144552-0.0579419im      0.144808-0.00219857im    0.093039+0.229528im     0.0596458+0.16187im     -0.0221292+0.152126im    0.00416303+0.127106im      -0.104738-0.0106177im     -0.0658524+0.0366507im     0.237384+0.17815im    -0.0604688+0.0529588im      -0.156907-0.0716437im     0.238162+0.0883324im    0.0670454-0.194922im     0.0243179+0.22875im       -0.117673+0.111172im     -0.0635002-0.129287im     -0.0830004+0.159896im      -0.135318-0.0234561im    0.0592246-0.122975im      0.0363705-0.158351im     0.0639727-0.0695478im    0.0723613+0.170329im      0.0696727+0.0545187im     -0.364566-0.0482652im     0.143334-0.0326994im
   -0.239583-0.124098im     -0.0631774+0.0171428im   -0.0544043+0.0627241im     0.0716289-0.166956im       -0.14777+0.142345im      0.198122-0.149671im     -0.197695-0.0232116im     0.060616+0.0394204im      0.174444-0.176745im    -0.0244718+0.0499297im     0.111335+0.0491364im   -0.0762172+0.0405488im    0.0653673-0.0163086im       0.17144+0.0519084im    -0.00404053+0.305536im      0.230344-0.0249732im   -0.222176+0.0865276im     -0.0523343+0.146461im     -0.143515+0.181199im     0.0471873+0.033543im    -0.0238956+0.0238616im    -0.0735942-0.122245im       0.312216-0.122782im     -0.0742592-0.000409833im   0.0830516-0.093531im     -0.145443-0.059508im     -0.0153002-0.042298im      0.100892-0.0267349im    0.0582226-0.274721im     -0.0545722+0.184452im      0.0161886+0.00813046im  -0.0844198-0.0987334im
 -0.00524436+0.0385392im      0.056446+0.388572im      0.125463-0.00102335im    -0.108268+0.153596im      -0.218428+0.077253im    -0.0715751+0.0587296im    0.0508878-0.103293im     -0.120175+0.00794029im    0.0991699-0.131659im      0.252065+0.216261im      0.150899-0.0777021im    0.0433762-0.0224644im   -0.0317954+0.0253597im      0.045644-0.156757im        0.155667-0.0872071im    -0.115258+0.0281445im   -0.066239-0.0457295im       0.114506+0.107222im    -0.0590853+0.0392793im    -0.183813+0.0985269im   -0.0173519+0.12141im        0.224298-0.0483129im    -0.0589986-0.0322011im      0.146965-0.209708im      0.0111799+0.091028im    -0.0880234-0.20382im        0.243302+0.249078im     0.0505001+0.0135446im     0.177348-0.0997042im    0.00329503-0.0432417im    -0.0655388+0.077723im    -0.0803855+0.0348249im
    0.149246-0.063694im      -0.158434+0.169814im    -0.0640691-0.0134777im   -0.00639954+0.143791im      0.0495057+0.0743585im   -0.0864143-0.0126111im     -0.35083+0.186104im     -0.268131-0.0632726im     0.0670413-0.00730413im    -0.11493-0.0455312im   -0.0796351+0.142126im     -0.311202+0.108625im      0.281983-0.0219522im      0.160957-0.000197374im    -0.116974-0.0583894im    0.0448185+0.0601401im  -0.0114362-0.0736532im      0.0588511-0.0673968im      0.28092-0.0432208im   -0.0336168-0.156845im      0.014258-0.121005im      0.0483837-0.155051im      -0.121688+0.154933im       -0.10034+0.0779319im    -0.0825297+0.0315139im    -0.122463-0.0548937im     0.0694006+0.130368im     0.0560879-0.0896622im    0.0240362-0.0775858im      0.238344+0.0661337im     0.0671905-0.113431im    -0.0265102+0.0305866im
   -0.163247-0.0763061im    -0.0459424-0.096896im     -0.047051-0.0814494im      0.127158+0.0642603im    -0.0257225+0.0186363im     0.162231+0.120916im     0.0949874-0.0471036im    -0.172712+0.147403im     0.00162839-0.116458im      0.117977-0.102432im      0.127012+0.059791im      0.120814+0.0570544im   -0.0939848+0.250982im       0.234048+0.00837172im    -0.0675815-0.0603705im    -0.224164+0.089447im   -0.0428049+0.136288im      -0.0220311+0.159778im     -0.105584+0.0443616im     0.037254-0.188149im     -0.131687-0.186726im      0.0463815+0.156168im      -0.276919-0.0262624im    -0.0190392+0.240438im      -0.243765+0.0664855im   -0.0536359+0.154769im       0.204668-0.0653023im    -0.171286+0.030642im      0.035831-0.0333141im    -0.0234458+0.168265im      0.0457277-0.142464im    -0.0998911-0.110099im
   -0.159735+0.00944253im   -0.0712211+0.0855339im     -0.16978-0.00410797im    -0.102084-0.11051im      -0.0874905+0.221228im       0.13032+0.264173im     0.0259883-0.0914574im     0.164078+0.0790447im      0.167241-0.107713im     -0.201681-0.0834405im    -0.104181+0.203702im      0.108764+0.135299im      0.245599-0.0225334im     -0.242271+0.198172im       0.0841205+0.118984im     -0.106626-0.0760036im   0.0250255+0.0913505im     -0.0476541-0.0017705im   -0.0498285+0.0736822im   0.00762893+0.0544231im     0.195035-0.0482609im     0.0119791-0.173582im       -0.25752-0.0782095im     0.0415673+0.00128465im   -0.0178829+0.148224im    -0.0401702+0.0282016im     0.0753554+0.157531im     0.0178606+0.163851im     -0.138638+0.133787im      0.0619884-0.227082im      0.0810405+0.0892959im    0.0246585+0.032705im
   -0.154702-0.285188im      -0.190996+0.0587686im    -0.215765+0.0515862im    0.00823553-0.0245792im      0.111867+0.273444im    -0.0942515-0.0572781im    0.0528064-0.152241im     0.0104135-0.17881im      -0.0876101-0.149886im      0.034101+0.233921im    -0.0418225-0.024399im       0.11603+0.00361498im   -0.177612+0.124918im      0.0322608+0.0283613im      -0.125023-0.28509im       0.129377+0.0846708im   -0.174926+0.0873778im     -0.0171033-0.0372702im    0.0668345-0.148971im     -0.075689+0.122858im     -0.066857+0.119664im      0.0930556+0.12391im      -0.0256625+0.071118im       -0.17696-0.0366939im     0.0559586+0.111798im     0.0748077+0.118958im      -0.204991+0.0507144im    0.0547294+0.0199954im     -0.14611-0.131393im       0.122211-0.165925im       0.160252-0.058215im      0.110215-0.0390282im
   -0.054061-0.229434im      -0.124068+0.252198im     0.0333429+0.122558im     -0.0982978+0.120711im       0.105115-0.29641im      0.0639144-0.0922269im    0.0768092+0.0815714im   -0.0218793-0.0043771im      0.182481-0.197065im     0.0640982-0.00238916im   0.0376806+0.0569568im    -0.287221-0.079426im    -0.0831921+0.00909311im    -0.188629+0.0196538im       -0.10528-0.0125943im    0.0610726-0.112881im    0.0492355-0.0541531im     -0.0343897+0.153964im    -0.0310725+0.158839im      0.232495+0.0697029im     0.180309+0.144091im       -0.05717+0.0449637im     -0.207031+0.00718938im    0.0751144-0.0887747im    -0.0250525+0.165646im     0.0644311+0.146915im     -0.0511247-0.344514im    -0.0979689-0.0462395im    0.0719999-0.0431737im   -0.00874431-0.0328481im     0.0241178-0.015279im    -0.0485795+0.177628im
    0.130487-0.0692565im      -0.14847+0.269911im      0.045166+0.0975032im     -0.147873-0.136047im      -0.055125+0.13785im       0.156342-0.0032863im     0.128159+0.190371im    -0.0812921+0.0358266im    -0.0921034+0.0853302im   0.00193967-0.242322im      0.339876-0.0401593im    0.0384724-0.110711im    -0.0264415+0.0474195im   -0.00598832-0.0637001im      -0.155859+0.0942388im   -0.0107924+0.0243628im   0.0675482-0.00559893im     0.0213048-0.308079im    -0.0635462+0.114687im     -0.129643-0.112662im     -0.022793-0.111724im      0.0709808+0.0865783im     -0.092722-0.161741im      -0.209625-0.0220414im    -0.0704601+0.00594759im  -0.0644171-0.153959im      -0.126063-0.12881im       0.149476-0.0594621im   -0.0481394-0.0153309im     -0.159485-0.0786823im     0.0313472+0.14063im       0.278194-0.0557531im
   -0.018707+0.0477913im    -0.0398177-0.115621im     0.0759329-0.0362412im      0.100548-0.202346im      -0.232052+0.136005im    -0.0209211-0.21025im       0.180768+0.159905im     0.0296794+0.185488im      0.0308438-0.0748229im     0.183865+0.190544im    -0.0915468+0.137867im    -0.0798659-0.0972913im     0.128434-0.0718956im      0.124144-0.0172454im      -0.124325-0.14172im      -0.164802-0.208118im    0.0277366+0.20306im        -0.211177-0.264356im      0.157357+0.0625771im     0.111939+0.259778im      0.132704-0.0602346im      0.163818+0.0547223im    -0.0351873+0.170129im      0.0707043+0.0092607im     0.0165212-0.0096628im   -0.0380263-0.139319im     -0.0382543-0.124108im     0.0301498-0.0304845im     0.101054+0.153018im      0.0491049+0.0498296im     0.0282978-0.0545905im    -0.079785-0.101836im
   0.0064607+0.0193533im     0.0475629-0.179234im    -0.0864411+0.082851im      -0.369427+0.199228im     -0.0760033+0.170001im     0.0593381+0.00218648im   -0.133305+0.00111643im  -0.0934389-0.00138272im     0.133363-0.00450226im  -0.0118648-0.086469im      0.168428+0.0263419im    0.0285631-0.0356817im   -0.0422317+0.0288467im     -0.142802+0.0220213im      0.0936491+0.038056im    -0.0764565+0.113258im    -0.277945+0.0277881im       0.104241-0.142092im     0.0530587+0.0473703im   -0.0669444+0.112419im      0.192901-0.107277im       0.216639+0.066691im       0.242612+0.079569im       0.133896+0.155738im     -0.0746908-0.0920274im     0.118837+0.0600773im     -0.106037-0.1039im       -0.269869-0.213356im    0.00868856+0.0207643im    -0.0273138-0.151598im      -0.122291-0.188648im     -0.075373+0.0983125im
    0.191618+0.193355im     -0.0919756+0.01148im       0.172068+0.0337063im     0.0070432-0.1201im        0.0166493-0.013469im      0.122003-0.0516181im    0.0547715-0.0252577im   -0.0364163+0.00889137im     0.214567+0.214484im    -0.0611406+0.187913im      0.164641-0.213836im     0.0423031+0.146723im      0.151963+0.036269im      -0.229261+0.265506im       -0.221785-0.144425im     -0.111705-0.0465589im    0.116267+0.148537im       -0.001727+0.179201im    -0.0361821+0.0129172im   -0.0142404+0.10401im      0.0141877-0.126956im      -0.026551+0.170759im      0.0850688+0.0478817im      -0.18929-0.0432175im     0.0976833+0.0919331im   -0.0253562+0.0717689im     0.0864509+0.0970862im   -0.0613163-0.0907048im    -0.158014-0.300207im      0.0922718+0.0635941im     -0.136492-0.111066im    -0.0221389+0.065232im
  -0.0743752-0.0498872im    -0.0297623-0.119594im      0.178037+0.0194628im    -0.0224906-0.163076im     -0.0304844+0.0861108im     0.198136-0.0406496im    -0.231953+0.0978763im     0.140435+0.11355im       0.0969032-0.149292im      0.189307-0.0221319im   -0.0145102-0.195093im    -0.0147555+0.0784969im     0.103149+0.0113631im    -0.0664961-0.126292im        0.174361-0.0484116im     0.167673-0.0122074im    0.109418-0.277896im       -0.197602-0.109694im    -0.0897176-0.112576im     0.0799392-0.0829449im     -0.12168+0.048355im      0.0210282+0.124997im      -0.219353+0.0712205im     -0.207697-0.0738803im    -0.0332014-0.156887im      0.124076-0.0443666im   -0.00714674+0.198649im     -0.186379+0.0496279im     0.102073-0.0150464im    -0.0838197-0.156216im     0.00355206-0.259783im     0.0301116+0.167394im
    0.012015-0.00799942im   -0.0342432-0.0370992im  -0.00357522+0.032199im      0.0208588-0.0919043im    -0.0565783+0.20358im      -0.133737+0.0228565im    0.0278586-0.0360632im     -0.10706+0.0512194im      0.126675+0.0326447im    -0.057331-0.00576741im  -0.0639326-0.168183im     0.0784508-0.172355im    -0.0717231+0.247914im       0.114879+0.0983298im      0.0578294-0.0942292im   -0.0222633-0.3184im     -0.0635601-0.165631im      -0.0598493-0.0326318im   -0.0137972+0.0442483im     0.143041-0.319532im     -0.116587-0.0351213im     -0.226513-0.26507im     -0.00187866+0.0983689im      0.192191-0.0954123im     0.0658622+0.180152im     0.0608144-0.0855236im      0.041963-0.116958im     0.0115469-0.298218im     -0.112957-0.0668325im    -0.0327524-0.228114im      -0.183183-0.0343757im   -0.0290807-0.0684335im
   -0.123577+0.0575685im     -0.152342-0.0150123im    -0.198971+0.152355im      -0.127865+0.132391im       -0.12858-0.131498im      -0.12875-0.0716202im    0.0834745+0.00431601im  -0.0103789-0.00990272im  -0.00538732-0.0930471im    0.0410939+0.0201952im    0.0350606-0.168866im     0.0308559+0.175641im      0.122409+0.180957im      -0.153247+0.0914691im      0.0633926-0.162535im     0.0650142+0.0715182im   0.0550845-0.0822221im       0.033255-0.0422858im    -0.143042-0.205075im    -0.0392646+0.0183209im   -0.0762439-0.13049im      -0.0908456-0.0455095im    -0.0677566-0.0213571im     -0.121417+0.141956im       0.185054-0.217306im     -0.321638-0.203942im     -0.0363239-0.272874im      0.135328+0.0686213im    0.0204733+0.179089im      0.0338911-0.00763563im   -0.0919777+0.0313313im    -0.296828-0.0119857im</code></pre><p>and then generate the state <span>$ψ$</span></p><pre><code class="language-julia hljs">psi = P[:, 3]</code></pre><pre><code class="nohighlight hljs">32-element Vector{ComplexF64}:
  -0.17642013288984643 + 0.06288932155854018im
   0.17222672564855118 + 0.06671533195957893im
   0.05577402785676128 - 0.05948001072743193im
  0.039819831225074744 + 0.10251643506950446im
   0.07189876476574739 + 0.1742832739069503im
   0.18489527622554888 + 0.08369582664451361im
    0.2129346254299507 - 0.049981978075409814im
 -0.025023997527871406 + 0.13728120739206923im
    0.0909887590092681 + 0.06273671576579926im
   0.05743556276713695 + 0.20090601644802708im
 -0.010447287875305227 - 0.025359311236224202im
  -0.17429513344464573 + 0.1593751170457876im
  -0.10307474908907002 - 0.10290771433185467im
    0.1201918750658185 - 0.008232550186236628im
    0.1376235097218122 + 0.035434888340286665im
   0.02195066631223206 + 0.03318721282990304im
   0.14474676525064456 - 0.0046591280404306434im
    0.0112641144431736 + 0.09246291483317932im
   0.04957452832890591 - 0.08277260528434101im
  -0.12179975388211702 - 0.01461424222292343im
   0.09102580832604168 - 0.1733095258126723im
   0.09936155437089297 + 0.03235631265547985im
  -0.07874675235391723 + 0.02521381277219281im
  -0.16835699491692357 - 0.1320052961836601im
  0.008897767071199002 + 0.06780817440139827im
  -0.06203874752784652 + 0.2525012034126791im
    0.2896031776137187 + 0.06238219186641017im
   0.01020312206725256 - 0.14759030968863937im
  -0.13897045540250316 - 0.2487365341606402im
  -0.21917167262115517 + 0.07576749123374724im
 -0.030340932128452718 - 0.0795893254516295im
   0.34365714421316335 + 0.0im</code></pre><p>In the phase estimation process, we will feed the state to circuit and measure the first <code>n</code> qubits processed by iQFT.</p><pre><code class="language-julia hljs">r = join(ArrayReg(psi), zero_state(N))
r |&gt; PE(N, M, U)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 8/8
    nlevel: 2</code></pre><p>Since our phase can be represented by 3 qubits precisely, we only need to measure once</p><pre><code class="language-julia hljs">results = measure(r, 1:N; nshots=1)</code></pre><pre><code class="nohighlight hljs">1-element Vector{DitStr{2, 3, Int64}}:
 011 ₍₂₎</code></pre><p>Recall that our QFT&#39;s bit numbering is reversed, let&#39;s reverse it back</p><pre><code class="language-julia hljs">using BitBasis
estimated_phase = bfloat(results[]; nbits=N)</code></pre><pre><code class="nohighlight hljs">0.75</code></pre><p>the phase is exactly <code>0.75</code>!</p><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../1.prepare-ghz-state/index.html">« Prepare Greenberger–Horne–Zeilinger state with Quantum Circuit</a><a class="docs-footer-nextpage" href="../3.grover-search/index.html">Grover Search »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.2.1 on <span class="colophon-date" title="Thursday 29 February 2024 06:41">Thursday 29 February 2024</span>. Using Julia version 1.10.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
