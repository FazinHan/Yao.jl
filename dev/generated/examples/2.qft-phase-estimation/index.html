<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Quantum Fourier Transformation and Phase Estimation · Documentation | Yao</title><meta name="title" content="Quantum Fourier Transformation and Phase Estimation · Documentation | Yao"/><meta property="og:title" content="Quantum Fourier Transformation and Phase Estimation · Documentation | Yao"/><meta property="twitter:title" content="Quantum Fourier Transformation and Phase Estimation · Documentation | Yao"/><meta name="description" content="Documentation for Documentation | Yao."/><meta property="og:description" content="Documentation for Documentation | Yao."/><meta property="twitter:description" content="Documentation for Documentation | Yao."/><script data-outdated-warner src="../../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../search_index.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script><link href="../../../assets/indigo.css" rel="stylesheet" type="text/css"/><link href="https://yaoquantum.org/assets/favicon-light.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../index.html"><img src="../../../assets/logo.png" alt="Documentation | Yao logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../../index.html">Documentation | Yao</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../../index.html">Home</a></li><li><a class="tocitem" href="../../../quick-start.html">Quick Start</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../../../man/registers.html">Quantum Registers</a></li><li><a class="tocitem" href="../../../man/blocks.html">Blocks</a></li><li><a class="tocitem" href="../../../man/symbolic.html">Symbolic Computation</a></li><li><a class="tocitem" href="../../../man/cuda.html">CUDA extension - CuYao</a></li><li><a class="tocitem" href="../../../man/plot.html">Quantum Circuit Visualization</a></li><li><a class="tocitem" href="../../../man/automatic_differentiation.html">Automatic Differentiation</a></li><li><a class="tocitem" href="../../../man/yao2einsum.html">Tensor network backend</a></li><li><a class="tocitem" href="../../../man/simplification.html">Simplification</a></li><li><a class="tocitem" href="../../../man/bitbasis.html">BitBasis</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../1.prepare-ghz-state/index.html">Prepare Greenberger–Horne–Zeilinger state with Quantum Circuit</a></li><li class="is-active"><a class="tocitem" href="index.html">Quantum Fourier Transformation and Phase Estimation</a><ul class="internal"><li><a class="tocitem" href="#Quantum-Fourier-Transformation"><span>Quantum Fourier Transformation</span></a></li><li><a class="tocitem" href="#Wrap-QFT-to-an-external-block"><span>Wrap QFT to an external block</span></a></li><li><a class="tocitem" href="#Phase-Estimation"><span>Phase Estimation</span></a></li></ul></li><li><a class="tocitem" href="../3.grover-search/index.html">Grover Search</a></li><li><a class="tocitem" href="../4.shor-algorithm/index.html">Shor&#39;s Algorithm</a></li><li><a class="tocitem" href="../5.shor-9-code/index.html">Shor&#39;s 9 qubit code</a></li><li><a class="tocitem" href="../6.quantum-circuit-born-machine/index.html">Quantum Circuit Born Machine</a></li><li><a class="tocitem" href="../7.variation-quantum-eigen-solver/index.html">Variational Quantum Eigen Solver</a></li><li><a class="tocitem" href="../8.riemannian-gradient-flow/index.html">Riemannian gradient flow optimizer</a></li></ul></li><li><a class="tocitem" href="../../../performancetips.html">Performance Tips</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href="index.html">Quantum Fourier Transformation and Phase Estimation</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="index.html">Quantum Fourier Transformation and Phase Estimation</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/QuantumBFS/Yao.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/QuantumBFS/Yao.jl/blob/master/docs/src/examples/2.qft-phase-estimation/main.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><p><a href="/generated/examples/2.qft-phase-estimation/main.ipynb"><img src="https://mybinder.org/badge_logo.svg" alt/></a></p><h1 id="example-qft"><a class="docs-heading-anchor" href="#example-qft">Quantum Fourier Transformation and Phase Estimation</a><a id="example-qft-1"></a><a class="docs-heading-anchor-permalink" href="#example-qft" title="Permalink"></a></h1><p>Let&#39;s use Yao first</p><pre><code class="language-julia hljs">using Yao</code></pre><h2 id="Quantum-Fourier-Transformation"><a class="docs-heading-anchor" href="#Quantum-Fourier-Transformation">Quantum Fourier Transformation</a><a id="Quantum-Fourier-Transformation-1"></a><a class="docs-heading-anchor-permalink" href="#Quantum-Fourier-Transformation" title="Permalink"></a></h2><p>The Quantum Fourier Transformation (QFT) circuit is to repeat two kinds of blocks repeatly:</p><p><img src="assets/qft.png" alt="qft-circuit"/></p><p>The basic building block control phase shift gate is defined as</p><p class="math-container">\[R(k)=\begin{bmatrix}
1 &amp; 0\\
0 &amp; \exp\left(\frac{2\pi i}{2^k}\right)
\end{bmatrix}\]</p><p>Let&#39;s define block <code>A</code> and block <code>B</code>, block <code>A</code> is actually a control block.</p><pre><code class="language-julia hljs">A(i, j) = control(i, j=&gt;shift(2π/(1&lt;&lt;(i-j+1))))</code></pre><pre><code class="nohighlight hljs">A (generic function with 1 method)</code></pre><p>Once you construct the blockl you can inspect its matrix using <code>mat</code> function. Let&#39;s construct the circuit in dash box A, and see the matrix of <span>$R_4$</span> gate.</p><pre><code class="language-julia hljs">R4 = A(4, 1)</code></pre><pre><code class="nohighlight hljs">(n -&gt; control(n, 4, 1 =&gt; shift(0.39269908169872414)))</code></pre><p>If you have read about <a href="@ref tutorial-ghz">preparing GHZ state</a>, you probably know that in Yao, we could just leave the number of qubits, and it will be evaluated when possible.</p><pre><code class="language-julia hljs">R4(5)</code></pre><pre><code class="nohighlight hljs">nqubits: 5
control(4)
└─ (1,) shift(0.39269908169872414)</code></pre><p>its matrix will be</p><pre><code class="language-julia hljs">mat(R4(5))</code></pre><pre><code class="nohighlight hljs">32×32 Diagonal{ComplexF64, Vector{ComplexF64}}:
 1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im</code></pre><p>Then we repeat this control block over and over on different qubits, and put a Hadamard gate to <code>i</code>th qubit to construct <code>i</code>-th <code>B</code> block.</p><pre><code class="language-julia hljs">B(n, k) = chain(n, j==k ? put(k=&gt;H) : A(j, k) for j in k:n)</code></pre><pre><code class="nohighlight hljs">B (generic function with 1 method)</code></pre><p>We need to input the total number of qubits <code>n</code> here because we have to iterate through from <code>k</code>-th location to the last.</p><p>Now, let&#39;s construct the circuit by chaining all the <code>B</code> blocks together</p><pre><code class="language-julia hljs">qft(n) = chain(B(n, k) for k in 1:n)
qft(4)</code></pre><pre><code class="nohighlight hljs">nqubits: 4
chain
├─ chain
│  ├─ put on (1)
│  │  └─ H
│  ├─ control(2)
│  │  └─ (1,) shift(1.5707963267948966)
│  ├─ control(3)
│  │  └─ (1,) shift(0.7853981633974483)
│  └─ control(4)
│     └─ (1,) shift(0.39269908169872414)
├─ chain
│  ├─ put on (2)
│  │  └─ H
│  ├─ control(3)
│  │  └─ (2,) shift(1.5707963267948966)
│  └─ control(4)
│     └─ (2,) shift(0.7853981633974483)
├─ chain
│  ├─ put on (3)
│  │  └─ H
│  └─ control(4)
│     └─ (3,) shift(1.5707963267948966)
└─ chain
   └─ put on (4)
      └─ H
</code></pre><h2 id="Wrap-QFT-to-an-external-block"><a class="docs-heading-anchor" href="#Wrap-QFT-to-an-external-block">Wrap QFT to an external block</a><a id="Wrap-QFT-to-an-external-block-1"></a><a class="docs-heading-anchor-permalink" href="#Wrap-QFT-to-an-external-block" title="Permalink"></a></h2><p>In most cases, <code>function</code>s are enough to wrap quantum circuits, like <code>A</code> and <code>B</code> we defined above, but sometimes, we need to dispatch specialized methods on certain kinds of quantum circuit, or we want to define an external block to export, thus, it&#39;s useful to be able to wrap circuit to custom blocks.</p><p>First, we define a new type as subtype of <code>PrimitiveBlock</code> since we are not going to use the subblocks of <code>QFT</code>, if you need to use its subblocks, it&#39;d be better to define it under <code>CompositeBlock</code>.</p><pre><code class="language-julia hljs">struct QFT &lt;: PrimitiveBlock{2}
    n::Int
end

YaoBlocks.nqudits(q::QFT) = q.n</code></pre><p>Now, let&#39;s define its circuit</p><pre><code class="language-julia hljs">circuit(q::QFT) = qft(q.n)</code></pre><pre><code class="nohighlight hljs">circuit (generic function with 1 method)</code></pre><p>And forward <code>mat</code> to its circuit&#39;s matrix</p><pre><code class="language-julia hljs">YaoBlocks.mat(::Type{T}, x::QFT) where T = mat(T, circuit(x))</code></pre><p>You may notice, it is a little ugly to print <code>QFT</code> at the moment, this is because we print the type summary by default, you can define your own printing by overloading <code>print_block</code></p><pre><code class="language-julia hljs">YaoBlocks.print_block(io::IO, x::QFT) = print(io, &quot;QFT($(x.n))&quot;)</code></pre><p>Since it is possible to use FFT to simulate the results of QFT (like cheating), we could define our custom <code>apply!</code> method:</p><pre><code class="language-julia hljs">using FFTW, LinearAlgebra

function YaoBlocks.apply!(r::ArrayReg, x::QFT)
    α = sqrt(length(statevec(r)))
    invorder!(r)
    lmul!(α, ifft!(statevec(r)))
    return r
end</code></pre><p>Now let&#39;s check if our <code>apply!</code> method is correct:</p><pre><code class="language-julia hljs">r = rand_state(5)
r1 = r |&gt; copy |&gt; QFT(5)
r2 = r |&gt; copy |&gt; circuit(QFT(5))
r1 ≈ r2</code></pre><pre><code class="nohighlight hljs">true</code></pre><p>We can get iQFT (inverse QFT) directly by calling <code>adjoint</code></p><pre><code class="language-julia hljs">QFT(5)&#39;</code></pre><pre><code class="nohighlight hljs"> [†]QFT(5)</code></pre><p>QFT and iQFT are different from FFT and IFFT in three ways,</p><ol><li>they are different by a factor of <span>$\sqrt{2^n}$</span> with <span>$n$</span> the number of qubits.</li><li>the <a href="https://quantumbfs.github.io/BitBasis.jl/stable/tutorial/#Conventions-1">bit numbering</a> will exchange after applying QFT or iQFT.</li><li>due to the convention, QFT is more related to IFFT rather than FFT.</li></ol><h2 id="Phase-Estimation"><a class="docs-heading-anchor" href="#Phase-Estimation">Phase Estimation</a><a id="Phase-Estimation-1"></a><a class="docs-heading-anchor-permalink" href="#Phase-Estimation" title="Permalink"></a></h2><p>Since we have QFT and iQFT blocks we can then use them to realize phase estimation circuit, what we want to realize is the following circuit:</p><p><img src="assets/phaseest.png" alt="phase estimation"/></p><p>First we call Hadamard gates repeatly on first <code>n</code> qubits.</p><pre><code class="language-julia hljs">Hadamards(n) = repeat(H, 1:n)</code></pre><pre><code class="nohighlight hljs">Hadamards (generic function with 1 method)</code></pre><p>Then in dashed box <code>B</code>, we have controlled unitaries:</p><pre><code class="language-julia hljs">ControlU(n, m, U) = chain(n+m, control(k, n+1:n+m=&gt;matblock(U^(2^(k-1)))) for k in 1:n)</code></pre><pre><code class="nohighlight hljs">ControlU (generic function with 1 method)</code></pre><p>each of them is a <code>U</code> of power <span>$2^{(k-1)}$</span>.</p><p>Since we will only apply the qft and Hadamard on first <code>n</code> qubits, we could use <code>Subroutine</code>, which creates a context of a sub-scope of the qubits.</p><pre><code class="language-julia hljs">PE(n, m, U) =
    chain(n+m, # total number of the qubits
        subroutine(Hadamards(n), 1:n), # apply H in local scope
        ControlU(n, m, U),
        subroutine(QFT(n)&#39;, 1:n))</code></pre><pre><code class="nohighlight hljs">PE (generic function with 1 method)</code></pre><p>we use the first <code>n</code> qubits as the output space to store phase <span>$ϕ$</span>, and the other <code>m</code> qubits as the input state which corresponds to an eigenvector of oracle matrix <code>U</code>.</p><p>The subroutine here uses <code>focus!</code> and <code>relax!</code> to manage a local scope of quantum circuit, and only activate the first <code>n</code> qubits while applying the block inside the subroutine context, and the scope will be <code>relax!</code>ed back, after the context. This is equivalent to manually <code>focus!</code> then <code>relax!</code></p><p>fullly activated</p><pre><code class="language-julia hljs">r = rand_state(5)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 5/5
    nlevel: 2</code></pre><p>first 3 qubits activated</p><pre><code class="language-julia hljs">focus!(r, 1:3)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 3/5
    nlevel: 2</code></pre><p>relax back to the original</p><pre><code class="language-julia hljs">relax!(r, 1:3)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 5/5
    nlevel: 2</code></pre><p>In this way, we will be able to apply small operator directly on the subset of the qubits.</p><p>Details about the algorithm can be found here: <a href="https://en.wikipedia.org/wiki/Quantum_phase_estimation_algorithm">Quantum Phase Estimation Algorithm</a></p><p>Now let&#39;s check the results of our phase estimation.</p><p>First we need to set up a unitary with known phase, we set the phase to be 0.75, which is <code>0.75 * 2^3 == 6 == 0b110</code> .</p><pre><code class="language-julia hljs">N, M = 3, 5
P = eigen(rand_unitary(1&lt;&lt;M)).vectors
θ = Int(0b110) / 1&lt;&lt;N
phases = rand(1&lt;&lt;M)
phases[0b010+1] = θ
U = P * Diagonal(exp.(2π * im * phases)) * P&#39;</code></pre><pre><code class="nohighlight hljs">32×32 Matrix{ComplexF64}:
   0.229892+0.263099im       0.207831-0.006804im     0.00859616+0.0635882im     0.103349+0.0111023im     0.177937+0.0240548im     0.205637+0.106276im     0.0125299+0.218162im       0.107294+0.0126393im      0.117437-0.217283im     -0.0887287-0.127987im    -0.0813116-0.0421624im      0.126651-0.118479im     0.0371522+0.212146im       0.120009+0.179747im        0.143988-0.000591118im      0.184286-0.178992im       0.0193326+0.00440522im    -0.125282-0.248384im    0.0579157-0.0387975im        0.118885-0.0611165im     0.134513+0.0279123im     -0.0170943+0.01778im       -0.162096-0.0547559im     0.00856992-0.0553532im     0.176828-0.0327312im    -0.0732442+0.0311454im    0.0792996-0.0465677im    -0.0470318+0.0983662im      0.26343+0.189531im     -0.0789729-0.136555im     0.0951301+0.0871199im      0.101262+0.0495023im
 -0.0919323+0.101304im       0.129713+0.131052im      0.0359368-0.103384im     -0.104788-0.0415439im   -0.0776793-0.0566801im   -0.0341871-0.0999874im    -0.101687+0.202774im     -0.0383045-0.17966im        0.036061+0.0274135im     0.0427392+0.122317im     -0.106871+0.0885999im   -0.00470894-0.332291im    -0.0515107+0.025732im      0.0647578-0.00491195im     -0.012907-0.119056im        -0.129541-0.167879im       0.0494394+0.0952544im      0.241679-0.12463im     -0.154062-0.301588im       0.00981285+0.0502913im    0.0729711-0.15519im         0.117578-0.127548im      0.0991057-0.229155im      0.00882606-0.175169im    -0.0272303+0.0446042im    -0.0669536-0.134034im      0.114293-0.226613im        0.11966+0.112031im     -0.279421-0.0143143im      -0.15219+0.0458067im    0.0421615-0.107899im     -0.0371737-0.106836im
  0.0506433+0.187609im      0.0863839+0.0096611im   -0.00515596+0.0521977im    0.0872344-0.139316im     0.0914264-0.0517717im     0.147319-0.0939319im   -0.0972125+0.176329im     -0.0444082-0.0184618im     -0.146382+0.129148im       0.231332+0.182146im      0.148729+0.0112987im    0.00627585+0.082521im      0.101393+0.100271im      0.0355407-0.0490054im      0.0659334-0.00906423im      -0.145139-0.180026im      -0.0442273-0.0537906im      0.179705+0.0967714im  0.00262989+0.00787511im       0.114878+0.189685im    -0.0644193-0.049391im       -0.340869+0.155068im      0.0102888+0.00514666im    0.00485139+0.15635im     -0.0918539+0.214673im      0.0438217-0.039135im    -0.0950411+0.160899im      -0.302123+0.0280492im    0.0548109-0.00619501im    -0.151647+0.281331im      0.118999-0.0458396im    -0.0137323+0.17582im
  0.0436355+0.166362im       0.191435+0.0145542im    -0.0873719-0.0866198im      0.13643+0.0446232im     0.130981+0.0630129im   -0.0901591-0.00519317im   0.0972002-0.114246im     0.00547889+0.251087im      -0.180771+0.0416381im      0.105413-0.0395392im    -0.177258-0.0538981im     -0.045986-0.0274157im   -0.0934472+0.041547im      -0.166687+0.269826im      -0.0138089-0.348915im        -0.160874+0.0301645im      -0.099608+0.136027im      -0.136842+0.0452013im   0.0635898+0.0631347im       -0.211041+0.198237im    0.00908213+0.157407im        0.139933+0.203376im       -0.14593-0.00232406im    -0.0198744-0.0511191im     -0.16507+0.139472im      0.0367164-0.0315039im   -0.0699525-0.172511im     -0.0871047-0.035807im    -0.0982472-0.12718im       -0.124069-0.0808077im   -0.0947799-0.0534736im      0.159314-0.101009im
  0.0970468-0.0386861im     0.0397105-0.0189139im      0.210366+0.0428607im    0.0055682-0.0548795im   -0.0255969+0.156701im      0.248301+0.0780753im    0.0576577+0.161059im      -0.167996-0.0380818im     0.0698077+0.131675im     -0.0467273+0.123608im      0.167303-0.0370378im     0.0924716+0.138799im     0.0318322-0.142219im       0.111613+0.0768414im       0.301928+0.0292788im        0.100074-0.0146923im     -0.0275038+0.202049im      0.0287917+0.139195im   -0.0975066+0.045944im       -0.0393264+0.296839im     -0.158673+0.0559024im       0.181129-0.0170635im     -0.204341+0.0574651im      -0.232003+0.106969im     0.0792237+0.00707084im  -0.00642103+0.0426026im    0.0296486-0.0528434im      0.258538-0.0461711im    -0.222453-0.0423379im      0.121314+0.0324124im     0.146587+0.116075im       0.128141-0.115644im
  0.0554649+0.0282656im      0.205083-0.0081381im    -0.0679575-0.202811im    -0.0158493-0.168826im     0.0705076+0.121894im      0.110586+0.183783im     -0.194079-0.130542im      -0.174526+0.134162im      0.0686361-0.0408359im   0.000996054+0.0112337im    0.0272609-0.0516557im    -0.0798783-0.0141478im   -0.0108191+0.103863im       0.194371-0.197206im        0.177388+0.0662908im      -0.0623425+0.0263864im        0.03201+0.228867im      -0.210386+0.217313im     0.061438-0.0478416im      -0.0553433-0.152185im     -0.120326+0.0507354im      0.0259955+0.120399im      0.0816105-0.0177215im       0.298284-0.333306im      0.127742-0.0804927im     0.0821413-0.119738im     -0.112215+0.12307im       0.0293439-0.0426287im     -0.10288+0.0969283im     0.0122562+0.124443im    -0.0140972-0.123721im      -0.155287+0.000646442im
 -0.0873237-0.194075im     -0.0284477-0.122174im       0.213681-0.136729im      0.159179+0.0431076im   -0.0718971-0.240856im      -0.23946+0.0843159im     0.119076+0.18925im       0.0237122+0.25585im       -0.087594-0.0964785im      0.278561-0.150444im      0.166746-0.00646749im   -0.0202008-0.136856im    -0.0232274+0.207143im      0.0252105+0.017893im        0.210436+0.125726im        0.0721631+0.0476357im       0.137473+0.133291im     -0.0594502-0.0101331im    0.281308-0.113482im       -0.0474192+0.121726im     -0.117856-0.209896im       0.0930301+0.000195379im    0.101706+0.000199204im   -0.0682208+0.0875102im   -0.0912249+0.0261521im      -0.10487-0.0730692im    0.0509062+0.0494198im     0.0970876-0.0221673im    0.0444625+0.0167797im     -0.122028-0.0261607im   -0.0395285+0.0910399im    -0.0986427+0.106135im
  0.0431703+0.0770411im    -0.0533689+0.0178095im    -0.0699295+0.137204im      0.167224-0.01741im      -0.042401-0.0332635im    0.0508085-0.0560895im    0.0774153-0.141745im       0.239833+0.0163431im    -0.0435251+0.0121901im      0.274607+0.0421444im    -0.127331+0.321352im        0.17055-0.00588831im  -0.0621233+0.0237414im    -0.0298318+0.0575519im       0.197989+0.0560535im       0.0963597-0.12762im         0.146357+0.0734526im     -0.153522+0.0680688im   -0.246134+0.0876725im        0.100331-0.179692im     -0.192802+0.236748im       -0.132445+0.0161094im      0.259832-0.113023im       -0.123047+0.0222426im   -0.0944955+0.0751027im    -0.0612116-0.0590134im   -0.0642473+0.0645178im      0.216188+0.187332im    -0.0379107-0.0182559im     0.0999714-0.0791234im   -0.0243575-0.107628im     -0.0628085-0.146717im
 -0.0441346-0.0477411im    -0.0594206-0.220066im     -0.0544068+0.176162im      0.207794-0.0581072im    0.0856484+0.0732833im     0.135492+0.128441im     -0.211055-0.172736im      -0.258237+0.0646552im   0.000408042+0.089336im       0.116321+0.0616602im    -0.036443-0.0592846im     0.0609639-0.261277im     0.0652837-0.21454im       0.0478555-0.077576im       0.0453636-0.0683727im       0.0356484+0.0414326im      0.0370491-0.0322951im    -0.0187634-0.266793im     -0.20884-0.0768612im        0.094212-0.133748im     -0.105747-0.0216672im        0.17238+0.0226655im     0.0234587+0.0824639im      -0.101041+0.112517im     0.0942039+0.113294im      0.0188715-0.117331im      0.134145+0.0247161im     -0.110654-0.150096im     0.0591372-0.174498im      -0.215249-0.0611624im    -0.269193+0.141801im     -0.0430884+0.100029im
  -0.105677+0.117014im      0.0423578-0.130301im       0.164496+0.137555im     -0.280962+0.216096im    -0.0386869+0.13807im     -0.0306137-0.293536im     -0.152367-0.164443im       0.116297+0.0768924im     -0.109207+0.0397031im      0.114643+0.0554424im     0.160063-0.0543125im     -0.104346-0.122429im      0.152031+0.107451im       0.254553+0.189831im       0.0675417-0.048467im          0.10658+0.284486im      -0.0611771+0.114943im      -0.076856+0.115322im   -0.0264502-0.106286im         0.192162-0.0415909im   -0.0606709-0.0111809im      -0.201846-0.091905im      -0.132389-0.159837im       0.0741998-0.00778463im  -0.0277867-0.162561im     -0.0646983-0.0723392im    0.0702259-0.0130922im    -0.0950038-0.0414128im   0.00974609-0.124527im      0.0458568-0.0978302im   -0.0298592+0.0281862im      0.131766-0.0360745im
   0.140252-0.0224818im     0.0812152-0.0586142im      0.158848-0.164942im    -0.0716483+0.00743411im   0.0365213-0.00135504im   0.0945171+0.071141im     -0.051012-0.0254623im    0.00746084-0.0040402im     -0.143379+0.0127053im    -0.0804707+0.0308456im       0.1757+0.193247im     -0.0786768+0.284723im     -0.144689+0.114334im      -0.194448-0.0142661im        0.09323+0.0360078im      -0.0230728+0.0758285im      0.0315856+0.0287559im     -0.071328-0.0167919im   -0.203855-0.125605im         0.205833-0.131836im      0.171777+0.0678203im       0.168221-0.0593671im     -0.108217+0.0598254im        0.17033+0.169764im     -0.335288+0.030756im       0.162247-0.00364741im      0.3707-0.105573im     -0.0392461+0.128089im     0.0087837+0.103958im     -0.0716703+0.0575401im    -0.145775-0.0153695im     -0.102764+0.0261255im
 0.00756983+0.0499508im     -0.355884+0.0674551im       0.13279-0.048542im     -0.194464-0.153965im    -0.0304068-0.129848im     0.0969697+0.147166im    -0.0112727-0.191323im      -0.217613+0.125056im      0.0976125+0.00786056im     0.100887-0.120037im    0.00193322+0.0716641im      0.119845+0.0958079im     0.144385+0.182277im    -0.00993508+0.0419497im      0.0425708-0.0147841im       0.0504377+0.000524033im   -0.0123272-0.0294778im    -0.0286288-0.218615im    0.0555261+0.00753804im       0.169131+0.0525018im     0.229931+0.0381464im      -0.162756+0.164155im      -0.045762+0.0308084im      -0.255851-0.312444im     -0.143728-0.076565im      -0.036927+0.0681089im   -0.0425626-0.185408im     -0.0429335-0.0869008im    -0.091941-0.162507im     -0.0321576+0.0893602im    0.0707429-0.0411196im      -0.12259-0.105203im
    0.16736-0.176607im      -0.107438+0.182607im       0.177999+0.0612858im    0.0462332-0.0920103im    0.0830647+0.212477im    -0.0197467+0.0387367im    -0.052132+0.00667419im    0.0619744+0.0923929im      -0.13176-0.133154im       0.209583+0.1287im      -0.0926324-0.219898im       0.164323+0.15472im       0.186698+0.320645im      -0.104463-0.0877007im      -0.197365+0.0429585im       0.0571353+0.105264im      -0.0974545-0.16419im     -0.00767215+0.0569866im   -0.231956-0.112004im        -0.129989+0.0271712im   -0.0556218-0.0536807im       0.146218-0.0230284im    -0.0226109-0.15766im        0.0547823+0.128604im       0.21421-0.025459im      -0.156313+0.0466197im   0.00536423-0.00437209im  -0.00369475-0.032773im    -0.0297278+0.0349791im     -0.134838-0.0483091im     0.022763-0.222119im     -0.0686119-0.133865im
   0.185821-0.0939758im     0.0865901+0.218316im     -0.0105606-0.0281816im  -0.00872139-0.103918im     0.0631335-0.0911044im    0.0864514+0.157357im      0.157668-0.14021im       0.0858986-0.071235im      0.0506903+0.0511914im      0.200034+0.205031im     -0.168282-0.14163im       -0.201519-0.139582im     0.0593446-0.00169363im     0.269742+0.0639649im     -0.0419878+0.0803887im       0.0649466+0.153535im       0.0698106-0.0694053im     0.0543851-0.0430478im   -0.111052+0.123569im        -0.108821-0.0164839im     0.151156-0.0644599im      0.0704798+0.130336im        0.14301-0.0719754im      0.0292714+0.0359214im    -0.365983-0.0405348im    -0.0268726-0.0810804im     0.136458+0.0352689im   0.000430878-0.183431im    0.00415728+0.114953im       0.204005+0.0329937im     0.129037+0.197561im       0.150886+0.11986im
   0.104722+0.000245499im  -0.0709081-0.183918im     -0.0730108-0.179376im     -0.263137+0.0790307im    0.0675084-0.0741177im    0.0299782+0.0952328im     0.194242+0.0625663im     0.0453163-0.12338im      -0.0922649-0.0462975im      0.058882-0.0106693im    0.0161152-0.0832771im    -0.0513303+0.0457984im   -0.0562977-0.063772im     -0.0966541+0.177452im        0.185891+0.246094im       -0.0529982-0.119904im        0.119428+0.0474525im    -0.0360449+0.0219514im   -0.158128+0.00403627im     -0.0898884-0.116179im      0.206415-0.0883314im     -0.0564566-0.0144082im     0.0741173-0.0325739im      0.0027692+0.00915598im    0.221102+0.116467im     -0.0621121+0.0236345im   -0.0443388+0.240343im      -0.312084-0.165672im     -0.322017-0.116621im     -0.0903203-0.196679im    -0.0747766+0.00591855im      0.10319-0.120476im
 0.00165504+0.117555im     0.00192722+0.00302129im    -0.319801-0.134166im     -0.134522-0.0871857im     0.104559-0.0592334im   -0.0659228-0.0378758im     0.057199+0.172283im    -0.00858752+0.106209im       -0.16636+0.183084im       0.108904+0.0819568im    0.0407936+0.0692449im     0.0731999+0.322248im       0.13301-0.0319632im      0.280405-0.0596653im      -0.145283-0.00510553im     0.00104588-0.0461776im      -0.139216-0.0498433im    -0.0713413-0.201758im     0.233645+0.034098im      -0.00488039-0.162112im     -0.105397+0.111996im       0.0826122-0.0890293im     0.0330918-0.192149im      -0.0800604+0.0868684im     0.041803-0.12788im        0.172649-0.0352585im     0.150034+0.0109074im      0.175477-0.0600827im    -0.144377-0.0639135im     -0.157446-0.198107im     0.0716534+0.0839021im    -0.0383798+0.0847185im
 -0.0818766-0.0535179im     0.0731835-0.0850492im     -0.207477+0.018627im      0.146468+0.0904339im   -0.0850373-0.105408im      0.055606-0.0876186im    -0.149954+0.0547155im      0.170769+0.0160093im     0.0471629+0.0509608im     0.0154381+0.187535im      0.122861-0.264097im       -0.11433-0.00656821im   -0.139227-0.0962169im     0.0661475+0.0982736im       0.096723+0.131978im         0.117825+0.0638014im       0.044614-0.132104im      -0.194233-0.143301im   0.00400046+0.102969im        0.0623391+0.176966im      0.216413+0.128872im       0.0804452+0.0651868im    0.00751505-0.0174301im       0.035581-0.0594523im    0.0152311-0.0241326im     -0.151695+0.271495im     0.0986532-0.0216092im       0.12738-0.0085238im   -0.0672253-0.173087im     -0.0806393+0.155309im     0.0372164-0.412237im      -0.137945+0.113504im
  -0.196991-0.169279im       0.155005+0.0302233im     0.0705555+0.106228im    -0.0611266+0.172568im      0.288599+0.0310836im    0.0564639+0.27458im      0.0807126+0.131406im     -0.0222435-0.194339im     -0.0618862-0.00244973im    0.0937087-0.175801im     0.0534775-0.127828im      0.0445212-0.00978611im    -0.24017+0.0537449im      0.097125+0.0179144im      0.0494771-0.10037im         -0.165267+0.214679im       -0.152166-0.123228im      0.0290397+0.110831im    -0.012766-0.019742im         0.167788-0.259297im   -0.00782917+0.13741im         0.114498-0.0919918im      0.115968-0.0384232im      -0.241168-0.0572373im   -0.0802907-0.00616083im    0.0189925+0.0386384im     -0.20305+0.00477125im   -0.0483392+0.10938im       0.038372-0.127312im     -0.0976317+0.0944099im     0.215694-0.0282052im   -0.00696636+0.0148555im
   0.249551+0.0141619im     0.0432776+0.0266707im     -0.104007-0.0280018im     0.121749-0.111626im     -0.216096+0.0105764im   -0.0303254+0.166676im      -0.15055+0.1446im        -0.178275-0.120032im     -0.0355695+0.0507676im     0.0970663-0.0683078im   -0.0498896+0.0337697im      0.177637-0.110772im    0.00789778-0.00798927im    -0.109948+0.0663573im      -0.141007-0.153114im       -0.0606236+0.205808im        0.195154+0.17705im       -0.101465+0.0993915im   0.0538149+0.0785725im       0.0211486-0.0599528im   -0.0835159-0.0921337im      -0.139143-0.263077im     -0.0630059+0.0617955im     0.00893439+0.0127626im   -0.0894696-0.0972949im    -0.0663349+0.223625im      0.159907+0.0357297im      -0.19199+0.0457341im   -0.0941595-0.166545im       0.162177-0.217652im      0.217718-0.126109im     -0.0475079+0.176407im
   0.134428+0.0784902im      0.154654-0.0494423im      0.190539-0.074938im    -0.0314096-0.0726504im    -0.119677-0.304775im    -0.0340119+0.229528im    -0.0697325+0.0203293im      0.160845+0.25959im        0.309356+0.172299im      -0.144915+0.18952im     -0.0899689+0.00118847im    0.0559532+0.0484053im   -0.0307523-0.0854633im     0.0311727+0.000554901im     0.175491-0.0613145im       -0.153862+0.0755189im      -0.133064-0.325448im       0.147552+0.127194im   0.00882916+0.0976419im       0.0487164-0.117606im     -0.140845-0.110254im      -0.0892533-0.0805713im    -0.0881739-0.0746856im      0.0112133+0.0427098im   -0.0306154-0.0647352im     -0.109878-0.00274482im  -0.0967927-0.0448478im   -0.00857225-0.0121667im    0.0282121-0.0668304im    -0.0964516-0.170724im     -0.184175-0.091087im       0.022885-0.0905581im
 -0.0870779+0.059321im     -0.0702757+0.301383im      -0.050456+0.171184im     -0.187673-0.0656143im     -0.10703-0.344185im     0.0357213+0.122124im    -0.0350037+0.0297913im    -0.0968803-0.155981im      -0.282765-0.122356im      0.0231347+0.128956im     0.0430491-0.0102387im    -0.0814373+0.0643359im   -0.0185959-0.00213258im   0.00651346-0.0673372im      0.0488502-0.131913im         0.141866+0.0988359im       0.101333+0.167959im      0.0540853-0.0106641im   0.0166922+0.105667im         0.110201-0.0495542im   -0.0440448+0.0961387im      0.0916546+0.0760081im     -0.101559+0.24709im           0.1326+0.0346393im    0.0901338-0.0198805im     -0.216808-0.0816457im    -0.192111-0.0342176im     0.0904713+0.0474232im   0.00105238+0.122103im      -0.181738-0.13582im      -0.159801-0.106726im       0.223671+0.11519im
 0.00284721+0.243672im      -0.304648-0.0931914im     0.0703891-0.242274im     -0.109482+0.108792im    -0.0256147+0.141443im      0.143767-0.0718644im    0.0262611+0.0875566im    -0.0172045-0.215228im      0.0935051+0.303747im       0.066565+0.0697895im    -0.130444+0.178849im      0.0197513-0.126899im    -0.0834298+0.126279im      0.0255061+0.0376249im    0.000519175+0.179408im       -0.0270639+0.0943556im       0.111574-0.0589287im    -0.0438985+0.0814763im    0.105589+0.0142686im       -0.106028+0.0108295im    -0.124622+0.0447263im       0.333213+0.133224im      0.0052413+0.0147216im    -0.00197252+0.0954345im   0.00239948-0.100591im     -0.0167913-0.0349729im    -0.153198-0.129508im       -0.12414-0.0511566im     0.269444+0.0177438im    -0.0399453-0.0401432im  0.000411785-0.195663im    -0.00401908+0.142801im
  -0.159739+0.208109im     -0.0644615+0.0919647im     0.0505494+0.0321425im    0.0639942+0.150447im     -0.030641-0.0870879im    0.0668689+0.0274097im    0.0858874+0.299008im     -0.0142147+0.0939348im     0.0284853-0.193984im      0.0131716-0.129063im     0.0162486+0.237435im       0.116865+0.0455896im    0.0981646-0.113843im        0.25536-0.0633953im     -0.0534134-0.0502574im       -0.155536+0.270296im       -0.066155-0.0951787im    -0.0984228+0.137407im    -0.267841+0.0140243im      -0.0540866+0.183481im     0.0881673+0.000841585im   -0.0239674+0.0890827im       0.20593+0.17911im         0.157044-0.120268im     0.0652541+0.143575im      0.0828332+0.0587921im     0.226381+0.0234219im     0.0180341-0.227924im     0.0848359-0.0239439im   -0.00856237-0.0916508im   -0.0176017-0.043362im     -0.0154171-0.0906982im
 -0.0330235+0.102783im      0.0284356-0.286288im       0.037736+0.183976im   -0.00675199+0.0438479im    -0.111086+0.0280847im    0.0843345+0.108658im    -0.0445997+0.00674218im    0.0301841+0.00118559im   -0.0076626-0.12395im      -0.0201547-0.158986im      0.184272-0.104343im      0.0838012+0.0530124im     0.164129+0.0728416im     0.0668677-0.0509465im     -0.0501109-0.0110766im      -0.0959473-0.180265im     -0.00261667-0.0545148im     0.0619503-0.173316im    -0.153378+0.146747im       -0.0832555+0.191827im   0.000975642-0.0133347im       0.199585+0.0119754im      0.194139-0.0187876im        0.24331+0.0630063im    -0.290129-0.275011im      0.0520527-0.0699432im    -0.304129-0.0412121im    -0.0690089+0.174261im      -0.18872-0.0376009im      0.088889-0.194014im    0.00306509-0.010186im     -0.0233951+0.0833087im
  0.0070168-0.193257im      0.0332279+0.121115im      0.0635939+0.0325945im     0.055277+0.146114im    -0.0165075-0.092399im     0.0696101-0.0913315im    0.0235576-0.0303788im     0.0544161+0.0105217im     0.0502568+0.22735im       -0.167295+0.0513894im  -0.00900386-0.0775823im    -0.0746441-0.0454236im   0.00627854+0.363827im       0.109244-0.203827im      -0.0485003+0.138123im        -0.275161-0.14451im         -0.12966+0.22323im      -0.0259993-0.0475508im  -0.0607204-0.000372709im     0.0372546+0.0622557im   -0.0949183+0.26951im       -0.0593506+0.00777389im      0.11817+0.0887042im     -0.0979053-0.0798733im    0.0666575+0.119713im      -0.116095+0.241514im     0.0959091-0.132019im      -0.136475-0.00507576im  -0.0658712+0.00189487im    0.0700679-0.260747im     -0.158788+0.143397im    -0.00986295+0.166572im
  0.0145674+0.072755im      -0.103876-0.00128926im   -0.0497517+0.243452im     -0.202081-0.0325515im     0.167213-0.048035im     -0.130788+0.153195im     0.0138414+0.0917316im      0.157048+0.0122402im     0.0118655+0.196954im      -0.051772+0.172328im      0.176233+0.0302271im     -0.136012-0.248749im      0.157159+0.131063im       -0.17155-0.0944719im       0.164642-0.189378im         0.147479+0.0400777im     -0.0559743+0.0683744im    -0.0460977-0.159469im    0.0461535+0.0747053im       -0.114374-0.0293453im    -0.121232-0.0823136im       0.115543-0.0633879im     0.0828966+0.0677748im      0.0686893-0.0459598im    -0.030674+0.157853im       0.292352+0.266828im     0.0205258+0.0771705im    -0.0646706-0.0348444im    0.0445393+0.0935783im     0.0792247+0.0041272im       0.1021-0.0834994im    -0.0998521-0.269689im
  -0.221748-0.00246593im    0.0966848+0.0199917im      0.182276-0.110336im    -0.0836433-0.207872im     0.0281133+0.0781347im     -0.22311-0.0431484im     0.142665-0.157423im      0.0979263-0.0287749im      0.217278+0.0230191im    -0.0219873+0.0967792im     0.182783+0.0728018im      0.189455+0.0780447im    -0.108243+0.0380671im      0.167748-0.0222372im       -0.12865-0.153016im          0.10212-0.104315im       0.0789528+0.0335913im     -0.166534-0.0913791im   -0.215648+0.100731im        -0.152785+0.0385514im   -0.0449821-0.0826827im      0.0725481-0.0624914im    -0.0855987+0.103775im       -0.185147-0.178253im    -0.0247825+0.00884073im  -0.00395199-0.00246523im   0.0968879+0.276538im      -0.156486+0.145683im     0.0322779+0.0296811im     -0.140712+0.009218im    -0.0117111-0.138255im       0.194994+0.227047im
  0.0152476+0.136973im     -0.0139184+0.138245im      -0.067509-0.0210553im   0.00451404-0.0577302im     0.201475-0.0395929im     0.280909-0.108692im    -0.0352883-0.130519im       0.199356-0.0292752im      0.109668+0.134601im        0.18976-0.221042im      0.116139-0.13661im      -0.0711847+0.0664508im    -0.232256+0.00289155im    -0.142997-0.107382im      -0.0844845+0.0304402im      -0.0970344+0.0752283im      0.0811209+0.112244im      0.0534855-0.0219548im   -0.110379-0.0969305im    -0.000370513+0.0670826im   -0.0568789-0.401698im      -0.0978557+0.0712843im    -0.0620298+0.0647038im      0.0337801-0.0406081im   0.00322799-0.115239im       0.124619+0.178709im     -0.063046+0.0565036im      0.311268+0.0041772im    0.0703147-0.13081im       -0.129091-0.208187im    -0.0267338+0.0952581im     0.0219438+0.00495265im
  0.0356015-0.0531524im    -0.0783159-0.0947515im       -0.1457-0.0782019im    -0.125307-0.164644im    -0.0790831-0.185554im     -0.118319-0.0412551im   -0.0623044+0.0895203im     -0.273603+0.00743756im    0.0956534+0.0287579im    -0.0376617-0.0391856im    0.0475827-0.187047im      0.0296717+0.00349413im    -0.11923-0.104624im      0.0441455+0.14094im       -0.0959028-0.0536633im        0.160983-0.0612044im      -0.212576+0.214205im     -0.0942107+0.200142im    -0.260979-0.122036im        0.0500681+0.0872267im    0.0143183+0.0550201im    0.000725832+0.118669im       0.178293-0.297581im      -0.0404513+0.10344im      -0.130144-0.0167174im    -0.0158019+0.208209im    -0.0955274+0.0208674im    -0.0353882+0.0467075im     0.318899+0.177039im     -0.0869409-0.0936541im   -0.0384841+0.0686714im     -0.040153-0.116415im
 -0.0351447+0.0241008im    -0.0485804+0.084907im       0.117531+0.0123225im    0.0980188-0.0852722im     0.122191-0.159605im     0.0962342-0.0643207im   -0.0323613-0.0185019im      0.045053-0.042134im     -0.0706048-0.209115im     -0.0164684+0.0714056im     0.141934-0.0712563im       0.18189+0.105692im    -0.0629157-0.167016im       0.196112+0.0597426im     -0.0594289+0.102139im        -0.142006+0.0877977im       0.347868+0.0577138im     0.0514592-0.163401im     0.140485-0.122654im        -0.190907-0.0907483im    -0.199216+0.0944477im      0.0237625-0.0594938im    -0.0883324-0.25011im        0.0335989-0.0335552im   -0.0665796+0.060613im       0.103223+0.267282im    -0.0875906-0.160687im       -0.20883-0.0126568im    0.0444653-0.00121032im     0.152938+0.147574im      -0.22602+0.0122674im     0.0570358-0.178652im
   0.168402-0.0301135im     0.0627514+0.0206084im     0.0702086+0.0227625im    -0.267634-0.0255161im       0.1188+0.213406im     -0.115242+0.0460345im   -0.0289354+0.0305364im     0.0476372-0.0728825im    -0.0316724+0.0443763im     -0.188039-0.0819287im    -0.239754-0.0149126im     0.0499978+0.166945im    -0.0705899-0.0437683im      0.126314-0.129568im        0.222211-0.168285im        0.0402399+0.179553im        0.135999+0.145464im     -0.0467636-0.21156im      0.042004+0.023587im         -0.15998+0.207923im     0.0808351-0.0562314im      -0.239553-0.035448im       0.307591-0.0376321im    -0.00557741+0.217434im     0.0186363+0.0625756im     -0.108741-0.0384092im   -0.0569285-0.083919im      0.0646532+0.0615959im     0.110461-0.170963im     -0.0512733+0.0959562im     -0.17238-0.0256771im     -0.130552+0.118308im
   0.287184-0.0374139im     -0.113272-0.0888063im      0.138599-0.0939238im  -0.00756226+0.198532im    -0.0475909-0.118401im     -0.109788+0.0708463im    -0.238643-0.195689im      0.0318286+0.129634im      -0.173154-0.0502868im     0.0849819-0.0624819im   -0.0314391+0.107812im      0.0103466-0.0325147im    -0.113074-0.0743728im     0.0549179+0.0300213im      0.0615106-0.014067im     -0.000248014-0.048694im       -0.109032+0.00250045im     0.194118-0.0768806im   -0.121636-0.0591767im      -0.0653457+0.0590125im    0.0164393+0.089042im      -0.0138555-0.134686im       0.110305-0.0327733im     -0.0315798-0.0842611im     0.195103+0.00755553im     0.336719+0.16483im     -0.0866589-0.0349028im       0.12115-0.0889575im     0.018914+0.129886im     -0.0158411+0.0817595im     0.163535-0.122968im       0.306482+0.310051im</code></pre><p>and then generate the state <span>$ψ$</span></p><pre><code class="language-julia hljs">psi = P[:, 3]</code></pre><pre><code class="nohighlight hljs">32-element Vector{ComplexF64}:
   -0.05626257050569593 + 0.06943852736042955im
   0.008941104275714026 - 0.13316951829700963im
     0.1346767920082772 - 0.09593980682468639im
     0.3333184778333459 + 0.0im
    0.04506095266769233 + 0.06175510653044007im
    0.13825362460631385 + 0.03370201137804711im
    0.12234043542789746 + 0.11405208438482836im
   -0.29625111500576723 + 0.014594977144872595im
    0.10557162569214414 + 0.21599273553805626im
    0.08318450156664614 + 0.07891756767287061im
    0.20271956309388228 - 0.06118588945650896im
    0.12771262806510017 + 0.12808456191831855im
  -0.045062830514678326 + 0.010800013655396536im
    0.09272315962721778 + 0.06470687998860315im
 -0.0010612468618196695 - 0.07180798662263282im
   -0.06270284302800659 - 0.052296299757638394im
   -0.06724595809325568 - 0.03278671494997892im
     -0.093713814212225 - 0.028671238153434447im
   -0.05626459950975862 + 0.07692466027576278im
  -0.047871583207911496 - 0.032729604096896875im
   0.029734735568227307 - 0.07180177223519339im
    -0.1819600020156837 - 0.15886980983042653im
   -0.08875830039424937 + 0.2408607712810318im
     0.0446050504875319 + 0.025386509821528687im
   -0.05583802399929778 + 0.2112482931081985im
    0.01945854846837415 - 0.25327099644182566im
    0.08793836243981264 - 0.028158225296741297im
    0.06957857075538423 + 0.22427933445313808im
   0.038752481540865934 + 0.1637349732161682im
   -0.00883629432361667 + 0.2582220672758658im
    -0.2300498334132744 - 0.1720829539151451im
    0.01054845538183561 - 0.06510041373881009im</code></pre><p>In the phase estimation process, we will feed the state to circuit and measure the first <code>n</code> qubits processed by iQFT.</p><pre><code class="language-julia hljs">r = join(ArrayReg(psi), zero_state(N))
r |&gt; PE(N, M, U)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 8/8
    nlevel: 2</code></pre><p>Since our phase can be represented by 3 qubits precisely, we only need to measure once</p><pre><code class="language-julia hljs">results = measure(r, 1:N; nshots=1)</code></pre><pre><code class="nohighlight hljs">1-element Vector{DitStr{2, 3, Int64}}:
 011 ₍₂₎</code></pre><p>Recall that our QFT&#39;s bit numbering is reversed, let&#39;s reverse it back</p><pre><code class="language-julia hljs">using BitBasis
estimated_phase = bfloat(results[]; nbits=N)</code></pre><pre><code class="nohighlight hljs">0.75</code></pre><p>the phase is exactly <code>0.75</code>!</p><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../1.prepare-ghz-state/index.html">« Prepare Greenberger–Horne–Zeilinger state with Quantum Circuit</a><a class="docs-footer-nextpage" href="../3.grover-search/index.html">Grover Search »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.4.1 on <span class="colophon-date" title="Thursday 2 May 2024 18:39">Thursday 2 May 2024</span>. Using Julia version 1.10.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
