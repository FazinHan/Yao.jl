<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Quantum Fourier Transformation and Phase Estimation · Documentation | Yao</title><meta name="title" content="Quantum Fourier Transformation and Phase Estimation · Documentation | Yao"/><meta property="og:title" content="Quantum Fourier Transformation and Phase Estimation · Documentation | Yao"/><meta property="twitter:title" content="Quantum Fourier Transformation and Phase Estimation · Documentation | Yao"/><meta name="description" content="Documentation for Documentation | Yao."/><meta property="og:description" content="Documentation for Documentation | Yao."/><meta property="twitter:description" content="Documentation for Documentation | Yao."/><script data-outdated-warner src="../../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../search_index.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script><link href="../../../assets/indigo.css" rel="stylesheet" type="text/css"/><link href="https://yaoquantum.org/assets/favicon-light.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../index.html"><img src="../../../assets/logo.png" alt="Documentation | Yao logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../../index.html">Documentation | Yao</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../../index.html">Home</a></li><li><a class="tocitem" href="../../../quick-start.html">Quick Start</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../../../man/registers.html">Quantum Registers</a></li><li><a class="tocitem" href="../../../man/blocks.html">Blocks</a></li><li><a class="tocitem" href="../../../man/symbolic.html">Symbolic Computation</a></li><li><a class="tocitem" href="../../../man/cuda.html">CUDA extension - CuYao</a></li><li><a class="tocitem" href="../../../man/plot.html">Quantum Circuit Visualization</a></li><li><a class="tocitem" href="../../../man/automatic_differentiation.html">Automatic Differentiation</a></li><li><a class="tocitem" href="../../../man/yao2einsum.html">Tensor network backend</a></li><li><a class="tocitem" href="../../../man/simplification.html">Simplification</a></li><li><a class="tocitem" href="../../../man/bitbasis.html">BitBasis</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../1.prepare-ghz-state/index.html">Prepare Greenberger–Horne–Zeilinger state with Quantum Circuit</a></li><li class="is-active"><a class="tocitem" href="index.html">Quantum Fourier Transformation and Phase Estimation</a><ul class="internal"><li><a class="tocitem" href="#Quantum-Fourier-Transformation"><span>Quantum Fourier Transformation</span></a></li><li><a class="tocitem" href="#Wrap-QFT-to-an-external-block"><span>Wrap QFT to an external block</span></a></li><li><a class="tocitem" href="#Phase-Estimation"><span>Phase Estimation</span></a></li></ul></li><li><a class="tocitem" href="../3.grover-search/index.html">Grover Search</a></li><li><a class="tocitem" href="../4.shor-algorithm/index.html">Shor&#39;s Algorithm</a></li><li><a class="tocitem" href="../5.shor-9-code/index.html">Shor&#39;s 9 qubit code</a></li><li><a class="tocitem" href="../6.quantum-circuit-born-machine/index.html">Quantum Circuit Born Machine</a></li><li><a class="tocitem" href="../7.variation-quantum-eigen-solver/index.html">Variational Quantum Eigen Solver</a></li><li><a class="tocitem" href="../8.riemannian-gradient-flow/index.html">Riemannian gradient flow optimizer</a></li></ul></li><li><a class="tocitem" href="../../../performancetips.html">Performance Tips</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href="index.html">Quantum Fourier Transformation and Phase Estimation</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="index.html">Quantum Fourier Transformation and Phase Estimation</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/QuantumBFS/Yao.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/QuantumBFS/Yao.jl/blob/master/docs/src/examples/2.qft-phase-estimation/main.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><p><a href="/generated/examples/2.qft-phase-estimation/main.ipynb"><img src="https://mybinder.org/badge_logo.svg" alt/></a></p><h1 id="example-qft"><a class="docs-heading-anchor" href="#example-qft">Quantum Fourier Transformation and Phase Estimation</a><a id="example-qft-1"></a><a class="docs-heading-anchor-permalink" href="#example-qft" title="Permalink"></a></h1><p>Let&#39;s use Yao first</p><pre><code class="language-julia hljs">using Yao</code></pre><h2 id="Quantum-Fourier-Transformation"><a class="docs-heading-anchor" href="#Quantum-Fourier-Transformation">Quantum Fourier Transformation</a><a id="Quantum-Fourier-Transformation-1"></a><a class="docs-heading-anchor-permalink" href="#Quantum-Fourier-Transformation" title="Permalink"></a></h2><p>The Quantum Fourier Transformation (QFT) circuit is to repeat two kinds of blocks repeatly:</p><p><img src="assets/qft.png" alt="qft-circuit"/></p><p>The basic building block control phase shift gate is defined as</p><p class="math-container">\[R(k)=\begin{bmatrix}
1 &amp; 0\\
0 &amp; \exp\left(\frac{2\pi i}{2^k}\right)
\end{bmatrix}\]</p><p>Let&#39;s define block <code>A</code> and block <code>B</code>, block <code>A</code> is actually a control block.</p><pre><code class="language-julia hljs">A(i, j) = control(i, j=&gt;shift(2π/(1&lt;&lt;(i-j+1))))</code></pre><pre><code class="nohighlight hljs">A (generic function with 1 method)</code></pre><p>Once you construct the blockl you can inspect its matrix using <code>mat</code> function. Let&#39;s construct the circuit in dash box A, and see the matrix of <span>$R_4$</span> gate.</p><pre><code class="language-julia hljs">R4 = A(4, 1)</code></pre><pre><code class="nohighlight hljs">(n -&gt; control(n, 4, 1 =&gt; shift(0.39269908169872414)))</code></pre><p>If you have read about <a href="@ref tutorial-ghz">preparing GHZ state</a>, you probably know that in Yao, we could just leave the number of qubits, and it will be evaluated when possible.</p><pre><code class="language-julia hljs">R4(5)</code></pre><pre><code class="nohighlight hljs">nqubits: 5
control(4)
└─ (1,) shift(0.39269908169872414)</code></pre><p>its matrix will be</p><pre><code class="language-julia hljs">mat(R4(5))</code></pre><pre><code class="nohighlight hljs">32×32 Diagonal{ComplexF64, Vector{ComplexF64}}:
 1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im</code></pre><p>Then we repeat this control block over and over on different qubits, and put a Hadamard gate to <code>i</code>th qubit to construct <code>i</code>-th <code>B</code> block.</p><pre><code class="language-julia hljs">B(n, k) = chain(n, j==k ? put(k=&gt;H) : A(j, k) for j in k:n)</code></pre><pre><code class="nohighlight hljs">B (generic function with 1 method)</code></pre><p>We need to input the total number of qubits <code>n</code> here because we have to iterate through from <code>k</code>-th location to the last.</p><p>Now, let&#39;s construct the circuit by chaining all the <code>B</code> blocks together</p><pre><code class="language-julia hljs">qft(n) = chain(B(n, k) for k in 1:n)
qft(4)</code></pre><pre><code class="nohighlight hljs">nqubits: 4
chain
├─ chain
│  ├─ put on (1)
│  │  └─ H
│  ├─ control(2)
│  │  └─ (1,) shift(1.5707963267948966)
│  ├─ control(3)
│  │  └─ (1,) shift(0.7853981633974483)
│  └─ control(4)
│     └─ (1,) shift(0.39269908169872414)
├─ chain
│  ├─ put on (2)
│  │  └─ H
│  ├─ control(3)
│  │  └─ (2,) shift(1.5707963267948966)
│  └─ control(4)
│     └─ (2,) shift(0.7853981633974483)
├─ chain
│  ├─ put on (3)
│  │  └─ H
│  └─ control(4)
│     └─ (3,) shift(1.5707963267948966)
└─ chain
   └─ put on (4)
      └─ H
</code></pre><h2 id="Wrap-QFT-to-an-external-block"><a class="docs-heading-anchor" href="#Wrap-QFT-to-an-external-block">Wrap QFT to an external block</a><a id="Wrap-QFT-to-an-external-block-1"></a><a class="docs-heading-anchor-permalink" href="#Wrap-QFT-to-an-external-block" title="Permalink"></a></h2><p>In most cases, <code>function</code>s are enough to wrap quantum circuits, like <code>A</code> and <code>B</code> we defined above, but sometimes, we need to dispatch specialized methods on certain kinds of quantum circuit, or we want to define an external block to export, thus, it&#39;s useful to be able to wrap circuit to custom blocks.</p><p>First, we define a new type as subtype of <code>PrimitiveBlock</code> since we are not going to use the subblocks of <code>QFT</code>, if you need to use its subblocks, it&#39;d be better to define it under <code>CompositeBlock</code>.</p><pre><code class="language-julia hljs">struct QFT &lt;: PrimitiveBlock{2}
    n::Int
end

YaoBlocks.nqudits(q::QFT) = q.n</code></pre><p>Now, let&#39;s define its circuit</p><pre><code class="language-julia hljs">circuit(q::QFT) = qft(q.n)</code></pre><pre><code class="nohighlight hljs">circuit (generic function with 1 method)</code></pre><p>And forward <code>mat</code> to its circuit&#39;s matrix</p><pre><code class="language-julia hljs">YaoBlocks.mat(::Type{T}, x::QFT) where T = mat(T, circuit(x))</code></pre><p>You may notice, it is a little ugly to print <code>QFT</code> at the moment, this is because we print the type summary by default, you can define your own printing by overloading <code>print_block</code></p><pre><code class="language-julia hljs">YaoBlocks.print_block(io::IO, x::QFT) = print(io, &quot;QFT($(x.n))&quot;)</code></pre><p>Since it is possible to use FFT to simulate the results of QFT (like cheating), we could define our custom <code>apply!</code> method:</p><pre><code class="language-julia hljs">using FFTW, LinearAlgebra

function YaoBlocks.apply!(r::ArrayReg, x::QFT)
    α = sqrt(length(statevec(r)))
    invorder!(r)
    lmul!(α, ifft!(statevec(r)))
    return r
end</code></pre><p>Now let&#39;s check if our <code>apply!</code> method is correct:</p><pre><code class="language-julia hljs">r = rand_state(5)
r1 = r |&gt; copy |&gt; QFT(5)
r2 = r |&gt; copy |&gt; circuit(QFT(5))
r1 ≈ r2</code></pre><pre><code class="nohighlight hljs">true</code></pre><p>We can get iQFT (inverse QFT) directly by calling <code>adjoint</code></p><pre><code class="language-julia hljs">QFT(5)&#39;</code></pre><pre><code class="nohighlight hljs"> [†]QFT(5)</code></pre><p>QFT and iQFT are different from FFT and IFFT in three ways,</p><ol><li>they are different by a factor of <span>$\sqrt{2^n}$</span> with <span>$n$</span> the number of qubits.</li><li>the <a href="https://quantumbfs.github.io/BitBasis.jl/stable/tutorial/#Conventions-1">bit numbering</a> will exchange after applying QFT or iQFT.</li><li>due to the convention, QFT is more related to IFFT rather than FFT.</li></ol><h2 id="Phase-Estimation"><a class="docs-heading-anchor" href="#Phase-Estimation">Phase Estimation</a><a id="Phase-Estimation-1"></a><a class="docs-heading-anchor-permalink" href="#Phase-Estimation" title="Permalink"></a></h2><p>Since we have QFT and iQFT blocks we can then use them to realize phase estimation circuit, what we want to realize is the following circuit:</p><p><img src="assets/phaseest.png" alt="phase estimation"/></p><p>First we call Hadamard gates repeatly on first <code>n</code> qubits.</p><pre><code class="language-julia hljs">Hadamards(n) = repeat(H, 1:n)</code></pre><pre><code class="nohighlight hljs">Hadamards (generic function with 1 method)</code></pre><p>Then in dashed box <code>B</code>, we have controlled unitaries:</p><pre><code class="language-julia hljs">ControlU(n, m, U) = chain(n+m, control(k, n+1:n+m=&gt;matblock(U^(2^(k-1)))) for k in 1:n)</code></pre><pre><code class="nohighlight hljs">ControlU (generic function with 1 method)</code></pre><p>each of them is a <code>U</code> of power <span>$2^{(k-1)}$</span>.</p><p>Since we will only apply the qft and Hadamard on first <code>n</code> qubits, we could use <code>Subroutine</code>, which creates a context of a sub-scope of the qubits.</p><pre><code class="language-julia hljs">PE(n, m, U) =
    chain(n+m, # total number of the qubits
        subroutine(Hadamards(n), 1:n), # apply H in local scope
        ControlU(n, m, U),
        subroutine(QFT(n)&#39;, 1:n))</code></pre><pre><code class="nohighlight hljs">PE (generic function with 1 method)</code></pre><p>we use the first <code>n</code> qubits as the output space to store phase <span>$ϕ$</span>, and the other <code>m</code> qubits as the input state which corresponds to an eigenvector of oracle matrix <code>U</code>.</p><p>The subroutine here uses <code>focus!</code> and <code>relax!</code> to manage a local scope of quantum circuit, and only activate the first <code>n</code> qubits while applying the block inside the subroutine context, and the scope will be <code>relax!</code>ed back, after the context. This is equivalent to manually <code>focus!</code> then <code>relax!</code></p><p>fullly activated</p><pre><code class="language-julia hljs">r = rand_state(5)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 5/5
    nlevel: 2</code></pre><p>first 3 qubits activated</p><pre><code class="language-julia hljs">focus!(r, 1:3)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 3/5
    nlevel: 2</code></pre><p>relax back to the original</p><pre><code class="language-julia hljs">relax!(r, 1:3)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 5/5
    nlevel: 2</code></pre><p>In this way, we will be able to apply small operator directly on the subset of the qubits.</p><p>Details about the algorithm can be found here: <a href="https://en.wikipedia.org/wiki/Quantum_phase_estimation_algorithm">Quantum Phase Estimation Algorithm</a></p><p>Now let&#39;s check the results of our phase estimation.</p><p>First we need to set up a unitary with known phase, we set the phase to be 0.75, which is <code>0.75 * 2^3 == 6 == 0b110</code> .</p><pre><code class="language-julia hljs">N, M = 3, 5
P = eigen(rand_unitary(1&lt;&lt;M)).vectors
θ = Int(0b110) / 1&lt;&lt;N
phases = rand(1&lt;&lt;M)
phases[0b010+1] = θ
U = P * Diagonal(exp.(2π * im * phases)) * P&#39;</code></pre><pre><code class="nohighlight hljs">32×32 Matrix{ComplexF64}:
    0.272507-0.155461im      0.0647963+0.0455263im      -0.21249-0.0852935im     -0.106961+0.051691im     -0.0692837-0.0947261im    -0.0383121-0.081684im       -0.177466+0.176374im      0.143438+0.137793im      -0.153462+0.00879732im  0.00988609+0.136448im    0.0300044-0.0678988im    0.0449558+0.201532im       -0.176235-0.0750252im     -0.156354+0.0796986im    0.0162949-0.0966954im    -0.0371076-0.206004im      -0.142284+0.0571308im    -0.0880793+0.0717222im    -0.284977-0.058189im    -0.0196492+0.176625im     -0.200512-0.0734215im      -0.16981-0.0906352im   -0.00557898+0.00378298im   -0.0162423-0.116841im     0.00980089-0.193783im     -0.108179-0.1033im         0.0165875+0.0545932im    0.210611+0.127383im     0.00662417-0.0862334im    -0.0246054-0.0427225im   -0.00452543+0.263414im      -0.0126473-0.201844im
    0.103362+0.106787im        0.14115+0.222516im     -0.0963402+0.0528257im     -0.079158+0.0576204im      -0.15516+0.170236im     -0.0202605+0.0122969im       0.225302+0.086364im    -0.0806411+0.0661094im    -0.0314768-0.162576im     0.0902269+0.0856201im    0.154254+0.0676528im    -0.187657+0.0855145im     -0.0474944+0.228358im       0.197383+0.218889im    -0.0225529+0.108864im      0.0324737+0.0116753im    -0.0513186-0.0157848im     0.0879564-0.237545im    -0.0786202+0.0669153im    0.0410656-0.188188im     0.0400075+0.00900472im    -0.148042-0.238673im      0.0251621-0.253686im        0.25131+0.142607im     -0.0353335+0.144771im     -0.244361-0.0300178im       0.124703-0.0129926im  0.00816075-0.0157403im     0.0387947-0.0411493im    -0.0416116-0.13352im     -0.00974524+0.000254684im     0.169891+0.0326676im
    0.170333+0.00379064im    -0.126237-0.257553im       0.163791-0.146341im      -0.169252-0.0579028im     -0.164819+0.00532453im    0.0442494+0.0563299im     -0.0596192-0.105165im    -0.0194466+0.00177706im   -0.0134334-0.0215573im    0.0314689+0.130839im    0.0754266+0.0693317im   -0.0862877+0.105513im        0.156101+0.0299064im     -0.227108-0.0732182im   -0.0387628+0.157582im      -0.339014+0.281222im    -0.00321302-0.063456im     -0.0587086+0.0555737im     0.066094+0.00772785im  -0.0715849-0.164989im     -0.157315+0.121302im      -0.160202+0.0555384im      0.273477+0.0291582im     0.0332412+0.0473672im     0.0872794-0.161821im    -0.0703164+0.0958144im     0.00149745+0.0807585im   0.0992652-0.0578333im      0.138589+0.0645898im    -0.0265034-0.0792274im      0.269993-0.111443im        0.180822-0.0138989im
   -0.106757-0.19408im       -0.227813+0.14678im        0.194202+0.0316661im     0.0470872-0.150563im      -0.192505+0.0118563im    0.00750785-0.294675im    -0.000538228-0.109621im    -0.0097002+0.0862058im    0.00841096-0.0995235im   -0.0597146-0.0890001im   0.0702018-0.142866im    -0.0873568+0.0270633im     -0.0615819-0.0711832im     0.0279978-0.169655im      0.139413+0.0718493im    -0.0444181+0.0786494im      0.264636+0.0389966im      0.118002+0.0862421im     -0.10221+0.0017363im    -0.155784+0.083011im     0.0313174+0.0163598im    -0.0253631-0.173006im      -0.218289+0.0505411im      0.120051-0.0878028im     -0.117555+0.19402im      0.0385908-0.020536im        0.120965-0.0966378im    0.389479+0.0708103im    -0.0288921+0.0132093im      0.144548-0.130114im       0.162936-0.016919im      -0.0352158+0.0653851im
    0.187142+0.011704im      -0.207974-0.0876056im     -0.118211-0.0900904im      0.156784-0.105138im       0.113396-0.00109295im     0.177694+0.155936im       0.0857023-0.181711im     0.0650665-0.0750949im      0.256887-0.150145im    -0.0480658+0.14545im      0.052725+0.126447im       0.21193+0.213675im      -0.0473376+0.0210985im      0.132563+0.073017im     0.0762742-0.038359im     -0.0338664+0.254261im       0.112148-0.0361579im    -0.0290523-0.0185184im     -0.26806+0.153494im      0.246547+0.108554im     0.0269012-0.0120852im     0.0611643-0.0292227im    -0.0426927-0.0162995im     0.0752116-0.130164im        0.22477-0.0455032im    0.0700712-0.180933im       0.0543121-0.157515im    0.0130834-0.079277im      -0.163538+0.127755im     -0.0616359-0.0227509im    -0.0787098+0.0941327im    -0.00973509+0.130326im
   -0.084534+0.138091im      0.0875075+0.00731448im    -0.110753-0.051771im     -0.0535847-0.32711im       -0.056708+0.087498im      0.0270146-0.0313029im       0.122608+0.0439741im     0.042605+0.145062im      0.0998895+0.037283im    -0.0152452-0.0420247im    0.051216-0.0462697im      0.15833+0.00960748im     -0.228281-0.286271im       0.254602-0.0156324im   -0.0381679-0.0684792im     -0.119455-0.0487811im    0.00459292-0.0452724im    -0.0901764+0.0883039im    0.0198732+0.04174im     -0.0943209-0.282653im    -0.0763557+0.121512im      0.0343217+0.0114445im       0.16066+0.117542im      0.0647962+0.190257im       0.059988-0.171164im      0.066967+0.0791721im     -0.0190735-0.326001im    0.0929878-0.0741046im     0.0372122-0.25959im        0.150337-0.00916558im    -0.153087-0.0627514im     -0.0465604-0.165389im
    0.186777+0.0263167im    0.00281743+0.0389579im     -0.118769-0.111762im     -0.0357983-0.14262im        0.215495-0.0311204im     -0.156908-0.188053im      -0.0513155+0.0642146im    0.0461985-0.121407im      0.0801231+0.0268495im    0.0377555-0.0902232im   -0.114198+0.0591532im   0.00328053+0.214007im      -0.0757536-0.11786im      -0.0558245+0.0128174im    -0.121353+0.474617im      0.0042841+0.00638748im   0.00481938-0.0733192im     -0.109575-0.0703863im     0.259343+0.0603057im     0.286958+0.04695im       0.294511-0.152434im    -0.00759855+0.0743706im     0.0239726+0.0618925im      0.121879+0.00384439im    -0.208897+0.0810269im  -0.00922383+0.0965643im     -0.0148506-0.0925688im   0.0733186+0.065487im      0.0810346-0.0344191im     0.0206883+0.0310488im      0.140333+0.12798im       -0.0601105-0.0459049im
   0.0324297+0.0835131im     -0.232766-0.0466433im     0.0601122-0.231256im      -0.103875-0.0955054im      0.106858+0.160012im     -0.0436051-0.28393im         0.110165+0.12028im       0.154356-0.08816im       0.0237297+0.0269627im   -0.0973471+0.0421918im   0.0485919-0.0997951im     0.142791-0.0168844im      0.0379475+0.153982im       0.065355+0.0773148im    -0.066803-0.044377im     -0.0867439-0.0629748im   -0.00790346+0.193005im        0.17048+0.0568955im     0.179766-0.139241im     0.0947239-0.180645im    -0.0887609-0.127709im      -0.132347-0.0290931im    -0.0942904+0.0729697im     -0.122113-0.239581im      0.0398403-0.111678im     -0.158382+0.0568287im       0.165019+0.100802im    -0.154529+0.198006im      -0.163893-0.130431im     -0.0550555-0.145997im      -0.151592-0.16449im       -0.0498249+0.162544im
  -0.0498136+0.0108743im     -0.182952+0.105853im      -0.119911+0.151076im      -0.109052-0.0352878im      0.211861+0.0513814im      0.142278+0.0465609im      0.0512863-0.0479707im   0.00323501-0.13687im       0.0772049-0.158113im      0.120175-0.0403308im    0.120345+0.21205im      -0.195427+0.144023im       -0.174134-0.0904384im      -0.25118+0.0325869im    0.0352762-0.330127im     -0.0254931-0.222976im       0.154848+0.0901991im     -0.122376-0.0676232im     0.052866+0.189156im     -0.178391-0.046198im      0.100793-0.0461448im     0.0112857+0.211051im       0.151563+0.0281714im   -1.53651e-5-0.0553829im     0.0971897+0.126243im    -0.0906833+0.217064im        0.049055+0.1323im       0.100214+0.082225im       0.087391-0.108943im     -0.0634156-0.0678234im     0.0192212-0.0103744im     -0.0801497+0.14021im
  -0.0796309-0.0476267im     -0.100919-0.0821326im    -0.0166217+0.0765455im      0.147919+0.148903im      0.0480313+0.323549im      -0.250201+0.0283153im       0.140033-0.109411im    0.00713959-0.0754957im     -0.054691-0.0174341im    -0.091215-0.13556im     0.0962459+0.145792im      0.104241-0.134221im      -0.0630337-0.0138709im      -0.18278+0.00323216im   -0.113963+0.0153922im      0.160316-0.140006im       0.180523-0.0750546im     0.0058064+0.0773921im    0.0278302-0.0879072im     0.218624+0.114976im     -0.251552+0.100227im     0.00626225-0.0992565im      0.138202-0.143317im        0.24705-0.149558im      0.0624103-0.148175im    -0.0144178+0.0900359im      -0.172289-0.124189im    0.0761827+0.195745im      0.0987854+0.0195244im      0.171012+0.0683003im   -0.00991574-0.015955im        0.205423-0.032147im
  -0.0974003+0.0654753im     -0.121174-0.0445351im      0.179543-0.0479952im     -0.197725+0.102084im       0.129595+0.108682im      0.0538493+0.191968im     -0.00229666+0.00539773im    -0.10503-0.0557066im      0.023285-0.121465im     -0.350898-0.0955537im    0.248041-0.0758624im    0.0540881-0.0246419im      0.0532234-0.016202im     -0.0680162-0.0500467im   -0.0717741+0.157773im       0.131969-0.0645906im     0.0158793+0.217254im     -0.0307535+0.113988im    -0.0825411+0.102933im      0.032054+0.0271605im     -0.10065-0.20222im       -0.164486+0.0123309im    -0.0922593-0.0204812im    -0.0565143+0.348354im     -0.0817642-0.0205168im   -0.0469091-0.125191im      0.00269379-0.150117im      0.10343-0.0924701im      0.140994-0.088397im      -0.308162+0.0715988im    -0.0143575+0.0809913im      -0.165598-0.0416915im
   -0.105665+0.150686im      0.0113338-0.143741im     -0.0827202-0.0527564im     0.0194907+0.0806193im    -0.0610794+0.0197444im   -0.00531403-0.0242322im      0.0779326-0.113815im    -0.0992346-0.0501005im     -0.192592-0.0809825im     0.146646-0.199585im   -0.0311075-0.109695im       0.15224+0.049206im      -0.0429787-0.17935im       -0.229984+0.0323719im   -0.0239914+0.144486im      -0.276675-0.160665im     -0.0932567-0.0544338im      0.129243+0.0717371im    -0.254763+0.0578315im    -0.112132-0.173084im     0.0331386-0.0309567im      0.277362+0.0552336im     -0.063389+0.00527581im    0.0469967-0.230003im      -0.170833+0.103878im      -0.18199-0.16634im        0.0715648-0.173616im    -0.165462-0.042681im        0.13294+0.142331im      -0.165682-0.0864044im    -0.0870609+0.0146361im      0.0508132+0.0584988im
   -0.157071-0.0428849im     -0.109072+0.011997im       0.183094-0.229077im      0.0241043-0.0719443im     -0.059986-0.0644997im     0.0943403+0.341651im         0.25507+0.138462im    -0.0304079+0.158885im     -0.0877745+0.0537996im     0.232438-0.0810543im   0.0976888-0.135456im     0.0937692+0.126875im      -0.0998417+0.0118924im    -0.0856354-0.048216im    -0.0877393+0.0332556im       0.19577+0.0507979im      0.168545-0.0584192im     0.0496194-0.128977im    -0.0288588-0.0666907im   -0.0497228-0.0518409im    0.0711616-0.112237im     -0.0825696-0.196852im       0.216382+0.100859im      -0.104108-0.174927im      -0.104814+0.0136632im    0.0683124+0.128722im      -0.0371321+0.0343159im   -0.150144+0.0219397im     -0.159236-0.100312im     -0.0189728+0.104208im       0.136406+0.292585im       0.0151062-0.0190966im
    0.111397+0.0613929im    0.00888654-0.0498607im     -0.175607-0.0296932im       0.19112-0.0120625im     -0.061573-0.0522002im     0.0432313-0.124722im        -0.11707+0.120084im     -0.311899-0.184im          0.106186+0.0559265im    -0.124541-0.0369967im   0.0641767-0.0372525im     0.149861+0.0257918im     -0.0170322+0.0188043im      0.164637-0.11825im      -0.241276-0.113025im      0.0260878+0.0180094im      0.154783-0.0861259im     0.0140858+0.202004im     -0.181514-0.0210896im   -0.0603024-0.0107256im   -0.0188092-0.0517161im     -0.270634-0.0530962im       0.20034+0.0929668im      0.132404-0.0803635im     -0.110343+0.31338im      0.0374309+0.142703im      -0.0788676+0.245054im   -0.0765011-0.0621059im     0.0994286+0.102955im      -0.114724-0.0246817im    -0.0943259-0.120454im      -0.0214048-0.1685im
  -0.0490162+0.131858im      0.0185538+0.0575533im    -0.0318727+0.112526im      0.0561049+0.000404351im    0.116725+0.0234348im     -0.149055+0.0278112im     -0.0513241-0.226395im     0.0396987+0.218633im      0.0812082-0.146493im      0.236036-0.104034im     0.155078+0.15242im       0.277829-0.0656635im     -0.0265017+0.00904191im    -0.148997-0.0163178im     0.179374+0.00170972im    -0.175391+0.0371961im    0.00340948-0.138907im       0.130757+0.0641179im    0.0437596-0.0317126im    0.0291512+0.113665im     0.0377851-0.0274927im     -0.196539-0.0923643im     -0.107075+0.233258im       0.102321+0.27462im       -0.114735-0.0789841im   -0.0919797+0.0066191im        0.22111+0.30139im    -0.0700751+0.0201961im     -0.154607-0.010671im      0.0125438+0.147747im     -0.0672632-0.0348873im     -0.0300605-0.156349im
  -0.0210551+0.165767im     -0.0708979-0.0999558im     -0.167818+0.238673im    -0.00402266-0.0212419im      0.247721-0.0856141im    -0.0369929+0.0646647im     -0.0419556+0.138007im    0.00744561+0.0453372im       0.13536+0.0441193im     0.119519-0.0510975im     0.18252-0.159729im     -0.282748+0.273284im        -0.13472-0.0447643im     0.0169652-0.118541im    -0.0210789+0.0590989im      0.118345+0.0958633im    -0.0710695-0.00630416im     0.169293+0.14002im      0.0843302+0.0117836im   -0.0357798+0.0960277im    -0.333298+0.0293957im    -0.0996931+0.011838im     -0.0751025+0.00352078im    -0.193938-0.0203314im    -0.0566495+0.0976857im    -0.103092-0.094603im       0.0247321-0.20124im      -0.15816-0.0219488im     -0.103185+0.127091im       0.184343+0.00794522im     0.121248-0.155024im        0.162609-0.0168761im
   0.0172671+0.0640983im   -0.00359293-0.236189im     -0.0631522-0.0343119im    -0.0547435-0.0517363im     0.0821376-0.0721198im      0.121369+0.0477215im       0.072709+0.185203im     -0.081349-0.0727203im    -0.0414962+0.0399286im    0.0118135+0.0954175im   0.0582076+0.0114209im     0.148998-0.231093im      -0.0324418-0.0643361im      0.115978-0.104157im     0.0886523-0.129906im     -0.0452038+0.017748im       0.240303-0.32887im       0.0278029-0.197689im      0.128867-0.232492im    -0.0168947+0.289638im     0.0107788-0.0465055im     0.0944513+0.0755358im      -0.14686-0.176982im     -0.0356574+0.0568589im   -0.00158164-0.0133273im    -0.307526-0.00412729im      0.123287-0.0670584im   0.0360431-0.00683983im     0.149404-0.102065im     -0.0686987-0.248012im       0.185929+0.0434998im     -0.0246633-0.116189im
    0.143055-0.0253071im     0.0981031-0.0405407im    -0.0578922+0.068601im      -0.186491-0.165219im     -0.0600628-0.165961im      0.0803256+0.0428343im     -0.0835443-0.0939147im     0.183566+0.00941099im   -0.0375468+0.143918im     -0.042753-0.0177806im   0.0643638+0.0929171im    -0.025714-0.0396773im       0.257563-0.10295im      -0.0739636-0.0731061im    0.0464793+0.122089im      0.0757993-0.2239im         0.204233+0.0872484im      0.276531+0.104063im     -0.158303+0.086178im      0.102162+0.0859103im     0.110065-0.0874969im      0.100923-0.208748im       0.116949-0.207027im      -0.072597-0.00797475im    0.0242774-0.025868im     -0.145444+0.353382im       0.0474022-0.0627187im  -0.0170911-0.243034im      -0.154672-0.0265941im     0.0384398+0.05664im       -0.132251-0.156253im       0.0455123-0.00681243im
    0.135299+0.0563474im      0.171078+0.061225im        -0.1477-0.0360766im    -0.0515867+0.0195413im    -0.0330698+0.148297im     0.00869514+0.0542007im      0.0265912+0.122647im     -0.169506-0.188404im      -0.174054-0.0238172im    -0.109454-0.0165826im    0.120008-0.0033351im  -0.00666929+0.129095im        0.144431-0.0191768im     -0.234332-0.157286im     0.0118963-0.130971im     -0.0548634+0.0922308im     0.0733179-0.0622518im   -0.00845155-0.0105699im     0.145324+0.00942057im   0.0504684-0.147501im     0.0979782+0.269093im       0.111469-0.261253im     -0.0431706-0.0186859im    -0.0875538-0.0303836im      0.100427+0.0560831im   -0.0101901-0.152607im       0.0694908-0.0905941im   0.0605785+0.179847im      -0.235716+0.041238im      0.0243809+0.213235im      0.0921238-0.103338im       -0.389203-0.14579im
 -0.00979825-0.0822657im     0.0848876-0.0555786im     -0.123994+0.194515im      -0.027168-0.038601im     -0.0639363+0.146771im       0.259685+0.158655im       -0.179982-0.0663445im   -0.0248686-0.129485im       0.154921+0.128642im    -0.0266634-0.070313im    -0.277662-0.248052im     0.0499265+0.0494762im     -0.0993839+0.125516im      -0.190226-0.188693im    -0.0112166-0.0704213im    -0.0068914+0.0635595im     0.0257317+0.00858605im     0.052156-0.0459831im    0.0880948-0.145095im      0.150726-0.135719im     0.0447272-0.0154761im    -0.0557017-0.0348681im     -0.038171-0.0155951im     0.0523206-0.00874129im    -0.087181+0.0171107im  -0.00707086-0.114044im        0.211376+0.0241297im    0.163141-0.0135392im     0.0372096-0.311614im     -0.0677291+0.151965im      -0.143437+0.0488475im       0.342256+0.112907im
   0.0187742-0.0801246im    -0.0935271-0.149754im      -0.123907-0.0438459im    -0.0900474+0.178065im      -0.231138-0.144401im      -0.112319+0.0381222im     -0.0190057-0.0414453im     0.127381+0.0742449im   -0.00276853+0.068223im    -0.0413635-0.0240845im    0.283941+0.0345833im   -0.0293992-0.0363419im       0.160048+0.11827im     -0.00392841+0.0779259im    -0.110514-0.0216038im   0.000290649-0.0173988im       0.13828-0.191584im     -0.0542897+0.0794415im   -0.0277364+0.139637im     0.0141976-0.0371199im      0.28201+0.00586499im   -0.0705223+0.24122im       -0.062883+0.160141im      -0.106135+0.0431938im    0.00622509+0.207439im    -0.0676422-0.238434im       -0.179962-0.113759im   -0.0156044+0.198088im      -0.113793-0.305789im       0.159094-0.0220168im     -0.125159-0.0343473im       0.179534-0.0122316im
  -0.0703552-0.00155504im     0.350319+0.000738567im   0.0162863+0.0512978im     0.0753705+0.271646im      0.0881594+0.0970249im      0.134507-0.169397im      -0.0102155-0.0615714im     0.119297+0.0430721im      0.206394-0.23761im     -0.0687157+0.230778im     0.243365-0.14953im       0.108647-0.103548im      -0.0249265-0.130938im     -0.0936858-0.088618im     0.0069172+0.158871im     0.00797404+0.121578im     -0.0184642+0.13974im        -0.12809-0.124704im     -0.126638-0.0431856im     0.099746+0.0606745im    0.0271741+0.0777922im      0.120366-0.10969im        0.199752+0.131198im      -0.259901-0.0924997im    -0.0519697+0.114185im     0.0131999+0.119083im       0.0394402+0.0339575im  -0.0779442+0.0467105im     0.0896655-0.160477im       0.102522-0.167867im      0.0631244-0.0365799im      0.0217228+0.0331041im
   0.0615575-0.210297im      0.0279371+0.101846im       0.106334-0.119298im      0.0318919+0.165887im       0.244104-0.0589478im      -0.16676+0.0587269im      -0.122356-0.0749399im    0.0638653+0.340831im       0.224864+0.0799122im   -0.0415031-0.0834833im   -0.212152-0.0444313im    0.0423975+0.102284im        0.127867-0.00988607im   -0.0247881-0.102577im     -0.139934-0.260779im     -0.0514924+0.0710851im     0.0996835-0.150957im     -0.0284603+0.0617375im  -0.00195348+0.167745im     0.0541743-0.244866im     -0.142145-0.113729im       0.147527-0.113867im      0.0636959-0.247743im      0.0408025+0.106314im      -0.127253+0.0831704im    -0.130715-0.0234763im      0.0235037-0.0251094im  -0.0860951+0.106891im      0.0320681-0.0437828im   -0.00267369-0.210578im      0.0567243-0.018443im       -0.131787+0.014253im
    0.337751+0.205617im     -0.0734037-0.022286im     -0.0870816+0.0342079im      0.015856-0.0155953im    -0.0776012+0.184119im      -0.147669+0.0268845im      -0.210869+0.0747622im    0.0976382+0.061526im       0.178737-0.0114826im     0.227346-0.141587im    0.0967747-0.136461im       0.11225-0.125617im       0.0999068+0.0149487im     -0.069083+0.118907im     -0.165031-0.00314302im     0.143234-0.107391im       0.169222+0.106513im      0.0253345-0.091052im    -0.0632132-0.127443im     -0.096687-0.174129im    -0.0504534+0.057518im       0.148293-0.00752022im    -0.253897+0.0736819im   -0.00378419+0.0555665im      0.186299+0.0505889im     0.173188+0.014096im      -0.0834261+0.0755049im   0.0148137-0.226338im      0.0835503-0.04583im      0.00495432-0.0392482im      0.275793+0.103163im      -0.0488229+0.114372im
   -0.126231-0.0651726im      0.149005+0.0378517im     -0.276522-0.0960205im      0.140519+0.0705147im     0.0238946-0.0252842im      0.205458-0.0130422im      -0.102911+0.0551834im    -0.220358+0.0638002im    -0.0648459+0.0973636im   0.00478736-0.19287im    0.00649829+0.104889im     -0.127991-0.000987793im    0.0143131+0.295296im      -0.143927-0.0348001im    0.0933915+0.185412im      0.0468288+0.0974498im       0.11804+0.0360436im      0.160789+0.0676331im   -0.0324092+0.0757938im   0.00583319-0.0306571im   -0.0540758-0.0408674im     0.0139075+0.0536205im    -0.0800607+0.203865im      0.0906162+0.0919627im      0.153913-0.281689im      0.107676+0.160036im     -0.00547237-0.108831im   -0.0751805+0.0856694im   -0.00470388-0.0620839im     0.0157117-0.420021im     -0.0342212+0.0867293im      -0.112589+0.0268404im
   -0.199675+0.131551im      -0.187093+0.220588im     -0.0584964+0.202628im   -0.000582758-0.0780173im     0.0504795-0.171359im      -0.124184+0.0769329im     -0.0438734+0.0907023im    0.0393336-0.0895226im    0.00198466+0.315289im     0.0137641+0.285866im    0.0539486-0.115243im       0.20148-0.0942194im      0.0857573+0.0648541im     -0.194937-0.0920765im   -0.0677517+0.0607059im    -0.0911733+0.0101748im   -0.00075145+0.201262im      -0.243595-0.139716im    -0.0956389+0.101866im     -0.112363+0.025161im      0.107857-0.112547im     -0.0256249-0.121364im     0.00265521-0.0559571im      0.266399-0.00838811im     0.093628-0.0511158im     0.083264-0.091002im       0.0892022-0.112251im    -0.150642+0.0950662im    0.00652654+0.0102732im     0.0393021-0.11412im        0.104675-0.161932im       0.0614262-0.115566im
    0.257573-0.223126im      0.0427909+0.0307248im     0.0221735+0.0580415im      0.253147-0.139273im     -0.0676163+0.0569277im     0.0918476+0.00398424im      0.148631-0.274863im      0.118406-0.00271486im    -0.168351+0.11773im      0.0041375+0.191593im    0.0686263+0.149666im    -0.0689062-0.0358612im      -0.162008+0.0219766im     -0.171798+0.0459795im    -0.191108+0.0259072im     0.0702119-0.00439166im     0.110853+0.0735538im      0.081774-0.180158im      0.185889-0.0713724im   -0.0730425-0.0473194im    -0.209821-0.209096im        0.06628+0.0639461im   -0.00363188+0.123925im     -0.0718142+0.0619im        -0.169906+0.105668im     0.0764232-0.20183im        0.0125525-0.0667837im  -0.0601344-0.13974im     -0.00417281-0.00293481im   -0.0889643-0.101203im     -0.0995354-0.167554im      -0.0935533-0.222059im
  0.00270539+0.121135im      -0.143014-0.0841217im    -0.0284692+0.0562483im     -0.034678+0.214712im      -0.100558-0.263821im      -0.102792-0.066435im       0.0403161-0.24751im      -0.162062-0.147264im     -0.0288327+0.0638597im   -0.0296787-0.162041im    -0.109751+0.0344579im    0.0183293+0.0289695im      0.0770197-0.205377im      0.0736961+0.0058666im   -0.0440287+0.0794254im      0.213745-0.0180346im    -0.0572071+0.00954589im    -0.103354-0.209169im      0.129024+0.152632im     -0.018481+0.0110733im    -0.201061+0.151908im      -0.110641-0.13963im       0.0965528+0.0557726im     0.0141873-0.124626im      0.0372034-0.0750671im   -0.0851628-0.140185im        0.220107+0.138717im    0.0373155-0.23348im      -0.0917037-0.262064im       0.132186-0.180557im     -0.0599571+0.0990548im      -0.155969+0.0516342im
  -0.0129095-0.0022217im     -0.118111-0.18435im       -0.177587-0.079649im      -0.027917-0.0404361im     -0.143931+0.0523236im    -0.0993757+0.158997im       0.0321337-0.0577377im   -0.0228195+0.0227593im      0.139664-0.239401im     -0.100943+0.207695im   -0.0992285-0.174842im    -0.0356992+0.0607744im       0.103576+0.349241im     -0.0355711+0.122966im     0.0428361-0.037963im      0.0593376-0.185229im     -0.0190782-0.0929095im     -0.189089+0.102803im      0.183509+0.10687im      -0.152049+0.112669im   -0.00426014-0.0339009im      0.154925-0.178066im     -0.0491193+0.134209im      -0.037894-0.0434406im     -0.225353-0.0275892im    0.0421882+0.202649im        0.214986-0.0977544im  -0.0256825-0.0772689im      0.180732+0.110634im       0.188248+0.0198054im     -0.108236+0.0233318im      -0.076375-0.0968902im
    0.158209-0.01981im        0.155239+0.0475932im      0.147316-0.0909338im     0.0747489-0.32498im       -0.012451+0.117567im     -0.0858962+0.0618656im      0.0228183+0.0289933im    -0.230923-0.246048im     -0.0362893-0.00642977im  -0.0057103+0.0363676im   0.0593163+0.0112523im     0.177331+0.0530523im       0.147166-0.0437234im     -0.135075+0.00178666im   0.0522856-0.0883133im     0.0671692+0.0278242im     -0.260598-0.0552803im   -0.00998286-0.0251585im    -0.131685+0.196081im      -0.10623+0.163078im     -0.179345-0.0257601im     0.0542874+0.119266im      -0.118598-0.0545346im     0.0087404+0.142305im      -0.246559+0.0418741im    0.0185334+0.116929im      -0.0964895+0.031487im   -0.0516077+0.0984827im     -0.183086-0.225397im       0.193359-0.118977im      0.0366301+0.0140914im       0.121021+0.253704im
  -0.0175335+0.0144037im     0.0150071-0.148187im       0.118908-0.0664264im    -0.0336413+0.166785im     -0.0212373+0.0267872im    -0.0111743+0.0922784im      -0.309988-0.112325im     -0.191035-0.0287426im      0.110517-0.0427214im     0.196194+0.151031im   -0.0504136+0.0827894im    0.0765612+0.0512503im      -0.122433+0.0784969im      0.225167-0.0230801im   -0.0887304+0.030163im      0.0563374-0.231928im      -0.108057+0.00051301im      0.32027-0.230469im    -0.0639341+0.0787773im   -0.0804658+0.039546im     0.0558481-0.116031im       0.021865+0.00164903im     0.119496+0.0721258im     0.0277186-0.0767479im    -0.0199929-0.123441im     0.0651467-0.0135355im   -0.000899907-0.179502im     0.180458+0.236818im     -0.0621165-0.0835051im    -0.0465049+0.104662im        0.17997-0.321793im       -0.112816-0.0123914im
    0.204103-0.0357258im    -0.0343572+0.056016im       0.196132-0.130007im      0.0962812+0.194896im       0.175063-0.00882489im    0.0972972-0.119255im        0.133283+0.134784im     0.0906125-0.131837im        0.14314+0.31774im       0.152676+0.0193589im    0.173598+0.0962323im    0.0780352-0.113471im     -0.00462622+0.132425im     -0.0456824-0.1239im        0.199652+0.0114303im     0.0673992-0.193706im      -0.227864-0.168334im      0.0814906+0.196298im      0.116213+0.133499im      -0.13324-0.0296996im    0.0346053+0.13894im         0.03582-0.145295im       0.124901+0.0909053im    0.00997425+0.0458394im     0.0735874+0.121414im     0.0949054-0.0676392im       0.165688-0.144626im     0.149792-0.0868365im      0.103874+0.045813im        -0.0814-0.0163659im    -0.0696691+0.132473im        0.120002+0.0247863im</code></pre><p>and then generate the state <span>$ψ$</span></p><pre><code class="language-julia hljs">psi = P[:, 3]</code></pre><pre><code class="nohighlight hljs">32-element Vector{ComplexF64}:
  -0.17615749917432952 - 0.04970186898954763im
  -0.01762021363657701 + 0.015271014175584616im
  -0.09284290577014465 + 0.17006552176406853im
   -0.1079310145156985 + 0.06496743465015561im
  -0.26678844241238103 - 0.009956946269732855im
   0.12415428054671526 + 0.20969179349151973im
 -0.010871210633550777 + 0.012119801966410208im
   0.10249877629326563 + 0.20266317041636683im
  -0.10424032916472346 + 0.02947512315042866im
    0.2745548918551144 + 0.0im
  0.007055139261784388 - 0.15090483437556754im
   0.17177613327828217 - 0.029305960382438226im
   -0.0680296765426413 - 0.18994627647190712im
   0.18680976740841213 + 0.005020996385201287im
 -0.009784537089074861 + 0.12704522572576962im
   0.01434850265764405 - 0.1009968071375304im
  -0.06977896679100687 + 0.0979265068172985im
   0.09533461304679187 - 0.14224603424363572im
    0.1989584025398801 - 0.10310165037428316im
   0.07566967540950381 + 0.054202809133611585im
  -0.09687184799718901 + 0.1004056185385167im
   0.03727622121463145 - 0.24557721670287033im
  -0.11921857875383257 - 0.22499722464262317im
   0.20076394641842482 - 0.07439023133692721im
   0.07220087562945926 + 0.18335260203838147im
  -0.05092509700105666 - 0.06339197909132713im
   0.07299759342666733 + 0.004037697789100229im
   0.23775611162797006 - 0.06939057857277754im
  0.060182850164587263 + 0.02240098048667768im
 -0.025456901443856813 + 0.014531610414117498im
   0.05411418895532181 + 0.2342615999572223im
   0.11886604348779277 + 0.06255500042043932im</code></pre><p>In the phase estimation process, we will feed the state to circuit and measure the first <code>n</code> qubits processed by iQFT.</p><pre><code class="language-julia hljs">r = join(ArrayReg(psi), zero_state(N))
r |&gt; PE(N, M, U)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 8/8
    nlevel: 2</code></pre><p>Since our phase can be represented by 3 qubits precisely, we only need to measure once</p><pre><code class="language-julia hljs">results = measure(r, 1:N; nshots=1)</code></pre><pre><code class="nohighlight hljs">1-element Vector{DitStr{2, 3, Int64}}:
 011 ₍₂₎</code></pre><p>Recall that our QFT&#39;s bit numbering is reversed, let&#39;s reverse it back</p><pre><code class="language-julia hljs">using BitBasis
estimated_phase = bfloat(results[]; nbits=N)</code></pre><pre><code class="nohighlight hljs">0.75</code></pre><p>the phase is exactly <code>0.75</code>!</p><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../1.prepare-ghz-state/index.html">« Prepare Greenberger–Horne–Zeilinger state with Quantum Circuit</a><a class="docs-footer-nextpage" href="../3.grover-search/index.html">Grover Search »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.4.1 on <span class="colophon-date" title="Thursday 2 May 2024 18:42">Thursday 2 May 2024</span>. Using Julia version 1.10.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
