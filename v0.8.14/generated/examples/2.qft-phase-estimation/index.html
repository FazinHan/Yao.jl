<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Quantum Fourier Transformation and Phase Estimation · Documentation | Yao</title><meta name="title" content="Quantum Fourier Transformation and Phase Estimation · Documentation | Yao"/><meta property="og:title" content="Quantum Fourier Transformation and Phase Estimation · Documentation | Yao"/><meta property="twitter:title" content="Quantum Fourier Transformation and Phase Estimation · Documentation | Yao"/><meta name="description" content="Documentation for Documentation | Yao."/><meta property="og:description" content="Documentation for Documentation | Yao."/><meta property="twitter:description" content="Documentation for Documentation | Yao."/><script data-outdated-warner src="../../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../search_index.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script><link href="../../../assets/indigo.css" rel="stylesheet" type="text/css"/><link href="https://yaoquantum.org/assets/favicon-light.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../index.html"><img src="../../../assets/logo.png" alt="Documentation | Yao logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../../index.html">Documentation | Yao</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../../index.html">Home</a></li><li><a class="tocitem" href="../../../quick-start.html">Quick Start</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../../../man/registers.html">Quantum Registers</a></li><li><a class="tocitem" href="../../../man/blocks.html">Blocks</a></li><li><a class="tocitem" href="../../../man/symbolic.html">Symbolic Computation</a></li><li><a class="tocitem" href="../../../man/cuda.html">CUDA extension - CuYao</a></li><li><a class="tocitem" href="../../../man/plot.html">Quantum Circuit Visualization</a></li><li><a class="tocitem" href="../../../man/automatic_differentiation.html">Automatic Differentiation</a></li><li><a class="tocitem" href="../../../man/yao2einsum.html">Tensor network backend</a></li><li><a class="tocitem" href="../../../man/simplification.html">Simplification</a></li><li><a class="tocitem" href="../../../man/bitbasis.html">BitBasis</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../1.prepare-ghz-state/index.html">Prepare Greenberger–Horne–Zeilinger state with Quantum Circuit</a></li><li class="is-active"><a class="tocitem" href="index.html">Quantum Fourier Transformation and Phase Estimation</a><ul class="internal"><li><a class="tocitem" href="#Quantum-Fourier-Transformation"><span>Quantum Fourier Transformation</span></a></li><li><a class="tocitem" href="#Wrap-QFT-to-an-external-block"><span>Wrap QFT to an external block</span></a></li><li><a class="tocitem" href="#Phase-Estimation"><span>Phase Estimation</span></a></li></ul></li><li><a class="tocitem" href="../3.grover-search/index.html">Grover Search</a></li><li><a class="tocitem" href="../4.shor-algorithm/index.html">Shor&#39;s Algorithm</a></li><li><a class="tocitem" href="../5.shor-9-code/index.html">Shor&#39;s 9 qubit code</a></li><li><a class="tocitem" href="../6.quantum-circuit-born-machine/index.html">Quantum Circuit Born Machine</a></li><li><a class="tocitem" href="../7.variation-quantum-eigen-solver/index.html">Variational Quantum Eigen Solver</a></li><li><a class="tocitem" href="../8.riemannian-gradient-flow/index.html">Riemannian gradient flow optimizer</a></li></ul></li><li><a class="tocitem" href="../../../performancetips.html">Performance Tips</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href="index.html">Quantum Fourier Transformation and Phase Estimation</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="index.html">Quantum Fourier Transformation and Phase Estimation</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/QuantumBFS/Yao.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/QuantumBFS/Yao.jl/blob/master/docs/src/examples/2.qft-phase-estimation/main.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><p><a href="/generated/examples/2.qft-phase-estimation/main.ipynb"><img src="https://mybinder.org/badge_logo.svg" alt/></a></p><h1 id="example-qft"><a class="docs-heading-anchor" href="#example-qft">Quantum Fourier Transformation and Phase Estimation</a><a id="example-qft-1"></a><a class="docs-heading-anchor-permalink" href="#example-qft" title="Permalink"></a></h1><p>Let&#39;s use Yao first</p><pre><code class="language-julia hljs">using Yao</code></pre><h2 id="Quantum-Fourier-Transformation"><a class="docs-heading-anchor" href="#Quantum-Fourier-Transformation">Quantum Fourier Transformation</a><a id="Quantum-Fourier-Transformation-1"></a><a class="docs-heading-anchor-permalink" href="#Quantum-Fourier-Transformation" title="Permalink"></a></h2><p>The Quantum Fourier Transformation (QFT) circuit is to repeat two kinds of blocks repeatly:</p><p><img src="assets/qft.png" alt="qft-circuit"/></p><p>The basic building block control phase shift gate is defined as</p><p class="math-container">\[R(k)=\begin{bmatrix}
1 &amp; 0\\
0 &amp; \exp\left(\frac{2\pi i}{2^k}\right)
\end{bmatrix}\]</p><p>Let&#39;s define block <code>A</code> and block <code>B</code>, block <code>A</code> is actually a control block.</p><pre><code class="language-julia hljs">A(i, j) = control(i, j=&gt;shift(2π/(1&lt;&lt;(i-j+1))))</code></pre><pre><code class="nohighlight hljs">A (generic function with 1 method)</code></pre><p>Once you construct the blockl you can inspect its matrix using <code>mat</code> function. Let&#39;s construct the circuit in dash box A, and see the matrix of <span>$R_4$</span> gate.</p><pre><code class="language-julia hljs">R4 = A(4, 1)</code></pre><pre><code class="nohighlight hljs">(n -&gt; control(n, 4, 1 =&gt; shift(0.39269908169872414)))</code></pre><p>If you have read about <a href="@ref tutorial-ghz">preparing GHZ state</a>, you probably know that in Yao, we could just leave the number of qubits, and it will be evaluated when possible.</p><pre><code class="language-julia hljs">R4(5)</code></pre><pre><code class="nohighlight hljs">nqubits: 5
control(4)
└─ (1,) shift(0.39269908169872414)</code></pre><p>its matrix will be</p><pre><code class="language-julia hljs">mat(R4(5))</code></pre><pre><code class="nohighlight hljs">32×32 Diagonal{ComplexF64, Vector{ComplexF64}}:
 1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅               ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im      ⋅              ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅           1.0+0.0im          ⋅    
     ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅          ⋅              ⋅               ⋅              ⋅               ⋅              ⋅               ⋅      0.92388+0.382683im</code></pre><p>Then we repeat this control block over and over on different qubits, and put a Hadamard gate to <code>i</code>th qubit to construct <code>i</code>-th <code>B</code> block.</p><pre><code class="language-julia hljs">B(n, k) = chain(n, j==k ? put(k=&gt;H) : A(j, k) for j in k:n)</code></pre><pre><code class="nohighlight hljs">B (generic function with 1 method)</code></pre><p>We need to input the total number of qubits <code>n</code> here because we have to iterate through from <code>k</code>-th location to the last.</p><p>Now, let&#39;s construct the circuit by chaining all the <code>B</code> blocks together</p><pre><code class="language-julia hljs">qft(n) = chain(B(n, k) for k in 1:n)
qft(4)</code></pre><pre><code class="nohighlight hljs">nqubits: 4
chain
├─ chain
│  ├─ put on (1)
│  │  └─ H
│  ├─ control(2)
│  │  └─ (1,) shift(1.5707963267948966)
│  ├─ control(3)
│  │  └─ (1,) shift(0.7853981633974483)
│  └─ control(4)
│     └─ (1,) shift(0.39269908169872414)
├─ chain
│  ├─ put on (2)
│  │  └─ H
│  ├─ control(3)
│  │  └─ (2,) shift(1.5707963267948966)
│  └─ control(4)
│     └─ (2,) shift(0.7853981633974483)
├─ chain
│  ├─ put on (3)
│  │  └─ H
│  └─ control(4)
│     └─ (3,) shift(1.5707963267948966)
└─ chain
   └─ put on (4)
      └─ H
</code></pre><h2 id="Wrap-QFT-to-an-external-block"><a class="docs-heading-anchor" href="#Wrap-QFT-to-an-external-block">Wrap QFT to an external block</a><a id="Wrap-QFT-to-an-external-block-1"></a><a class="docs-heading-anchor-permalink" href="#Wrap-QFT-to-an-external-block" title="Permalink"></a></h2><p>In most cases, <code>function</code>s are enough to wrap quantum circuits, like <code>A</code> and <code>B</code> we defined above, but sometimes, we need to dispatch specialized methods on certain kinds of quantum circuit, or we want to define an external block to export, thus, it&#39;s useful to be able to wrap circuit to custom blocks.</p><p>First, we define a new type as subtype of <code>PrimitiveBlock</code> since we are not going to use the subblocks of <code>QFT</code>, if you need to use its subblocks, it&#39;d be better to define it under <code>CompositeBlock</code>.</p><pre><code class="language-julia hljs">struct QFT &lt;: PrimitiveBlock{2}
    n::Int
end

YaoBlocks.nqudits(q::QFT) = q.n</code></pre><p>Now, let&#39;s define its circuit</p><pre><code class="language-julia hljs">circuit(q::QFT) = qft(q.n)</code></pre><pre><code class="nohighlight hljs">circuit (generic function with 1 method)</code></pre><p>And forward <code>mat</code> to its circuit&#39;s matrix</p><pre><code class="language-julia hljs">YaoBlocks.mat(::Type{T}, x::QFT) where T = mat(T, circuit(x))</code></pre><p>You may notice, it is a little ugly to print <code>QFT</code> at the moment, this is because we print the type summary by default, you can define your own printing by overloading <code>print_block</code></p><pre><code class="language-julia hljs">YaoBlocks.print_block(io::IO, x::QFT) = print(io, &quot;QFT($(x.n))&quot;)</code></pre><p>Since it is possible to use FFT to simulate the results of QFT (like cheating), we could define our custom <code>apply!</code> method:</p><pre><code class="language-julia hljs">using FFTW, LinearAlgebra

function YaoBlocks.apply!(r::ArrayReg, x::QFT)
    α = sqrt(length(statevec(r)))
    invorder!(r)
    lmul!(α, ifft!(statevec(r)))
    return r
end</code></pre><p>Now let&#39;s check if our <code>apply!</code> method is correct:</p><pre><code class="language-julia hljs">r = rand_state(5)
r1 = r |&gt; copy |&gt; QFT(5)
r2 = r |&gt; copy |&gt; circuit(QFT(5))
r1 ≈ r2</code></pre><pre><code class="nohighlight hljs">true</code></pre><p>We can get iQFT (inverse QFT) directly by calling <code>adjoint</code></p><pre><code class="language-julia hljs">QFT(5)&#39;</code></pre><pre><code class="nohighlight hljs"> [†]QFT(5)</code></pre><p>QFT and iQFT are different from FFT and IFFT in three ways,</p><ol><li>they are different by a factor of <span>$\sqrt{2^n}$</span> with <span>$n$</span> the number of qubits.</li><li>the <a href="https://quantumbfs.github.io/BitBasis.jl/stable/tutorial/#Conventions-1">bit numbering</a> will exchange after applying QFT or iQFT.</li><li>due to the convention, QFT is more related to IFFT rather than FFT.</li></ol><h2 id="Phase-Estimation"><a class="docs-heading-anchor" href="#Phase-Estimation">Phase Estimation</a><a id="Phase-Estimation-1"></a><a class="docs-heading-anchor-permalink" href="#Phase-Estimation" title="Permalink"></a></h2><p>Since we have QFT and iQFT blocks we can then use them to realize phase estimation circuit, what we want to realize is the following circuit:</p><p><img src="assets/phaseest.png" alt="phase estimation"/></p><p>First we call Hadamard gates repeatly on first <code>n</code> qubits.</p><pre><code class="language-julia hljs">Hadamards(n) = repeat(H, 1:n)</code></pre><pre><code class="nohighlight hljs">Hadamards (generic function with 1 method)</code></pre><p>Then in dashed box <code>B</code>, we have controlled unitaries:</p><pre><code class="language-julia hljs">ControlU(n, m, U) = chain(n+m, control(k, n+1:n+m=&gt;matblock(U^(2^(k-1)))) for k in 1:n)</code></pre><pre><code class="nohighlight hljs">ControlU (generic function with 1 method)</code></pre><p>each of them is a <code>U</code> of power <span>$2^{(k-1)}$</span>.</p><p>Since we will only apply the qft and Hadamard on first <code>n</code> qubits, we could use <code>Subroutine</code>, which creates a context of a sub-scope of the qubits.</p><pre><code class="language-julia hljs">PE(n, m, U) =
    chain(n+m, # total number of the qubits
        subroutine(Hadamards(n), 1:n), # apply H in local scope
        ControlU(n, m, U),
        subroutine(QFT(n)&#39;, 1:n))</code></pre><pre><code class="nohighlight hljs">PE (generic function with 1 method)</code></pre><p>we use the first <code>n</code> qubits as the output space to store phase <span>$ϕ$</span>, and the other <code>m</code> qubits as the input state which corresponds to an eigenvector of oracle matrix <code>U</code>.</p><p>The subroutine here uses <code>focus!</code> and <code>relax!</code> to manage a local scope of quantum circuit, and only activate the first <code>n</code> qubits while applying the block inside the subroutine context, and the scope will be <code>relax!</code>ed back, after the context. This is equivalent to manually <code>focus!</code> then <code>relax!</code></p><p>fullly activated</p><pre><code class="language-julia hljs">r = rand_state(5)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 5/5
    nlevel: 2</code></pre><p>first 3 qubits activated</p><pre><code class="language-julia hljs">focus!(r, 1:3)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 3/5
    nlevel: 2</code></pre><p>relax back to the original</p><pre><code class="language-julia hljs">relax!(r, 1:3)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 5/5
    nlevel: 2</code></pre><p>In this way, we will be able to apply small operator directly on the subset of the qubits.</p><p>Details about the algorithm can be found here: <a href="https://en.wikipedia.org/wiki/Quantum_phase_estimation_algorithm">Quantum Phase Estimation Algorithm</a></p><p>Now let&#39;s check the results of our phase estimation.</p><p>First we need to set up a unitary with known phase, we set the phase to be 0.75, which is <code>0.75 * 2^3 == 6 == 0b110</code> .</p><pre><code class="language-julia hljs">N, M = 3, 5
P = eigen(rand_unitary(1&lt;&lt;M)).vectors
θ = Int(0b110) / 1&lt;&lt;N
phases = rand(1&lt;&lt;M)
phases[0b010+1] = θ
U = P * Diagonal(exp.(2π * im * phases)) * P&#39;</code></pre><pre><code class="nohighlight hljs">32×32 Matrix{ComplexF64}:
     0.299359-0.179854im        0.13693-0.192618im     -0.0481329+0.0191285im    -0.171969+0.0284551im    -0.225413+0.00653344im   -0.0223596+0.0103587im     0.112373-0.132165im     0.0865263+0.184929im     -0.132208+0.160291im      0.176514-0.0318387im      0.152777-0.0156058im    -0.0360442+0.138076im     -0.206395-0.0679641im    -0.0500417-0.0141544im      0.108207+0.156858im         0.13896+0.0984197im      0.0903071-0.146091im    -0.0815254+0.0139986im     -0.151665+0.0139529im      0.15176-0.135159im    0.00688066+0.077221im       -0.108838+0.0790062im      0.162388-0.118303im   -0.00782998-0.0451158im     -0.0250413-0.369055im     -0.0024622+0.198765im      -0.0494035-0.0356102im     -0.0581715+0.0408325im     0.0325934-0.200535im    0.00728603+0.171098im      -0.04724+0.0354873im    -0.0670383-0.0163178im
     -0.21327-0.0889054im    -0.0339572+0.110381im     0.00969317+0.138753im     0.0890045-0.00713703im   -0.197569-0.106284im      -0.175763-0.105845im      -0.12379-0.0796211im  -0.00966511+0.17449im     -0.0790077+0.0311682im     -0.11555+0.0286461im    -0.0938979+0.067206im    -0.00931817-0.0550741im     0.139186+0.084519im      0.0150005+0.0853683im      0.194144+0.262238im      -0.0368458-0.0406056im       0.105766-0.12824im     0.00862226+0.0785955im      0.227243+0.227356im    -0.0471015+0.0293086im   -0.0818868+0.171174im       -0.221066+0.108897im    -0.00639167+0.140277im     0.0671012-0.0423202im       0.235504-0.0955697im     0.0464061+0.0102275im     -0.0926026-0.0559209im      0.0391716-0.118991im       -0.23614+0.137736im    -0.0441999-0.0569467im    -0.298744+0.121979im      -0.115833+0.158837im
    0.0465215+0.0418081im      0.155331-0.0984784im      0.158579+0.301009im    -0.0969871+0.0223844im    0.0609122+0.0142903im      0.245875-0.158515im      0.142869-0.132118im     0.0279487-0.0822138im    0.0441723-0.0596502im     0.107924+0.0837929im     0.0162419+0.0910308im    -0.0800684-0.0561604im    -0.057619+0.14761im       -0.199068+0.0627429im      0.169175+0.0331187im     -0.0852225-0.0301807im       0.120904+0.181115im     -0.155457-0.0358615im    0.00827228-0.152726im     -0.189974-0.033877im    -0.0557631+0.0843368im     0.00480058+0.162366im     -0.0221403+0.131014im    -0.0250735-0.217252im      -0.0947604+0.106129im      -0.101907-0.0480838im        0.13781+0.323066im        0.264627-0.136529im      -0.123197-0.0135073im     -0.11634+0.146221im    -0.0388747+0.106639im      0.0263369-0.0917741im
    0.0069298-0.216611im     -0.0224925+0.155803im     -0.0348212-0.0768728im     0.206564-0.29232im      0.0642849+0.155569im     -0.0912552+0.0626845im    0.0401852-0.0113749im     0.127111-0.0708724im    -0.220244-0.191776im    -0.0329293+0.0503586im     0.0802111-0.185424im      -0.236653+0.207475im      0.145701+0.0151309im      -0.16399+0.178298im      0.0154178-0.0478141im      -0.139928+0.0410741im      -0.144938-0.153964im    0.00452576-0.22923im      -0.0480132+0.153505im     0.0478718-0.0946899im    0.0446412+0.106999im        0.229859-0.0256188im      0.175477+0.0864633im     0.141413-0.0503559im     -0.0261056+0.0114972im     -0.170263-0.0955528im   -0.000136442+0.0553448im       0.149247-0.0106123im    -0.0795276-0.156554im    -0.0887491+0.0836645im    0.0189456-0.10467im      -0.0919838+0.069148im
    0.0809654+0.207061im     -0.0321078+0.171856im      -0.283601-0.0164322im   -0.0548025+0.112445im     0.0298495-0.0298435im     0.0310198+0.0234969im   -0.0487619+0.0639081im    0.0178811+0.070656im     -0.105052+0.0715478im    0.0830445+0.131264im     -0.0863049+0.125083im    -0.00130237+0.245777im     -0.111602+0.221858im      -0.178969+0.217062im       0.131605-0.328599im      0.00912856-0.246838im      -0.0251874-0.0170403im    0.0274161-0.0523105im    -0.0420606-0.0436621im     0.149381-0.155194im      0.029614+0.0164262im      -0.220899+0.0848118im    -0.0484999+0.0474742im    -0.169626+0.031166im      -0.0273929+0.0855714im     -0.230214-0.00504299im     0.0903811-0.220937im     -0.00177663+0.0529978im    -0.0523154+0.0573517im    0.0612806-0.140433im    -0.0243627+0.113427im      -0.205451-0.07507im
   -0.0574571+0.035351im      0.0268289-0.149287im      0.0633739-0.0552898im    -0.123186+0.130187im      0.204326+0.0879947im      0.340673-0.192459im     0.0183158-0.0617203im    -0.178155-0.0792614im    -0.224627+0.0866631im     -0.19661-0.139711im    -0.00275044+0.0303342im     -0.189348+0.135051im      0.201368-0.0261491im     0.0689585+0.0698229im   -0.00991828-0.0692095im      -0.128283+0.0685502im       0.018159-0.0633985im     0.228156+0.196376im      0.0680029-0.054981im     0.0428099-0.125691im    -0.0712972+0.124246im      -0.0785093+0.0533271im      0.169936+0.0593241im     0.158511+0.0874107im      -0.188838+0.00178086im    0.0422212-0.0259755im      -0.133882-0.000827765im   -0.0991526+0.210062im       0.167677+0.040136im    -0.0374659-0.00930632im   -0.285001-0.0293176im    -0.0219534-0.0411799im
     -0.16963-0.0491907im    0.00313994+0.138681im      0.0277883-0.0905251im     0.151335-0.125275im     -0.100851+0.046538im       0.206188+0.244891im      0.239114-0.123248im     -0.208393-0.0322983im    0.0901093-0.107337im     0.0307289+0.00285779im      0.24222+0.209982im        0.30096+0.0279903im   -0.0617034-0.145174im       0.130478+0.158693im     -0.0893939+0.0357419im       0.154221+0.0416885im      0.0343964-0.164055im     0.0175207+0.0922318im     -0.184021+0.0198227im    0.0804017-0.118053im   -0.00865923-0.0263195im      0.0159549+0.0807284im      0.125524+0.0385052im   -0.0266698+0.0150564im    -0.00169662+0.0349562im     0.0902627-0.249193im       0.0441731+0.0325371im       0.133439-0.0629625im    -0.0470231+0.117197im      0.123744-0.0111956im    -0.133736+0.188025im       -0.10799-0.209585im
    -0.149717+0.0614104im      0.155908+0.0458125im     -0.168354+0.167147im    -0.0829594+0.0206134im    -0.353247-0.240917im      0.0456378+0.0212316im    -0.180508+0.023464im      0.191805-0.0597953im    -0.144262-0.0679183im     0.022381-0.121924im      0.0160417+0.11185im       0.0701637-0.0674267im     0.213347-0.0683377im     -0.010562-0.06937im      -0.0029944-0.0409702im       0.110681+0.169264im        0.153592-0.113943im      0.279375-0.0358993im    -0.0628312+0.0411493im     0.110654+0.123303im     0.0299716-0.113767im       0.0278619+0.0178441im   -0.00291506-0.0270865im   0.00708049-0.125752im       -0.298305+0.186357im      -0.145511+0.067456im       0.0102427+0.177579im       0.0247451+0.0369327im    -0.0131167+0.0393979im    0.0792125+0.0667188im    0.0840639-0.220582im      -0.179343-0.0173609im
  -0.00975035+0.274345im      0.0333528+0.371419im       0.186833+0.0885151im     0.155523-0.166014im     0.0635682-0.0577598im    -0.0335885-0.165824im     -0.040655-0.293234im      0.130806-0.0438013im     0.159587-0.0152075im     0.107065-0.0286995im     -0.063578-0.0552126im      -0.03275+0.191926im     -0.275414-0.0293912im     0.0701674-0.0368503im    -0.0810817+0.00841004im     0.0524016+0.0547662im    -0.00818195-0.0280627im    0.0113911+0.0371039im    -0.0390658+0.0628339im     0.144878+0.0289089im    -0.277623+0.0952918im       0.179383+0.0716083im    -0.0624725-0.0128769im   -0.0644615+0.00771977im     -0.199604+0.00947058im    0.0889795+0.228285im      0.00932183-0.0254198im        -0.1713+0.126472im     -0.0682097+0.0587259im    -0.140292-0.00184895im   -0.168472-0.0611883im     0.0516866+0.00417109im
    -0.232746-0.0973117im     0.0526214-0.120366im     -0.0312541-0.198335im     0.0405015+0.00945434im   -0.118746-0.0360667im      0.039311-0.299751im    -0.0288015+0.150722im    -0.0138455-0.152407im      0.118627-0.0780793im     0.398704-0.0579638im     -0.106744-0.0839417im     0.0952907-0.0744543im     0.110842+0.0682695im     -0.142854-0.0809645im     -0.156417+0.114526im       -0.127224-0.129247im       -0.183977-0.0208831im   -0.0708929-0.230114im       0.033385-0.0565463im     0.203694+0.0901989im   -0.0364297-0.0171007im      -0.083345+0.167437im       0.228102-0.184041im    -0.0189307-0.000197316im    -0.063947-0.0466604im    -0.0785936-0.0135725im     -0.0475175-0.0850543im     -0.0424484-0.0539673im    -0.0156047+0.0476693im   -0.0717836-0.0391363im    -0.176335+0.0775517im     0.0985582-0.20356im
    -0.057699+0.147095im       0.107942-0.166912im     -0.0196358-0.116964im      0.176651+0.0394871im    0.0861078-0.0358349im   -0.00838032+0.0580942im    -0.130571+0.249061im    -0.0806466-0.160148im      0.102708-0.0860337im   -0.0962276+0.0130976im      0.357001-0.129698im      0.0272261-0.0498832im    -0.178481-0.110945im     -0.0778508+0.0536042im     0.0797313-0.000251011im   0.00190005+0.130791im      -0.0232068+0.288463im     0.0681536+0.186865im       -0.13131+0.172288im     0.0568579+0.129653im     0.0792325+0.0991133im      -0.169781+0.0598991im     0.0495054+0.0803847im    0.0325072+0.0758651im      -0.139724-0.065947im      -0.190521+0.223302im      -0.0494923-0.119373im        0.180536+0.0305871im      -0.25767+0.0207167im   -0.0706344+0.0522415im   -0.0455532+0.0317999im     0.0335192+0.142599im
   -0.0285726+0.147587im      -0.116621+0.00823146im     0.244284-0.0876167im   -0.0760936+0.0668627im    -0.125889+0.0651315im      0.150548+0.110854im    -0.0310894+0.0287386im    0.0143367+0.173044im    -0.0340558+0.144995im     -0.137416+0.0800944im     -0.173688-0.107437im       0.167738+0.036685im     -0.020008-0.0206048im     -0.107152+0.0757006im    -0.0310712+0.10883im        -0.122098+0.0841993im      -0.241518+0.109564im    -0.0376277-0.145163im        -0.1221+0.195996im    -0.0330146+0.129863im    -0.0449317+0.177279im      -0.0978605+0.122693im       0.080338+0.249116im      -0.14785+0.00057065im   -0.00659592+0.0942438im     0.0721198+0.0350895im      -0.273667+0.0470589im      -0.112582-0.0620026im     0.0497979-0.0154433im      0.04225+0.19968im        0.23384-0.108005im      -0.175646-0.253986im
     0.227277+0.0761123im    -0.0681622-0.11259im      -0.0876389+0.0692966im   -0.0152711+0.0868877im   -0.0186687+0.0964278im       0.15088+0.174503im     -0.112792-0.119804im      0.162939-0.0736674im     0.261513+0.100125im     0.0356979-0.00944099im   -0.0815658-0.0746411im     -0.111099+0.143143im      0.193344-0.0966681im      0.145572+0.117386im       0.103306+0.182201im     -0.00951141+0.0491592im      0.0730957+0.105878im      0.071063-0.105562im       0.100779-0.0338666im     0.149419+0.177347im     -0.285708+0.0315758im      0.0402132-0.183207im      0.0741894-0.161296im      0.171094+0.0813319im     -0.0446184+0.0379321im     0.0277881-0.119772im       0.0354779-0.26555im         0.243067-0.141984im     -0.0651307+0.0918701im   -0.0617456-0.0108819im     0.104726+0.14387im       -0.148604-0.0846868im
    -0.131783-0.149883im        0.12735+0.229004im     -0.0563212-0.0240864im     0.176917+0.104289im      0.029888+0.0729848im    -0.0730706+0.045752im     -0.113786-0.0193898im    -0.117796+0.167922im   -0.00105777+0.0871398im   -0.0104472-0.00668698im    0.0164384-0.21169im      -0.0679292-0.22144im      -0.083953+0.00830107im     0.260969+0.150352im       0.147451+0.114862im      -0.0437307-0.0267693im      0.0951974-0.0720779im    -0.106751-0.155192im      0.0317451-0.379875im    -0.0298948-0.0423258im    0.0717627+0.054235im       -0.146573-0.0872713im     0.0509788+0.0423944im    -0.147823+0.19448im        -0.183142+0.102375im     -0.0283692+0.17151im         0.047922-0.0217962im       0.207459+0.0476322im      0.178266+0.0377886im   -0.0477293+0.169345im    -0.0502556-0.176599im    -0.00796482-0.12409im
   -0.0512843-0.119621im      0.0138784+0.0197092im      0.136712-0.0307217im    -0.194002-0.0344741im    -0.228764-0.117216im      0.0605123+0.0212535im    -0.163801+0.0366686im    -0.141872-0.0765592im     0.123756+0.098145im     0.0597902+0.143869im     -0.0818342-0.0969259im    0.00607854-0.0606532im    -0.104181-0.10078im       0.0464005+0.159852im       0.232399-0.132728im       -0.148487+0.155152im      -0.0288125+0.0272099im     0.183781+0.107114im      0.0256455+0.0639796im    0.0945791-0.226394im     0.0856909-0.0658173im        0.21002+0.123866im      -0.215937-0.0562263im     0.096194+0.201112im        0.177133+0.0142197im     -0.046202-0.0100613im      0.0813171+0.0191668im     0.00883314-0.0948891im    -0.0108507-0.233013im     -0.297269-0.165926im    -0.0450997-0.0978434im      0.022232-0.222494im
     -0.12338+0.143669im      -0.146089-0.118285im     -0.0573122+0.0260912im    0.0596672-0.0126819im   -0.0268532-0.150383im      0.0622156-0.00417177im  -0.0336055+0.20516im       0.192029-0.148684im   0.000117496-0.0936295im     0.174185+0.00152428im    -0.134422+0.0630189im     -0.145716+0.108106im    -0.0743882-0.0993711im     0.0470168+0.174568im     -0.0500853+0.274663im        0.312772-0.1845im         0.0106998-0.0430028im     0.109867+0.189781im    -0.00289119-0.0144053im    -0.363314-0.17664im      0.0534767+0.174935im        0.148698-0.0133474im       0.12255+0.0545543im    -0.216613+0.0486107im      0.0441928-0.0459993im    -0.0362126-0.0158582im     -0.0998881-0.0901757im      0.0954292-0.0489249im      0.203621-0.0899411im   -0.0863053-0.00473218im   0.0214808-0.101371im      0.0115738-0.0090675im
     -0.14623+0.0600427im      0.115058-0.0188274im     -0.103956-0.186006im    -0.0116816-0.156711im     0.0428368+0.0405924im     0.0855339-0.0623369im   -0.0782926-0.051355im    -0.0728903-0.0137529im   0.00531039+0.183433im    -0.0132355+0.00665187im   0.00376879+0.156801im     -0.0874206+0.0440019im     0.147793-0.179326im     -0.0433627-0.111467im      0.0324441-0.0479944im     -0.0786806-0.153323im        0.401713+0.0659193im     0.034514-0.341689im      -0.179041+0.198624im     -0.133296-0.181462im    -0.0748526+0.120773im      -0.0281122+0.0859161im    -0.0926472-0.0785677im    -0.145315+0.22199im      -0.00655927-0.156619im       0.150789-0.0452382im      0.0537946+0.0111926im      0.0094899+0.0137327im     -0.173655+0.0796283im  -0.00296079+0.0797051im     0.194293-0.0907316im      0.175751+0.0341854im
  -0.00434545+0.0205814im     -0.306265-0.135765im      0.0256525+0.0469617im     -0.12199-0.201382im     0.0390854+0.116064im      -0.108419+0.141159im     -0.156791-0.235105im    -0.0519938-0.0152035im   -0.0328808-0.0385482im     0.236305-0.00195107im     0.210203+0.168047im      -0.178153+0.0899861im   -0.0561449+0.0743526im     0.0952706-0.275355im       -0.16532+0.0804354im     -0.0696106+0.192093im      -0.0542866+0.139341im      0.112246-0.114913im       0.169555-0.158725im    -0.0108963-0.0949517im     0.232262+0.0354034im      -0.161838+0.149285im    -0.00223287+0.0868079im    -0.116994+0.0606494im    -0.00315929+0.123291im       0.046491+0.0394876im     -0.0609318-0.0493162im      0.0700511-0.0597194im     -0.124502+0.0185403im    0.0287781-0.13677im     -0.0610378-0.155173im      -0.146356-0.042199im
    0.0967323-0.154206im       0.137639+0.161483im      0.0199023-0.0466924im   -0.0484061-0.0333919im     0.125728+0.0372769im     0.0173111-0.137281im     0.0101853+0.174584im       0.25955+0.0376128im   0.00663849-0.0617462im    -0.287715-0.111652im       0.159027+0.0563048im    -0.0987893+0.0285622im     0.023838-0.114597im      0.0734126-0.109601im     -0.0597597-0.0974666im     -0.0151381-0.0254071im      0.0762802+0.0983182im   -0.0010306+0.00702618im     0.229731+0.166807im    -0.0109597+0.0213736im    0.0354721-0.18618im        0.0333537+0.0453161im    -0.0678773-0.0644195im    -0.365182-0.136677im      -0.0225847-0.0832323im     0.0663796+0.0600234im      -0.118511-0.112176im        0.119207-0.204792im      0.0464995-0.0866154im   -0.0182545-0.0168215im    -0.164835+0.0902223im     -0.110633-0.379818im
   -0.0793792+0.0514667im     -0.106832-0.0139398im     -0.277281-0.156605im     -0.192033+0.0452419im   8.97143e-5-0.111804im     -0.0743845-0.0235175im   -0.0676369-0.0191669im   -0.0882391-0.298232im    0.00947727+0.0968065im   -0.0133003-0.0671965im      0.135972-0.0361451im    -0.0484201+0.00544848im  -0.0596903+0.159949im       0.376259+0.00801811im     0.107422-0.0355366im     -0.0276617-0.0208243im     -0.0178762-0.0431505im    -0.174913-0.0734099im    -0.0362785+0.0643331im      0.15604+0.0826565im    -0.257265-0.0621375im      0.0823651+0.220347im      0.0107899+0.329725im     -0.076547-0.256528im       0.0702145-0.0405292im     0.0994327-0.0844229im     -0.0487298+0.0474337im       0.114252+0.00796466im     0.137411-0.180553im   -0.00669709+0.0624654im    0.0563278-0.00874697im    0.0549398+0.118484im
   -0.0588187+0.057436im      0.0752724+0.198885im      -0.170606-0.00692235im  -0.0596923+0.18273im     -0.0224418+0.0628024im       0.13273+0.0458898im   -0.0907578-0.23039im     -0.0522456-0.151152im      0.166904-0.165569im     -0.121312+0.0760182im    -0.0592002+0.0804633im    -0.0847144-0.0608245im    -0.002085-0.0911335im     -0.184929+0.0762574im     -0.133944+0.196058im        -0.12322-0.0380429im      0.0566511-0.0580651im    0.0460392-0.0346963im     0.0786579+0.0152232im    0.0198707-0.0753763im     0.310281-0.0693699im    -0.00634819+0.0436354im     0.0940217+0.128427im      0.126326-0.0848785im     -0.0521264+0.0616608im      0.156494+0.248525im       0.0927653-0.200296im       -0.169375-0.16792im       0.0430208-0.300254im      0.113274+0.0933485im    0.0920385+0.195067im       0.118031+0.0811389im
   -0.0489129-0.0960004im     0.0600863+0.0348124im   -0.00209405+0.00205834im   -0.208874-0.178091im      0.142237+0.0348593im    -0.0476253+0.0962406im   -0.0238176+0.11686im     -0.0637779+0.169056im       0.17051+0.09185im       0.033821-0.0343926im      0.162059+0.0322112im    -0.0400653-0.0953299im     0.036952-0.0418523im    -0.0564065+0.147842im     -0.0833901-0.0177523im      0.0847848-0.256533im       0.0581239-0.0103218im      0.17056+0.0775815im      0.113699-0.224522im     0.0187142+0.134518im      -0.21092+0.211145im        0.178455+0.200609im     -0.0463568-0.0980196im     0.118031-0.0853999im       0.153704+0.176462im      -0.145389+0.079579im        -0.16311-0.0566177im      -0.123869+0.0594806im     -0.195531-0.18075im        0.28354+0.185648im    -0.0196192-0.0846166im      0.020384-0.054282im
   -0.0154581-0.085364im      -0.140951-0.101535im      -0.121078+0.0128044im   -0.0895901-0.0755407im     0.108492+0.251362im    -0.00740001+0.124721im     -0.198513+0.21059im      0.0588394+0.180196im     0.0776641-0.0960558im    0.0528958+0.142364im     -0.0148759+0.15485im       0.0907124+0.0302248im    -0.113603+0.108524im      0.0588697+0.0901096im    -0.0554035+0.139954im       -0.300899+0.099752im         0.18778-0.111954im      0.116027+0.0481142im     -0.147132+0.139402im     0.0131223+0.0237731im    -0.211141-0.045448im      -0.0313177-0.169303im      0.0717839-0.0697427im    -0.201926-0.0150906im     -0.0922326+0.146826im     -0.0974115+0.0819862im      0.0460822+0.265793im       -0.160425-0.0673984im      0.126733-0.0650803im    -0.119751-0.016749im     -0.149873+0.173223im          0.116+0.0976845im
    -0.231677+0.00688556im  0.000632823+0.0131973im      0.190715+0.0775899im   -0.0715189+0.134841im     0.0788965-0.0175303im     -0.148491-0.0511594im   -0.0350622+0.0487353im     0.143143+0.0829455im    -0.213786+0.0025472im    -0.116378-0.181137im     -0.0458258+0.241928im      0.0985713+0.00494796im   -0.373102+0.0858362im    -0.0373734+0.0293229im     -0.084441-0.0440637im      -0.041232+0.0108501im      0.0858692+0.0973116im    0.0638555-0.096208im      0.0716399-0.0297882im     0.182616-0.0927843im    -0.150521-0.000439052im    0.0829424-0.0322781im      0.278776+0.0126508im     0.253949+0.163044im      0.00354121-0.0798983im    -0.0182402-0.0165299im    -0.00188088-0.035357im        0.241094-0.223042im       0.044696-0.0461177im        0.144-0.136886im      0.184269-0.0501884im      0.148522-0.011993im
    -0.116191+0.0600065im    -0.0412654-0.117564im      0.0118973+0.0985721im     0.123753-0.0776828im     0.113531+0.122527im     0.00885064-0.0373275im    -0.154059-0.0424755im      0.01832-0.101001im      0.122211+0.115313im     -0.112097-0.00958101im   0.00403122+0.00588871im     0.035108+0.167601im     0.0449501+0.0880808im     0.0586682-0.113986im     -0.0430882+0.092121im           0.104-0.246597im        0.106372-0.14377im       -0.07667+0.135118im      0.0712349+0.045627im      0.219326-0.0651023im      0.16082-0.209187im      -0.0361894-0.0717379im      0.100337+0.0864385im     0.128691+0.0300873im       0.276811-0.0470571im     -0.176656+0.224366im       0.0142225+0.267484im      0.00563746+0.193477im      -0.057728+0.0758476im    -0.148334+0.133806im      0.220598+0.0260289im    -0.0860267-0.300392im
   -0.0702509-0.062888im    -0.00849822+0.0521014im     0.0565858-0.0739142im   -0.0428899+0.222467im     0.0146714-0.181047im     -0.0326013+0.144972im     0.0117803+0.0274656im    0.0207839+0.175156im     -0.123724+0.0165118im     0.249174+0.00442926im     0.192712+0.0463352im     -0.174459+0.0130854im   -0.0542799-0.247595im      0.0328311-0.0538934im     -0.025657-0.11028im        -0.103356-0.358139im      -0.0357945+0.0859789im    -0.132568+0.146294im      0.0792453+0.170444im     0.0893352-0.0145136im    0.0254316+0.039337im       -0.036059-0.0948599im      0.130846-0.0813245im     0.108201-0.10021im       -0.0691659+0.293388im       0.290614-0.0393739im      0.0332375+0.0986556im      -0.046161-0.0187781im    -0.0398714+0.0394685im    -0.319762+0.0831163im    0.0715011-0.0022531im     -0.113555+0.0633908im
 -0.000197648-0.214065im     -0.0426845-0.0522575im     -0.187713+0.0419037im   -0.0598254-0.240997im     -0.245276-0.123752im      0.0130717-0.121684im     0.0537494+0.0402992im     0.106316+0.0590143im     0.250659-0.0835746im    -0.310166-0.145271im       0.109344+0.0159418im    -0.0462943+0.118876im    -0.0683834-0.0189158im     0.0363954+0.0805049im     0.0803624-0.0630009im      0.0369886-0.00777674im     -0.142506+0.232671im    -0.0281759-0.076441im     -0.0195282-0.140358im     -0.157469-0.0662142im    -0.101564+0.0676573im      -0.147367-0.00695008im     0.289757+0.111797im     0.0685882+0.0305552im     0.00806419+0.0989662im     0.0823824+0.0558012im       0.261489+0.0339946im      -0.291951+0.0613993im   -0.00138865+0.120226im    -0.0778021-0.141528im     0.0808278-0.0280162im     0.0357232-0.0662668im
    -0.148325+0.0908605im      0.117243-0.0900794im      0.174712-0.231035im    -0.0653421-0.0468095im   -0.0298151+0.0101349im     0.0246886+0.0614052im     0.269846-0.0727995im   -0.0723945+0.170124im      0.251569-0.0892019im    0.0226724-0.170949im     -0.0470475-0.0272219im      0.103893+0.161349im     0.0737727+0.0405595im     -0.106843-0.0769838im      0.215341-0.0549687im     -0.0121829+0.0862575im       0.195213-0.176349im    -0.0614306-0.0152193im      0.205473+0.00925501im  -0.0647275+0.0120374im   -0.0205748-0.0836226im     -0.0464982-0.0704288im      0.137005+0.0174185im    -0.146838-0.103746im     -0.00147867+0.189613im     -0.0913227+0.125488im       -0.146671-0.123604im        0.152579+0.154577im      0.0223848-0.206325im     -0.127425-0.265693im       0.13757-0.0646906im    -0.0272461+0.184736im
     -0.14864-0.0512209im    -0.0808285+0.124754im      0.0092178+0.00802067im  -0.0505657+0.0304366im    -0.190652-0.105735im      0.0639037-0.0907856im   -0.0244852-0.114842im    -0.0718496-0.0607832im     0.167785-0.00012438im   0.0547553+0.180866im       0.253419+0.130916im       -0.28226+0.0273344im    0.0260725+0.168087im       -0.17798+0.0350953im      0.079624-0.150033im       0.0191868+0.115834im       -0.132121+0.0624579im   -0.0581134+0.00168174im  -0.00953905+0.105593im    -0.0498728-0.0503162im    -0.114895-0.0852942im      0.0109894-0.29289im      0.00770236-0.181505im    -0.0229724+0.119592im        0.144805+0.0154123im   0.000692893+0.151582im       -0.335636+0.0684729im       0.125155+0.0298513im      0.234783+0.156729im      0.213253+0.164465im    0.00111789+0.0681796im     0.0801467+0.0189801im
  -0.00909357-0.161495im       0.321947-0.0130976im     -0.142871-0.0508088im    0.0174041+0.294462im      0.180903+0.0902828im     -0.174444+0.155258im      0.131625-0.10803im      -0.175102-0.0211423im    0.0960177-0.0765023im   -0.0176198-0.00544635im   -0.0748338+0.127026im     -0.0788748+0.23222im     -0.0670342+0.0683552im   -0.00885176-0.0743972im     0.0877611+0.153736im       0.0859483+0.0310914im      -0.213201+0.00648089im    0.245005-0.045041im     -0.0182681+0.16492im     -0.0880236+0.10503im      -0.052194+0.0118174im      0.0439759+0.257453im     -0.0443732-0.1177im      -0.0110759-0.0314759im       0.112683+0.0364646im     -0.082251+0.0740451im      0.0898432+0.0883478im       -0.02392-0.140376im       0.151925+0.265084im    -0.0770963-0.0118423im     0.037286-0.214711im     0.00961606-0.0374398im
    0.0856062-0.0716195im    -0.0530453-0.0120127im       0.16524-0.10227im      0.0763636+0.0265518im    -0.147037-0.205634im       0.219792+0.259297im     -0.195244+0.0566788im    -0.190496-0.0356969im   -0.0797691-0.156238im      -0.16996-0.0635575im     -0.174287+0.0840493im     -0.241137+0.0233184im    -0.151564+0.0396509im      0.115716+0.0136922im     -0.225646-0.0509294im    -0.00939202-0.0147409im   -0.000554971-0.105096im     -0.221275-0.114644im       0.159109+0.0255972im    -0.133404+0.12423im     -0.0881679+0.0358015im     -0.0180972+0.228955im     -0.0169213-0.268224im    -0.0157568+0.0392219im     -0.0419696-0.104001im      -0.149722+0.111228im        0.108179+0.131968im       0.0598668+0.167373im     -0.0528933-0.0459625im    0.0497152-0.0562913im     0.055201+0.170541im     -0.0925661+0.0516447im
    0.0908625-0.0704432im    -0.0596619+0.039758im      -0.130726-0.20426im       0.147104+0.0981055im   -0.0883497+0.101261im     0.00629497+0.0880712im   -0.0384603-0.0834591im     0.135265-0.158748im     -0.267462-0.0138075im     0.147765+0.0800551im    -0.0181502-0.0667538im      0.168101-0.0291145im   -0.0266046-0.187337im      -0.024144-0.266053im       0.183852-0.0564141im      -0.146936+0.00461266im      0.109452+0.05084im     -0.0414757+0.0986914im     0.0439604-0.0382143im    -0.303149-0.0644712im    -0.234313+0.0512744im        0.11383+0.0294771im     0.0537258+0.110865im      0.168599-0.0536837im       0.110828+0.140016im     -0.0779258+0.293497im      -0.0243346-0.0112046im    -0.00118258+0.0771691im    0.00764697+0.0760333im     0.196435-0.157411im     -0.044711+0.10379im       0.0484457-0.236069im</code></pre><p>and then generate the state <span>$ψ$</span></p><pre><code class="language-julia hljs">psi = P[:, 3]</code></pre><pre><code class="nohighlight hljs">32-element Vector{ComplexF64}:
   0.15396001574511897 - 0.2386617670169703im
  -0.05736135423967542 - 0.1755603039470496im
  -0.04281114741604746 - 0.02515210254942166im
   0.10563433837719194 - 0.11510884494305694im
   -0.2881462038372268 - 0.08596786366555095im
   0.07478640520289859 - 0.025635627119038374im
    0.1673029079449938 - 0.07157321754965926im
  -0.07801570481497705 + 0.03667197024346604im
   0.19854269041961056 - 0.01758496058988958im
  -0.09696501617486392 + 0.048958302669483866im
   0.03363356965772067 + 0.011771207053638068im
    0.0126764741127103 + 0.10373001925340401im
   0.31356555936344555 + 0.0im
 -0.026473178940176874 + 0.07533932611320239im
   -0.1302017654044755 + 0.10544939489421529im
  -0.26981743831220156 - 0.1414562451915543im
  -0.11180635911375425 - 0.07183834009857851im
  -0.03979298761833269 - 0.013066024342154401im
   0.08854006621060961 + 0.11211027968157367im
  -0.23925251879465043 - 0.1317707324475464im
   0.08815112189385545 + 0.2510876835371082im
   0.11019403972355712 - 0.04023121691647758im
  -0.04062837276135703 - 0.07443603933461275im
 -0.042889830319516875 - 0.24563252399588806im
 -0.010555047377533221 - 0.056925878576435815im
  -0.08720872209242755 - 0.22147535872998175im
   0.06957387209151045 + 0.07815678958556399im
  -0.09176260719749092 + 0.03588431769677957im
 -0.007485878962432163 + 0.11129266921304im
  0.024909007604022287 - 0.08460625406376576im
  -0.08157566468742528 + 0.03264813958962187im
   0.17114369889952227 + 0.15989691164403325im</code></pre><p>In the phase estimation process, we will feed the state to circuit and measure the first <code>n</code> qubits processed by iQFT.</p><pre><code class="language-julia hljs">r = join(ArrayReg(psi), zero_state(N))
r |&gt; PE(N, M, U)</code></pre><pre><code class="nohighlight hljs">ArrayReg{2, ComplexF64, Array...}
    active qubits: 8/8
    nlevel: 2</code></pre><p>Since our phase can be represented by 3 qubits precisely, we only need to measure once</p><pre><code class="language-julia hljs">results = measure(r, 1:N; nshots=1)</code></pre><pre><code class="nohighlight hljs">1-element Vector{DitStr{2, 3, Int64}}:
 011 ₍₂₎</code></pre><p>Recall that our QFT&#39;s bit numbering is reversed, let&#39;s reverse it back</p><pre><code class="language-julia hljs">using BitBasis
estimated_phase = bfloat(results[]; nbits=N)</code></pre><pre><code class="nohighlight hljs">0.75</code></pre><p>the phase is exactly <code>0.75</code>!</p><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../1.prepare-ghz-state/index.html">« Prepare Greenberger–Horne–Zeilinger state with Quantum Circuit</a><a class="docs-footer-nextpage" href="../3.grover-search/index.html">Grover Search »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.4.1 on <span class="colophon-date" title="Friday 3 May 2024 00:20">Friday 3 May 2024</span>. Using Julia version 1.10.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
